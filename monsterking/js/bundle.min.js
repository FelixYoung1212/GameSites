!function(){"use strict";var e;!function(e){e.unknown="unknown",e.qq="qq",e.wechat="wx",e.tt="tt",e.oppo="oppo",e.vivo="vivo",e.editor="editor"}(e||(e={}));class t{constructor(){this.platform=e.unknown,this.adUnitId_Config={wx:{bannerId:"adunit-2c3bea2049669dd4",videoId:"adunit-81ee7f692642c6f7",interstitialId:"adunit-80bef9d79c40c427"},qq:{bannerId:null,videoId:null,appBoxId:null},tt:{bannerId:null,videoId:null},oppo:{appId:"30428233",nativeId:["268289","268290","268291"],videoId:"266266",bannerId:"266262",interstitialId:"266259",boxId:"273514"},vivo:{appId:"100012178",nativeId:["c19765a97fef4481b9eaffd06d033fd4"],videoId:"081915e69c89445698fa91eb33a14442",bannerId:"0b2a4a8ed49d4b63897237331c9c5e19",interstitialId:"72e488c74a584e028551f6c8ecd6dc55"}},this.recommendConfig=[{name:"我冲的贼快",appId:"30444933",pkgName:"com.wcdzk.xxtch.nearme.gamecenter"},{name:"兽王争霸",appId:"30428233",pkgName:"com.monsterking.xxtch.nearme.gamecenter"},{name:"撞飞糖豆人",appId:"30439515",pkgName:"com.zftdr.xxtch.nearme.gamecenter"},{name:"音速少女",appId:"30348185",pkgName:"com.speedgirl.xxtch.nearme.gamecenter"},{name:"肥仔大冲撞",appId:"30439517",pkgName:"com.fzdcz.xxtch.nearme.gamecenter"},{name:"剁手狂欢",appId:"30439516",pkgName:"com.xx.cutmyhand.nearme.gamecenter"}],this.adUnitId_Banner=null,this.adUnitId_Video=null,this.adUnitId_AppBox=null,this.adUnitId_Interstitial=null,this.adUnitId_Native=null,this.adUnitId_OppoBox=null,this.rewardedVideoAd=null,this.bannerAd=null,this.interstitialAd=null,this.appBox=null,this.nativeAd=[],this.nativeAdData=[],this.showAdList=[],this.boxAdSelf=null,this.boxAdOfficial=null,this.banner_Width=300,this.banner_Height=120,this.margin_Bottom=0,this.nativeLoadTime=0,this.video_OnLoad_Callback=null,this.video_OnClose_Callback=null,this.native_OnLoad_Callback=null,this.adList=[],this.isCheat=0,this.isShowNative=0,this.exchangeTime=0,this.delayTime=0,this.defaultOpen=0,this.oppoLimit=0,this.oppoShowBanner=0,this.boxTimeLimit=4,this.boxType=0,this.isOfficial=1,this.freeTry=0,this.showVideoEventId=0}static get Instance(){return null==this._instance&&(this._instance=new t),window.AllPlatformAdMgr=this._instance,this._instance}getPlatform(){if(window.wx)this.platform=e.wechat,window.tt&&(this.platform=e.tt);else if(window.qq)this.platform=e.qq;else if(window.qg){let t=qg.getSystemInfoSync();"OPPO"==t.brand?this.platform=e.oppo:"vivo"==t.brand&&(this.platform=e.vivo)}else this.platform=e.editor}init(){switch(this.getPlatform(),this.platform){case e.wechat:this.adUnitId_Video=this.adUnitId_Config.wx.videoId,this.adUnitId_Banner=this.adUnitId_Config.wx.bannerId,this.adUnitId_Interstitial=this.adUnitId_Config.wx.interstitialId,this.initVideoAd(),this.initBannerAd(),this.initInterstitialAd();break;case e.qq:this.adUnitId_Video=this.adUnitId_Config.qq.videoId,this.adUnitId_Banner=this.adUnitId_Config.qq.bannerId,this.adUnitId_AppBox=this.adUnitId_Config.qq.appBoxId;break;case e.tt:this.adUnitId_Video=this.adUnitId_Config.tt.videoId,this.adUnitId_Banner=this.adUnitId_Config.tt.bannerId;break;case e.oppo:this.adUnitId_Video=this.adUnitId_Config.oppo.videoId,this.adUnitId_Interstitial=this.adUnitId_Config.oppo.interstitialId,this.adUnitId_Native=this.adUnitId_Config.oppo.nativeId,this.adUnitId_Banner=this.adUnitId_Config.oppo.bannerId,this.adUnitId_OppoBox=this.adUnitId_Config.oppo.boxId,this.initVideoAd(),this.initBannerAd(),this.initNativeAd(),this.initBox();break;case e.vivo:this.adUnitId_Video=this.adUnitId_Config.vivo.videoId,this.adUnitId_Interstitial=this.adUnitId_Config.vivo.interstitialId,this.adUnitId_Native=this.adUnitId_Config.vivo.nativeId,this.adUnitId_Banner=this.adUnitId_Config.vivo.bannerId,this.initVideoAd(),this.initBannerAd(),this.initNativeAd()}}getCheatState(){Laya.loader.load(`https://cdn.xxtch.com/monster/adconfig.json?ran=${Math.floor(1e6*Math.random())}`,Laya.Handler.create(this,e=>{this.isCheat=e.isCheat,this.isShowNative=e.isShowNative,this.exchangeTime=e.exchangeTime,this.delayTime=e.delayTime,this.defaultOpen=e.defaultOpen,this.oppoLimit=e.oppoLimit,this.oppoShowBanner=e.oppoShowBanner,this.isOfficial=e.isOfficial,this.freeTry=e.freeTry?e.freeTry:0}))}initBox(){if(this.platform===e.oppo){Laya.timer.once(60*this.boxTimeLimit*1e3,this,()=>{this.boxTimeLimit=0}),this.boxAdSelf=new Laya.Image("ads/Ui_Commontuijian.png"),this.boxAdSelf.width=Laya.stage.width,this.boxAdSelf.height=275;for(let e=0;e<this.recommendConfig.length;e++){let t=this.recommendConfig[e];if(t.appId==this.adUnitId_Config.oppo.appId){let i=new Laya.Image("ads/icon"+t.appId+".png");i.anchorY=.5,i.y=168,i.width=i.height=128,i.x=52+148*e,i.on(Laya.Event.CLICK,this,()=>{qg.navigateToMiniGame({pkgName:t.pkgName})}),this.boxAdSelf.addChild(i)}}qg.getSystemInfoSync().platformVersionCode>=1076&&(this.boxAdOfficial=qg.createGameBannerAd({adUnitId:this.adUnitId_OppoBox}),this.boxAdOfficial.onError(e=>{console.error(e)}),this.boxAdOfficial.onLoad(e=>{console.log(e)}))}}showBox(){(this.boxAdSelf||this.boxAdOfficial)&&(this.isOfficial&&this.boxAdOfficial?this.boxAdOfficial.show():(this.boxAdSelf.x=0,this.boxAdSelf.y=Laya.stage.height-this.boxAdSelf.height,Laya.stage.addChild(this.boxAdSelf)))}hideBox(){(this.boxAdSelf||this.boxAdOfficial)&&(this.isOfficial&&this.boxAdOfficial?this.boxAdOfficial.hide():Laya.stage.removeChild(this.boxAdSelf))}initBannerAd(){if(this.platform===e.wechat){let e=this.bannerAd;e&&e.destory();let t=wx.getSystemInfoSync(),i=(t.screenWidth-this.banner_Width)/2,a=t.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=wx.createBannerAd({adUnitId:this.adUnitId_Banner,adIntervals:30,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(e=this.bannerAd).onError(e=>{console.log(e)}),e.onResize(i=>{this.banner_Height=i.height,e.style.top=t.screenHeight-this.banner_Height-this.margin_Bottom})}else if(this.platform===e.qq){let e=qq.getSystemInfoSync();e.screenWidth,this.banner_Width,e.screenHeight,this.banner_Height,this.margin_Bottom,this.bannerAd=qq.createBannerAd({adUnitId:this.adUnitId_Banner,style:{left:1,top:1,width:this.banner_Width,height:this.banner_Height}})}else if(this.platform===e.tt){this.banner_Width=208;let e=tt.getSystemInfoSync(),t=(e.screenWidth-this.banner_Width)/2,i=e.screenHeight-this.banner_Height-this.margin_Bottom,a=this.bannerAd;a&&a.destory(),this.bannerAd=tt.createBannerAd({adUnitId:this.adUnitId_Banner,adIntervals:30,style:{left:t,top:i,width:this.banner_Width}}),(a=this.bannerAd).onError(e=>{console.log(e)}),a.onResize(t=>{this.banner_Height=t.height,a.style.top=e.screenHeight-this.banner_Height-this.margin_Bottom})}else if(this.platform===e.oppo){let e=this.bannerAd;if(e)return;let t=qg.getSystemInfoSync();this.banner_Width=t.screenWidth;let i=(t.screenWidth-this.banner_Width)/2,a=t.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=qg.createBannerAd({adUnitId:this.adUnitId_Banner,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(e=this.bannerAd).onError(e=>{console.error(e)}),e.onResize(i=>{this.banner_Height=i.height,this.banner_Width=i.width,e.style.top=t.screenHeight-this.banner_Height-this.margin_Bottom,e.style.width=i.width,e.style.left=(t.screenWidth-i.width)/2})}else if(this.platform===e.vivo){let e=this.bannerAd;if(e)return;let t=qg.getSystemInfoSync();this.banner_Width=t.screenWidth;let i=(t.screenWidth-this.banner_Width)/2,a=t.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=qg.createBannerAd({posId:this.adUnitId_Banner,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(e=this.bannerAd).onError(e=>{console.error(e)}),e.onResize(i=>{this.banner_Height=i.height,this.banner_Width=i.width,e.style.top=t.screenHeight-this.banner_Height-this.margin_Bottom,e.style.width=i.width,e.style.left=(t.screenWidth-i.width)/2})}}initVideoAd(){if(this.adUnitId_Video)switch(this.platform){case e.wechat:this.rewardedVideoAd=wx.createRewardedVideoAd({adUnitId:this.adUnitId_Video});let t=this.rewardedVideoAd;t.onError(e=>{console.log(e)}),t.onClose(e=>{e.isEnded?(this.video_OnClose_Callback&&this.video_OnClose_Callback(),this.showVideoEventId&&(mpsdk.Report.reportEvent(this.showVideoEventId,"0"),this.showVideoEventId=0)):this.showVideoEventId&&(mpsdk.Report.reportEvent(this.showVideoEventId,"1"),this.showVideoEventId=0)});break;case e.qq:this.rewardedVideoAd=qq.createRewardedVideoAd({adUnitId:this.adUnitId_Video}),this.rewardedVideoAd.onError(e=>{console.log(e)});break;case e.tt:this.rewardedVideoAd=tt.createRewardedVideoAd({adUnitId:this.adUnitId_Video}),this.rewardedVideoAd.onError(e=>{console.log(e)});break;case e.oppo:this.rewardedVideoAd=qg.createRewardedVideoAd({adUnitId:this.adUnitId_Video});let i=this.rewardedVideoAd;i.onError(e=>{console.error(e),qg.showToast({title:"视频广告加载失败",icon:"none"})}),i.onClose(e=>{e.isEnded&&this.video_OnClose_Callback&&this.video_OnClose_Callback()}),i.onLoad(()=>{i.show()});break;case e.vivo:this.rewardedVideoAd=qg.createRewardedVideoAd({posId:this.adUnitId_Video});let a=this.rewardedVideoAd;a.onError(e=>{console.error(e),qg.showToast({title:"视频广告加载失败",icon:"none"})}),a.onClose(e=>{a.load(),e.isEnded&&this.video_OnClose_Callback&&this.video_OnClose_Callback()}),a.onLoad(()=>{})}}initAppBox(){this.adUnitId_AppBox&&(this.appBox=qq.createAppBox({adUnitId:this.adUnitId_AppBox}))}initInterstitialAd(){if(this.adUnitId_Interstitial)switch(this.platform){case e.wechat:this.interstitialAd=wx.createInterstitialAd({adUnitId:this.adUnitId_Interstitial}),this.interstitialAd.onError(e=>{console.log(e)});break;case e.oppo:this.interstitialAd=qg.createInsertAd({adUnitId:this.adUnitId_Interstitial});let t=this.interstitialAd;t.onError(e=>{console.error("oppo插屏广告加载失败",e)}),t.onLoad(()=>{console.log("oppo插屏广告加载成功")})}}initNativeAd(){if(this.adUnitId_Native&&(this.platform==e.oppo||this.platform==e.vivo)){if(this.nativeAd.length>0){for(let e=0;e<this.nativeAd.length;e++)this.nativeAd.shift().destroy();this.nativeAdData=[],this.showAdList=[]}if(this.platform==e.oppo)for(let e=0;e<this.adUnitId_Native.length;e++){let t=qg.createNativeAd({adUnitId:this.adUnitId_Native[e]});this.nativeAd.push(t),this.nativeAdData.push([]),this.showAdList.push([]),this.loadNativeAd(e)}else if(this.platform==e.vivo)for(let e=0;e<this.adUnitId_Native.length;e++){let t=qg.createNativeAd({posId:this.adUnitId_Native[e]});this.nativeAd.push(t),this.nativeAdData.push([]),this.showAdList.push([]),this.loadNativeAd(e)}}}loadNativeAd(t){return new Promise(i=>{let a=this.nativeAd[t],s=this.nativeAdData[t],n=e=>{console.error("oppo原生广告出错"+t,e),a.offError(n),a.offLoad(r),i()},r=e=>{console.log("oppo原生广告加载成功"+t,e),this.nativeLoadTime++,2==this.nativeLoadTime&&Laya.timer.once(6e4,this,()=>{this.nativeLoadTime=0});for(let t=0;t<e.adList.length;t++){let i=e.adList[t];if(s.length>0)for(let e=0;e<s.length;e++)s[e].adId!=i.adId&&s.push(i);else s.push(i)}a.offError(n),a.offLoad(r),i()};a.onError(n),a.onLoad(r),s.length>0?(i(),this.platform==e.oppo&&this.oppoLimit?this.nativeLoadTime<2&&a.load():s.length<3&&a.load()):this.platform==e.oppo&&this.oppoLimit?this.nativeLoadTime<2&&a.load():a.load()})}showNativeAd(t,i){this.platform!=e.editor&&(this.platform==e.vivo&&(t=0),this.loadNativeAd(t).then(()=>{let e=this.nativeAdData[t],a=this.showAdList[t];for(let s=0;s<e.length;s++){let n=e[e.length-1-s];if(-1==a.indexOf(n))return i&&i(n),a.push(n),void this.reportNativeAdShow(t,n)}}))}hideNativeAd(t,i){this.platform==e.vivo&&(t=0);let a=this.showAdList[t],s=a.indexOf(i);console.log("hideNativeAd",s),-1!=s&&a.splice(s,1)}reportNativeAdClick(t,i){this.platform==e.vivo&&(t=0);let a=this.showAdList[t],s=this.nativeAdData[t],n=a.indexOf(i),r=s.indexOf(i);console.log("reportNativeAdClick",n,r),-1!=n&&a.splice(n,1),-1!=r&&s.splice(r,1),this.nativeAd[t].reportAdClick({adId:i.adId})}reportNativeAdShow(t,i){this.platform==e.vivo&&(t=0),this.nativeAd[t].reportAdShow({adId:i.adId})}showBannerAd(){if(this.bannerAd||this.platform!=e.oppo||!this.oppoShowBanner)switch(this.platform){case e.wechat:case e.qq:case e.tt:case e.oppo:this.bannerAd.show();break;case e.vivo:this.bannerAd.show()}}showVideoAd(t){if(this.platform===e.editor)t&&t();else{if(!this.rewardedVideoAd)return;switch(this.video_OnClose_Callback=t,this.platform){case e.wechat:this.rewardedVideoAd.show().catch(e=>{console.log("微信视频播放失败原因",e),wx.showToast({icon:"none",title:"视频播放失败",duration:1500})});break;case e.qq:let i=this.rewardedVideoAd;t&&i.onClose(e=>{e.isEnded&&t&&t()}),i.show().catch(e=>{});break;case e.tt:let a=this.rewardedVideoAd;t&&a.onClose(e=>{e.isEnded&&t&&t()}),a.show().catch(e=>{});break;case e.oppo:this.rewardedVideoAd.load();break;case e.vivo:this.rewardedVideoAd.show()}}}showAppBox(t){t&&this.platform===e.editor&&t(),this.appBox&&(t&&this.appBox.onClose(t),this.appBox.show())}showInterstitialAd(t){if(t&&this.platform===e.editor&&t(),this.interstitialAd)switch(this.platform){case e.wechat:this.interstitialAd.show();break;case e.oppo:let i=this.interstitialAd;i.onClose(()=>{i.load(),t&&t()}),i.show()}}hideBannerAd(){if(this.bannerAd&&(this.platform!=e.oppo||!this.oppoShowBanner))switch(this.platform){case e.wechat:case e.qq:case e.tt:case e.oppo:this.bannerAd.hide();break;case e.vivo:this.bannerAd.hide()}}compareVersion(e,t){e=e.split(".");const i=Math.max(e.length,t.length);for(;e.length<i;)e.push("0");for(;t.length<i;)t.push("0");for(let a=0;a<i;a++){const i=parseInt(e[a]),s=parseInt(t[a]);if(i>s)return 1;if(i<s)return-1}return 0}}var i,a,s,n,r,o,l=Laya.View,h=Laya.Dialog,c=Laya.ClassUtils.regClass;!function(e){class t extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("addMoney")}}e.addMoneyUI=t,c("ui.addMoneyUI",t);class i extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("bigMap")}}e.bigMapUI=i,c("ui.bigMapUI",i);class a extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(a.uiView)}}a.uiView={type:"View",props:{width:223,height:33,autoDestroyAtClosed:!0},compId:2,child:[{type:"Image",props:{y:0,x:0,var:"bg",skin:"game/Ui_Progress.png"},compId:4,child:[{type:"Image",props:{y:3,x:3,width:217,var:"white",skin:"game/Ui_White.png",height:27,sizeGrid:"1,1,1,1"},compId:6},{type:"Image",props:{y:3,x:3,var:"bar",skin:"game/Ui_Progress1.png"},compId:5},{type:"Label",props:{var:"hpLabel",text:"1/1",fontSize:25,font:"ZooFont0",color:"#ffffff",centerY:11,centerX:12},compId:7}]}],loadList:["game/Ui_Progress.png","game/Ui_White.png","game/Ui_Progress1.png"],loadList3D:[]},e.bloodUI=a,c("ui.bloodUI",a);class s extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("buyConfirm")}}e.buyConfirmUI=s,c("ui.buyConfirmUI",s);class n extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("cardTip")}}e.cardTipUI=n,c("ui.cardTipUI",n);class r extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("compose")}}e.composeUI=r,c("ui.composeUI",r);class o extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("composeShow")}}e.composeShowUI=o,c("ui.composeShowUI",o);class d extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("count")}}e.countUI=d,c("ui.countUI",d);class p extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(p.uiView)}}p.uiView={type:"View",props:{width:100,runtime:"game/runtime/DivisionRuntime.ts",height:100},compId:2,child:[{type:"Image",props:{var:"icon",top:0,skin:"rank/Ui_level1.png",centerX:0},compId:3},{type:"Image",props:{var:"star1",skin:"rank/Ui_star.png",left:0,bottom:4},compId:6},{type:"Image",props:{var:"star2",skin:"rank/Ui_star.png",centerX:0,bottom:-6},compId:7},{type:"Image",props:{var:"star3",skin:"rank/Ui_star.png",right:2,bottom:4},compId:8},{type:"Image",props:{y:-29,x:12,visible:!1,var:"labelIcon",skin:"rank/Ui_duanwei2.png"},compId:9}],loadList:["rank/Ui_level1.png","rank/Ui_star.png","rank/Ui_duanwei2.png"],loadList3D:[]},e.divisionUI=p,c("ui.divisionUI",p);class g extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(g.uiView)}}g.uiView={type:"View",props:{width:720,runtime:"game/runtime/DivisionRewardRuntime.ts",isModal:!0,height:860,autoDestroyAtClosed:!0},compId:2,child:[{type:"Box",props:{y:12,x:19},compId:35,child:[{type:"Image",props:{y:128,x:19,var:"point1",skin:"rank/Ui_jindu3.png"},compId:5},{type:"Image",props:{y:128,x:58,var:"line1",skin:"rank/Ui_jindu4.png",sizeGrid:"13,27,18,24"},compId:6},{type:"Image",props:{y:128,x:120,var:"point2",skin:"rank/Ui_jindu3.png"},compId:7},{type:"Image",props:{y:128,x:157,var:"line2",skin:"rank/Ui_jindu4.png",sizeGrid:"13,27,18,24"},compId:8},{type:"Image",props:{y:128,x:223,var:"point3",skin:"rank/Ui_jindu3.png"},compId:9},{type:"Image",props:{y:128,x:263,var:"line3",skin:"rank/Ui_jindu4.png",sizeGrid:"13,27,18,24"},compId:10},{type:"Image",props:{y:128,x:324,var:"point4",skin:"rank/Ui_jindu3.png"},compId:11},{type:"Image",props:{y:128,x:364,var:"line4",skin:"rank/Ui_jindu4.png",sizeGrid:"13,27,18,24"},compId:12},{type:"Image",props:{y:128,x:424,var:"point5",skin:"rank/Ui_jindu3.png"},compId:13},{type:"Image",props:{y:128,x:463,var:"line5",skin:"rank/Ui_jindu4.png",sizeGrid:"13,27,18,24"},compId:14},{type:"Image",props:{y:128,x:525,var:"point6",skin:"rank/Ui_jindu3.png"},compId:15},{type:"Image",props:{y:128,x:564,var:"line6",skin:"rank/Ui_jindu4.png",sizeGrid:"13,27,18,24"},compId:16},{type:"Image",props:{y:128,x:627,var:"point7",skin:"rank/Ui_jindu3.png"},compId:17},{type:"Image",props:{y:72,x:1,var:"division1",skin:"rank/Ui_level1.png",scaleY:.7,scaleX:.7},compId:18},{type:"Image",props:{y:71,x:101,var:"division2",skin:"rank/Ui_level2.png",scaleY:.7,scaleX:.7},compId:19},{type:"Image",props:{y:71,x:204,var:"division3",skin:"rank/Ui_level3.png",scaleY:.7,scaleX:.7},compId:20},{type:"Image",props:{y:69,x:306,var:"division4",skin:"rank/Ui_level4.png",scaleY:.7,scaleX:.7},compId:22},{type:"Image",props:{y:69,x:406,var:"division5",skin:"rank/Ui_level5.png",scaleY:.7,scaleX:.7},compId:24},{type:"Image",props:{y:71,x:507,var:"division6",skin:"rank/Ui_level6.png",scaleY:.7,scaleX:.7},compId:25},{type:"Image",props:{y:70,x:607,var:"division7",skin:"rank/Ui_level4.png",scaleY:.7,scaleX:.7},compId:26},{type:"Image",props:{y:136,x:1,var:"box1",skin:"rank/Ui_box1.png"},compId:27},{type:"Image",props:{y:136,x:96,var:"box2",skin:"rank/Ui_box2.png"},compId:28},{type:"Image",props:{y:136,x:201,var:"box3",skin:"rank/Ui_box3.png"},compId:29},{type:"Image",props:{y:138,x:299,var:"box4",skin:"rank/Ui_box4.png"},compId:30},{type:"Image",props:{y:143,x:399,var:"box5",skin:"rank/Ui_box5.png"},compId:31},{type:"Image",props:{y:143,x:501,var:"box6",skin:"rank/Ui_box6.png"},compId:32},{type:"Image",props:{y:157,x:603.5,var:"box7",skin:"rank/Ui_box7.png",scaleY:.9,scaleX:.9},compId:33}]},{type:"Image",props:{y:481,x:41.5,skin:"rank/Ui_framejinagli.png"},compId:54,child:[{type:"Image",props:{y:223,x:83,skin:"rank/Ui_money.png",scaleY:.6,scaleX:.6},compId:55},{type:"Label",props:{y:236,x:177,var:"moneyAddLabel",text:"label",fontSize:30,color:"#ffffff",centerX:-110},compId:56},{type:"FightCell",props:{y:66,x:38,var:"fightCell1",scaleY:.5,scaleX:.5,runtime:"game/runtime/FightCellRuntime.ts"},compId:64},{type:"FightCell",props:{y:66,x:152,var:"fightCell2",scaleY:.5,scaleX:.5,runtime:"game/runtime/FightCellRuntime.ts"},compId:65},{type:"FightCell",props:{y:66,x:267,visible:!1,var:"fightCell3",scaleY:.5,scaleX:.5,runtime:"game/runtime/FightCellRuntime.ts"},compId:66},{type:"Button",props:{y:162,x:440,var:"receiveButton",stateNum:1,skin:"rank/Btn_receive.png"},compId:67},{type:"Image",props:{y:77,x:486,var:"curRewardBox",skin:"rank/Ui_box1.png"},compId:69}]},{type:"Image",props:{y:243,x:40,skin:"rank/Ui_frameduanwei2.png"},compId:34,child:[{type:"Image",props:{y:152,x:167,skin:"rank/Ui_duanweinext.png"},compId:70},{type:"Image",props:{y:153,x:400,skin:"rank/Ui_framewin.png"},compId:72,child:[{type:"Label",props:{var:"successNeedLabel",text:"label",fontSize:30,color:"#ffffff",centerY:0,centerX:0},compId:71}]},{type:"Image",props:{y:68,x:231,skin:"rank/Ui_duanweipaiming.png"},compId:37,child:[{type:"Label",props:{y:4.5,x:206,var:"rankNum",text:"label",fontSize:30,color:"#ffffff"},compId:39}]},{type:"Image",props:{y:11,x:230,skin:"rank/Ui_duizhanjifen.png"},compId:40,child:[{type:"Label",props:{y:4,x:189,var:"scoreLabel",text:"label",fontSize:30,color:"#fffdfd"},compId:41}]},{type:"division",props:{y:53,x:45,var:"divisionIcon",scaleY:1,scaleX:1,runtime:"game/runtime/DivisionRuntime.ts"},compId:52}]},{type:"Label",props:{y:813,x:227.5,text:"段位越高奖励越好哦",fontSize:30,color:"#ffffff"},compId:73},{type:"Label",props:{y:763,x:497.5,text:"每日可领取一次",fontSize:20,color:"#45699e"},compId:74}],loadList:["rank/Ui_jindu3.png","rank/Ui_jindu4.png","rank/Ui_level1.png","rank/Ui_level2.png","rank/Ui_level3.png","rank/Ui_level4.png","rank/Ui_level5.png","rank/Ui_level6.png","rank/Ui_box1.png","rank/Ui_box2.png","rank/Ui_box3.png","rank/Ui_box4.png","rank/Ui_box5.png","rank/Ui_box6.png","rank/Ui_box7.png","rank/Ui_framejinagli.png","rank/Ui_money.png","rank/Btn_receive.png","rank/Ui_frameduanwei2.png","rank/Ui_duanweinext.png","rank/Ui_framewin.png","rank/Ui_duanweipaiming.png","rank/Ui_duizhanjifen.png"],loadList3D:[]},e.divisionRewardUI=g,c("ui.divisionRewardUI",g);class u extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(u.uiView)}}u.uiView={type:"View",props:{y:-1,x:0,width:234,runtime:"game/runtime/FightCellRuntime.ts",pivotY:.5,pivotX:.5,height:400},compId:2,child:[{type:"Image",props:{visible:!1,var:"selectBg",skin:"card/selectBg.png",scaleY:1,scaleX:1,centerY:0,centerX:0,anchorY:.5,anchorX:.5},compId:24},{type:"Image",props:{var:"bg",skin:"card/Ui_CardBg1.png",gray:!1,centerY:-62,centerX:0,anchorY:.5,anchorX:.5,sizeGrid:"0,0,0,0"},compId:3,child:[{type:"Box",props:{y:0,width:193,height:238,centerX:0},compId:21,child:[{type:"Image",props:{y:41,x:51,var:"foot",skin:"part/Bear3.png",scaleY:1,scaleX:1,centerY:0,centerX:0},compId:15},{type:"Image",props:{y:43,x:52,var:"body",skin:"part/Bear2.png",scaleY:1,scaleX:1,centerY:0,centerX:0},compId:14},{type:"Image",props:{var:"foot1",skin:"part/Lion2.png",centerY:0,centerX:0},compId:23},{type:"Image",props:{y:43,x:52,var:"head",skin:"part/Bear1.png",scaleY:1,scaleX:1,centerY:0,centerX:0},compId:13},{type:"Image",props:{y:4,x:0,width:193,skin:"card/AnimalF.png",renderType:"mask",height:236},compId:22}]},{type:"Image",props:{width:189,var:"cardBlack",skin:"card/Ui_CardBlack1.png",height:71,centerX:0,bottom:5},compId:16,child:[{type:"List",props:{y:10,x:32,var:"propList",repeatY:2,repeatX:2},compId:10,child:[{type:"Box",props:{y:0,x:0,width:90,renderType:"render",height:35},compId:18,child:[{type:"Label",props:{y:0,x:0,text:"攻击力:44",name:"prop",fontSize:22,font:"ZooFont0",color:"#ffffff"},compId:11}]}]}]},{type:"Image",props:{var:"cardLight",skin:"card/Ui_Cardlight1.png",centerY:0,centerX:0},compId:28},{type:"Image",props:{y:-7,x:-7,visible:!0,var:"flagIcon",skin:"card/Ui_CardJiaoBiao1.png"},compId:17}]},{type:"Image",props:{y:16.5,x:18.5,width:197,var:"magicImage",skin:"card/Ui_Magic1.png",height:243},compId:29},{type:"Button",props:{y:305,x:10.5,visible:!1,var:"next",stateNum:1,skin:"card/next.png"},compId:25},{type:"Button",props:{y:305,x:10.5,visible:!1,var:"out",stateNum:1,skin:"card/out.png"},compId:27},{type:"Button",props:{y:226.5,x:10.5,visible:!1,var:"info",stateNum:1,skin:"card/info.png"},compId:26}],animations:[{nodes:[{target:24,keyframes:{scaleY:[{value:.9,tweenMethod:"backOut",tween:!0,target:24,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleY",index:5}],scaleX:[{value:.9,tweenMethod:"backOut",tween:!0,target:24,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleX",index:5}]}},{target:3,keyframes:{scaleY:[{value:.9,tweenMethod:"backOut",tween:!0,target:3,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:5}],scaleX:[{value:.9,tweenMethod:"backOut",tween:!0,target:3,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:5}]}}],name:"showBg",id:1,frameRate:24,action:0}],loadList:["card/selectBg.png","card/Ui_CardBg1.png","part/Bear3.png","part/Bear2.png","part/Lion2.png","part/Bear1.png","card/AnimalF.png","card/Ui_CardBlack1.png","card/Ui_Cardlight1.png","card/Ui_CardJiaoBiao1.png","card/Ui_Magic1.png","card/next.png","card/out.png","card/info.png"],loadList3D:[]},e.FightCellUI=u,c("ui.FightCellUI",u);class m extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("freeTry")}}e.freeTryUI=m,c("ui.freeTryUI",m);class y extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(y.uiView)}}y.uiView={type:"View",props:{width:150,runtime:"game/runtime/GameCellRuntime.ts",height:202},compId:2,child:[{type:"Image",props:{width:150,var:"bg",skin:"card/Ui_CardBg1.png",height:202,centerY:0,centerX:0,anchorY:.5,anchorX:.5,sizeGrid:"0,0,0,0"},compId:3,child:[{type:"Box",props:{y:0,x:0},compId:29,child:[{type:"Image",props:{y:0,x:0,var:"foot",skin:"part/Bear3.png",scaleY:.9,scaleX:.9},compId:30},{type:"Image",props:{y:0,x:0,var:"body",skin:"part/Bear2.png",scaleY:.9,scaleX:.9},compId:31},{type:"Image",props:{y:0,x:0,var:"foot1",skin:"part/Lion2.png",scaleY:.9,scaleX:.9},compId:35},{type:"Image",props:{y:0,x:0,var:"head",skin:"part/Bear1.png",scaleY:.9,scaleX:.9},compId:32},{type:"Image",props:{y:6,x:5,width:143,skin:"card/AnimalF.png",renderType:"mask",height:188},compId:33}]}]},{type:"Image",props:{y:101,x:75,width:150,visible:!1,var:"magicImage",skin:"card/Ui_Magic1.png",height:202,anchorY:.5,anchorX:.5},compId:34},{type:"Image",props:{width:148,var:"maskFrame",skin:"game/Ui_GameFrame1.png",height:200,centerY:0,centerX:0},compId:22,child:[{type:"Sprite",props:{y:0,x:0,width:150,var:"cardMask",renderType:"mask",height:202},compId:11}]},{type:"Image",props:{width:150,visible:!1,var:"lightFrame",skin:"game/Ui_CardFrame.png",height:202,centerY:0,centerX:0},compId:21},{type:"Image",props:{y:-8,x:-7,skin:"game/Ui_Store.png"},compId:4,child:[{type:"Label",props:{var:"costLabel",text:"1",fontSize:30,font:"ZooFont0",color:"#ffffff",centerY:7,centerX:5},compId:5}]}],animations:[{nodes:[{target:3,keyframes:{scaleY:[{value:1,tweenMethod:"sineIn",tween:!0,target:3,key:"scaleY",index:0},{value:1.2,tweenMethod:"sineOut",tween:!0,target:3,key:"scaleY",index:10},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:20}],scaleX:[{value:1,tweenMethod:"sineIn",tween:!0,target:3,key:"scaleX",index:0},{value:1.2,tweenMethod:"sineOut",tween:!0,target:3,key:"scaleX",index:10},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:20}]}}],name:"remind",id:1,frameRate:60,action:0},{nodes:[{target:34,keyframes:{scaleY:[{value:1,tweenMethod:"sineIn",tween:!0,target:34,key:"scaleY",index:0},{value:1.2,tweenMethod:"sineOut",tween:!0,target:34,key:"scaleY",index:10},{value:1,tweenMethod:"linearNone",tween:!0,target:34,key:"scaleY",index:20}],scaleX:[{value:1,tweenMethod:"sineIn",tween:!0,target:34,key:"scaleX",index:0},{value:1.2,tweenMethod:"sineOut",tween:!0,target:34,key:"scaleX",index:10},{value:1,tweenMethod:"linearNone",tween:!0,target:34,key:"scaleX",index:20}]}}],name:"remind1",id:2,frameRate:60,action:0}],loadList:["card/Ui_CardBg1.png","part/Bear3.png","part/Bear2.png","part/Lion2.png","part/Bear1.png","card/AnimalF.png","card/Ui_Magic1.png","game/Ui_GameFrame1.png","game/Ui_CardFrame.png","game/Ui_Store.png"],loadList3D:[]},e.gameCellUI=y,c("ui.gameCellUI",y);class f extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("gameLoad")}}e.gameLoadUI=f,c("ui.gameLoadUI",f);class v extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("gift")}}e.giftUI=v,c("ui.giftUI",v);class L extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(L.uiView)}}L.uiView={type:"View",props:{y:75,x:63,width:126,runtime:"game/runtime/GiftCellRuntime.ts",height:150,anchorY:.5,anchorX:.5},compId:2,child:[{type:"Image",props:{y:-7,x:-7,var:"selectLight",skin:"gift/Ui_FrameTianFu3.png"},compId:8},{type:"Image",props:{var:"bg",skin:"gift/Ui_FrameTianFu1.png"},compId:3,child:[{type:"Image",props:{x:5,var:"giftImage",skin:"gift/Ui_TianFuCommon1.png",centerY:-3,centerX:0},compId:4,child:[{type:"Image",props:{y:44,x:45,var:"timeLogo",skin:"gift/Ui_TianFuBattle17.png"},compId:9}]},{type:"Image",props:{y:101,x:84,var:"levelBg",skin:"gift/Ui_FrameTianFuLv.png"},compId:6,child:[{type:"Label",props:{var:"giftLevel",valign:"middle",text:"1",fontSize:20,color:"#ffffff",centerY:-6,centerX:-4,align:"center"},compId:7}]}]},{type:"Image",props:{y:5,x:5,var:"lockImage",skin:"gift/Ui_FrameTianFu4.png"},compId:11},{type:"Image",props:{y:15,x:88,var:"newLogo",skin:"gift/Ui_TianFuNew.png"},compId:10}],loadList:["gift/Ui_FrameTianFu3.png","gift/Ui_FrameTianFu1.png","gift/Ui_TianFuCommon1.png","gift/Ui_TianFuBattle17.png","gift/Ui_FrameTianFuLv.png","gift/Ui_FrameTianFu4.png","gift/Ui_TianFuNew.png"],loadList3D:[]},e.giftCellUI=L,c("ui.giftCellUI",L);class C extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(C.uiView)}}C.uiView={type:"View",props:{width:720,top:0,right:0,mouseEnabled:!1,left:0,height:1600,bottom:0},compId:2,child:[{type:"Image",props:{y:561,x:123,visible:!1,var:"talkBg",skin:"guide/Ui_talk.png"},compId:3,child:[{type:"Label",props:{wordWrap:!0,width:388,var:"talkLabel",valign:"middle",overflow:"scroll",leading:6,fontSize:40,font:"ZooFont2",color:"#ffffff",centerX:32,align:"left"},compId:4},{type:"Image",props:{y:116.5,x:0,var:"kawayi",skin:"guide/Ui_bear.png",rotation:0,anchorY:.5,anchorX:.5},compId:8}]},{type:"Image",props:{y:1048,x:191,visible:!1,var:"clickHand",skin:"guide/Ui_quan.png",anchorY:.5,anchorX:.5},compId:5,child:[{type:"Image",props:{y:52,x:52,width:105,visible:!1,skin:"guide/Ui_quan.png",height:105,anchorY:.5,anchorX:.5},compId:7},{type:"Image",props:{y:124,x:184,width:91,skin:"guide/Ui_hand.png",skewY:0,skewX:0,rotation:26,height:99,anchorY:1,anchorX:1},compId:6}]}],animations:[{nodes:[{target:6,keyframes:{y:[{value:124,tweenMethod:"sineIn",tween:!0,target:6,key:"y",index:0},{value:143,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:25},{value:143,tweenMethod:"sineOut",tween:!0,target:6,key:"y",index:35},{value:124,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:60}],x:[{value:184,tweenMethod:"sineIn",tween:!0,target:6,key:"x",index:0},{value:134,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:25},{value:134,tweenMethod:"sineOut",tween:!0,target:6,key:"x",index:35},{value:184,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:60}],rotation:[{value:26,tweenMethod:"sineIn",tween:!0,target:6,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:25},{value:0,tweenMethod:"sineOut",tween:!0,target:6,key:"rotation",index:35},{value:26,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:60}]}},{target:7,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:25},{value:!1,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:35},{value:!1,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:60}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleY",index:25},{value:1.5,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleY",index:35},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleY",index:60}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleX",index:25},{value:1.5,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleX",index:35},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleX",index:60}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:25},{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:35},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:60}]}}],name:"handClick",id:1,frameRate:60,action:0}],loadList:["guide/Ui_talk.png","guide/Ui_bear.png","guide/Ui_quan.png","guide/Ui_hand.png"],loadList3D:[]},e.guideUI=C,c("ui.guideUI",C);class S extends h{constructor(){super()}createChildren(){super.createChildren(),this.createView(S.uiView)}}S.uiView={type:"Dialog",props:{width:710,runtime:"game/runtime/HandBookRuntime.ts",isModal:!0,height:900,autoDestroyAtClosed:!0},compId:2,child:[{type:"Image",props:{y:79,x:21.5,skin:"handbook/ui-underframe.png"},compId:4,child:[{type:"Button",props:{y:807,x:543,stateNum:1,skin:"handbook/Btn-back.png",name:"close"},compId:9}]},{type:"Image",props:{y:0,x:0,skin:"handbook/ui-title.png"},compId:3},{type:"Sprite",props:{y:-147,x:0,texture:"handbook/图鉴-模板.png"},compId:5},{type:"List",props:{y:225,var:"cardList",spaceY:20,spaceX:90,repeatY:3,repeatX:3,centerX:0},compId:6,child:[{type:"handBookCell",props:{renderType:"render",runtime:"game/runtime/HandBookCellRuntime.ts"},compId:7}]},{type:"List",props:{y:80,x:62.5,var:"tabList",repeatY:1,repeatX:4},compId:10,child:[{type:"Box",props:{renderType:"render"},compId:11,child:[{type:"Image",props:{x:19,skin:"handbook/Btn-FeiLong1.png",name:"frame",centerY:3,centerX:0},compId:12},{type:"Image",props:{y:0,x:0,skin:"handbook/Btn-FeiLong3.png",name:"light"},compId:13}]}]}],loadList:["handbook/ui-underframe.png","handbook/Btn-back.png","handbook/ui-title.png","handbook/图鉴-模板.png","handbook/Btn-FeiLong1.png","handbook/Btn-FeiLong3.png"],loadList3D:[]},e.handBookUI=S,c("ui.handBookUI",S);class k extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(k.uiView)}}k.uiView={type:"View",props:{width:137,runtime:"game/runtime/HandBookCellRuntime.ts",height:171},compId:2,child:[{type:"Image",props:{skin:"handbook/ui-kuang1.png"},compId:3},{type:"Box",props:{width:137,height:171,centerY:0,centerX:0},compId:9,child:[{type:"Image",props:{y:4,x:3,var:"foot",skin:"part/Bear3.png",scaleY:.7,scaleX:.7,centerY:0,centerX:0},compId:5},{type:"Image",props:{y:4,x:3,var:"body",skin:"part/Bear2.png",scaleY:.7,scaleX:.7,centerY:0,centerX:0},compId:6},{type:"Image",props:{y:5,x:3,var:"foot1",skin:"part/Lion2.png",scaleY:.7,scaleX:.7,centerY:0,centerX:0},compId:7},{type:"Image",props:{y:4,x:3,var:"head",skin:"part/Bear1.png",scaleY:.7,scaleX:.7,centerY:0,centerX:0},compId:8},{type:"Sprite",props:{y:0,x:0,texture:"handbook/ui-kuang1.png",renderType:"mask"},compId:10}]},{type:"Image",props:{var:"newFlag",skin:"handbook/Btn_Newtip.png",centerY:-28,centerX:-13},compId:11}],loadList:["handbook/ui-kuang1.png","part/Bear3.png","part/Bear2.png","part/Lion2.png","part/Bear1.png","handbook/Btn_Newtip.png"],loadList3D:[]},e.handBookCellUI=k,c("ui.handBookCellUI",k);class b extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("handbookNewReward")}}e.handbookNewRewardUI=b,c("ui.handbookNewRewardUI",b);class w extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("load")}}e.loadUI=w,c("ui.loadUI",w);class I extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("lottery")}}e.lotteryUI=I,c("ui.lotteryUI",I);class _ extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("lotteryResult")}}e.lotteryResultUI=_,c("ui.lotteryResultUI",_);class x extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(x.uiView)}}x.uiView={type:"View",props:{width:201,top:0,runtime:"game/runtime/MagicCardRuntime.ts",height:250},compId:2,child:[{type:"Image",props:{width:201,var:"selectLight",skin:"card/Ui_FaShuKuang2.png",height:238,centerX:0,sizeGrid:"56,46,61,47"},compId:10},{type:"Image",props:{var:"magicImage",skin:"card/Ui_Magic2.png",centerY:-6,centerX:0},compId:6},{type:"Label",props:{var:"cardNum",text:"X1",scaleY:2,scaleX:2,fontSize:32,font:"Word",color:"#ffffff",centerX:0,bottom:0},compId:8},{type:"Image",props:{y:14,x:16,width:170,var:"lockImage",skin:"card/Ui_cardmengban.png",height:211},compId:11}],loadList:["card/Ui_FaShuKuang2.png","card/Ui_Magic2.png","card/Ui_cardmengban.png"],loadList3D:[]},e.magicCardUI=x,c("ui.magicCardUI",x);class T extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("main")}}e.mainUI=T,c("ui.mainUI",T);class P extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(P.uiView)}}P.uiView={type:"View",props:{width:100,runtime:"game/runtime/MapCellRuntime.ts",height:100},compId:2,child:[{type:"Image",props:{y:69,var:"shadow",skin:"map/Ui_Place2.png",skewX:0,centerX:0},compId:3},{type:"Image",props:{y:63,var:"light",skin:"map/Ui_Place3.png",centerX:0},compId:6},{type:"Image",props:{y:0,x:0,var:"whiteBase",skin:"map/Ui_Place4.png",skewY:0,centerX:0},compId:4},{type:"Image",props:{y:34,var:"balckBase",skin:"map/Ui_Place5.png",centerX:0},compId:5},{type:"Box",props:{y:94,width:90,var:"starBox",height:35,centerX:0},compId:7,child:[{type:"Image",props:{var:"star1",skin:"map/Ui_PlaceStar1.png",left:0},compId:8},{type:"Image",props:{var:"star2",skin:"map/Ui_PlaceStar1.png",centerX:0,bottom:0},compId:9},{type:"Image",props:{y:0,var:"star3",skin:"map/Ui_PlaceStar1.png",right:0},compId:10}]},{type:"Label",props:{y:10,var:"stageNum",text:"1",fontSize:32,font:"Word",color:"#ffffff",centerX:2},compId:11},{type:"Image",props:{y:-6.5,x:52,width:140,var:"rewardPop",skin:"map/Ui_FramePlaceTitle1.png",pivotY:97,pivotX:72,height:97},compId:13,child:[{type:"List",props:{y:18,var:"rewardPopList",spaceX:5,repeatY:1,repeatX:3,centerX:0},compId:14,child:[{type:"Box",props:{renderType:"render"},compId:15,child:[{type:"Image",props:{skin:"map/Ui_FramePlaceTitle2.png"},compId:16},{type:"Image",props:{skin:"main/Ui_Diamonds.png",scaleY:.7,scaleX:.7,name:"rewardImage",centerY:0,centerX:0},compId:17}]}]}]}],animations:[{nodes:[{target:6,keyframes:{alpha:[{value:1,tweenMethod:"sineIn",tween:!0,target:6,key:"alpha",index:0},{value:0,tweenMethod:"sineOut",tween:!0,target:6,key:"alpha",index:30},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:60}]}}],name:"breath",id:1,frameRate:60,action:0}],loadList:["map/Ui_Place2.png","map/Ui_Place3.png","map/Ui_Place4.png","map/Ui_Place5.png","map/Ui_PlaceStar1.png","map/Ui_FramePlaceTitle1.png","map/Ui_FramePlaceTitle2.png","main/Ui_Diamonds.png"],loadList3D:[]},e.mapCellUI=P,c("ui.mapCellUI",P);class B extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(B.uiView)}}B.uiView={type:"View",props:{y:443,x:296,width:592,skewY:0,skewX:0,runtime:"game/runtime/MapPageRuntime.ts",height:886,anchorY:.5,anchorX:.5},compId:2,child:[{type:"Image",props:{width:592,skin:"map/Ui_MapDi.png",height:886},compId:3},{type:"Box",props:{y:0,x:0,width:592,var:"contextBox",height:882},compId:4,child:[{type:"Image",props:{y:0,x:0,width:562,var:"mapImage",skin:"map/Ui_Map3.png",height:852,centerY:0,centerX:0},compId:5},{type:"Image",props:{y:0,x:0,skin:"map/Ui_MapRoad1.png",centerY:0,centerX:0},compId:6},{type:"Box",props:{y:0,x:0,width:605,var:"lineBox",height:887,centerY:0,centerX:0},compId:7,child:[{type:"Image",props:{y:489,x:354,skin:"map/Ui_Road5.png",name:"line5"},compId:9},{type:"Image",props:{y:771,x:147,skin:"map/Ui_Road1.png",name:"line1"},compId:10},{type:"Image",props:{y:648,x:220,skin:"map/Ui_Road3.png",name:"line3"},compId:11},{type:"Image",props:{y:653,x:51,skin:"map/Ui_Road2.png",name:"line2"},compId:12},{type:"Image",props:{y:592.5,x:393.5,skin:"map/Ui_Road4.png",name:"line4"},compId:13},{type:"Image",props:{y:398,x:173.5,skin:"map/Ui_Road6.png",name:"line6"},compId:14},{type:"Image",props:{y:269,x:32,skin:"map/Ui_Road7.png",name:"line7"},compId:15},{type:"Image",props:{y:161,x:81.5,skin:"map/Ui_Road8.png",name:"line8"},compId:16},{type:"Image",props:{y:162,x:226,skin:"map/Ui_Road9.png",name:"line9"},compId:17},{type:"Image",props:{y:77,x:385,skin:"map/Ui_Road10.png",name:"line10"},compId:18}]},{type:"Box",props:{width:605,var:"baseBox",height:887,centerY:0,centerX:0},compId:8,child:[{type:"mapCell",props:{y:675,x:44,name:"base1",runtime:"game/runtime/MapCellRuntime.ts"},compId:19},{type:"mapCell",props:{y:570,x:123,name:"base2",runtime:"game/runtime/MapCellRuntime.ts"},compId:20},{type:"mapCell",props:{y:581,x:290,name:"base3",runtime:"game/runtime/MapCellRuntime.ts"},compId:21},{type:"mapCell",props:{y:492,x:418,name:"base4",runtime:"game/runtime/MapCellRuntime.ts"},compId:22},{type:"mapCell",props:{y:411,x:274,name:"base5",runtime:"game/runtime/MapCellRuntime.ts"},compId:23},{type:"mapCell",props:{y:321,x:101,name:"base6",runtime:"game/runtime/MapCellRuntime.ts"},compId:24},{type:"mapCell",props:{y:187,x:44,name:"base7",runtime:"game/runtime/MapCellRuntime.ts"},compId:25},{type:"mapCell",props:{y:82,x:151,name:"base8",runtime:"game/runtime/MapCellRuntime.ts"},compId:26},{type:"mapCell",props:{y:159,x:302.5,name:"base9",runtime:"game/runtime/MapCellRuntime.ts"},compId:27},{type:"mapCell",props:{y:76,x:440,name:"base10",runtime:"game/runtime/MapCellRuntime.ts"},compId:28}]}]}],loadList:["map/Ui_MapDi.png","map/Ui_Map3.png","map/Ui_MapRoad1.png","map/Ui_Road5.png","map/Ui_Road1.png","map/Ui_Road3.png","map/Ui_Road2.png","map/Ui_Road4.png","map/Ui_Road6.png","map/Ui_Road7.png","map/Ui_Road8.png","map/Ui_Road9.png","map/Ui_Road10.png"],loadList3D:[]},e.mapPageUI=B,c("ui.mapPageUI",B);class E extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("match")}}e.matchUI=E,c("ui.matchUI",E);class R extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("mode")}}e.modeUI=R,c("ui.modeUI",R);class A extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("newCardPop")}}e.newCardPopUI=A,c("ui.newCardPopUI",A);class D extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(D.uiView)}}D.uiView={type:"View",props:{width:198,runtime:"game/runtime/OutCellRuntime.ts",height:244},compId:2,child:[{type:"Image",props:{y:192,x:99,visible:!1,var:"selectBg",skin:"card/selectBg.png",centerX:0,anchorY:.5,anchorX:.5},compId:20},{type:"Image",props:{y:122,x:99,var:"bg",skin:"card/Ui_CardBg1.png",gray:!1,anchorY:.5,anchorX:.5,sizeGrid:"0,0,0,0"},compId:3,child:[{type:"Box",props:{y:0,x:0,width:193,height:238,centerX:0},compId:21,child:[{type:"Image",props:{y:41,x:51,var:"foot",skin:"part/Bear3.png",scaleY:1,scaleX:1,centerY:0,centerX:0},compId:23},{type:"Image",props:{y:43,x:52,var:"body",skin:"part/Bear2.png",scaleY:1,scaleX:1,centerY:0,centerX:0},compId:24},{type:"Image",props:{var:"foot1",skin:"part/Lion2.png",centerY:0,centerX:0},compId:25},{type:"Image",props:{y:43,x:52,var:"head",skin:"part/Bear1.png",scaleY:1,scaleX:1,centerY:0,centerX:0},compId:26},{type:"Image",props:{y:4,x:0,width:193,skin:"card/AnimalF.png",renderType:"mask",height:236},compId:27}]},{type:"Image",props:{x:0,width:189,var:"cardBlack",skin:"card/Ui_CardBlack1.png",height:71,centerX:0,bottom:6},compId:22,child:[{type:"List",props:{y:10,x:6,var:"propList",repeatY:2,repeatX:2},compId:28,child:[{type:"Box",props:{y:0,x:29,width:90,renderType:"render",height:35},compId:29,child:[{type:"Label",props:{y:0,x:0,text:"攻击力:44",name:"prop",fontSize:22,font:"ZooFont0",color:"#ffffff"},compId:30}]}]}]},{type:"Image",props:{var:"cardLight",skin:"card/Ui_Cardlight1.png",centerY:0,centerX:0},compId:31}]},{type:"Image",props:{y:7,x:154,visible:!1,var:"flagIcon",skin:"card/Ui_LightG.png"},compId:4},{type:"Button",props:{y:305,x:-7,visible:!1,var:"next",stateNum:1,skin:"card/next.png"},compId:17},{type:"Button",props:{y:305,x:-7,visible:!1,var:"out",stateNum:1,skin:"card/out.png"},compId:18},{type:"Button",props:{y:226,x:-7,visible:!1,var:"info",stateNum:1,skin:"card/info.png"},compId:19}],animations:[{nodes:[{target:20,keyframes:{scaleY:[{value:.9,tweenMethod:"backOut",tween:!0,target:20,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:5}],scaleX:[{value:.9,tweenMethod:"backOut",tween:!0,target:20,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:5}]}},{target:3,keyframes:{scaleY:[{value:.9,tweenMethod:"backOut",tween:!0,target:3,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:5}],scaleX:[{value:.9,tweenMethod:"backOut",tween:!0,target:3,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:5}]}}],name:"showBg",id:1,frameRate:24,action:0}],loadList:["card/selectBg.png","card/Ui_CardBg1.png","part/Bear3.png","part/Bear2.png","part/Lion2.png","part/Bear1.png","card/AnimalF.png","card/Ui_CardBlack1.png","card/Ui_Cardlight1.png","card/Ui_LightG.png","card/next.png","card/out.png","card/info.png"],loadList3D:[]},e.outCellUI=D,c("ui.outCellUI",D);class M extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("package")}}e.packageUI=M,c("ui.packageUI",M);class U extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("play")}}e.playUI=U,c("ui.playUI",U);class N extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pvp")}}e.pvpUI=N,c("ui.pvpUI",N);class O extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(O.uiView)}}O.uiView={type:"View",props:{width:720,height:860},loadList:[],loadList3D:[]},e.PvpShopUI=O,c("ui.PvpShopUI",O);class V extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(V.uiView)}}V.uiView={type:"View",props:{width:720,runtime:"game/runtime/RankRuntime.ts",height:860},compId:2,child:[{type:"Panel",props:{width:677,var:"rankPanel",top:80,elasticEnabled:!0,centerX:0,bottom:50},compId:3}],loadList:[],loadList3D:[]},e.rankUI=V,c("ui.rankUI",V);class G extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(G.uiView)}}G.uiView={type:"View",props:{width:659,runtime:"game/runtime/RankCellRuntime.ts",height:118,centerX:0},compId:2,child:[{type:"Image",props:{y:-7,x:-8,var:"selfLight",skin:"rank/Ui_paihang5.png",centerY:0,centerX:0},compId:14},{type:"Image",props:{var:"cellBg",skin:"rank/Ui_paihang6.png"},compId:3,child:[{type:"Image",props:{y:16,x:131,skin:"match/Ui_vsheadframe.png"},compId:4,child:[{type:"Image",props:{width:70,var:"playerHead",skin:"comp/image.png",height:70,centerY:0,centerX:0},compId:5,child:[{type:"Image",props:{skin:"match/Ui_vsheadzhezhao.png",renderType:"mask"},compId:6}]}]},{type:"Image",props:{y:-5.5,x:16.4462890625,var:"rankIcon",skin:"rank/Ui_paihnagfrist.png"},compId:7},{type:"Label",props:{x:46.3232421875,var:"rankLabel",text:"1",fontSize:40,color:"#ffffff",centerY:0},compId:8},{type:"Label",props:{y:17.5,x:234,var:"playerName",text:"label",fontSize:30,color:"#ffffff"},compId:9},{type:"Image",props:{y:59,x:234,skin:"rank/Ui_duizhanjifen.png"},compId:10},{type:"Label",props:{y:67,x:410,var:"playerScore",text:"1",fontSize:30,color:"#ffffff"},compId:12},{type:"division",props:{y:8,x:532,var:"division",runtime:"game/runtime/DivisionRuntime.ts"},compId:13}]}],loadList:["rank/Ui_paihang5.png","rank/Ui_paihang6.png","match/Ui_vsheadframe.png","comp/image.png","match/Ui_vsheadzhezhao.png","rank/Ui_paihnagfrist.png","rank/Ui_duizhanjifen.png"],loadList3D:[]},e.rankCellUI=G,c("ui.rankCellUI",G);class F extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("select")}}e.selectUI=F,c("ui.selectUI",F);class H extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("shop")}}e.shopUI=H,c("ui.shopUI",H);class X extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(X.uiView)}}X.uiView={type:"View",props:{width:212,runtime:"game/runtime/ShopCellRuntime.ts",height:261},compId:2,child:[{type:"FightCell",props:{var:"cell",top:-13,centerX:0,runtime:"game/runtime/FightCellRuntime.ts"},compId:3}],loadList:[],loadList3D:[]},e.shopCellUI=X,c("ui.shopCellUI",X);class W extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("sign")}}e.signUI=W,c("ui.signUI",W);class Y extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(Y.uiView)}}Y.uiView={type:"View",props:{y:97,x:155,width:310,runtime:"game/runtime/SignCellRuntime.ts",height:194,anchorY:.5,anchorX:.5},compId:2,child:[{type:"Image",props:{y:97,x:155,var:"dayFrame",skin:"sign/Ui_frameday1.png",centerY:0,centerX:0,anchorY:.5,anchorX:.5},compId:3,child:[{type:"Image",props:{var:"rewardNameFrame",skin:"sign/Ui_framemini.png",centerX:0,bottom:46,sizeGrid:"16,34,20,77"},compId:6,child:[{type:"Image",props:{var:"rewardNameImage",skin:"lottery/Btn_wordkabao.png",centerY:0,centerX:0},compId:24}]},{type:"Image",props:{var:"moneyImage",skin:"sign/Ui_money.png",scaleY:.6,scaleX:.6,centerX:0,bottom:98},compId:9},{type:"Image",props:{var:"packageLight",skin:"sign/Ui_kabaodi.png",scaleY:.6,scaleX:.6,centerX:0,bottom:62,anchorY:.5,anchorX:.5},compId:25},{type:"Image",props:{var:"secretImage",skin:"sign/Ui_bao3.png",scaleY:.6,scaleX:.6,centerX:-7,bottom:94},compId:15},{type:"Box",props:{var:"cell3",scaleY:.35,scaleX:.35,rotation:19,centerX:40,bottom:77,anchorY:.4,anchorX:.5},compId:22,child:[{type:"FightCell",props:{var:"cardCell3",runtime:"game/runtime/FightCellRuntime.ts"},compId:23}]},{type:"Box",props:{var:"cell2",scaleY:.35,scaleX:.35,rotation:-15,centerX:0,bottom:76,anchorY:.4,anchorX:.5},compId:20,child:[{type:"FightCell",props:{var:"cardCell2",runtime:"game/runtime/FightCellRuntime.ts"},compId:21}]},{type:"Box",props:{var:"cell1",scaleY:.35,scaleX:.35,rotation:-3,centerX:-40,bottom:82,anchorY:.4,anchorX:.5},compId:16,child:[{type:"FightCell",props:{var:"cardCell1",runtime:"game/runtime/FightCellRuntime.ts"},compId:19}]},{type:"Image",props:{y:9,x:9,var:"day",top:9,skin:"sign/Ui_day1.png",left:9},compId:4},{type:"Image",props:{var:"canReceiveTag",skin:"sign/Ui_jinrilingqu.png",centerX:0,bottom:8},compId:26}]},{type:"Image",props:{var:"dayMask",skin:"sign/Ui_framedaymengban.png",centerY:0,centerX:0},compId:27,child:[{type:"Image",props:{y:5,x:202,top:5,skin:"sign/Ui_yilingqu.png",right:5},compId:5}]}],loadList:["sign/Ui_frameday1.png","sign/Ui_framemini.png","lottery/Btn_wordkabao.png","sign/Ui_money.png","sign/Ui_kabaodi.png","sign/Ui_bao3.png","sign/Ui_day1.png","sign/Ui_jinrilingqu.png","sign/Ui_framedaymengban.png","sign/Ui_yilingqu.png"],loadList3D:[]},e.signCellUI=Y,c("ui.signCellUI",Y);class j extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("surrender")}}e.surrenderUI=j,c("ui.surrenderUI",j);class z extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("task")}}e.taskUI=z,c("ui.taskUI",z);class $ extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView($.uiView)}}$.uiView={type:"View",props:{width:520,runtime:"game/runtime/TaskCellRuntime.ts",height:105},compId:2,child:[{type:"Image",props:{var:"bg",skin:"task/Ui_Kuang2.png",centerY:0,centerX:0},compId:3,child:[{type:"Label",props:{y:8.5,x:32,var:"desc",text:"label",fontSize:25,color:"#ffffff"},compId:4},{type:"Label",props:{y:32.5,x:33,var:"activeLabel",text:"label",fontSize:20,color:"#ffffff"},compId:10},{type:"Image",props:{y:29.5,x:371,var:"goBtn",stateNum:1,skin:"task/Btn_QianWang.png",label:"label"},compId:5,child:[{type:"Image",props:{y:-17,x:1.5,skin:"task/Ui_YiWanCheng5.png"},compId:6,child:[{type:"Image",props:{var:"progressBar",skin:"task/Ui_YiWanCheng4.png"},compId:8},{type:"Label",props:{var:"progressLabel",text:"label",color:"#ffffff",centerY:0,centerX:0},compId:9}]}]},{type:"Image",props:{y:58,x:32,var:"rewardBg",skin:"task/Ui_Kuang4.png"},compId:11,child:[{type:"Label",props:{y:5,x:16.6767578125,var:"rewardNum",text:"label",color:"#ffffff"},compId:12},{type:"Image",props:{y:0,x:-7.3232421875,width:20,var:"rewardIcon",skin:"main/Ui_Gold.png",height:20},compId:13}]},{type:"Image",props:{y:29.5,x:399.5,var:"finishIcon",skin:"task/Btn_YiWanCheng.png"},compId:15}]}],loadList:["task/Ui_Kuang2.png","task/Btn_QianWang.png","task/Ui_YiWanCheng5.png","task/Ui_YiWanCheng4.png","task/Ui_Kuang4.png","main/Ui_Gold.png","task/Btn_YiWanCheng.png"],loadList3D:[]},e.taskCellUI=$,c("ui.taskCellUI",$);class K extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(K.uiView)}}K.uiView={type:"View",props:{width:200,runtime:"game/runtime/TipRuntime.ts",height:50},compId:2,child:[{type:"Image",props:{var:"bg",top:0,skin:"main/Ui_BgBlack.png",right:0,left:0,bottom:0},compId:3,child:[{type:"Label",props:{width:0,var:"tipLabel",valign:"middle",text:"label",height:0,fontSize:30,color:"#ffffff",centerY:0,centerX:0,align:"center"},compId:4}]}],loadList:["main/Ui_BgBlack.png"],loadList3D:[]},e.tipUI=K,c("ui.tipUI",K);class J extends l{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("tipView")}}e.tipViewUI=J,c("ui.tipViewUI",J);class q extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("unlockOut")}}e.unlockOutUI=q,c("ui.unlockOutUI",q);class Z extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("upDivision")}}e.upDivisionUI=Z,c("ui.upDivisionUI",Z);class Q extends h{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("welfare")}}e.welfareUI=Q,c("ui.welfareUI",Q);class ee extends l{constructor(){super()}createChildren(){super.createChildren(),this.createView(ee.uiView)}}ee.uiView={type:"View",props:{width:663,runtime:"game/runtime/WelfareCellRuntime.ts",height:130},compId:2,child:[{type:"Image",props:{skin:"main/Ui_Frame.png"},compId:3,child:[{type:"Image",props:{y:15,x:19,width:99,var:"gameIcon",skin:"comp/image.png",height:90},compId:4,child:[{type:"Sprite",props:{texture:"main/Ui_Kuang.png",renderType:"mask"},compId:6}]},{type:"Label",props:{y:15,x:129,var:"gameName",text:"label",stroke:1,fontSize:40},compId:8},{type:"Label",props:{y:88,x:129,var:"rewardNum",text:"100",strokeColor:"#ffffff",stroke:1,fontSize:20,color:"#000000"},compId:9,child:[{type:"Image",props:{y:0,width:20,skin:"main/Ui_Diamonds.png",right:-25,height:20},compId:11}]},{type:"Label",props:{y:61,x:129,var:"desc",text:"试玩一分钟返回即可领取",fontSize:20,color:"#ffc305"},compId:10},{type:"Image",props:{y:33,x:470,var:"playBtn",skin:"main/Btn_ShiWan.png"},compId:7}]}],loadList:["main/Ui_Frame.png","comp/image.png","main/Ui_Kuang.png","main/Ui_Diamonds.png","main/Btn_ShiWan.png"],loadList3D:[]},e.welfareCellUI=ee,c("ui.welfareCellUI",ee)}(i||(i={})),function(e){e.BaseExplode="BaseExplode",e.RecoveryWeapon="RecoveryWeapon",e.MineStoneChange="MineStoneChange",e.SendTip="SendTip",e.CardHouseChange="CardHouseChange",e.ComposeNewCard="ComposeNewCard",e.RefreshShop="RefreshShop",e.NextChange="NextChange",e.JumpPage="JumpPage",e.RoleDeath="RoleDeath",e.OutCard="OutCard",e.SkillBallHit="SkillBallHit",e.SelectCardChange="SelectCardChange",e.MainShowOpen="MainShowOpen",e.RuneFinish="RuneFinish",e.LotteryOpen="LotteryOpen",e.OnShow="OnShow",e.OnHide="OnHide",e.MapCellSelect="MapCellSelect",e.MagicFinish="MagicFinish",e.ReceiveTaskReward="ReceiveTaskReward",e.GiftCellClick="GiftCellClick"}(a||(a={})),function(e){e.play="play.scene",e.main="main.scene",e.count="count.scene",e.unlockOut="unlockOut.scene",e.buyConfirm="buyConfirm.scene",e.cardTip="cardTip.scene",e.pvp="pvp.scene",e.divisionReward="divisionReward.scene",e.match="match.scene",e.upDivision="upDivision.scene",e.surrender="surrender.scene",e.composeShow="composeShow.scene",e.sign="sign.scene",e.lottery="lottery.scene",e.package="package.scene",e.lotteryResult="lotteryResult.scene",e.addMoney="addMoney.scene",e.gameLoad="gameLoad.scene",e.freeTry="freeTry.scene",e.newCardPop="newCardPop.scene",e.bigMap="bigMap.scene",e.handBook="handBook.scene",e.handbookNewReward="handbookNewReward.scene",e.task="task.scene",e.welfare="welfare.scene"}(s||(s={}));class d extends i.addMoneyUI{constructor(){super(...arguments),this.type=0}setMoneyType(e){this.type=e,this.goldLabel.visible=1==this.type,this.diamondLabel.visible=2==this.type,this.powerLabel.visible=3==this.type}onAwake(){this.getBtn.visible=!0,this.noBtn.visible=!1,Laya.timer.once(3e3,this,()=>{this.noBtn.visible=!0}),this.getBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["get"]),this.noBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["no"]),t.Instance.showBannerAd()}onClosed(){t.Instance.hideBannerAd(),t.Instance.initBannerAd()}onMouseEvent(e){"get"==e?(1==this.type?t.Instance.showVideoEventId=203:2==this.type&&(t.Instance.showVideoEventId=202),t.Instance.showVideoAd(()=>{let e={desc:"+688",value:688,type:"gold",isDirect:!0};1==this.type?(e.type="gold",e.value=1e3,e.desc="+1000"):2==this.type?(e.type="diamond",e.value=10,e.desc="+10"):3==this.type&&(e.type="power",e.value=20,e.desc="+20"),Laya.Scene.load(s.lotteryResult,Laya.Handler.create(this,t=>{t.open(!1),t.setData(e)})),this.close()})):"no"==e&&this.close()}}class p{static init(){p._disp||(p._disp=new Laya.EventDispatcher)}static event(e,t){return p._disp.event(e,t)}static on(e,t,i,a){return p._disp.on(e,t,i,a)}static once(e,t,i,a){return p._disp.once(e,t,i,a)}static off(e,t,i,a){return p._disp.off(e,t,i,a)}static offAll(e){return p._disp.offAll(e)}static isMouseEvent(e){return p._disp.isMouseEvent(e)}static hasListener(e){return p._disp.hasListener(e)}}class g{static init(){g.CUR_PLATFORM=g.BROWSER;let e=window.navigator.userAgent;-1==e.indexOf("OPPO")&&e.indexOf("MiniGame")>-1&&"wx"in window&&("tt"in window?g.CUR_PLATFORM=g.TT:"qq"in window?g.CUR_PLATFORM=g.QQ:g.CUR_PLATFORM=g.WX),e.indexOf("OPPO")>-1&&e.indexOf("MiniGame")>-1&&(g.CUR_PLATFORM=g.OPPO),e.indexOf("VVGame")>-1&&(g.CUR_PLATFORM=g.VIVO),console.log("当前小游戏运行平台",g.CUR_PLATFORM)}}g.CUR_PLATFORM=null,g.OPPO="OPPO",g.VIVO="VIVO",g.WX="WX",g.TT="TT",g.QQ="QQ",g.BROWSER="BROWSER";class u{constructor(){u._resMap=new Map,g.CUR_PLATFORM==g.WX?(u._remote="https://cdn.xxtch.com/monsterwx/",u._resBasePath=wx.env.USER_DATA_PATH+"/cache/res/",u._fileSystemManager=wx.getFileSystemManager(),u._downloadFile=wx.downloadFile,u._loadSubpackage=wx.loadSubpackage,u._fileSystemManager.access({path:u._resBasePath,fail:()=>{u._fileSystemManager.mkdirSync(u._resBasePath,!0)}})):g.CUR_PLATFORM!=g.OPPO&&g.CUR_PLATFORM!=g.VIVO||(u._remote="https://cdn.xxtch.com/monster/",u._resBasePath=qg.env.USER_DATA_PATH+"/cache/res/",u._fileSystemManager=qg.getFileSystemManager(),u._downloadFile=qg.downloadFile,u._loadSubpackage=qg.loadSubpackage,u._fileSystemManager.access({path:u._resBasePath,fail:()=>{u._fileSystemManager.mkdirSync(u._resBasePath,!0)}}))}static init(){return new Promise(e=>{if(null==u._instance){u._instance=new u;let t=Laya.LocalStorage.getItem("zipVersion");t&&(u._zipVersion=JSON.parse(t));let i="resconfig.json";g.CUR_PLATFORM==g.WX&&(i=u._remote+"resconfig.json?ran="+1e6*Math.random()),Laya.loader.load(i,Laya.Handler.create(this,t=>{"string"==typeof t&&(t=JSON.parse(t));for(const e in t)if(t.hasOwnProperty(e)){let i=t[e],a=i[0];for(let t=0;t<a.length;t++){let s=a[t];if("local"==i[1]||"sub"==i[1]){let t="res/"+e+"/"+s;g.CUR_PLATFORM==g.OPPO&&"sub"==i[1]&&(t=e+"/"+s),u._resMap.set(s,new m(s,e,i[1],t))}else{let t=u._resBasePath+s;u._resMap.set(s,new m(s,e+"_"+i[2],i[1],t))}}}console.log(u._resMap),e()}))}})}static getRes(e){return Laya.loader.getRes(u._resMap.get(e).url)}static getResClone(e){return Laya.loader.getRes(u._resMap.get(e).url).clone()}static download(e,t=null){return new Promise(i=>{let a=[],s=[];for(let t=0;t<e.length;t++){let i=e[t],n=u._resMap.get(i);if(n||console.error("找不到资源",i),"sub"==n.location)-1==a.indexOf(n.bundleName)&&-1==u._loadedSubNames.indexOf(n.bundleName)&&a.push(n.bundleName);else if("net"==n.location&&-1==s.indexOf(n.bundleName)){let e=n.bundleName.split("_")[0],t=n.bundleName.split("_")[1];u._zipVersion[e]!=t&&s.push(n.bundleName)}}u._loadSubpackages(a,t).then(()=>{u._downloadFiles(s,t).then(()=>{i()})})})}static create(e,t=null){return new Promise(i=>{u.download(e,t).then(()=>{let a=[];for(let t=0;t<e.length;t++)a.push(u._resMap.get(e[t]));u._createRes(a,a.length,t).then(()=>{i()})})})}static _createRes(e,t,i=null){return new Promise(a=>{if(e.length>0){let s=e.shift(),n=s.name.split(".")[0],r=(t-e.length-1)/t;i&&i({type:"create",progress:r,name:n}),Laya.loader.create(s.url,Laya.Handler.create(this,()=>{r=(t-e.length)/t,i&&i({type:"create",progress:r,name:n}),u._createRes(e,t,i).then(()=>{a()})}),Laya.Handler.create(this,e=>{i&&i({type:"create",progress:r,name:n})}))}else a()})}static loadSpines(e){return new Promise(t=>{let i=[];if(e&&e.length>0){let a=e.shift();u.download([a]).then(()=>{let s=new Laya.Skeleton;i.push(s),s.load(u._resMap.get(a).url,Laya.Handler.create(this,()=>{u.loadSpines(e).then(e=>{t(i.concat(e))})}))})}else t(i)})}static loadFonts(e){return new Promise(t=>{if(e&&e.length>0){let i=e.shift();u.download([i]).then(()=>{let a=new Laya.BitmapFont;a.loadFont(u._resMap.get(i).url,Laya.Handler.create(this,a=>{a.setSpaceWidth(10),a.autoScaleSize=!0,Laya.Text.registerBitmapFont(i.split(".")[0],a),u.loadFonts(e).then(()=>{t()})},[a]))})}else t()})}static playSound(e,t=1,i=null,a=null,s=0){u.download([e]).then(()=>Laya.SoundManager.playSound(u._resMap.get(e).url,t,i,a,s))}static playMusic(e,t=0,i=null,a=0){u.download([e]).then(()=>Laya.SoundManager.playMusic(u._resMap.get(e).url,t,i,a))}static _loadSubpackages(e,t=null){return new Promise(i=>{if(e.length>0){let a=e.shift(),s=0;t&&t({type:"download",progress:s,location:"sub",name:a}),u._loadSubpackage({name:a,success:n=>{u._loadedSubNames.push(a),s=1,t&&t({type:"download",progress:s,location:"sub",name:a}),u._loadSubpackages(e,t).then(()=>{i()})},fail:e=>{console.log("loadSubpackageFail",e)}}).onProgressUpdate(e=>{s=(s=e.progress>s?e.progress:s)<1?s:1,t&&t({type:"download",progress:s,location:"sub",name:a,totalBytesWritten:e.totalBytesWritten,totalBytesExpectedToWrite:e.totalBytesExpectedToWrite})})}else i()})}static _downloadFiles(e,t=null){return new Promise(i=>{if(e.length>0){let a=e.shift(),s=a.split("_")[0],n=a.split("_")[1],r=0;t&&t({type:"download",progress:r,location:"net",name:s});let o=u._resBasePath+a+".zip";u._downloadFile({url:u._remote+a+".zip",filePath:o,success:a=>{200===a.statusCode&&u._fileSystemManager.unzip({zipFilePath:o,targetPath:u._resBasePath,success:a=>{u._zipVersion[s]=n,Laya.LocalStorage.setItem("zipVersion",JSON.stringify(u._zipVersion)),r=1,t&&t({type:"download",progress:r,location:"net",name:s}),u._fileSystemManager.unlink({filePath:o}),u._downloadFiles(e,t).then(()=>{i()})},fail:e=>{}})},fail:e=>{}}).onProgressUpdate(e=>{let i=e.progress/100;r=(r=i>r?i:r)<1?r:1,t&&t({type:"download",progress:r,location:"net",name:s})})}else i()})}}u._instance=null,u._fileSystemManager=null,u._resBasePath=null,u._downloadFile=null,u._loadSubpackage=null,u._remote="",u._resMap=null,u._loadedSubNames=[],u._zipVersion={};class m{constructor(e,t,i,a){this._location=null,this._bundleName=null,this._url=null,this._name=null,this._name=e,this._location=i,this._bundleName=t,this._url=a}get location(){return this._location}get bundleName(){return this._bundleName}get url(){return this._url}get name(){return this._name}}!function(e){e[e.Number=0]="Number",e[e.String=1]="String",e[e.Json=2]="Json"}(n||(n={}));class y{constructor(e,t){this._type=n.Number,this._name=e,this._type="number"==typeof t?n.Number:"string"==typeof t?n.String:n.Json;let i=Laya.LocalStorage.getItem(this._name);i?this._value=i:(this._type==n.Json?this._value=JSON.stringify(t):this._value=t.toString(),Laya.LocalStorage.setItem(this._name,this._value))}get value(){return this._type==n.Number?Number(this._value):this._type==n.String?this._value:this._type==n.Json?JSON.parse(this._value):void 0}get valueStr(){return this._value}set value(e){let t="";t=this._type==n.Json?JSON.stringify(e):e.toString(),this._value!=t&&(this._value=t,Laya.LocalStorage.setItem(this._name,this._value),p.event("DataChange",this._name))}}class f{constructor(){f._dataMap=new Map}static init(){null==f._instance&&(f._instance=new f)}static get(e){return f._dataMap.get(e)}static setLocal(e,t){let i=f._dataMap.get(e);i?i.value=t:f._dataMap.set(e,new y(e,t))}static setJson(e,t){f._dataMap.get(e)||f._dataMap.set(e,u.getRes(t))}}f._instance=null,f._dataMap=null;class v{static fixNumber(e,t){return e?-1!=e.toString().indexOf(".")?Number(e.toFixed(t)):e:0}static getRandom(e,t){return Math.floor(e+Math.random()*(t-e+1))}}class L{constructor(){this.standNameArr=["Bear","Chicken","Monkey","Panda","Crocodile","Tortoise","Sloth","Elephant"],this.climbNameArr=["Wolf","Pig","Tiger","Hippo","Lion","Leopard","Rhinoceros","Cow"],this.flyNameArr=["DesertDragon","FireDragon","IceDragon","PoisonDragon"]}static get instance(){return L._instance||(L._instance=new L),L._instance}idToSkin(e){let t=e.split("-"),i=[],a=0;for(let e=0;e<t.length;e++){let s=Number(t[e]);s<=this.standNameArr.length?(i.push(this.standNameArr[s-1]),a||(a=2)):s<=this.climbNameArr.length?(i.push(this.climbNameArr[s-8-1]),a||(a=1)):s<=this.flyNameArr.length&&(i.push(this.flyNameArr[s-16-1]),a||(a=3))}return{skin:i.join("-"),type:a}}skinToId(e){let t=e.split("-"),i=[],a=0;for(let e=0;e<t.length;e++){let s=-1;-1!=(s=this.standNameArr.indexOf(t[e]))?(i.push(s+1),a||(a=2)):-1!=(s=this.climbNameArr.indexOf(t[e]))?(i.push(s+1+8),a||(a=1)):-1!=(s=this.flyNameArr.indexOf(t[e]))&&(i.push(s+1+16),a||(a=3))}return{id:i.join("-"),type:a}}updateHandbookRecord(e){let t=this.skinToId(e.skin);-1==k.instance.handBookRecord.indexOf(t.id)&&(k.instance.handBookRecord.push(t.id),k.instance.newUnlockRecord.push(t.id))}getMagicCardData(e,t){return u.getRes("spell.json")[6*(e-1)+t-1]}getCardDataArr(e,t){let i=[];for(let a=0;a<e.length;a++){let s=this.getCardData(e[a]);s.exp=this.getBaseExpByFightLevel(t[a]),i.push(s)}return i}getFightData(e,t){return u.getRes("fightLevel.json")[50*(e-1)+t-1]}getCardColor(e){let t="";return e<=5?t="white":e<=15?t="green":e<=30?t="blue":e<=50&&(t="purple"),t}getCardData(e){if(-1==e)return{id:0,skin:"",type:0,datatype:0,exp:0};let t=u.getRes("unit.json")[e];return{id:0,skin:`${t.name}-${t.name}-${t.name}`,type:t.type,datatype:t.datatype,exp:1}}getColorByEXP(e){return e<9?"white":e<108?"green":e<1620?"blue":"purple"}getExpSection(e){let t={min:1620,max:24300,id:4};return e<1620&&(t.min=108,t.max=1620,t.id=3),e<108&&(t.min=9,t.max=108,t.id=2),e<9&&(t.min=1,t.max=9,t.id=1),t}getFightLevelByEXP(e){let t=[1,6,16,31,50],i=[1,9,108,1620,24300],a=i[i.length-2],s=t[t.length-2],n=i[i.length-1],r=t[i.length-1];for(let o=1;o<i.length;o++)if(e<i[o]){s=t[o-1],a=i[o-1],n=i[o],r=t[o];break}return Math.round((r-1-s)/(n-1-a)*(e-a)+s)}getBaseExpByFightLevel(e){let t=[1,6,16,31,50],i=[1,9,108,1620,24300],a=t[t.length-2],s=i[i.length-2];for(let n=1;n<t.length;n++)if(e<=t[n]){a=t[n-1],s=i[n-1];break}return s}getExpByFightLevel(e){let t=[1,6,16,31,50],i=[1,9,108,1620,24300],a=t[t.length-2],s=i[i.length-2];for(let n=1;n<t.length;n++){let r=t[n],o=i[n];if(e<=r)return a=t[n-1],(s=i[n-1])+Math.round((o-s)/(r-a)*(e-a))}}splitAllData(){let e=f.get("house").value,t=[],i=[],a=[];for(let s=0;s<e.length;s++){const n=e[s];1==n.type?i.push(n):2==n.type?t.push(n):3==n.type&&a.push(n)}return{double:t,four:i,fly:a}}addNewCard(e){let t=f.get("newCardId"),i=f.get("house"),s=L.instance.splitAllData(),n=k.instance.magicCardNum;for(let i=0;i<e.length;i++){let a=e[i];a.magicType?n[a.magicType-1]++:(a.id=t.value,t.value++,1==a.type?s.four.push(a):2==a.type?s.double.push(a):3==a.type&&s.fly.push(a))}k.instance.magicCardNum=n;let r=s.double.concat(s.four,s.fly);i.value=r,p.event(a.CardHouseChange)}getOriginalCost(e){let t=u.getRes("unit.json"),i=e.split("-"),a=0;for(let e=0;e<20;e++){let s=t[e],n=i.indexOf(s.name);-1!=n&&(i.splice(n,1),s.cost>a&&(a=s.cost))}return a}getCardPackData(e){let t=e.totalCard,i=e.pool1,a=JSON.parse(e.amount1),s=e.pool1chance,n=e.pool2,r=JSON.parse(e.amount2),o=e.pool2chance,l=e.pool3,h=[];for(let e=0;e<3;e++){let c=0,d=0;0==e?(c=i,Math.random()<s&&(d=a[v.getRandom(0,a.length-1)])):1==e?(c=n,Math.random()<o&&(d=r[v.getRandom(0,r.length-1)])):2==e&&(c=l,d=t),t-=d,h=h.concat(this.getCardPoolData(d,c))}return h}getCardPoolData(e,t){let i=u.getRes("gachapool.json")[this.getCardPoolIndex(t)],a=[...JSON.parse(i.content)],s=i.unitLevel,n=[],r=[],o=i.ifRepetitive,l=!1;if(t>=5001&&(l=!0),l){let t=[];for(let i=0;i<e;i++){let e=v.getRandom(0,a.length-1),i=a[e];t.push({magicType:Number(i.toString()[1])}),o||a.splice(e,1)}return t}for(let t=0;t<e;t++){let e=v.getRandom(0,a.length-1),t=a[e];n.push(t),r.push(s),o||a.splice(e,1)}return L.instance.getCardDataArr(n,r)}getCardPoolIndex(e){let t=0,i=e%1e3,a=(e-i)/1e3,s=[4,4,4,1,1];for(let e=0;e<a-1;e++)t+=s[e];return t+i-1}}class C{static init(){C._disp||(C._disp=new Laya.EventDispatcher)}static event(e,t){return C._disp.event(e,t)}static on(e,t,i,a){return C._disp.on(e,t,i,a)}static once(e,t,i,a){return C._disp.once(e,t,i,a)}static off(e,t,i,a){return C._disp.off(e,t,i,a)}static offAll(e){return C._disp.offAll(e)}static isMouseEvent(e){return C._disp.isMouseEvent(e)}static hasListener(e){return C._disp.hasListener(e)}}class S{}S.UserDataChange="UserDataChange",S.NEWGUIDETASK="NEWGUIDETASK";class k{constructor(){this.wxopenid=null,this.wxunionid=null,this._group1=[{id:0,skin:"",type:0,datatype:0,exp:0},{id:0,skin:"",type:0,datatype:0,exp:0},{id:0,skin:"",type:0,datatype:0,exp:0}],this._group2=[{id:0,skin:"",type:0,datatype:0,exp:0},{id:0,skin:"",type:0,datatype:0,exp:0},{id:0,skin:"",type:0,datatype:0,exp:0}],this._group3=[{id:0,skin:"",type:0,datatype:0,exp:0},{id:0,skin:"",type:0,datatype:0,exp:0},{id:0,skin:"",type:0,datatype:0,exp:0}],this._unlock=3,this._curGroup=1,this._gold=800,this._diamond=4,this._shopId=1,this._curLevel=1,this._baseLevel=1,this._mineLevel=1,this._wallBaseHp=500,this._wallUpHp=100,this._mineBaseCreate=60,this._mineUpCreate=10,this._pvpWinCount=0,this._curDivision=1,this._pvpCoin=0,this._pvpScore=0,this._divisionRecord=[0,0,0,0,0,0,0],this._everydayDivisionRecord="",this._signTimeStap=0,this._signDay=1,this._signed=0,this._freeLottery=0,this._refreshShopTimeStap=0,this._house=[],this._enemyPool=[],this._shop=[],this._newCardId=0,this._buyGoldTimeLeft=4,this._buyDiamondTimeLeft=4,this._power=20,this._usePowerTs=0,this._newUnlockRecord=[],this._handBookRecord=[],this._curStage=[1,1],this._starRecord=[],this._magicCardNum=[0,0,0,0,0,0,0],this._magicCardUnlock=[0,0,0,0,0,0,0],this._magicCardLevel=[1,1,1,1,1,1,1],this._useMagicType=[],this._commonGiftY=1,this._commonGiftUpgradeRecord=[],this._fightGiftY=1,this._fightGiftUpgradeRecord=[],this._baseCardPackTs=0,this._superCardPackTs=0,this._dayTimeStamp=0,this._cardPackOpenTs=[0,0,0,0,0,0]}static get instance(){if(!k._instance){let e=localStorage.getItem("UserData");k._instance=new k;let t=null;e&&e.length>0&&(t=JSON.parse(e)),k._instance.init(t)}return k._instance}get signDay(){return this._signDay}set signDay(e){k.instance.changeValue("_signDay",e)}get signed(){return this._signed}set signed(e){k.instance.changeValue("_signed",e)}get freeLottery(){return this._freeLottery}set freeLottery(e){k.instance.changeValue("_freeLottery",e)}get refreshShopTimeStap(){return this._refreshShopTimeStap}set refreshShopTimeStap(e){k.instance.changeValue("_refreshShopTimeStap",e)}get house(){return this._house}set house(e){k.instance.changeValue("_house",e)}get enemyPool(){return this._enemyPool}set enemyPool(e){k.instance.changeValue("_enemyPool",e)}get shop(){return this._shop}set shop(e){k.instance.changeValue("_shop",e)}get newCardId(){return this._newCardId}set newCardId(e){k.instance.changeValue("_newCardId",e)}get group1(){return this._group1}set group1(e){k.instance.changeValue("_group1",e)}get group2(){return this._group2}set group2(e){k.instance.changeValue("_group2",e)}get group3(){return this._group3}set group3(e){k.instance.changeValue("_group3",e)}get unlock(){return this._unlock}set unlock(e){k.instance.changeValue("_unlock",e)}get curGroup(){return this._curGroup}set curGroup(e){k.instance.changeValue("_curGroup",e)}get gold(){return this._gold}set gold(e){k.instance.changeValue("_gold",e)}get diamond(){return this._diamond}set diamond(e){k.instance.changeValue("_diamond",e)}get shopId(){return this._shopId}set shopId(e){k.instance.changeValue("_shopId",e)}get curLevel(){return this._curLevel}set curLevel(e){k.instance.changeValue("_curLevel",e)}get baseLevel(){return this._baseLevel}set baseLevel(e){k.instance.changeValue("_baseLevel",e)}get mineLevel(){return this._mineLevel}set mineLevel(e){k.instance.changeValue("_mineLevel",e)}get wallBaseHp(){return this._wallBaseHp}set wallBaseHp(e){k.instance.changeValue("_wallBaseHp",e)}get wallUpHp(){return this._wallUpHp}set wallUpHp(e){k.instance.changeValue("_wallUpHp",e)}get mineBaseCreate(){return this._mineBaseCreate}set mineBaseCreate(e){k.instance.changeValue("_mineBaseCreate",e)}get mineUpCreate(){return this._mineUpCreate}set mineUpCreate(e){k.instance.changeValue("_mineUpCreate",e)}get pvpWinCount(){return this._pvpWinCount}set pvpWinCount(e){k.instance.changeValue("_pvpWinCount",e)}get curDivision(){return this._curDivision}set curDivision(e){k.instance.changeValue("_curDivision",e)}get pvpCoin(){return this._pvpCoin}set pvpCoin(e){k.instance.changeValue("_pvpCoin",e)}get pvpScore(){return this._pvpScore}set pvpScore(e){k.instance.changeValue("_pvpScore",e)}get divisionRecord(){return this._divisionRecord}set divisionRecord(e){k.instance.changeValue("_divisionRecord",e)}get everydayDivisionRecord(){return this._everydayDivisionRecord}set everydayDivisionRecord(e){k.instance.changeValue("_everydayDivisionRecord",e)}get signTimeStap(){return this._signTimeStap}set signTimeStap(e){k.instance.changeValue("_signTimeStap",e)}get buyGoldTimeLeft(){return this._buyGoldTimeLeft}set buyGoldTimeLeft(e){k.instance.changeValue("_buyGoldTimeLeft",e)}get buyDiamondTimeLeft(){return this._buyDiamondTimeLeft}set buyDiamondTimeLeft(e){k.instance.changeValue("_buyDiamondTimeLeft",e)}get power(){return this._power}set power(e){k.instance.changeValue("_power",e)}get usePowerTs(){return this._usePowerTs}set usePowerTs(e){k.instance.changeValue("_usePowerTs",e)}get newUnlockRecord(){return this._newUnlockRecord}set newUnlockRecord(e){k.instance.changeValue("_newUnlockRecord",e)}get handBookRecord(){return this._handBookRecord}set handBookRecord(e){k.instance.changeValue("_handBookRecord",e)}get curStage(){return this._curStage}set curStage(e){k.instance.changeValue("_curStage",e)}get starRecord(){return this._starRecord}set starRecord(e){k.instance.changeValue("_starRecord",e)}get magicCardNum(){return this._magicCardNum}set magicCardNum(e){k.instance.changeValue("_magicCardNum",e)}get magicCardUnlock(){return this._magicCardUnlock}set magicCardUnlock(e){k.instance.changeValue("_magicCardUnlock",e)}get magicCardLevel(){return this._magicCardLevel}set magicCardLevel(e){k.instance.changeValue("_magicCardLevel",e)}get useMagicType(){return this._useMagicType}set useMagicType(e){k.instance.changeValue("_useMagicType",e)}get commonGiftY(){return this._commonGiftY}set commonGiftY(e){k.instance.changeValue("_commonGiftY",e)}get commonGiftUpgradeRecord(){return this._commonGiftUpgradeRecord}set commonGiftUpgradeRecord(e){k.instance.changeValue("_commonGiftUpgradeRecord",e)}get fightGiftY(){return this._fightGiftY}set fightGiftY(e){k.instance.changeValue("_fightGiftY",e)}get fightGiftUpgradeRecord(){return this._fightGiftUpgradeRecord}set fightGiftUpgradeRecord(e){k.instance.changeValue("_fightGiftUpgradeRecord",e)}get baseCardPackTs(){return this._baseCardPackTs}set baseCardPackTs(e){k.instance.changeValue("_baseCardPackTs",e)}get superCardPackTs(){return this._superCardPackTs}set superCardPackTs(e){k.instance.changeValue("_superCardPackTs",e)}get dayTaskId(){return this._dayTaskId}set dayTaskId(e){k.instance.changeValue("_dayTaskId",e)}get dayTaskRecord(){return this._dayTaskRecord}set dayTaskRecord(e){k.instance.changeValue("_dayTaskRecord",e)}get dayTaskReceive(){return this._dayTaskReceive}set dayTaskReceive(e){k.instance.changeValue("_dayTaskReceive",e)}get dayTimeStamp(){return this._dayTimeStamp}set dayTimeStamp(e){k.instance.changeValue("_dayTimeStamp",e)}get achieveTaskRecord(){return this._achieveTaskRecord}set achieveTaskRecord(e){k.instance.changeValue("_achieveTaskRecord",e)}get achieveTaskReceive(){return this._achieveTaskReceive}set achieveTaskReceive(e){k.instance.changeValue("_achieveTaskReceive",e)}get achieveTaskStage(){return this._achieveTaskStage}set achieveTaskStage(e){k.instance.changeValue("_achieveTaskStage",e)}get cardPackOpenTs(){return this._cardPackOpenTs}set cardPackOpenTs(e){k.instance.changeValue("_cardPackOpenTs",e)}init(e){if(this.initAchieveTask(),this.initGift(),this.initCardData(),e)for(const t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.refreshDayTask(),this.addPower()}initGift(){this._commonGiftUpgradeRecord=[],this._fightGiftUpgradeRecord=[];for(let e=0;e<18;e++)this._commonGiftUpgradeRecord.push(0),this._fightGiftUpgradeRecord.push(0)}initCardData(){let e=[],t=[0,1,2];for(let i=0;i<t.length;i++){let a=L.instance.getCardData(t[i]);a.id=i+1,e.push(a)}this._house=e,this._enemyPool=t,this._newCardId=t.length+1}refreshPower(){let e=Date.now()-this._usePowerTs,t=Math.floor(e/72e4);this._power=this._power+t,this._power=this._power<20?this._power:20,this.power=this._power}addPower(){Laya.timer.loop(72e4,this,()=>{this._power++,this._power=this._power<20?this._power:20,this.power=this._power})}changeValue(e,t){this[e]=t,localStorage.setItem("UserData",JSON.stringify(k._instance)),C.event(S.UserDataChange,e)}refreshDayTask(){let e=Date.now();if(e-this._dayTimeStamp>864e5){this.dayTimeStamp=e;let t=2001,i=10,a=[],s=5;for(let e=0;e<i;e++)a.push(e+t);this._dayTaskRecord=[],this._dayTaskReceive=[];for(let e=0;e<i;e++)this._dayTaskRecord.push(0),this._dayTaskReceive.push(0);this.dayTaskRecord=this._dayTaskRecord,this.dayTaskReceive=this._dayTaskReceive,this._dayTaskId=[];for(let e=0;e<s;e++)this._dayTaskId.push(a.splice(v.getRandom(0,a.length-1),1)[0]);this._dayTaskId.sort((e,t)=>e-t),this.dayTaskId=this._dayTaskId,this.buyDiamondTimeLeft=4,this.buyGoldTimeLeft=4}}initAchieveTask(){this._achieveTaskRecord=[],this._achieveTaskStage=[],this._achieveTaskReceive=[];for(let e=0;e<19;e++)this._achieveTaskRecord.push(0),this._achieveTaskStage.push(0),this._achieveTaskReceive.push(0)}finishTask(e,t){let i=this._dayTaskRecord;e>2e3&&(i=this._achieveTaskRecord),i[e%1e3-1]+=t}getNormalizeLevel(e){return 10*(e[0]-1)+e[1]}}class b{constructor(){this.weakId=1,this.acidId=2,this.energyId=4,this.redSunId=5,this.blueSunId=6,this.purpleSunId=7,this.electricityId=8,this.sunProp=[[0,0],[0,0],[0,0]],this.thunderId=3,this.randomBuffState=[0,0,0,0,0,0,0,0],this.acidDamageSec=0,this.acidSpeedSlowPer=0,this.energyAdd=0,this.electricitySlowPer=0,this.electricityTimeGap=0,this.thunderTimeGap=0,this.thunderDamage=0,this.magicData=null,this.cursePer=0,this.encouragePer=0,this.recoverySec=0,this.recoveryTime=0,this.fireballDamage=0,this.arrowRainDamage=0,this.encourageTime=0,this.curseTime=0,this.helpUnitDataArr=[],this.fightGiftTime=0,this.commonGiftProp=null,this.fightGiftProp=null,this.fightGiftTimeProp=null,this.refreshMonster=null,this.playStage=null,this.roadBlock=null,this.mapCannonPos=null,this.mapCannonId=0,this.cannonId=0,this.isPVP=!1,this.isGamePause=!1,this.isGameOver=!1,this.countStar=[0,0,0,0]}static get instance(){return b._instance||(b._instance=new b),window.GameDataManager=b._instance,b._instance}updateMapBuffData(){let e=u.getRes("buff.json"),t=u.getRes("map.json")[10*(this.playStage[0]-1)+this.playStage[1]-1],i=[];t.buff1&&i.push(t.buff1),t.buff2&&i.push(t.buff2),console.log(this.playStage,t),this.randomBuffState=[0,0,0,0,0,0,0,0];for(let t=0;t<i.length;t++){let a=e[i[t]-1];this.randomBuffState[a.type-1]=1,1==a.type||(2==a.type?(this.acidDamageSec=a.param1,this.acidSpeedSlowPer=a.param2):3==a.type?(this.thunderTimeGap=1e3*a.param1,this.thunderDamage=a.param2):4==a.type?this.energyAdd=a.param1:5==a.type?(this.sunProp[0][0]=a.param1,this.sunProp[0][1]=a.param2):6==a.type?(this.sunProp[1][0]=a.param1,this.sunProp[1][1]=a.param2):7==a.type?(this.sunProp[2][0]=a.param1,this.sunProp[2][1]=a.param2):8==a.type&&(this.electricitySlowPer=a.param1,this.electricityTimeGap=1e3*a.param2))}this.updateRefreshParam()}updateRefreshParam(){this.isGameOver=!1,this.isGamePause=!1,this.refreshMonster=[[0,0,0],[0,0,0],[0,0,0]],this.roadBlock=null,this.mapCannonPos=null,this.mapCannonId=0;let e=u.getRes("map.json"),t=this.playStage[0],i=e[10*(t-1)+this.playStage[1]-1];this.refreshMonster[0][0]=i.infantry,this.refreshMonster[0][1]=i.squad,this.refreshMonster[0][2]=i.infLevel,this.refreshMonster[1][0]=i.elite,this.refreshMonster[1][1]=i.group,this.refreshMonster[1][2]=i.eliteLevel,this.refreshMonster[2][0]=i.dragon,this.refreshMonster[2][1]=i.dragonSquad,this.refreshMonster[2][2]=i.dragonLevel,i.roadBlock&&(this.roadBlock=JSON.parse(i.roadBlock)),i.towerPos&&(this.mapCannonPos=JSON.parse(i.towerPos),this.mapCannonId=5e3+2*t)}updateMagicData(){this.magicData={};let e=k.instance.useMagicType;for(let t=0;t<e.length;t++){let i=e[t],a=k.instance.magicCardLevel[i-1],s=L.instance.getMagicCardData(i,a);if(this.magicData[i]=s,1==i)this.fireballDamage=s.param;else if(2==i)this.arrowRainDamage=s.param;else if(3==i)this.cannonId=s.param;else if(4==i){let e=s.param.split(",");this.encouragePer=Number(e[0])/100,this.encourageTime=1e3*Number(e[1])}else if(5==i){let e=JSON.parse(s.param),t=[],i=[];for(let a=0;a<e.length-1;a++)i.push(e[a]),t.push(e[e.length-1]);this.helpUnitDataArr=L.instance.getCardDataArr(i,t)}else if(6==i){let e=s.param.split(",");this.cursePer=Number(e[0])/100,this.curseTime=1e3*Number(e[1])}else if(7==i){let e=s.param.split(",");this.recoverySec=Number(e[0]),this.recoveryTime=1e3*Number(e[1])}}}upgradeGift(e){let t=u.getRes("talent.json")[e],i=this.getPropInfo(t.attType);return i.propArr[i.y][i.x]+=t.param,t}initGiftDataByType(e){let t=0,i=k.instance.commonGiftUpgradeRecord;1==e&&(t=18,i=k.instance.fightGiftUpgradeRecord);for(let e=0;e<18;e++){let a=i[e];for(let i=0;i<a;i++)b.instance.upgradeGift(t+e)}}initGiftData(){this.commonGiftProp=[[0,0,0,0,0]],this.fightGiftProp=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.fightGiftTimeProp=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.initGiftDataByType(0),this.initGiftDataByType(1)}getPropInfo(e){let t=0,i=0,a=null;return e>=1001&&e<=1005?(i=0,t=e%1e3-1,a=this.commonGiftProp):e>=11001&&e<=11004?(i=0,t=e%11e3-1,a=this.fightGiftProp):e>=21001&&e<=21004?(i=1,t=e%21e3-1,a=this.fightGiftProp):e>=31001&&e<=31004?(i=2,t=e%31e3-1,a=this.fightGiftProp):e>=41001&&e<=41004?(i=3,t=e%41e3-1,a=this.fightGiftProp):e>=10001&&e<=10004?(i=0,t=e%1e4-1,a=this.fightGiftTimeProp):e>=20001&&e<=20004?(i=1,t=e%2e4-1,a=this.fightGiftTimeProp):e>=30001&&e<=30004?(i=2,t=e%3e4-1,a=this.fightGiftTimeProp):e>=40001&&e<=40004&&(i=3,t=e%4e4-1,a=this.fightGiftTimeProp),{x:t,y:i,propArr:a,value:a[i][t]}}}b._instance=null;class w extends i.mapPageUI{set dataSource(e){if(this._dataSource=e,e){let t=k.instance.curStage,i=t[1],a=t[0],s=k.instance.starRecord;this.mapImage.skin=`map/Ui_Map${e}.png`;for(let t=0;t<10;t++){let n=this.baseBox.getChildByName(`base${t+1}`),r=this.lineBox.getChildByName(`line${t+1}`),o=10*(e-1)+t+1,l=10*(a-1)+i,h=o<=l;n.dataSource=o>=l?{state:2,star:0,level:t+1,chapter:e,canClick:h}:{state:1,star:s[o-1],level:t+1,chapter:e,canClick:h},r.visible=o<=l}}}get dataSource(){return this._dataSource}}class I extends i.bigMapUI{constructor(){super(...arguments),this.maxChapter=3,this.selectLevel=0,this.pageArr=[]}onAwake(){let e=k.instance.curStage;this.showChapter=e[0];for(let e=0;e<this.maxChapter;e++){let t=new w;t.x=360,t.y=715,t.rotation=-2.5,t.scaleX=t.scaleY=1.1,t.zOrder=this.maxChapter-1-e,t.dataSource=e+1,e+1>=this.showChapter?t.x=360:t.x=-720,this.pageBox.addChild(t),this.pageArr.push(t)}this.updateSlideBtn()}onOpened(){let e=k.instance.curStage;this.setSelectLevel(e[1]),this.backBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.startBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.leftBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.rightBtn.on(Laya.Event.CLICK,this,this.onBtnClick),p.on(a.MapCellSelect,this,this.onMapCellSelect)}onDestroy(){p.off(a.MapCellSelect,this,this.onMapCellSelect)}onBtnClick(e){if(this.backBtn==e.target)this.close();else if(this.startBtn==e.target){let e=5,t=k.instance.power;if(t<e)return void p.event(a.SendTip,[["体力不足"]]);let i=b.instance.playStage;1==i[0]&&1==i[1]?mpsdk.Report.reportEvent(17):1==i[0]&&2==i[1]&&mpsdk.Report.reportEvent(28),mpsdk.Report.reportEvent(101,`${i[0]}-${i[1]}`),k.instance.usePowerTs=Date.now(),t-=e,k.instance.power=t,b.instance.isPVP=!1,this.close(),Laya.Scene.open(s.gameLoad)}else if(this.leftBtn==e.target){let e=this.pageArr[this.showChapter-2],t=this.pageArr[this.showChapter-1];this.showChapter--,this.updateSlideBtn(),Laya.MouseManager.enabled=!1,Laya.Tween.to(e,{x:360},500,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{Laya.MouseManager.enabled=!0,this.selectLevel>0&&(t.baseBox.getChildByName(`base${this.selectLevel}`).setSelect(!1),this.selectLevel=0),this.showChapter==k.instance.curStage[0]&&this.setSelectLevel(k.instance.curStage[1])}))}else if(this.rightBtn==e.target){let e=this.pageArr[this.showChapter-1];this.showChapter++,this.updateSlideBtn(),Laya.MouseManager.enabled=!1,Laya.Tween.to(e,{x:-720},500,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{Laya.MouseManager.enabled=!0,this.selectLevel>0&&(e.baseBox.getChildByName(`base${this.selectLevel}`).setSelect(!1),this.selectLevel=0),this.showChapter==k.instance.curStage[0]&&this.setSelectLevel(k.instance.curStage[1])}))}}setSelectLevel(e){if(this.selectLevel==e)return;let t=this.pageArr[this.showChapter-1];this.selectLevel>0&&(t.baseBox.getChildByName(`base${this.selectLevel}`).setSelect(!1),this.selectLevel=0),this.selectLevel=e;let i=t.baseBox.getChildByName(`base${e}`),a=(i.localToGlobal(new Laya.Point(54,36),!1,this),u.getRes("map.json")[10*(this.showChapter-1)+e-1]),s=this.buffFrame.bottom;Laya.MouseManager.enabled=!1,Laya.Tween.to(this.buffFrame,{bottom:-320},200,Laya.Ease.sineIn,Laya.Handler.create(this,()=>{this.setBuffFrameData(a),this.setRewardFirstData(JSON.parse(a.firstReward)),this.setRewardNormalData(JSON.parse(a.reward)),Laya.timer.once(200,this,()=>{Laya.Tween.to(this.buffFrame,{bottom:s},200,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{Laya.MouseManager.enabled=!0}))})})),i.setSelect(!0),b.instance.playStage=[this.showChapter,this.selectLevel]}onMapCellSelect(e){this.setSelectLevel(e)}getRewardDataArr(e,t=!1){let i=[];for(let a=0;a<e.length/2;a++){let s=e[2*a],n=e[2*a+1],r="";1==s?r="main/Ui_Gold.png":2==s?r="main/Ui_Diamonds.png":3==s?r="main/Ui_power.png":s>=5e4&&s<=50019?(r="map/Ui_WenHaoCard.png",n=1):s>=1101&&s<=1706&&(r="map/Ui_WenHaoCard.png"),i.push({rewardImage:{skin:r},rewardNum:{text:"X"+n},receivedCover:{visible:t}})}return i}setRewardFirstData(e){let t=this.getRewardDataArr(e),i=!0;null==k.instance.starRecord[10*(this.showChapter-1)+this.selectLevel-1]&&(i=!1);for(let e=0;e<t.length;e++)t[e].rewardBg={skin:`map/Ui_FrameGift${e+1}.png`},t[e].receivedCover={visible:i};this.firstRewardList.repeatX=t.length,this.firstRewardList.centerX=-1,this.firstRewardList.array=t,this.firstRewardList.centerX=0}setRewardNormalData(e){let t=this.getRewardDataArr(e);for(let e=0;e<t.length;e++)t[e].rewardBg={skin:`map/Ui_FrameGift${e+1}.png`};this.normalRewardList.repeatX=t.length,this.normalRewardList.centerX=-1,this.normalRewardList.array=t,this.normalRewardList.centerX=0}setBuffFrameData(e){let t=u.getRes("buff.json"),i=[],a=[e.buff1,e.buff2];for(let e=0;e<a.length;e++){let s=a[e];if(s>0){let e=t[s-1],a=e.description;if(-1!=e.description.indexOf("*"))for(let t=0;t<2;t++){let i=e["param"+(t+1)];(2==e.type&&1==t||5==e.type||6==e.type||7==e.type||8==e.type&&0==t)&&(i=Math.floor(100*i)+"%"),a=a.replace("*",i)}i.push({buffImage:{skin:`map/Ui_Buff${e.type}.png`},buffName:{skin:`map/Ui_BuffName${e.type}.png`},buffDesc:{text:a}})}}this.buffList.array=i}updateSlideBtn(){1==this.showChapter?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.showChapter==this.maxChapter?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0)}}class _ extends Laya.Sprite{constructor(){super(),this._guideConfig=[{task:"开始欢迎语",text:"欢迎来到灵兽世界，我将带领你快速学习如何操控灵兽们",closeType:0},{task:"点击卡组",closeType:1},{task:"点击选择一张卡片",closeType:1},{task:"点击出战",closeType:1},{task:"战斗前激励语",text:"好了，现在我们上阵了新的灵兽，现在让我们使用它去战胜敌对势力吧！",closeType:0},{task:"点击战斗",closeType:1},{task:"点击当前关卡",closeType:1},{task:"矿石增长",text:"这里是矿石资源，会持续增加",closeType:0},{task:"灵兽消耗矿石",text:"召唤灵兽需要消耗相应数量的矿石",closeType:0},{task:"拖动卡牌到战线上",text:"现在拖动一张卡片到任意一条战线上吧!",closeType:0},{task:"点击拖动一张卡牌",closeType:1},{task:"召唤更多提示语",text:"请继续召唤更多灵兽，摧毁敌方基地吧！",closeType:0},{task:"购买灵兽提示语",text:"刚才战斗胜利，我们获得了不少金币，现在让我们补充更多的灵兽卡",closeType:0},{task:"点击商店",closeType:1},{task:"点击第一张双足卡片",closeType:1},{task:"点击购买",closeType:1},{task:"点击第一张双足卡片",closeType:1},{task:"点击购买",closeType:1},{task:"提示解锁合成系统",text:"灵兽合成系统解锁，我们可以将同类型的灵兽合成，变成更强大的灵兽！",closeType:0},{task:"点击合成",closeType:0},{task:"点击第一张合成卡牌",closeType:1},{task:"点击第一张合成卡牌",closeType:1},{task:"点击第一张合成卡牌",closeType:1},{task:"点击普通合成",closeType:1},{task:"合成成功提示语",text:"合成的新灵兽所有属性都加强了，只有强大的灵兽才能合成出更强的灵兽哦！",closeType:0},{task:"使用合成卡牌提示语",text:"现在让我们用新合成的卡片,消灭更多的敌对势力吧！",closeType:0},{task:"上阵卡牌",closeType:1},{task:"点击选择一张卡片",closeType:1},{task:"点击出战",closeType:1},{task:"点击战斗",closeType:1},{task:"点击当前关卡",closeType:1},{task:"使用火球术提示语",text:"敌方灵兽开始攻击我方基地了，使用火球术消灭他们！",closeType:0},{task:"点击放置火球牌",closeType:1},{task:"合理利用火球牌提示语",text:"太棒了！火球可以消灭河道内一条轨道的所有敌人，记得多加利用哦！",closeType:0},{task:"派出沙龙提示语",text:"为了抵抗敌人的猛烈攻击，我们派出了最强生物 - 沙龙！快点使用他消灭敌人吧！",closeType:0},{task:"点击放置沙龙",closeType:1}],this._guideId=0,this.guideFinish=!1,this.guideData=null,this._kawayiIndex=0,this._closeGuideOnFinish=!1,this._kawayiArr=["guide/Ui_wolf.png","guide/Ui_bear.png","guide/Ui_chicken.png"],this.mouseEnabled=!0,this.visible=!1,this.name="GuideManager",this.cacheAs="bitmap",this.zOrder=1001,this.width=Laya.stage.width,this.height=Laya.stage.height,this._guideMask=new Laya.Sprite,this._guideMask.alpha=.5,this._guideMask.cacheAs="bitmap",this._guideMask.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),this.addChild(this._guideMask),this._destroyBox=new Laya.Box,this._destroyBox.width=Laya.stage.width,this._destroyBox.height=Laya.stage.height,this.addChild(this._destroyBox),this._guideView=new i.guideUI,this._guideView.width=Laya.stage.width,this._guideView.height=Laya.stage.height,this.addChild(this._guideView),this.on(Laya.Event.CLICK,this,this.onPageEvent)}static get Instance(){return _._instance||(_._instance=new _,Laya.stage.addChild(_._instance)),_._instance}init(){let e=localStorage.getItem("guideId");e?this._guideId=Number(e):localStorage.setItem("guideId",this._guideId.toString()),this._guideId<this._guideConfig.length?(this._guideId=0,this.guideFinish=!1,this.guideData=this._guideConfig[this._guideId],localStorage.clear()):this.guideFinish=!0}onPageEvent(e){0==this.guideData.closeType&&this.finishTask(this.guideData.task)}showGuide(e,t,i=!1){if(this._guideId!=this._guideConfig.length&&e==this.guideData.task)if(this.mouseEnabled=!0,this.visible=!0,this._guideMask.visible=!0,this._closeGuideOnFinish=i,this.guideData.text&&this.guideData.text.length>0&&this.showTalk(!0,this.guideData.text),t){let e=new Laya.Point(t.width/2,t.height/2);t.localToGlobal(e,!1);let i=this.realScale(t),a=t.nodeAnchorX?t.nodeAnchorX:0,s=t.nodeAnchorY?t.nodeAnchorY:0,n=new Laya.Point(t.width*i.scaleX*a,t.height*i.scaleX*s);t.localToGlobal(n,!1),this._nodeExParent=t.parent,this._nodeExX=t.x,this._nodeExY=t.y,this._nodeExScaleX=t.scaleX,this._nodeExScaleY=t.scaleY,t.parent.removeChild(t),this._destroyBox.addChild(t),t.x=n.x,t.y=n.y,t.scaleX=i.scaleX,t.scaleY=i.scaleY,this.showHand(!0,e)}else{let e=new Laya.Point(454,173);this._guideView.talkBg.localToGlobal(e,!1,this),this.showHand(!0,e)}}finishTask(e,t=0){if(this._guideId==this._guideConfig.length||e!=this.guideData.task)return;this._closeGuideOnFinish&&this.hideGuide();let i=null;this._nodeExParent&&(i=this._destroyBox.removeChildAt(0),this._nodeExParent.addChild(i),i.x=this._nodeExX,i.y=this._nodeExY,i.scaleX=this._nodeExScaleX,i.scaleY=this._nodeExScaleY,this._nodeExParent=null),this.showTalk(!1,null),this.showHand(!1,null),this._guideId++,localStorage.setItem("guideId",this._guideId.toString()),this._guideId==this._guideConfig.length?(this.guideFinish=!0,this.guideData=null):(this.guideData=this._guideConfig[this._guideId],Laya.timer.once(t,this,()=>{this.sendNewGuideTaskEvent()}))}sendNewGuideTaskEvent(){this.guideData&&C.event(S.NEWGUIDETASK,this.guideData.task)}hideGuide(){this.visible=!1}realScale(e){let t={scaleX:e.scaleX,scaleY:e.scaleY};return e.parent&&(t.scaleX*=this.realScale(e.parent).scaleX,t.scaleY*=this.realScale(e.parent).scaleY),t}showTalk(e,t){e?(this._guideView.talkBg.visible=!0,this._guideView.kawayi.skin=this._kawayiArr[this._kawayiIndex],this._guideView.talkLabel.text=t,this._guideView.talkLabel.y=(this._guideView.talkBg.height-this._guideView.talkLabel.height)/2):this._guideView.talkBg.visible=!1}showHand(e,t){this._guideView.clickHand.visible=e,e?(this._guideView.clickHand.x=t.x,this._guideView.clickHand.y=t.y,this._guideView.handClick.play(0,!0)):this._guideView.handClick.stop()}}class x extends i.buyConfirmUI{constructor(){super(...arguments),this.goldLocal=null,this.houseLocal=null,this.newCardIdLocal=null,this.shopRuntime=null,this.shopLocal=null}onAwake(){this.goldLocal=f.get("gold"),this.houseLocal=f.get("house"),this.newCardIdLocal=f.get("newCardId"),this.shopLocal=f.get("shop"),this.buyBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["buy"]),this.closeBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["close"]),C.on(S.NEWGUIDETASK,this,this.onNewGuideTaskEvent),t.Instance.showBannerAd()}onClosed(){t.Instance.hideBannerAd(),t.Instance.initBannerAd()}onDestroy(){C.off(S.NEWGUIDETASK,this,this.onNewGuideTaskEvent)}onNewGuideTaskEvent(e){"点击购买"==e&&_.Instance.showGuide(e,this.buyBtn)}onMouseEvent(e,t){if(t.stopPropagation(),"buy"==e){if(this.goldLocal.value>=this.cost){this.goldLocal.value-=this.cost;let e=JSON.parse(JSON.stringify(this.cell.dataSource));this.removeBuy(e.id),L.instance.addNewCard([e]),u.playSound("buyCard.mp3"),p.event(a.SendTip,[["购买成功!"]]),p.event(a.RefreshShop),_.Instance.finishTask("点击购买",500),p.event("BreakPoint",["购买单卡",e.type]),_.Instance.guideFinish&&Laya.Scene.load(s.newCardPop,Laya.Handler.create(this,e=>{e.isModal=!0,e.open()}))}else u.playSound("Error.mp3"),p.event(a.SendTip,[["金币不足!"]]);this.close()}else"close"==e&&(u.playSound("Open.mp3"),this.close())}removeBuy(e){let t=this.shopLocal.value;for(let i=0;i<t.length;i++)if(t[i].id==e){t.splice(i,1);break}this.shopLocal.value=t}}!function(e){e[e.normal=0]="normal",e[e.cd=1]="cd"}(r||(r={}));class T extends i.FightCellUI{constructor(){super(...arguments),this.original=null,this.originalIndex=-1,this.curState=r.normal,this.isTweening=!1,this.cellArray=null,this._cardData=null,this._cost=10,this._cd=8,this.increaseSpeed=0,this.fightData=null}onAwake(){this.cost=10,this.out.on(Laya.Event.CLICK,this,e=>{1==_.Instance.visible&&(e.stopPropagation(),p.event(a.OutCard,["out",e]))})}onEnable(){}onDisable(){}set dataSource(e){if(!e)return;if(this.bg.disabled=!1,this.cellArray&&this.cellArray.length>0)for(let t=0;t<this.cellArray.length;t++){const i=this.cellArray[t];if(i.dataSource&&i.dataSource.id>0&&i.dataSource.id==e.id){this.bg.disabled=!0;break}}this._cardData=e;let t=this._cardData.magicType;if(t)this.magicImage.visible=!0,this.magicImage.skin=`card/Ui_Magic${t}.png`,this.bg.visible=!1;else{if(this.magicImage.visible=!1,this.bg.visible=!0,0==e.id)return void(this.bg.visible=!1);this.bg.visible=!0,this.setRaceIcon(e.type);let t=L.instance.getColorByEXP(e.exp);this.setColor(t);let i=L.instance.getFightLevelByEXP(e.exp);if(this.fightData=L.instance.getFightData(e.datatype,i),this.propList.array=[{icon:{skin:"compose/Ui_Attribute1.png"},prop:{text:this.fixed(this.fightData.atk)}},{icon:{skin:"compose/Ui_Attribute2.png"},prop:{text:this.fixed(this.fightData.hp)}},{icon:{skin:"compose/Ui_Attribute3.png"},prop:{text:this.fixed(Math.floor((2e3-this.fightData.atkgap)/10))}},{icon:{skin:"compose/Ui_Attribute4.png"},prop:{text:this.fixed(this.fightData.speed)}}],this.propList.refresh(),""!=e.skin){let t=e.skin.split("-");1==e.type?(this.foot1.visible=!0,this.head.skin=`part/${t[0]}1.png`,this.foot1.skin=`part/${t[2]}2.png`,this.body.skin=`part/${t[1]}3.png`,this.foot.skin=`part/${t[2]}4.png`):(this.foot1.visible=!1,this.head.skin=`part/${t[0]}1.png`,this.body.skin=`part/${t[1]}2.png`,this.foot.skin=`part/${t[2]}3.png`)}}}fixed(e){return e%1!=0?e.toFixed(1):`${e}`}setRaceIcon(e){let t="";1==e?t="card/Ui_CardJiaoBiao2.png":2==e?t="card/Ui_CardJiaoBiao1.png":3==e&&(t="card/Ui_CardJiaoBiao3.png"),this.flagIcon.skin=t}setColor(e){let t="",i="";this.cardLight.visible=!1,"white"==e?(t="card/Ui_CardBg0.png",i="card/Ui_CardBlack0.png"):"green"==e?(t="card/Ui_CardBg1.png",i="card/Ui_CardBlack1.png",this.cardLight.skin="card/Ui_Cardlight1.png",this.cardLight.visible=!0):"blue"==e?(t="card/Ui_CardBg2.png",i="card/Ui_CardBlack2.png",this.cardLight.skin="card/Ui_Cardlight2.png",this.cardLight.visible=!0):"purple"==e&&(t="card/Ui_CardBg3.png",i="card/Ui_CardBlack3.png",this.cardLight.skin="card/Ui_Cardlight3.png",this.cardLight.visible=!0),this.cardBlack.skin=i,this.bg.skin=t}get dataSource(){return this._cardData}clone(){let e=new T;return e.original=this,e.width=this.width,e.height=this.height,e.dataSource=JSON.parse(JSON.stringify(this._cardData)),e}changeState(e){e!=this.curState&&(e==r.normal||e==r.cd&&Laya.timer.once(1e3*this._cardData.cd,this,()=>{this.changeState(r.normal)}),this.curState=e)}get cost(){return this._cost}set cost(e){this._cost=e}setOutFight(e,t){this.originalIndex=t,this.isTweening=!0,this._cardData=e.dataSource,this.visible=!1;let i=this.parent.localToGlobal(new Laya.Point(this.x,this.y),!1,this.scene.parent.scene);Laya.Tween.to(e,{scaleX:this.scaleX,scaleY:this.scaleY,x:i.x,y:i.y,rotation:this.parent.rotation},300,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.isTweening=!1,this.visible=!0,e.destroy(),this.dataSource=this._cardData,this.bg.disabled=!1}))}setEmpty(){this.originalIndex=-1,this._cardData=L.instance.getCardData(-1),this.dataSource=this._cardData}setNew(e){let t=this.localToGlobal(new Laya.Point,!1);Laya.Tween.to(e,{scaleX:this.scaleX,scaleY:this.scaleY,x:t.x,y:t.y},300,Laya.Ease.sineOut,new Laya.Handler(this,()=>{let t=this.parent.parent;t.array[t.array.length-1]=e.dataSource,this.dataSource=e.dataSource,e.destroy()}))}openInfo(e,t){this.selectBg.visible=e,this.info.visible=e,e?(this.showBg.play(0,!1),0==t?(this.next.visible=!0,this.out.visible=!1):1==t&&(this.next.visible=!1,this.out.visible=!0)):(this.next.visible=!1,this.out.visible=!1)}}class P extends i.composeUI{constructor(){super(...arguments),this.curGroupDataLocal=null,this.curGroupNumberLocal=null,this.curLevelLocal=null,this.diamondLocal=null,this.goldLocal=null,this.houseLocal=null,this.newCardIdLocal=null,this.diamondCost=0,this.goldCost=0,this.cellArray=[],this.cellTipArray=[],this.curIndex=0,this.newCard=null,this.isSelect=!1,this.isComposing=!1,this.flyCount=0,this.isDiamondCompose=!1,this.composeTipTween=null}onAwake(){this.houseList.vScrollBarSkin="",this.curGroupNumberLocal=f.get("curGroup"),this.curGroupDataLocal=f.get(`group${this.curGroupNumberLocal.value}`),this.curLevelLocal=f.get("curLevel"),this.diamondLocal=f.get("diamond"),this.goldLocal=f.get("gold"),this.houseLocal=f.get("house"),this.newCardIdLocal=f.get("newCardId"),this.houseList.mouseHandler=Laya.Handler.create(this,this.onHouseHandler,null,!1),this.houseList.scrollBar.changeHandler=Laya.Handler.create(this,this.onScrollBarHandler,null,!1),this.standBtn.on(Laya.Event.CLICK,this,this.selectStore,[0]),this.climbBtn.on(Laya.Event.CLICK,this,this.selectStore,[1]),this.flyBtn.on(Laya.Event.CLICK,this,this.selectStore,[2]),this.registerPageEvent(),this.updataCost(!0),this.headCell.dataSource=L.instance.getCardData(-1),this.bodyCell.dataSource=L.instance.getCardData(-1),this.handCell.dataSource=L.instance.getCardData(-1),this.cellArray.push(this.headCell,this.bodyCell,this.handCell),this.cellTipArray.push(this.selectTip1,this.selectTip2,this.selectTip3),this.headCell.on(Laya.Event.CLICK,this,this.onCellHandler,["head"]),this.bodyCell.on(Laya.Event.CLICK,this,this.onCellHandler,["body"]),this.handCell.on(Laya.Event.CLICK,this,this.onCellHandler,["hand"]),Laya.timer.frameLoop(1,this,this.onFrameLoop),this.selectStore(0),this.registerCustomEvent()}onFrameLoop(){this.light.x-=2,this.light.x<=-612&&(this.light.x=0)}onDestroy(){Laya.timer.clear(this,this.onFrameLoop),this.cancelCustomEvent()}onScrollBarHandler(e){this.isSelect&&e>=0&&(e>=this.houseList.scrollBar.max?p.event(a.NextChange,"hide"):p.event(a.NextChange,"show"))}onHouseDataChange(){this.selectStore(this.curIndex)}registerCustomEvent(){p.on(a.CardHouseChange,this,this.onHouseDataChange)}cancelCustomEvent(){p.off(a.CardHouseChange,this,this.onHouseDataChange)}onStoreTabHandler(e,t){if(!this.isComposing&&e.type==Laya.Event.CLICK){if(u.playSound("Click.mp3"),this.curIndex==t)return;this.selectStore(t)}}updataCost(e){if(e)this.diamondCost=0,this.goldCost=0,this.diamondCostLabel.text="",this.goldCostLabel.text="";else{let e=L.instance.getFightLevelByEXP(this.cellArray[0].dataSource.exp),t=L.instance.getFightLevelByEXP(this.cellArray[1].dataSource.exp),i=L.instance.getFightLevelByEXP(this.cellArray[2].dataSource.exp);this.goldCost=2*(e+t+i),this.diamondCost=Math.ceil(this.goldCost/10),this.diamondCostLabel.text=""+this.diamondCost,this.goldCostLabel.text=""+this.goldCost}}onCellHandler(e,t){if(t.type=Laya.Event.CLICK){u.playSound("Click.mp3");let t=null;if("head"==e?t=this.cellArray[0]:"body"==e?t=this.cellArray[1]:"hand"==e&&(t=this.cellArray[2]),t.isTweening||null==t.dataSource||0==t.dataSource.id)return;if(this.updataCost(!0),-1!=t.originalIndex){let e=this.houseList.getCell(t.originalIndex);e&&(e.bg.disabled=!1)}this.removeOrAddData(JSON.parse(JSON.stringify(t.dataSource)),!1);let i=t.clone(),a=t.localToGlobal(new Laya.Point,!1,this.cardView);i.pos(a.x,a.y),this.cardView.addChild(i),this.flyCenter(i),t.setEmpty(),this.updateSelectTip()}}onHouseHandler(e,t){if(!this.isComposing&&e.type==Laya.Event.CLICK){u.playSound("Click.mp3");let e=this.houseList.getCell(t),i=null,s=-1;for(let n=0;n<this.cellArray.length;n++){let r=this.cellArray[n];if(r.dataSource.id==e.dataSource.id)return void p.event(a.SendTip,[["已选择!"]]);0==r.dataSource.id&&-1==s&&(i=this.houseList.getCell(t),s=n,i.bg.disabled=!0)}let n=0;for(let e=0;e<this.cellArray.length;e++)0!=this.cellArray[e].dataSource.id&&n++;if(i){if(i.isTweening)return;_.Instance.finishTask("点击第一张合成卡牌");let e=this.cellArray[s];e.cardBlack.visible=!1;let a=i.clone(),r=i.localToGlobal(new Laya.Point);return a.anchorX=.5,a.anchorY=.5,a.pos(r.x+.5*i.width,r.y+.5*i.height),this.cardView.addChild(a),e.setOutFight(a,t),this.removeOrAddData(i.dataSource,!0),this.updateSelectTip(),void(2==n&&this.updataCost(!1))}p.event(a.SendTip,[["位置已满!"]])}}selectStore(e){this.curIndex=e,this.standBtn.skin="card/Btn_bule.png",this.climbBtn.skin="card/Btn_bule.png",this.flyBtn.skin="card/Btn_bule.png";let t=[];if(0==e){for(let e=0;e<this.houseLocal.value.length;e++){const i=this.houseLocal.value[e];2==i.type&&t.push(JSON.parse(JSON.stringify(i)))}this.standBtn.skin="card/Btn_yellow.png"}else if(1==e){for(let e=0;e<this.houseLocal.value.length;e++){const i=this.houseLocal.value[e];1==i.type&&t.push(JSON.parse(JSON.stringify(i)))}this.climbBtn.skin="card/Btn_yellow.png"}else if(2==e){for(let e=0;e<this.houseLocal.value.length;e++){const i=this.houseLocal.value[e];3==i.type&&t.push(JSON.parse(JSON.stringify(i)))}this.flyBtn.skin="card/Btn_yellow.png"}this.sortData(t),this.houseList.array=t,this.houseList.refresh(),this.onScrollBarHandler(this.houseList.scrollBar.value);for(let e=0;e<this.houseList.array.length;e++){let t=this.houseList.getCell(e);t&&(t.bg.disabled=!1,t.cellArray=this.cellArray)}this.clearComposeCellArray(),this.updateSelectTip()}registerPageEvent(){this.goldCompose.on(Laya.Event.CLICK,this,this.onMouseEvent,["goldCompose"]),this.diamondCompose.on(Laya.Event.CLICK,this,this.onMouseEvent,["diamondCompose"]),this.showTip.on(Laya.Event.MOUSE_DOWN,this,this.onMouseEvent,["showTip"]),this.showTip.on(Laya.Event.MOUSE_OUT,this,this.onMouseEvent,["showTip"])}onMouseEvent(e,t){if(t.stopPropagation(),!this.isComposing){if(t.type==Laya.Event.CLICK)if("goldCompose"==e)if(this.goldLocal.value>=this.goldCost){if(0==this.cellArray[0].dataSource.id||0==this.cellArray[1].dataSource.id||0==this.cellArray[2].dataSource.id)return p.event(a.SendTip,[["卡片不足!"]]),void u.playSound("Error.mp3");u.playSound("Click.mp3"),this.clearCellPosCard(),this.headPos.parent.alpha=1,this.bodyPos.parent.alpha=1,this.handPos.parent.alpha=1,this.isComposing=!0,this.flyCount=0,this.playCardFly(),this.isDiamondCompose=!1,this.goldLocal.value-=this.goldCost,1==_.Instance.visible&&(_.Instance.finishTask("点击普通合成"),_.Instance.hideGuide())}else p.event(a.SendTip,[["金币不足!"]]),u.playSound("Error.mp3");else if("diamondCompose"==e)if(this.diamondLocal.value>=this.diamondCost){if(0==this.cellArray[0].dataSource.id||0==this.cellArray[1].dataSource.id||0==this.cellArray[2].dataSource.id)return p.event(a.SendTip,[["卡片不足!"]]),void u.playSound("Error.mp3");this.clearCellPosCard(),this.headPos.parent.alpha=1,this.bodyPos.parent.alpha=1,this.handPos.parent.alpha=1,this.isComposing=!0,this.flyCount=0,this.playCardFly(),this.isDiamondCompose=!0,this.diamondLocal.value-=this.diamondCost,u.playSound("Click.mp3")}else p.event(a.SendTip,[["钻石不足!"]]),u.playSound("Error.mp3");t.target==this.showTip&&(this.composeTipTween&&(this.composeTipTween.recover(),this.composeTipTween=null),t.type==Laya.Event.MOUSE_DOWN?(this.composeTip.visible=!0,this.composeTipTween=Laya.Tween.to(this.composeTip,{alpha:1},250,Laya.Ease.sineOut)):t.type==Laya.Event.MOUSE_OUT&&(this.composeTipTween=Laya.Tween.to(this.composeTip,{alpha:0},250,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.composeTip.visible=!1}))))}}onComposeResultClosed(){this.blackMask.visible=!1,this.isComposing=!1,this.headCell.visible=!0,this.bodyCell.visible=!0,this.handCell.visible=!0,this.removeOrAddData(JSON.parse(JSON.stringify(this.newCard)),!1)}compose(e,t,i,a){let s=L.instance.getCardData(-1);s.id=this.newCardIdLocal.value,this.newCardIdLocal.value++;let n=e.skin.split("-"),r=t.skin.split("-"),o=i.skin.split("-");s.skin=`${n[0]}-${r[1]}-${o[2]}`,s.type=e.type;let l=[e,t,i];return l.sort((e,t)=>t.exp-e.exp),s.datatype=l[0].datatype,s.exp=l[0].exp+l[1].exp+l[2].exp,a&&(s.exp=Math.floor(2.5*s.exp)),s.exp=s.exp<24300?s.exp:24300,this.newCard=s,l[0].exp}updateCardStore(){let e=this.houseLocal.value,t=this.curGroupDataLocal.value;for(let i=0;i<3;i++){let a=this.cellArray[i];for(let t=0;t<e.length;t++)if(e[t].id==a.dataSource.id){e.splice(t,1);break}for(let e=0;e<t.length;e++)if(t[e].id==a.dataSource.id){t[e]=L.instance.getCardData(-1);break}}let i=[],a=[],s=[];for(let t=0;t<e.length;t++){const n=e[t];1==n.type?a.push(n):2==n.type?i.push(n):3==n.type&&s.push(n)}1==this.newCard.type?(a.push(this.newCard),this.sortData(a)):2==this.newCard.type?(i.push(this.newCard),this.sortData(i)):3==this.newCard.type&&(s.push(this.newCard),this.sortData(s));let n=i.concat(a,s);this.houseLocal.value=n,this.curGroupDataLocal.value=t}clearComposeCellArray(){for(let e=0;e<this.cellArray.length;e++)this.cellArray[e].setEmpty()}onSelect(){this.isSelect=!0,this.selectStore(this.curIndex)}playCardFly(){let e=null,t=null;if(0==this.flyCount?(e=this.headCell,t=this.headPos):1==this.flyCount?(e=this.bodyCell,t=this.bodyPos):2==this.flyCount&&(e=this.handCell,t=this.handPos),e){e.visible=!1;let i=e.clone(),a=e.localToGlobal(new Laya.Point);i.pos(a.x,a.y),i.anchorX=.5,i.anchorY=.5,i.rotation=e.parent.rotation,this.cardView.addChild(i),t.setOutFight(i,0)}this.flyCount++,this.flyCount>=3?(u.playSound("Compose.mp3"),this.blackMask.visible=!0,this.blackMask.alpha=0,Laya.Tween.to(this.blackMask,{alpha:1},300,Laya.Ease.linearNone),Laya.timer.once(300,this,()=>{this.loadSpine()})):Laya.timer.once(300,this,()=>{this.playCardFly()})}loadSpine(){return new Promise(e=>{u.loadSpines(["Fusion.sk"]).then(t=>{let i=t[0];i.name="fusion",i.pos(Laya.stage.width/2,Laya.stage.height/2);let n=this.compose(this.cellArray[0].dataSource,this.cellArray[1].dataSource,this.cellArray[2].dataSource,this.isDiamondCompose);Laya.Scene.load(s.composeShow,Laya.Handler.create(this,e=>{e.isShowEffect=!1,e.closeEffect=null,e.popupEffect=null,e.mouseEnabled=!0,e.open(!1),e.closeHandler=Laya.Handler.create(this,()=>{this.onComposeResultClosed(),this.updateCardStore(),this.clearComposeCellArray(),this.updateSelectTip(),p.event(a.ComposeNewCard)}),e.setModel(this.newCard,n,i),i.play(0,!1)})),Laya.Tween.to(this.headPos.parent,{alpha:0},80,Laya.Ease.linearNone),Laya.Tween.to(this.bodyPos.parent,{alpha:0},80,Laya.Ease.linearNone),Laya.Tween.to(this.handPos.parent,{alpha:0},80,Laya.Ease.linearNone),e()})})}clearCellPosCard(){this.headPos.dataSource=L.instance.getCardData(-1),this.bodyPos.dataSource=L.instance.getCardData(-1),this.handPos.dataSource=L.instance.getCardData(-1)}removeOrAddData(e,t){let i=[];for(let a=0;a<this.houseList.array.length;a++){let s=this.houseList.array[a];t?s&&s.id>0&&s.id!=e.id&&i.push(s):s&&s.id>0&&i.push(s)}t||i.push(e),this.sortData(i),this.houseList.array=i,this.houseList.refresh()}sortData(e){e.sort((e,t)=>t.attack-e.attack)}updateSelectTip(){let e=-1;for(let t=0;t<this.cellArray.length;t++)0==this.cellArray[t].dataSource.id&&-1==e?(e=t,this.cellTipArray[t].visible=!0):this.cellTipArray[t].visible=!1}flyCenter(e){let t=(this.cardView.width-e.width)/2,i=(this.cardView.height-e.height)/2;Laya.Tween.to(e,{x:t,y:i,alpha:0},200,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{e.destroy()}))}}class B{static findNodeByUrl(e,t){let i=t.split("/"),a=e;for(let e=0;e<i.length;e++)a=a.getChildByName(i[e]);return a}static findNodeByName(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);return a.name==t?a:this.findNodeByName(a,t)}}static findNodeByType(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);return a instanceof t?a:this.findNodeByType(a,t)}}static findNodesByType(e,t){let i=[];for(let a=0;a<e.numChildren;a++){let s=e.getChildAt(a);s instanceof t&&i.push(s),s.numChildren>0&&(i=i.concat(this.findNodeByType(s,t)))}return i}static getComponent(e,t){return e.getComponent(t)}static getComponents(e,t){return e.getComponents(t)}static getComponentInChildren(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);return this.getComponent(a,t)||this.getComponentInChildren(a,t)}}static getComponentsInChildren(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);return this.getComponents(a,t)||this.getComponentsInChildren(a,t)}}static tweenTo(e,t,i,a,s){let n={};for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){n[i+"Start"]=e.transform[i].clone();let a=new Laya.Vector3;Laya.Vector3.subtract(t[i],e.transform[i],a),n[i+"Diff"]=a}let r={value:0};return Laya.Tween.to(r,{value:1,update:Laya.Handler.create(this,()=>{for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let t=new Laya.Vector3,a=new Laya.Vector3;Laya.Vector3.scale(n[i+"Diff"],r.value,a),Laya.Vector3.add(n[i+"Start"],a,t),e.transform[i]=t}},null,!1)},i,a,s)}static projectPos(e,t){let i=new Laya.Vector4;return e.viewport.project(t,e.projectionViewMatrix,i),i}}class E extends i.composeShowUI{constructor(){super(...arguments),this.modelScene=null,this.modelCamera=null,this.player1Show=null,this.player2Show=null,this.player3Show=null,this.shine=null,this.isOpen=!1,this.animators=[],this.isFinish=!1}onAwake(){this.width=Laya.stage.width,this.height=Laya.stage.height,this.modelScene=this.scene3dBox.addChild(u.getRes("Show.ls")),this.modelCamera=this.modelScene.getChildByName("ShowCamera"),this.modelCamera.clearFlag=Laya.CameraClearFlags.DepthOnly,this.modelCamera.enableHDR=!1,this.shine=this.modelScene.getChildByName("Shine1"),this.player1Show=this.modelScene.getChildByName("Player1Show"),this.player2Show=this.modelScene.getChildByName("Player2Show"),this.player3Show=this.modelScene.getChildByName("Player3Show"),this.modelScene.visible=!0,this.shine.active=!1,Laya.timer.frameOnce(45,this,()=>{this.shine.active=!0})}onDestroy(){Laya.timer.clearAll(this),C.off(S.NEWGUIDETASK,this,this.onNewGuideTaskEvent)}onOpened(){this.useCardBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.scene3dBox.on(Laya.Event.CLICK,this,this.onBtnClick),C.on(S.NEWGUIDETASK,this,this.onNewGuideTaskEvent)}onNewGuideTaskEvent(e){"上阵卡牌"==e&&_.Instance.showGuide("上阵卡牌",this.useCardBtn)}clearModelScene(){this.modelScene&&(this.scene3dBox.removeChild(this.modelScene),this.player1Show.destroyChildren(),this.player2Show.destroyChildren(),this.player3Show.destroyChildren())}onBtnClick(e){this.isFinish&&(this.clearModelScene(),e.target==this.useCardBtn?(this.close(),_.Instance.finishTask("上阵卡牌",600),p.event(a.JumpPage,3)):e.target==this.scene3dBox&&this.close())}setModel(e,t,i){this.spineBox.addChild(i);let a=L.instance.getFightLevelByEXP(e.exp),s=L.instance.getFightData(e.datatype,a);Laya.timer.frameOnce(60,this,()=>{this.animators=[];let i=e.skin.split("-"),a="";2==e.type?a="Player1":1==e.type?a="Player2":3==e.type&&(a="Player3"),this.hpLabel.text="0",this.attackLabel.text="0",this.speedLabel.text="0",this.delayLabel.text="0",u.create([`${a}.lh`,`${a}_${i[0]}1.lh`,`${a}_${i[1]}3.lh`,`${a}_${i[2]}2.lh`]).then(()=>{let n=u.getRes(`${a}.lh`),r=u.getRes(`${a}_${i[0]}1.lh`),o=u.getRes(`${a}_${i[1]}3.lh`),l=u.getRes(`${a}_${i[2]}2.lh`);if(null==n||null==r||null==o||null==l)return;let h=Laya.Sprite3D.instantiate(n);h.addChild(Laya.Sprite3D.instantiate(r)),h.addChild(Laya.Sprite3D.instantiate(o)),h.addChild(Laya.Sprite3D.instantiate(l)),"Player3"==h.name?h.transform.position=new Laya.Vector3(0,-3,0):h.transform.position=new Laya.Vector3(0,0,0),"Player1"==a?this.player1Show.addChild(h):"Player2"==a?this.player2Show.addChild(h):"Player3"==a&&this.player3Show.addChild(h);let c=B.projectPos(this.modelCamera,new Laya.Vector3);c&&(this.propBg.pos(c.x/Laya.stage.clientScaleX-this.propBg.width/2,c.y/Laya.stage.clientScaleY-this.propBg.parent.y+25),Laya.timer.frameOnce(1,this,()=>{this.propBg.visible=!0,this.showExpBar(t,e.exp)}));for(let e=0;e<h.numChildren;e++){let t=h.getChildAt(e).getComponent(Laya.Animator);t&&this.animators.push(t)}this.onAnimationChange("Bron");let d=0,p=Math.ceil(s.hp/60),g=Math.ceil(s.atk/60),m=Math.ceil(s.speed/60),y=Math.ceil(s.atkgap/60);Laya.timer.frameLoop(1,this,()=>{if(d>70)return;d+=1;let e=Number(this.hpLabel.text),t=Number(this.attackLabel.text),i=Number(this.speedLabel.text),a=Number(this.delayLabel.text);e<s.hp?this.hpLabel.text=(e+p).toString():this.hpLabel.text=s.hp.toString(),t<s.atk?this.attackLabel.text=(t+g).toString():this.attackLabel.text=s.atk.toString(),i<s.speed?this.speedLabel.text=(i+m).toString():this.speedLabel.text=s.speed.toString(),a<s.atkgap?this.delayLabel.text=(a+y).toString():this.delayLabel.text=s.atkgap.toString()}),Laya.timer.once(1500,this,()=>{this.onAnimationChange("Stand"),this.isFinish=!0,_.Instance.showGuide("合成成功提示语",null)})})})}onAnimationChange(e){for(let t=0;t<this.animators.length;t++){const i=this.animators[t];i&&i.crossFade(e,.2,0,0)}}showExpBar(e,t){let i=L.instance.getExpSection(e),a=i.max-1;4==i.id&&(a=i.max);let s=e-i.min;this.expBar1.width=s/a*499,this.expBar2.width=s/a*499,this.expLabel.text=`${e}/${a}`;let n=L.instance.getExpSection(t);if(n.id>i.id){let e=n.max-1;4==n.id&&(e=n.max),Laya.MouseManager.enabled=!1,this.addExp2Bar(a,i.min,a).then(()=>{this.expBar1.width=0,this.expBar2.width=0,this.expLabel.text=`${n.min}/${e}`,this.addExp2Bar(t,n.min,e).then(()=>{Laya.MouseManager.enabled=!0})})}else Laya.MouseManager.enabled=!1,this.addExp2Bar(t,i.min,a).then(()=>{Laya.MouseManager.enabled=!0})}addExp2Bar(e,t,i){return new Promise(a=>{let s=(e-t)/(i-t)*499,n=Laya.Handler.create(this,()=>{let e=Math.floor(this.expBar2.width/499*(i-t))+t;this.expLabel.text=`${e}/${i}`},null,!1);Laya.Tween.to(this.expBar2,{width:s,update:n},1e3,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{a()}))})}}class R extends i.countUI{constructor(){super(...arguments),this.curLevelLocal=null,this.diamondLocal=null,this.moneyLocal=null,this.houseLocal=null,this.enemyPoolLocal=null,this.isSuccess=!1,this.unitConfig=null,this.firstReward=null,this.reward=null,this.isFirst=!1,this.starCondition=null}onAwake(){this.curLevelLocal=f.get("curLevel"),this.diamondLocal=f.get("diamond"),this.moneyLocal=f.get("gold"),this.enemyPoolLocal=f.get("enemyPool"),this.unitConfig=f.get("unit"),this.closeEffect=null,this.back.on(Laya.Event.CLICK,this,this.onMouseEvent,["back"]),this.next.on(Laya.Event.CLICK,this,this.onMouseEvent,["next"]),this.kuang.on(Laya.Event.CLICK,this,this.onMouseEvent,["kuang"]),this.continue.on(Laya.Event.CLICK,this,this.onMouseEvent,["continue"]),this.goCompose.on(Laya.Event.CLICK,this,this.onMouseEvent,["goCompose"]),this.goGift.on(Laya.Event.CLICK,this,this.onMouseEvent,["goGift"]),this.goMagic.on(Laya.Event.CLICK,this,this.onMouseEvent,["goMagic"]),this.goShop.on(Laya.Event.CLICK,this,this.onMouseEvent,["goShop"])}onOpened(){t.Instance.showBannerAd()}onClosed(){t.Instance.hideBannerAd(),t.Instance.initBannerAd()}setSuccess(e){if(p.event("BreakPoint",["关卡结束",this.curLevelLocal.value]),this.isSuccess=e,this.curLevelLocal=f.get("curLevel"),this.updateLevelData(),e){this.popInsertAd(),this.upgradeStage(),this.kuang.visible=!0,this.gou.visible=!0,this.winBox.visible=!0,this.composeTitle.visible=!1;let e=0,t=this.reward[1];this.isFirst&&(e+=this.firstReward[1]);let i=b.instance.getPropInfo(1005).value;if(t=Math.floor(t*(1+i)),e=Math.floor(e*(1+i)),this.goldLabel.text=t.toString(),this.diamondLabel.text=e.toString(),u.playSound("GameSuccess.mp3"),this.title.skin="count/Ui_Victory.png",this.light.skin="count/Ui_VictoryLight.png",this.lostFrame.visible=!1,this.next.visible=!0,this.continue.visible=!1,b.instance.isPVP){let e=f.get("pvpWinCount"),t=f.get("pvp"),i=f.get("curDivision");e.value++;let a=t[i.value];a&&e.value==a.winCount&&(e.value=0,i.value++),this.continue.visible=!0,this.next.visible=!1}else p.event("BreakPoint",["关卡进度",this.curLevelLocal.value+1])}else b.instance.isPVP||p.event("BreakPoint",["关卡失败",this.curLevelLocal.value]),this.kuang.visible=!1,this.winBox.visible=!1,this.composeTitle.visible=!0,u.playSound("GameLose.mp3"),this.lostFrame.visible=!0,this.next.visible=!1,this.continue.visible=!1,this.title.skin="count/Ui_Fail.png",this.light.skin="count/Ui_FailLight.png";this.curLevelLocal.value<=2&&(this.next.visible=!1,this.lostFrame.visible=!1,this.continue.visible=!1,this.back.visible=!0,this.back.x=258,this.kuang.visible=!1),this.isSuccess&&this.curLevelLocal.value++,this.isSuccess&&!b.instance.isPVP&&this.unlockCard()}onMouseEvent(e,i){if(i.type==Laya.Event.CLICK)if(u.playSound("Open.mp3"),"back"==e||"goCompose"==e||"goMagic"==e||"goShop"==e||"goGift"==e)this.isSuccess?1==this.kuang.visible&&1==this.gou.visible?t.Instance.showVideoAd(()=>{this.receiveReward(!0),this.backToMainEvent(e)}):(this.receiveReward(!1),this.backToMainEvent(e)):this.backToMainEvent(e);else if("next"==e){if(0==_.Instance.guideFinish)return;1==this.kuang.visible&&1==this.gou.visible?t.Instance.showVideoAd(()=>{this.receiveReward(!0),this.upgradePlayStage(),this.nextBtnEvent()}):(this.receiveReward(!1),this.upgradePlayStage(),this.nextBtnEvent())}else"kuang"==e?this.gou.visible=!this.gou.visible:"continue"==e&&(1==this.kuang.visible&&1==this.gou.visible?t.Instance.showVideoAd(()=>{this.receiveReward(!0),this.close(),Laya.Scene.open(s.match)}):(this.receiveReward(!1),this.close(),Laya.Scene.open(s.match)))}unlockCard(){let e=this.enemyPoolLocal.value,t=[];for(let i=0;i<16;i++)-1==e.indexOf(i)&&t.push(i);if(t.length>0){let i=t[v.getRandom(0,t.length-1)];e.push(i),this.enemyPoolLocal.value=e}}receiveReward(e){let t=Number(this.diamondLabel.text),i=Number(this.goldLabel.text),a=0,s=f.get("pvpCoin");if(a=f.get("pvp")[f.get("curDivision").value-1].pvpCoin,e&&(i*=2,a*=2),s.value+=a,this.diamondLocal.value=this.diamondLocal.value+t,this.moneyLocal.value=this.moneyLocal.value+i,this.isFirst){let e=this.firstReward[2];if(e>=5e4&&e<=50019){let t=e%1e4,i=this.firstReward[3],a=L.instance.getCardData(t);a.exp=L.instance.getBaseExpByFightLevel(i),L.instance.addNewCard([a])}else if(e>=1101&&e<=1706){let t=this.firstReward[3],i=(e-e%100)/100%10-1,a=k.instance.magicCardNum;a[i]+=t,k.instance.magicCardNum=a}}}nextBtnEvent(){this.close(),Laya.Scene.open(s.gameLoad)}backToMainEvent(e){let t=b.instance.playStage;1==t[0]&&1==t[1]?mpsdk.Report.reportEvent(22):1==t[0]&&2==t[1]&&mpsdk.Report.reportEvent(30),Laya.Scene.load(s.main,Laya.Handler.create(this,t=>{this.close("back"),"goCompose"==e?t.curIndex=1:"goMagic"==e?t.curIndex=2:"goGift"==e?t.curIndex=2:"goShop"==e&&(t.curIndex=0),t.open()}))}upgradeStage(){let e=b.instance.playStage,t=e[1],i=e[0],a=k.instance.starRecord,s=10*(i-1)+t,n=a[s-1],r=this.countStar(),o=k.instance.curStage;null==n?(++t>10&&i<3&&(t=1,i=++i<3?i:3),t=t<10?t:10,o[0]=i,o[1]=t,a.push(r),k.instance.curStage=o,this.isFirst=!0):(this.isFirst=!1,r>n&&(a[s-1]=r)),k.instance.starRecord=a}upgradePlayStage(){let e=b.instance.playStage,t=e[0],i=e[1];++i>10&&(t=++t<3?t:3),i=i<10?i:10,b.instance.playStage=[t,i]}countStar(){let e=1,t=b.instance.countStar[this.starCondition[0]];return t<=this.starCondition[1]&&e++,t<=this.starCondition[0]&&e++,e}updateLevelData(){this.isFirst=!1;let e=u.getRes("map.json"),t=b.instance.playStage,i=e[10*(t[0]-1)+t[1]-1];this.firstReward=JSON.parse(i.firstReward),this.reward=JSON.parse(i.reward),this.starCondition=JSON.parse(i.fullStarCond)}popInsertAd(){this.curLevelLocal.value>=4&&this.curLevelLocal.value%2==0&&t.Instance.showInterstitialAd(null)}}class A extends i.divisionUI{set division(e){this._division=e;let t=Math.ceil(this._division/3),i=this._division%3;this.icon.skin=`rank/Ui_level${t}.png`,this.labelIcon.skin=`rank/Ui_duanwei${t}.png`,1==i?(this.star1.visible=!0,this.star2.visible=!1,this.star3.visible=!1):2==i?(this.star1.visible=!0,this.star2.visible=!0,this.star3.visible=!1):0==i&&(this.star1.visible=!0,this.star2.visible=!0,this.star3.visible=!0)}}class D extends i.divisionRewardUI{constructor(){super(...arguments),this.boxArr=[],this.pointArr=[],this.lineArr=[],this.divisionArr=[]}onAwake(){this.goldLocal=f.get("gold"),this.pvpWinCountLocal=f.get("pvpWinCount"),this.curDivisionLocal=f.get("curDivision"),this.pvpScoreLocal=f.get("pvpScore"),this.divisionRecordLocal=f.get("divisionRecord"),this.everydayDivisionRecordLocal=f.get("everydayDivisionRecord"),this.pvpConfig=f.get("pvp"),this.boxArr=[this.box1,this.box2,this.box3,this.box4,this.box5,this.box6,this.box7],this.lineArr=[this.line1,this.line2,this.line3,this.line4,this.line5,this.line6],this.pointArr=[this.point1,this.point2,this.point3,this.point4,this.point5,this.point6,this.point7],this.divisionArr=[this.division1,this.division2,this.division3,this.division4,this.division5,this.division6,this.division7],this.box1.on(Laya.Event.CLICK,this,this.onBoxEvent,[1]),this.box2.on(Laya.Event.CLICK,this,this.onBoxEvent,[2]),this.box3.on(Laya.Event.CLICK,this,this.onBoxEvent,[3]),this.box4.on(Laya.Event.CLICK,this,this.onBoxEvent,[4]),this.box5.on(Laya.Event.CLICK,this,this.onBoxEvent,[5]),this.box6.on(Laya.Event.CLICK,this,this.onBoxEvent,[6]),this.box7.on(Laya.Event.CLICK,this,this.onBoxEvent,[7]),this.receiveButton.on(Laya.Event.CLICK,this,this.onMouseEvent,["receive"]),this.initRewardProgress(),this.initDivisionInfo(),this.initEverydayReward()}format(e,t){var i={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[a]:("00"+i[a]).substr((""+i[a]).length)));return e}initRewardProgress(){let e=this.divisionRecordLocal.value,t=Math.ceil(this.curDivisionLocal.value/3);for(let i=0;i<7;i++){let a=this.boxArr[i],s=this.divisionArr[i],n=this.lineArr[i-1],r=this.pointArr[i];i<t?(r.skin="rank/Ui_jindu3.png",n&&(n.skin="rank/Ui_jindu4.png"),a.visible=!0,s.visible=!0):(r.skin="rank/Ui_jindu1.png",n&&(n.skin="rank/Ui_jindu2.png"),a.visible=!1,s.visible=!1),1==e[i]?a.skin=`rank/Ui_box${i+1}open.png`:a.skin=`rank/Ui_box${i+1}.png`}}onBoxEvent(e,t){0==this.divisionRecordLocal.value[e-1]&&Laya.Scene.load(s.upDivision,Laya.Handler.create(this,t=>{t.open(!1),t.setDivision(3*e-2),t.closeHandler=Laya.Handler.create(this,()=>{this.initRewardProgress()})}))}initDivisionInfo(){let e=this.pvpConfig[this.curDivisionLocal.value];this.divisionIcon.division=this.curDivisionLocal.value,this.divisionIcon.labelIcon.visible=!0,this.rankNum.text="1",this.scoreLabel.text=this.pvpScoreLocal.value,this.successNeedLabel.text=`胜场${this.pvpWinCountLocal.value}/${e.winCount}`}initEverydayReward(){let e=this.pvpConfig[this.curDivisionLocal.value-1];this.moneyAddLabel.text=e.rankRewardCoin.toString(),this.format("yyyy-MM-dd",new Date)!=this.everydayDivisionRecordLocal.value&&(this.everydayDivisionRecordLocal.value="");let t=Math.ceil(this.curDivisionLocal.value/3);""!=this.everydayDivisionRecordLocal.value?(this.receiveButton.skin="rank/Btn_received.png",this.receiveButton.mouseEnabled=!1,this.curRewardBox.skin=`rank/Ui_box${t}open.png`):(this.receiveButton.mouseEnabled=!0,this.receiveButton.skin="rank/Btn_receive.png",this.curRewardBox.skin=`rank/Ui_box${t}.png`);let i=f.get("shop").value;for(let e=0;e<2;e++){let t=i[v.getRandom(0,i.length-1)];0==e?this.fightCell1.dataSource=t:1==e&&(this.fightCell2.dataSource=t)}}onMouseEvent(e,t){"receive"==e&&this.receiveEverydayReward()}receiveEverydayReward(){this.goldLocal.value+=Number(this.moneyAddLabel.text);let e=this.format("yyyy-MM-dd",new Date);this.everydayDivisionRecordLocal.value=e;let t=f.get("house"),i=f.get("newCardId"),s=t.value;for(let e=0;e<2;e++){let a;0==e?a=this.fightCell1.dataSource:1==e&&(a=this.fightCell2.dataSource),a.id=i.value,i.value++,s.push(a),t.value=s}p.event(a.CardHouseChange),this.initEverydayReward()}}class M extends i.freeTryUI{onAwake(){let e=L.instance.getCardData(16);e.cost=5,e.id=1,this.card.dataSource=e,this.freeUse.on(Laya.Event.CLICK,this,this.onMouseEvent),this.freeNo.on(Laya.Event.CLICK,this,this.onMouseEvent)}onMouseEvent(e){e.target==this.freeUse?(t.Instance.showVideoEventId=201,t.Instance.showVideoAd(()=>{this.close("yes")})):e.target==this.freeNo&&this.close("no")}}!function(e){e[e.normal=0]="normal",e[e.cd=1]="cd"}(o||(o={}));class U extends i.gameCellUI{constructor(){super(...arguments),this.original=null,this.originalIndex=-1,this.curState=o.normal,this.isTweening=!1,this._cardData=null,this._realStoneNum=0,this.playRemindAni=!1,this._magicType=0,this._cost=0,this._increaseCost=0,this._originalCost=0,this._cdLeft=0,this._originalCd=0}onAwake(){Laya.timer.frameLoop(1,this,this.onFrameLoop)}onFrameLoop(){this._cdLeft>0&&(this._cdLeft-=Laya.timer.delta/1e3,this._cdLeft<=0&&(this._cdLeft=0))}onDestroy(){Laya.timer.clear(this,this.onFrameLoop)}set dataSource(e){if(e){if(this._magicType=e.magicType,this._magicType){let e=b.instance.magicData[this._magicType];this.magicImage.visible=!0,this.magicImage.skin=`card/Ui_Magic${this._magicType}.png`,this.bg.visible=!1,this._originalCost=e.intialEnergy,this._increaseCost=e.increaseEnergy,this._originalCd=e.collDown,this.cost=this._originalCost}else{if(this.magicImage.visible=!1,this.bg.visible=!0,""!=e.skin){let t=e.skin.split("-");1==e.type?(this.foot1.visible=!0,this.head.skin=`part/${t[0]}1.png`,this.foot1.skin=`part/${t[2]}2.png`,this.body.skin=`part/${t[1]}3.png`,this.foot.skin=`part/${t[2]}4.png`):(this.foot1.visible=!1,this.head.skin=`part/${t[0]}1.png`,this.body.skin=`part/${t[1]}2.png`,this.foot.skin=`part/${t[2]}3.png`)}let t=L.instance.getColorByEXP(e.exp),i="";"white"==t?i="card/Ui_CardBg0.png":"green"==t?i="card/Ui_CardBg1.png":"blue"==t?i="card/Ui_CardBg2.png":"purple"==t&&(i="card/Ui_CardBg3.png"),e.cost?this._originalCost=e.cost:this._originalCost=L.instance.getOriginalCost(e.skin),this._increaseCost=1,this.cost=this._originalCost,this.bg.skin=i}this._cardData=e}}set realStoneNum(e){this._realStoneNum=e;let t=this._realStoneNum/this._cost;t<1?(this.maskFrame.visible=!0,this.bg.disabled=!0,this.magicImage.disabled=!0,this.cardMask.visible=!0,this.playRemindAni=!1,this.cardMask.graphics.clear(),this.cardMask.graphics.drawPie(75,101,200,360*t-90,270,"#ff0000","#ff0000",0)):(this.playRemindAni||(this.isMagic?this.remind1.play(0,!1):this.remind.play(0,!1),this.playRemindAni=!0),this.bg.disabled=!1,this.magicImage.disabled=!1,this.cardMask.visible=!1,this.maskFrame.visible=!1)}get dataSource(){return this._cardData}clone(){let e=new U;return e.original=this,e.width=this.width,e.height=this.height,e.dataSource=JSON.parse(JSON.stringify(this._cardData)),e}changeState(e){e!=this.curState&&(e==o.normal||e==o.cd&&Laya.timer.once(1e3*this._cardData.cd,this,()=>{this.changeState(o.normal)}),this.curState=e)}get cost(){return this._cost}set cost(e){this._cost=e,this._cardData&&(this._cardData.cost=e),this.costLabel.text=this._cost.toString()}setOutFight(e,t){this.originalIndex=t,this.isTweening=!0,this._cardData=e.dataSource,this.visible=!1;let i=this.parent.localToGlobal(new Laya.Point(this.x,this.y),!1,this.scene.parent.scene);Laya.Tween.to(e,{x:i.x,y:i.y},300,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.isTweening=!1,this.visible=!0,e.destroy(),this.dataSource=this._cardData}))}useCard(){this._cdLeft=this._originalCd,this.cost=this._cost+this._increaseCost,b.instance.countStar[1]+=this._cost}get isCd(){return this._cdLeft>0}get isMagic(){return this._magicType>0}get magicType(){return this._magicType}}class N extends i.gameLoadUI{constructor(){super(...arguments),this.moveSpeed=1}onOpened(){mpsdk.Report.reportEvent(18);let e=k.instance.curStage;1==e[0]&&2==e[1]&&(k.instance.useMagicType=[1],k.instance.magicCardUnlock=[1,0,0,0,0,0,0]),b.instance.updateMagicData(),Laya.timer.loop(60,this,this.onFrameLoop);let t=[],i=f.get("group1").value,a=f.get("enemyPool").value;for(let e=0;e<a.length;e++){let i=a[e];t.push(L.instance.getCardData(i))}let n=[16,17,18,19];for(let e=0;e<n.length;e++){let i=n[e];t.push(L.instance.getCardData(i))}let r=b.instance.helpUnitDataArr,o=this.getMonsterNames(i).concat(this.getMonsterNames(r),this.getMonsterNames(t),["SceneInfo.lh","MainCamera.lh","SelectLight.lh","SelectLightSkill.lh","BronEffect.lh","Skill_FireBall.lh","AddCrystal.lh","AddCrystal10.lh","AddCrystal20.lh","AddCrystal30.lh","MissilePoint1.lh","MissileSizu1.lh","MissileSizu2.lh","MissileShuangzu1.lh","MissileDragon1.lh","MissileDragon2.lh","MissileDragon3.lh","ExplodeDragon1.lh","ExplodeDragon2.lh","ExplodeDragon3.lh","ExplodeShuangzu1.lh","ExplodeSizu1.lh","Rune1.lh","Rune2.lh","Rune3.lh","Rune4.lh","RuneBuff1.lh","RuneBuff2.lh","RuneBuff3.lh","RuneLight1.lh","RuneLight2.lh","RuneLight3.lh","CastleFire1.lh","CastleFire2.lh","Castle1_Boom.lh","Castle2_Boom.lh","Weather_Electric.lh","Weather_Flash.lh","Weather_Fog.lh","Weather_Rain.lh","Weather_Sun1.lh","Weather_Sun2.lh","Weather_Sun3.lh","Weather_Wind.lh","SelectLightSkill1.lh","SelectLightSkill2.lh","SelectLightSkill3.lh","SelectLightSkill4.lh","SelectLightSkill5.lh","Skill1.lh","Skill2.lh","Skill3.lh","Skill3Buff.lh","FX_TowerBron.lh","MissileTower1.lh","MissileTower2.lh","Tower1.lh","Tower2.lh","TowerDeath1.lh","TowerDeath2.lh","FX_Flash.lh","SelectLightSkill5_1.lh","SelectLightSkill5_2.lh","SelectLightSkill5_Range.lh","Skill6.lh","Skill6Buff.lh","NoEntry.lh"]);b.instance.isPVP?(o.push("LevelVS.ls"),b.instance.playStage=k.instance.curStage):o.push(`Level${b.instance.playStage[0]}.ls`),b.instance.updateMapBuffData(),u.create(o,this.onProgress.bind(this)).then(()=>{Laya.Scene.load(s.play,Laya.Handler.create(this,e=>{e.open(!0)}))})}onProgress(e){"download"==e.type?this.descLabel.text=`下载资源${e.name}中`:"create"==e.type&&(this.descLabel.text="创建资源中"),this.bar.width=520*e.progress,0==e.progress?this.bar.width=520*e.progress:Laya.Tween.to(this.bar,{width:520*e.progress},500,Laya.Ease.sineOut)}onDestroy(){Laya.timer.clearAll(this)}onFrameLoop(){this.bg.x-=this.moveSpeed,this.bg.y-=this.moveSpeed,this.bg.x<=-168&&(this.bg.x=0,this.bg.y=0)}getMonsterNames(e){let t=[],i=[];for(let a=0;a<e.length;a++){const s=e[a];let n=s.skin.split("-");for(let e=0;e<n.length;e++){const a=n[e];-1==i.indexOf(a)&&(i.push(a),1==s.type?(t.push(`Player2_${a}1.lh`),t.push(`Player2_${a}2.lh`),t.push(`Player2_${a}3.lh`),t.push("Player2.lh")):2==s.type?(t.push(`Player1_${a}1.lh`),t.push(`Player1_${a}2.lh`),t.push(`Player1_${a}3.lh`),t.push("Player1.lh")):3==s.type&&(t.push(`Player3_${a}1.lh`),t.push(`Player3_${a}2.lh`),t.push(`Player3_${a}3.lh`),t.push("Player3.lh")))}}return t}}class O extends i.giftCellUI{constructor(){super(...arguments),this._curLevel=0}onAwake(){this.on(Laya.Event.CLICK,this,this.onClick)}set dataSource(e){if(!e)return;this._dataSource=e;let t=b.instance.getPropInfo(e.attType);t.propArr==b.instance.commonGiftProp?(this.giftImage.skin=`gift/Ui_TianFuCommon${5*t.y+t.x}.png`,this.timeLogo.visible=!1):(this.giftImage.skin=`gift/Ui_TianFuBattle${t.y+4*t.x}.png`,t.propArr==b.instance.fightGiftProp?this.timeLogo.visible=!1:this.timeLogo.visible=!0)}setState(e,t,i,a,s){this.bg.disabled=!!e,t>0?(this.levelBg.visible=!0,this.giftLevel.text=t+"",this._curLevel=t):this.levelBg.visible=!1,this.newLogo.visible=i,this.lockImage.visible=!a,this.selectLight.visible=s}get isFullLevel(){return this._curLevel==this._dataSource.levels}onClick(){p.event(a.GiftCellClick,this._dataSource)}}class V extends i.giftUI{constructor(){super(...arguments),this._curShowGift=-1,this.isSelect=!1,this.commonSelectId=0,this.fightSelectId=0,this.diamondLocal=null,this.moneyLocal=null,this.maxScrollValue=0,this.commonPanelMax=0,this.fightPanelMax=0,this.commonLockY=0,this.fightLockY=0}onAwake(){this.diamondLocal=f.get("diamond"),this.moneyLocal=f.get("gold"),this.commonGiftPanel.vScrollBarSkin=null,this.fightGiftPanel.vScrollBarSkin=null,b.instance.initGiftData(),this.showGift(0),this.fightGiftTitle.on(Laya.Event.CLICK,this,this.onClick),this.commonGiftTitle.on(Laya.Event.CLICK,this,this.onClick),this.upgradeBtn.on(Laya.Event.CLICK,this,this.onClick),p.on(a.GiftCellClick,this,this.onGiftCellClick),this.fightGiftPanel.vScrollBar.changeHandler=Laya.Handler.create(this,this.scrollChangeHandler,null,!1),this.commonGiftPanel.vScrollBar.changeHandler=Laya.Handler.create(this,this.scrollChangeHandler,null,!1)}scrollChangeHandler(e){e>=this.maxScrollValue&&(0==this._curShowGift?(this.commonGiftPanel.vScrollBar.stopScroll(),this.commonGiftPanel.vScrollBar.value=this.maxScrollValue):(this.fightGiftPanel.vScrollBar.stopScroll(),this.fightGiftPanel.vScrollBar.value=this.maxScrollValue))}onGiftCellClick(e){1==this._curShowGift?this.fightSelectId=e.id:this.commonSelectId=e.id,this.updateGiftUI(this._curShowGift),this.updateGiftProp(this._curShowGift)}onDestroy(){p.off(a.GiftCellClick,this,this.onGiftCellClick)}onClick(e){if(e.target==this.fightGiftTitle)this.tweenTitleBg(1),this.showGift(1);else if(e.target==this.commonGiftTitle)this.tweenTitleBg(0),this.showGift(0);else if(e.target==this.upgradeBtn){let e=Number(this.moneyCost.text),t=Number(this.diamondCost.text);if(e>this.moneyLocal.value)return void p.event(a.SendTip,[["金币不足!"]]);if(t>this.diamondLocal.value)return void p.event(a.SendTip,[["钻石不足!"]]);if(this.moneyLocal.value-=e,this.diamondLocal.value-=t,0==this._curShowGift){let e=b.instance.upgradeGift(this.commonSelectId-1),t=k.instance.commonGiftUpgradeRecord;if(t[this.commonSelectId-1]++,k.instance.commonGiftUpgradeRecord=t,e.levels==t[this.commonSelectId-1]&&e.ifNext){let e=k.instance.commonGiftY;e++,k.instance.commonGiftY=e}}else{let e=b.instance.upgradeGift(this.fightSelectId-1),t=k.instance.fightGiftUpgradeRecord;if(t[this.fightSelectId-1-18]++,k.instance.fightGiftUpgradeRecord=t,e.levels==t[this.fightSelectId-1-18]&&e.ifNext){let e=k.instance.fightGiftY;e++,k.instance.fightGiftY=e}}this.updateGiftUI(this._curShowGift),this.updateGiftProp(this._curShowGift)}}tweenTitleBg(e){Laya.MouseManager.enabled=!1;let t=59;1==e&&(t=384),Laya.Tween.to(this.titleBg,{x:t},500,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{Laya.MouseManager.enabled=!0}))}showGift(e){e!=this._curShowGift&&(this._curShowGift=e,1==e?(this.fightGiftPanel.visible=!0,this.commonGiftPanel.visible=!1,this.upgradeRace.visible=!0,this.fightSelectId=19):(this.fightGiftPanel.visible=!1,this.commonGiftPanel.visible=!0,this.upgradeRace.visible=!1,this.commonSelectId=1),this.updateFrogData(this._curShowGift),this.updateGiftUI(this._curShowGift),this.updateGiftProp(this._curShowGift),this.updateFrogImage(this._curShowGift))}updateGiftUI(e){let t=0,i=this.commonCellBox,a=this.commonLineBox,s=k.instance.commonGiftUpgradeRecord,n=this.commonSelectId,r=this.commonLockY,o=k.instance.commonGiftY;1==e&&(s=k.instance.fightGiftUpgradeRecord,i=this.fightCellBox,a=this.fightLineBox,t=18,n=this.fightSelectId,r=this.fightLockY,o=k.instance.fightGiftY);let l=u.getRes("talent.json");for(let e=0;e<18;e++){let a=l[e+t],h=JSON.parse(a.pos),c=`cell${h[0]}_${h[1]}`,d=i.getChildByName(c);if(!d){(d=new O).dataSource=a,d.name=c;let e=this.getPos(h[0],h[1]);d.x=e.x,d.y=e.y,i.addChild(d)}let p=!1,g=!0,u=!1,m=!1,y=s[e],f=h[1];n==e+t+1&&(m=!0),f<r&&(f<=o&&(g=!1),u=!0),d.setState(g,y,p,u,m)}for(let e=0;e<18;e++){let s=l[e+t],n=JSON.parse(s.pos);if(s.ifNext){let e=this.isSameTypeNode(n),t=n[0]%2==0,s=null;s=e?`line${n[0]}_${n[1]}`:`line2_${n[1]}`;let r=a.getChildByName(s);if(!r){if((r=new Laya.Image).name=s,r.anchorX=.5,e||t||(r.anchorY=1,r.scaleY=-1),e){let e=this.getPos(n[0],n[1]);r.x=e.x,r.y=e.y,r.width=6,r.height=192}else{r.width=361,r.height=192;let e=this.getPos(2,n[1]);r.x=e.x,r.y=e.y}a.addChild(r)}if(e)i.getChildByName(`cell${n[0]}_${n[1]}`).isFullLevel?r.skin="gift/Ui_Line1.png":r.skin="gift/Ui_Line2.png";else if(t)i.getChildByName(`cell${n[0]}_${n[1]}`).isFullLevel?r.skin="gift/Ui_Line3.png":r.skin="gift/Ui_Line4.png";else{let e=i.getChildByName(`cell1_${n[1]}`),t=i.getChildByName(`cell3_${n[1]}`);e.isFullLevel&&t.isFullLevel?r.skin="gift/Ui_Line3.png":r.skin="gift/Ui_Line4.png"}}}0==e?(this.commonGiftPanel.refresh(),this.commonPanelMax=this.commonGiftPanel.vScrollBar.max):(this.fightGiftPanel.refresh(),this.fightPanelMax=this.fightGiftPanel.vScrollBar.max)}getPos(e,t){let i=new Laya.Point;return i.x=180*(e-2)+360,i.y=192*(t-1)+115,i}onSelect(){this.isSelect=!0,p.event(a.NextChange,"hide")}isSameTypeNode(e){let t=[1,4,5,8,9,12],i=e[1]+1;return e[0]%2!=0&&-1==t.indexOf(i)||e[0]%2==0&&-1!=t.indexOf(i)}updateGiftProp(e){let t=u.getRes("talent.json"),i=0,a=this.commonSelectId,s=k.instance.commonGiftY,n=this.commonLockY,r=k.instance.commonGiftUpgradeRecord;1==e&&(i=18,a=this.fightSelectId,s=k.instance.fightGiftY,n=this.fightLockY,r=k.instance.fightGiftUpgradeRecord);let o=r[a-1-i],l=t[a-1],h=JSON.parse(l.pos)[1],c=b.instance.getPropInfo(l.attType),d=["能量获取","建筑生命值","建筑生命回复","击杀额外能量","游戏获得奖励"];c.propArr==b.instance.fightGiftProp?d=["攻击力","生命值","移动速度","攻击速度"]:c.propArr==b.instance.fightGiftTimeProp&&(d=["攻击力提升持续时间","生命值提升持续时间","移动速度提升持续时间","攻击速度提升持续时间"]);let p=JSON.parse(l.cost);this.moneyCost.text=p[1]+"",this.diamondCost.text=p[3]+"",this.giftName.text=l.name,h<n&&h<=s?o==l.levels?this.upgradeBtn.visible=!1:this.upgradeBtn.visible=!0:this.upgradeBtn.visible=!1,this.giftLevel.text=`LV.${o}`;let g=c.propArr[c.y];this.propAddList.bottom=0,this.propNameList.bottom=0,this.propValueList.bottom=0,c.propArr==b.instance.commonGiftProp?(this.upgradeRace.visible=!1,this.propAddList.repeatY=5,this.propNameList.repeatY=5,this.propValueList.repeatY=5):(this.propAddList.repeatY=4,this.propNameList.repeatY=4,this.propValueList.repeatY=4,this.upgradeRace.visible=!0,0==c.y?this.upgradeRace.skin="gift/Ui_TianFuBattleWord6.png":1==c.y?this.upgradeRace.skin="gift/Ui_TianFuBattleWord3.png":2==c.y?this.upgradeRace.skin="gift/Ui_TianFuBattleWord4.png":3==c.y&&(this.upgradeRace.skin="gift/Ui_TianFuBattleWord5.png"));let m=[];for(let e=0;e<d.length;e++)m.push({propName:{text:d[e]+":"}});this.propNameList.array=m;let y=[],f=[];for(let t=0;t<g.length;t++){let i="",a="";0==e&&4==t||1==e&&3==t?(i=Math.floor(100*g[t])+"%",a="+"+Math.floor(100*l.param)+"%"):0==e&&2==t?(i=g[t]+"/s",a="+"+l.param+"/s"):0==e&&0==t?(i=g[t]+"/m",a="+"+l.param+"/m"):(i=g[t]+"",a="+"+l.param),y.push({propValue:{text:i}}),t==c.x?(f.push({propAdd:{text:a}}),this.giftDesc.text=`${d[c.x]}${a}`):f.push({propAdd:{text:""}})}this.propValueList.array=y,this.propAddList.array=f,this.propAddList.bottom=25,this.propNameList.bottom=25,this.propValueList.bottom=25}updateFrogImage(e){let t=this.commonLockY,i=this.commonGiftPanel;if(1==e&&(t=this.fightLockY,i=this.fightGiftPanel),t>0){this.frogImage.visible=!0,i.addChild(this.frogImage);let e=this.getPos(2,t),a=e.y-i.height/2+75;a=a>0?a:0,this.maxScrollValue=a,this.frogImage.x=e.x,this.frogImage.y=e.y,i.refresh()}else this.frogImage.visible=!1,i==this.commonGiftPanel?this.maxScrollValue=this.commonPanelMax:this.maxScrollValue=this.fightPanelMax,i.refresh(),i.vScrollBar.stopScroll()}updateFrogData(e){let t=0;1==e&&(t=18);let i=k.instance.curStage,a=1e3*i[0]+i[1],s=0,n=null,r=u.getRes("talent.json");for(let e=0;e<18;e++){let i=r[e+t];if(i.unlockLevel>0&&i.unlockLevel>=a){s=i.unlockLevel,n=i;break}}if(s>0){let t=JSON.parse(n.pos);0==e?this.commonLockY=t[1]:this.fightLockY=t[1]}else 0==e?this.commonLockY=0:this.fightLockY=0}}class G extends i.handBookUI{onAwake(){G.colorFilter=new Laya.ColorFilter([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0]),this.cardList.vScrollBarSkin=null,this.updateTab(0),this.updateList(0)}onOpened(){this.tabList.mouseHandler=Laya.Handler.create(this,this.onMouseHandler,null,!1)}onDestroy(){G.colorFilter&&(G.colorFilter=null)}onMouseHandler(e,t){e.type==Laya.Event.CLICK&&G.selectTabIndex!=t&&(this.updateTab(t),this.updateList(t),G.selectTabIndex=t)}updateTab(e){let t=[];for(let i=0;i<4;i++){let a="handbook/Btn-JiChu";1==i?a="handbook/Btn-ShuangZu":2==i?a="handbook/Btn-SiZu":2==i&&(a="handbook/Btn-FeiLong");let s=a+"3.png",n=a+"2.png",r=!1;i==e&&(n=a+"1.png",r=!0),t.push({frame:{skin:n},light:{skin:s,visible:r}})}this.tabList.dataSource=t}updateList(e){let t=[];if(0==e){let e=[...L.instance.standNameArr,...L.instance.climbNameArr,...L.instance.flyNameArr];for(let i=0;i<e.length;i++){let a={type:0,skin:[e[i],e[i],e[i]].join("-"),isNew:!1,isUnlock:!1},s=L.instance.skinToId(a.skin);a.type=s.type,-1==k.instance.handBookRecord[s.id]?(a.isNew=!1,a.isUnlock=!1):(a.isUnlock=!0,-1==k.instance.newUnlockRecord[s.id]?a.isNew=!1:a.isNew=!0),t.push(a)}}else if(1==e||2==e||3==e){let i=L.instance.standNameArr;2==e?i=L.instance.climbNameArr:3==e&&(i=L.instance.flyNameArr);for(let e=0;e<i.length;e++)for(let a=0;a<i.length;a++)for(let s=0;s<i.length;s++){let n={skin:[i[e],i[a],i[s]].join("-"),isNew:!1,isUnlock:!1},r=L.instance.skinToId(n.skin);-1==k.instance.handBookRecord[r.id]?(n.isNew=!1,n.isUnlock=!1):(n.isUnlock=!0,-1==k.instance.newUnlockRecord[r.id]?n.isNew=!1:n.isNew=!0),t.push(n)}}this.cardList.dataSource=t}}G.selectTabIndex=0,G.colorFilter=null;class F extends i.handBookCellUI{set dataSource(e){if(this._dataSource=e,e){let t=e.skin.split("-");1==e.type?(this.foot1.visible=!0,this.head.skin=`part/${t[0]}1.png`,this.foot1.skin=`part/${t[2]}2.png`,this.body.skin=`part/${t[1]}3.png`,this.foot.skin=`part/${t[2]}4.png`):(this.foot1.visible=!1,this.head.skin=`part/${t[0]}1.png`,this.body.skin=`part/${t[1]}2.png`,this.foot.skin=`part/${t[2]}3.png`),e.isNew?this.newFlag.visible=!0:this.newFlag.visible=!1,e.isUnlock?(this.head.visible&&(this.head.filters=null),this.body.visible&&(this.body.filters=null),this.foot.visible&&(this.foot.filters=null),this.foot1.visible&&(this.foot1.filters=null)):(this.head.visible&&(this.head.filters=[G.colorFilter]),this.body.visible&&(this.body.filters=[G.colorFilter]),this.foot.visible&&(this.foot.filters=[G.colorFilter]),this.foot1.visible&&(this.foot1.filters=[G.colorFilter]))}}onOpened(){this.on(Laya.Event.CLICK,this,this.onClick)}onClick(){this._dataSource.isClick&&this._dataSource.isNew}}class H extends i.handbookNewRewardUI{}class X{constructor(){this.sameTime=0,this.lossLevel=0,p.on("BreakPoint",this,this.onBreakPoint)}static init(){X._BreakPointManager||(X._BreakPointManager=new X)}onBreakPoint(e,t){"关卡进度"==e?X.upload(t,`第${t}关`,e,0,0,e):"关卡失败"==e?(X.upload(t,`第${t}关`,e,0,0,e),0==this.lossLevel?(this.lossLevel=t,X.upload(t,`第${t}关`,"第一次失败",0,0,"第一次失败")):(t==this.lossLevel?(this.sameTime++,this.sameTime>=3&&X.upload(t,`第${t}关`,"3次以上失败",0,0,"3次以上失败")):this.sameTime=0,this.lossLevel=t)):"关卡开始"==e?"undefined"!=typeof wx&&wx.aldStage.onStart({stageId:t,stageName:`第${t}关`}):"关卡结束"==e&&"undefined"!=typeof wx&&wx.aldStage.onEnd({stageId:t,stageName:`第${t}关`})}static upload(e,t,i,a,s,n){"undefined"!=typeof wx&&(wx.aldLevel.onSetLevel({levelId:e,levelName:t}),wx.aldLevel.onPaySuccess({levelId:e,levelName:t,params:{amount:100,desc:n}}))}}class W extends i.loadUI{onAwake(){mpsdk.init(7107,"lszbn").then(e=>{console.log("获得openid",e),mpsdk.Report.reportEvent(11),mpsdk.Report.reportEvent(12)}).catch(e=>{console.log("初始化失败.",e)}),this.openWxShare(),Laya.MouseManager.multiTouchEnabled=!1,UIConfig.closeDialogOnSide=!1,p.init(),C.init(),g.init(),this.registerPlatformEvent(),u.init().then(()=>{u.loadFonts(["ZooFont0.fnt","ZooFont1.fnt","ZooFont2.fnt","Green.fnt","Word.fnt","TianFu.fnt"]).then(()=>{t.Instance.init(),f.init(),X.init(),this.onManagerInit()})})}openWxShare(){window.wx&&wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})}registerPlatformEvent(){Laya.Browser.onMiniGame&&(Laya.MiniAdpter.window.wx.onShow(()=>{console.log("OnShow"),p.event(a.OnShow)}),Laya.MiniAdpter.window.wx.onHide(()=>{console.log("OnHide"),p.event(a.OnHide)}))}onProgress(e){"download"==e.type?this.descLabel.text=`下载资源${e.name}中`:"create"==e.type&&(this.descLabel.text="创建资源中"),0==e.progress?this.progressMask.x=(e.progress-1)*this.progressMask.width:Laya.Tween.to(this.progressMask,{x:(e.progress-1)*this.progressMask.width},500,Laya.Ease.sineOut)}onManagerInit(){u.create(["fightLevel.json","gacha.json","gachapool.json","task.json","pvp.json","spell.json","map.json","buff.json","unit.json","talent.json","Main.ls","Card.ls","Show.ls"],this.onProgress.bind(this)).then(()=>{this.afterResLoad()})}afterResLoad(){let e=L.instance.getCardData(-1);f.setLocal("group1",[e,e,e]),f.setLocal("group2",[e,e,e]),f.setLocal("group3",[e,e,e]),f.setLocal("unlock",3),f.setLocal("curGroup",1),f.setLocal("gold",800),f.setLocal("diamond",4),f.setLocal("curLevel",1),f.setLocal("baseLevel",1),f.setLocal("mineLevel",1),f.setLocal("shopId",1),f.setLocal("wallBaseHp",500),f.setLocal("wallUpHp",100),f.setLocal("mineBaseCreate",60),f.setLocal("mineUpCreate",10),f.setLocal("pvpWinCount",0),f.setLocal("curDivision",1),f.setLocal("pvpCoin",0),f.setLocal("pvpScore",0),f.setLocal("divisionRecord",[0,0,0,0,0,0,0]),f.setLocal("everydayDivisionRecord",""),f.setLocal("signTimeStap",0),f.setLocal("signDay",1),f.setLocal("signed",0),f.setLocal("freeLottery",0),f.setLocal("refreshShopTimeStap",0),f.setJson("unit","unit.json"),f.setJson("pvp","pvp.json"),mpsdk.Report.reportLogin(f.get("gold").value,f.get("curLevel").value);let t=[],i=[0,1,2];for(let e=0;e<i.length;e++){let a=L.instance.getCardData(i[e]);a.id=e+1,t.push(a)}f.setLocal("house",t),f.setLocal("enemyPool",i),f.setLocal("shop",[]),f.setLocal("newCardId",t.length+1),u.download(["card.atlas","compose.atlas","count.atlas","game.atlas","gameload.atlas","gift.atlas","guide.atlas","handbook.atlas","lottery.atlas","main.atlas","map.atlas","match.atlas","part.atlas","rank.atlas","shop.atlas","sign.atlas","tip.atlas","try.atlas"]).then(()=>{_.Instance.init(),Laya.Scene.open(s.main)})}}class Y extends i.lotteryUI{constructor(){super(...arguments),this.rotateAngle=0,this.rotating=!1,this.tweenTarget={rotation:0},this.lotteryData=null,this.closeHandler=null}onAwake(){this.lotteryData=[{type:"package",desc:"钻石卡包",value:[3],per:.01},{type:"gold",desc:"+1999",value:1999,per:.01},{type:"gold",desc:"+188",value:188,per:.2},{type:"gold",desc:"+288",value:288,per:.08},{type:"card",desc:"卡牌 X3",value:3,per:.05},{type:"gold",desc:"+588",value:588,per:.05},{type:"gold",desc:"+88",value:88,per:.3},{type:"card",desc:"卡牌 X1",value:1,per:.3}],this.light.visible=!1,0==f.get("freeLottery").value?(this.freeGoBtn.visible=!0,this.videoGoBtn.visible=!1):(this.freeGoBtn.visible=!1,this.videoGoBtn.visible=!0),this.freeGoBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["freeGo"]),this.videoGoBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["videoGo"]),this.backBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["back"])}onMouseEvent(e,i){this.rotating||(u.playSound("Click.mp3"),"freeGo"==e?(this.freeGoBtn.visible=!1,this.videoGoBtn.visible=!0,f.get("freeLottery").value=1,this.startLottery()):"videoGo"==e?(t.Instance.showVideoEventId=204,t.Instance.showVideoAd(()=>{this.startLottery()})):"back"==e&&(p.event(a.MainShowOpen,!0),this.close(),this.closeHandler&&this.closeHandler.run()))}calculateResult(){let e=0,t=Math.random();for(let i=0;i<this.lotteryData.length;i++){let a=this.lotteryData[i];if(t<(e+=a.per))return console.log(a),i}}onDestroy(){Laya.timer.clearAll(this)}startLottery(){u.playSound("roate.mp3"),this.rotating=!0,this.light.visible=!1,this.tweenTarget.rotation=this.rewardPanel.rotation;let e=this.calculateResult(),t=45*e,i=this.calculateIndex();Laya.Tween.to(this.tweenTarget,{rotation:this.rewardPanel.rotation+1080,update:Laya.Handler.create(this,()=>{this.rewardPanel.rotation=this.tweenTarget.rotation;let e=this.calculateIndex();e==i||this.pointer.isPlaying||(this.pointer.play(0,!1),i=e)},null,!1)},3e3,Laya.Ease.sineIn,Laya.Handler.create(this,()=>{this.tweenTarget.rotation=this.rewardPanel.rotation;let a=this.rewardPanel.rotation%360,n=0;n=a>t?360+t-a:t-a,Laya.Tween.to(this.tweenTarget,{rotation:this.rewardPanel.rotation+1800+n,update:Laya.Handler.create(this,()=>{this.rewardPanel.rotation=this.tweenTarget.rotation;let e=this.calculateIndex();e==i||this.pointer.isPlaying||(this.pointer.play(0,!1),i=e)},null,!1)},5e3,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.light.visible=!0,this.rewardPanel.rotation=this.rewardPanel.rotation%360,this.rotating=!1;let t=this.lotteryData[e];Laya.Scene.load(s.lotteryResult,Laya.Handler.create(this,e=>{e.open(!1),e.setData(t)}))}))}))}calculateIndex(){let e=this.rewardPanel.rotation%360;return e>=22.5&&e<67.5?1:e>=67.5&&e<112.5?2:e>=112.5&&e<157.5?3:e>=157.5&&e<202.5?4:e>=202.5&&e<247.5?5:e>=247.5&&e<292.5?6:e>=292.5&&e<337.5?7:0}}class j extends i.lotteryResultUI{constructor(){super(...arguments),this.enemyPoolLocal=null,this.curLevelLocal=null,this.shopIdLocal=null,this.data=null,this.cardData=null}onAwake(){this.curLevelLocal=f.get("curLevel"),this.enemyPoolLocal=f.get("enemyPool"),this.shopIdLocal=f.get("shopId"),u.playSound("GetItem.mp3"),t.Instance.showBannerAd()}onClosed(){t.Instance.hideBannerAd(),t.Instance.initBannerAd()}setData(e){if(this.data=e,this.rewardName.text=e.desc,"gold"==e.type||"diamond"==e.type||"power"==e.type)"gold"==e.type?this.moneyImage.skin="sign/Ui_money.png":"diamond"==e.type?this.moneyImage.skin="sign/Ui_diamond.png":"power"==e.type&&(this.moneyImage.skin="main/Ui_power.png"),this.moneyImage.visible=!0,this.secretImage.visible=!1,this.cardCell1.visible=!1,this.cardCell2.visible=!1,this.cardCell3.visible=!1,this.receiveBtn.visible=!1,e.isDirect?(this.receiveVideoBtn.visible=!1,this.receiveDirectBtn.visible=!0):(this.receiveVideoBtn.visible=!0,this.receiveDirectBtn.visible=!1,Laya.timer.once(3e3,this,()=>{this.receiveDirectBtn.visible=!0}));else if("card"==e.type){if(this.receiveBtn.visible=!0,this.receiveVideoBtn.visible=!1,this.receiveDirectBtn.visible=!1,this.data.value instanceof Number){this.cardData=[];for(let e=0;e<this.data.value;e++)this.cardData.push(this.getPackageCard())}else this.cardData=this.data.value;1==e.value?(this.cardCell1.visible=!1,this.cardCell2.visible=!0,this.cell2.rotation=19,this.cardCell3.visible=!1,this.cardCell2.dataSource=this.cardData[0]):(this.cardCell1.visible=!0,this.cardCell2.visible=!0,this.cell2.rotation=-15,this.cardCell3.visible=!0,this.cardCell1.dataSource=this.cardData[0],this.cardCell2.dataSource=this.cardData[1],this.cardCell3.dataSource=this.cardData[2]),this.moneyImage.visible=!1,this.secretImage.visible=!1}else"package"==e.type&&(this.receiveBtn.visible=!0,this.receiveVideoBtn.visible=!1,this.receiveDirectBtn.visible=!1,this.moneyImage.visible=!1,this.secretImage.visible=!0,this.cardCell1.visible=!1,this.cardCell2.visible=!1,this.cardCell3.visible=!1,-1!=e.value.indexOf(1)?this.secretImage.skin="shop/Ui_bao1.png":-1!=e.value.indexOf(2)?this.secretImage.skin="shop/Ui_bao2.png":-1!=e.value.indexOf(3)&&(3==e.value.length?this.secretImage.skin="shop/Ui_kabaothree.png":this.secretImage.skin="shop/Ui_bao3.png"))}onOpened(){this.receiveBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["receive"]),this.receiveDirectBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["receiveDirect"]),this.receiveVideoBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["receiveVideo"])}onMouseEvent(e,i){u.playSound("Click.mp3"),"receive"==e?("card"==this.data.type?L.instance.addNewCard(this.cardData):"package"==this.data.type&&this.openPackage(this.data.value),this.close()):"receiveDirect"==e?("gold"==this.data.type?f.get("gold").value+=this.data.value:"diamond"==this.data.type?f.get("diamond").value+=this.data.value:"power"==this.data.type&&(k.instance.power=20),this.data.from&&"task"==this.data.from&&p.event(a.ReceiveTaskReward),this.close()):"receiveVideo"==e&&("gold"==this.data.type?t.Instance.showVideoAd(()=>{f.get("gold").value+=3*this.data.value,this.close()}):"diamond"==this.data.type?t.Instance.showVideoAd(()=>{f.get("diamond").value+=3*this.data.value,this.close()}):"power"==this.data.type&&t.Instance.showVideoAd(()=>{k.instance.power=20,this.close()}))}getPackageCard(){let e=L.instance.getCardData(v.getRandom(0,15));return e.id=1,e.exp=6,e}openPackage(e){let t=[],i=u.getRes("gacha.json");for(let a=0;a<e.length;a++){let s=i[e[a]-1],n=L.instance.getCardPackData(s);t.push(n),L.instance.addNewCard(n)}Laya.Scene.load(s.package,Laya.Handler.create(this,i=>{i.isModal=!0,i.isShowEffect=!1,i.width=Laya.stage.width,i.height=Laya.stage.height,i.open(!1),i.showBook(e,t)}))}}class z extends i.magicCardUI{set dataSource(e){if(this._dataSource=e,!e)return;this.magicImage.skin=`card/Ui_Magic${e.magicType}.png`,this.selectLight.visible=e.isSelect;let t=k.instance.magicCardNum[e.magicType-1];k.instance.magicCardUnlock[e.magicType-1]?(this.cardNum.visible=!0,this.lockImage.visible=!1,this.cardNum.text="X"+t):(this.cardNum.visible=!1,this.lockImage.visible=!0)}get dataSource(){return this._dataSource}}class $ extends Laya.Material{constructor(){super(),this._albedoIntensity=0,this._albedoColor=null,this._enableVertexColor=!1,this._enableLighting=!1,this._enableVertexColor=!1,this.setShaderName("UNLITBLINNPHONG"),this._albedoIntensity=1,this._albedoColor=new Laya.Vector4(1,1,1,1);var e=this._shaderValues;e.setVector($.ALBEDOCOLOR,new Laya.Vector4(1,1,1,1)),e.setVector($.MATERIALSPECULAR,new Laya.Vector4(1,1,1,1)),e.setNumber($.SHININESS,.078125),e.setNumber(Laya.Material.ALPHATESTVALUE,.5),e.setVector($.TILINGOFFSET,new Laya.Vector4(1,1,0,0)),this._enableLighting=!0,this.renderMode=$.RENDERMODE_OPAQUE}static __initDefine__(){$.SHADERDEFINE_DIFFUSEMAP=Laya.Shader3D.getDefineByName("DIFFUSEMAP"),$.SHADERDEFINE_NORMALMAP=Laya.Shader3D.getDefineByName("NORMALMAP"),$.SHADERDEFINE_SPECULARMAP=Laya.Shader3D.getDefineByName("SPECULARMAP"),$.SHADERDEFINE_TILINGOFFSET=Laya.Shader3D.getDefineByName("TILINGOFFSET"),$.SHADERDEFINE_ENABLEVERTEXCOLOR=Laya.Shader3D.getDefineByName("ENABLEVERTEXCOLOR")}static initShader(){$.__initDefine__();var e={a_Position:Laya.VertexMesh.MESH_POSITION0,a_Color:Laya.VertexMesh.MESH_COLOR0,a_Normal:Laya.VertexMesh.MESH_NORMAL0,a_Texcoord0:Laya.VertexMesh.MESH_TEXTURECOORDINATE0,a_Texcoord1:Laya.VertexMesh.MESH_TEXTURECOORDINATE1,a_BoneWeights:Laya.VertexMesh.MESH_BLENDWEIGHT0,a_BoneIndices:Laya.VertexMesh.MESH_BLENDINDICES0,a_Tangent0:Laya.VertexMesh.MESH_TANGENT0,a_MvpMatrix:Laya.VertexMesh.MESH_MVPMATRIX_ROW0,a_WorldMat:Laya.VertexMesh.MESH_WORLDMATRIX_ROW0},t={u_Bones:Laya.Shader3D.PERIOD_CUSTOM,u_DiffuseTexture:Laya.Shader3D.PERIOD_MATERIAL,u_SpecularTexture:Laya.Shader3D.PERIOD_MATERIAL,u_NormalTexture:Laya.Shader3D.PERIOD_MATERIAL,u_AlphaTestValue:Laya.Shader3D.PERIOD_MATERIAL,u_DiffuseColor:Laya.Shader3D.PERIOD_MATERIAL,u_MaterialSpecular:Laya.Shader3D.PERIOD_MATERIAL,u_Shininess:Laya.Shader3D.PERIOD_MATERIAL,u_TilingOffset:Laya.Shader3D.PERIOD_MATERIAL,u_WorldMat:Laya.Shader3D.PERIOD_SPRITE,u_MvpMatrix:Laya.Shader3D.PERIOD_SPRITE,u_LightmapScaleOffset:Laya.Shader3D.PERIOD_SPRITE,u_LightMap:Laya.Shader3D.PERIOD_SPRITE,u_LightMapDirection:Laya.Shader3D.PERIOD_SPRITE,u_CameraPos:Laya.Shader3D.PERIOD_CAMERA,u_Viewport:Laya.Shader3D.PERIOD_CAMERA,u_ProjectionParams:Laya.Shader3D.PERIOD_CAMERA,u_View:Laya.Shader3D.PERIOD_CAMERA,u_ViewProjection:Laya.Shader3D.PERIOD_CAMERA,u_ReflectTexture:Laya.Shader3D.PERIOD_SCENE,u_ReflectIntensity:Laya.Shader3D.PERIOD_SCENE,u_FogStart:Laya.Shader3D.PERIOD_SCENE,u_FogRange:Laya.Shader3D.PERIOD_SCENE,u_FogColor:Laya.Shader3D.PERIOD_SCENE,u_DirationLightCount:Laya.Shader3D.PERIOD_SCENE,u_LightBuffer:Laya.Shader3D.PERIOD_SCENE,u_LightClusterBuffer:Laya.Shader3D.PERIOD_SCENE,u_AmbientColor:Laya.Shader3D.PERIOD_SCENE,u_ShadowBias:Laya.Shader3D.PERIOD_SCENE,u_ShadowLightDirection:Laya.Shader3D.PERIOD_SCENE,u_ShadowMap:Laya.Shader3D.PERIOD_SCENE,u_ShadowParams:Laya.Shader3D.PERIOD_SCENE,u_ShadowSplitSpheres:Laya.Shader3D.PERIOD_SCENE,u_ShadowMatrices:Laya.Shader3D.PERIOD_SCENE,u_ShadowMapSize:Laya.Shader3D.PERIOD_SCENE,u_AmbientSHAr:Laya.Shader3D.PERIOD_SCENE,u_AmbientSHAg:Laya.Shader3D.PERIOD_SCENE,u_AmbientSHAb:Laya.Shader3D.PERIOD_SCENE,u_AmbientSHBr:Laya.Shader3D.PERIOD_SCENE,u_AmbientSHBg:Laya.Shader3D.PERIOD_SCENE,u_AmbientSHBb:Laya.Shader3D.PERIOD_SCENE,u_AmbientSHC:Laya.Shader3D.PERIOD_SCENE,"u_DirectionLight.color":Laya.Shader3D.PERIOD_SCENE,"u_DirectionLight.direction":Laya.Shader3D.PERIOD_SCENE,"u_PointLight.position":Laya.Shader3D.PERIOD_SCENE,"u_PointLight.range":Laya.Shader3D.PERIOD_SCENE,"u_PointLight.color":Laya.Shader3D.PERIOD_SCENE,"u_SpotLight.position":Laya.Shader3D.PERIOD_SCENE,"u_SpotLight.direction":Laya.Shader3D.PERIOD_SCENE,"u_SpotLight.range":Laya.Shader3D.PERIOD_SCENE,"u_SpotLight.spot":Laya.Shader3D.PERIOD_SCENE,"u_SpotLight.color":Laya.Shader3D.PERIOD_SCENE},i={s_Cull:Laya.Shader3D.RENDER_STATE_CULL,s_Blend:Laya.Shader3D.RENDER_STATE_BLEND,s_BlendSrc:Laya.Shader3D.RENDER_STATE_BLEND_SRC,s_BlendDst:Laya.Shader3D.RENDER_STATE_BLEND_DST,s_DepthTest:Laya.Shader3D.RENDER_STATE_DEPTH_TEST,s_DepthWrite:Laya.Shader3D.RENDER_STATE_DEPTH_WRITE},a=Laya.Shader3D.add("UNLITBLINNPHONG",null,null,!0),s=new Laya.SubShader(e,t);a.addSubShader(s),s.addShaderPass('\n#include "Lighting.glsl";\n#include "Shadow.glsl";\n\nattribute vec4 a_Position;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nattribute vec3 a_Normal;\nvarying vec3 v_Normal; \n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_WorldMat;\n#else\n\tuniform mat4 u_WorldMat;\n#endif\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\tvarying vec4 v_ShadowCoord;\n#endif\n\n#ifdef CALCULATE_SPOTSHADOWS\n\tvarying vec4 v_SpotShadowCoord;\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\n#ifdef SIMPLEBONE\n\t#ifdef GPU_INSTANCE\n\t\tattribute vec4 a_SimpleTextureParams;\n\t#else\n\t\tuniform vec4 u_SimpleAnimatorParams;\n\t#endif\n\tuniform sampler2D u_SimpleAnimatorTexture;\n\n\tuniform float u_SimpleAnimatorTextureSize; \n#endif\n\n\n#ifdef SIMPLEBONE\nmat4 loadMatFromTexture(float FramePos,int boneIndices,float offset)\n{\n\tvec2 uv;\n\tfloat PixelPos = FramePos+float(boneIndices)*4.0;\n\tfloat halfOffset = offset * 0.5;\n\tfloat uvoffset = PixelPos/u_SimpleAnimatorTextureSize;\n\tuv.y = floor(uvoffset)*offset+halfOffset;\n\tuv.x = mod(float(PixelPos),u_SimpleAnimatorTextureSize)*offset+halfOffset;\n\tvec4 mat0row = texture2D(u_SimpleAnimatorTexture,uv);\n\tuv.x+=offset;\n\tvec4 mat1row = texture2D(u_SimpleAnimatorTexture,uv);\n\tuv.x+=offset;\n\tvec4 mat2row = texture2D(u_SimpleAnimatorTexture,uv);\n\tuv.x+=offset;\n\tvec4 mat3row = texture2D(u_SimpleAnimatorTexture,uv);\n\tmat4 m =mat4(mat0row.x,mat0row.y,mat0row.z,mat0row.w,\n\t\t\t  mat1row.x,mat1row.y,mat1row.z,mat1row.w,\n\t\t\t  mat2row.x,mat2row.y,mat2row.z,mat2row.w,\n\t\t\t  mat3row.x,mat3row.y,mat3row.z,mat3row.w);\n\treturn m;\n}\n#endif\n\nvoid main()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform;\n\t \t#ifdef SIMPLEBONE\n\t\t\tfloat currentPixelPos;\n\t\t\t#ifdef GPU_INSTANCE\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\n\t\t\t#else\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\n\t\t\t#endif\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\n\t\t#else\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\t#endif\n\t\tposition=skinTransform*a_Position;\n\t #else\n\t\tposition=a_Position;\n\t#endif\n\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\tmat4 worldMat;\n\t#ifdef GPU_INSTANCE\n\t\tworldMat = a_WorldMat;\n\t#else\n\t\tworldMat = u_WorldMat;\n\t#endif\n\n\tmat3 worldInvMat;\n\t#ifdef BONE\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat*skinTransform));\n\t#else\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat));\n\t#endif  \n\tv_Normal=normalize(a_Normal*worldInvMat);\n\t#if defined(NORMALMAP)\n\t\tv_Tangent=normalize(a_Tangent0.xyz*worldInvMat);\n\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\t\tvec3 positionWS=(worldMat*position).xyz;\n\t\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t\tv_ViewDir = u_CameraPos-positionWS;\n\t\t#endif\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\t\t\tv_PositionWorld = positionWS;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t\t#else\n\t\t\tv_Texcoord0=a_Texcoord0;\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x,1.0-a_Texcoord1.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,1.0-a_Texcoord0.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t\tv_LightMapUV.y=1.0-v_LightMapUV.y;\n\t#endif\n\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\t\tv_ShadowCoord =getShadowCoord(vec4(positionWS,1.0));\n\t#endif\n\n\t#ifdef CALCULATE_SPOTSHADOWS\n\t\tv_SpotShadowCoord = u_SpotViewProjectMatrix*vec4(positionWS,1.0);\n\t#endif\n\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n        ','\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n\n#include "Lighting.glsl";\n#include "Shadow.glsl"\n\nuniform vec4 u_DiffuseColor;\n\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\nvarying vec3 v_Normal;\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvarying vec3 v_ViewDir; \n\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tuniform DirectionLight u_DirectionLight;\n\t\t#endif\n\t\t#ifdef POINTLIGHT\n\t\t\tuniform PointLight u_PointLight;\n\t\t#endif\n\t\t#ifdef SPOTLIGHT\n\t\t\tuniform SpotLight u_SpotLight;\n\t\t#endif\n\t#else\n\t\tuniform mat4 u_View;\n\t\tuniform vec4 u_ProjectionParams;\n\t\tuniform vec4 u_Viewport;\n\t\tuniform int u_DirationLightCount;\n\t\tuniform sampler2D u_LightBuffer;\n\t\tuniform sampler2D u_LightClusterBuffer;\n\t#endif\n\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef NORMALMAP \n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n\n#include "GlobalIllumination.glsl";//"GlobalIllumination.glsl use uniform should at front of this\n\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\tvarying vec4 v_ShadowCoord;\n#endif\n\n#ifdef CALCULATE_SPOTSHADOWS\n\tvarying vec4 v_SpotShadowCoord;\n#endif\n\n\nvoid main()\n{\n\tvec3 normal;//light and SH maybe use normal\n\t#if defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t#else\n\t\tnormal = normalize(v_Normal);\n\t#endif\n\n\tLayaGIInput giInput;\n\t#ifdef LIGHTMAP\t\n\t\tgiInput.lightmapUV=v_LightMapUV;\n\t#endif\n\tvec3 globalDiffuse=layaGIBase(giInput,1.0,normal);\n\t\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\n\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse),mainColor.a);\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n}\n',i,"Forward")}get _ColorR(){return this._albedoColor.x}set _ColorR(e){this._albedoColor.x=e,this.albedoColor=this._albedoColor}get _ColorG(){return this._albedoColor.y}set _ColorG(e){this._albedoColor.y=e,this.albedoColor=this._albedoColor}get _ColorB(){return this._albedoColor.z}set _ColorB(e){this._albedoColor.z=e,this.albedoColor=this._albedoColor}get _ColorA(){return this._albedoColor.w}set _ColorA(e){this._albedoColor.w=e,this.albedoColor=this._albedoColor}get _SpecColorR(){return this._shaderValues.getVector($.MATERIALSPECULAR).x}set _SpecColorR(e){this._shaderValues.getVector($.MATERIALSPECULAR).x=e}get _SpecColorG(){return this._shaderValues.getVector($.MATERIALSPECULAR).y}set _SpecColorG(e){this._shaderValues.getVector($.MATERIALSPECULAR).y=e}get _SpecColorB(){return this._shaderValues.getVector($.MATERIALSPECULAR).z}set _SpecColorB(e){this._shaderValues.getVector($.MATERIALSPECULAR).z=e}get _SpecColorA(){return this._shaderValues.getVector($.MATERIALSPECULAR).w}set _SpecColorA(e){this._shaderValues.getVector($.MATERIALSPECULAR).w=e}get _AlbedoIntensity(){return this._albedoIntensity}set _AlbedoIntensity(e){if(this._albedoIntensity!==e){var t=this._shaderValues.getVector($.ALBEDOCOLOR);Laya.Vector4.scale(this._albedoColor,e,t),this._albedoIntensity=e,this._shaderValues.setVector($.ALBEDOCOLOR,t)}}get _Shininess(){return this._shaderValues.getNumber($.SHININESS)}set _Shininess(e){e=Math.max(0,Math.min(1,e)),this._shaderValues.setNumber($.SHININESS,e)}get _MainTex_STX(){return this._shaderValues.getVector($.TILINGOFFSET).x}set _MainTex_STX(e){var t=this._shaderValues.getVector($.TILINGOFFSET);t.x=e,this.tilingOffset=t}get _MainTex_STY(){return this._shaderValues.getVector($.TILINGOFFSET).y}set _MainTex_STY(e){var t=this._shaderValues.getVector($.TILINGOFFSET);t.y=e,this.tilingOffset=t}get _MainTex_STZ(){return this._shaderValues.getVector($.TILINGOFFSET).z}set _MainTex_STZ(e){var t=this._shaderValues.getVector($.TILINGOFFSET);t.z=e,this.tilingOffset=t}get _MainTex_STW(){return this._shaderValues.getVector($.TILINGOFFSET).w}set _MainTex_STW(e){var t=this._shaderValues.getVector($.TILINGOFFSET);t.w=e,this.tilingOffset=t}get _Cutoff(){return this.alphaTestValue}set _Cutoff(e){this.alphaTestValue=e}set renderMode(e){switch(e){case $.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=Laya.Material.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=Laya.RenderState.CULL_BACK,this.blend=Laya.RenderState.BLEND_DISABLE,this.depthTest=Laya.RenderState.DEPTHTEST_LESS;break;case $.RENDERMODE_CUTOUT:this.renderQueue=Laya.Material.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=Laya.RenderState.CULL_BACK,this.blend=Laya.RenderState.BLEND_DISABLE,this.depthTest=Laya.RenderState.DEPTHTEST_LESS;break;case $.RENDERMODE_TRANSPARENT:this.renderQueue=Laya.Material.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=Laya.RenderState.CULL_BACK,this.blend=Laya.RenderState.BLEND_ENABLE_ALL,this.blendSrc=Laya.RenderState.BLENDPARAM_SRC_ALPHA,this.blendDst=Laya.RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=Laya.RenderState.DEPTHTEST_LESS;break;default:throw new Error("Material:renderMode value error.")}}get enableVertexColor(){return this._enableVertexColor}set enableVertexColor(e){this._enableVertexColor=e,e?this._shaderValues.addDefine($.SHADERDEFINE_ENABLEVERTEXCOLOR):this._shaderValues.removeDefine($.SHADERDEFINE_ENABLEVERTEXCOLOR)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(e){this._MainTex_STX=e}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(e){this._MainTex_STY=e}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(e){this._MainTex_STZ=e}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(e){this._MainTex_STW=e}get tilingOffset(){return this._shaderValues.getVector($.TILINGOFFSET)}set tilingOffset(e){!e||1==e.x&&1==e.y&&0==e.z&&0==e.w?this._shaderValues.removeDefine($.SHADERDEFINE_TILINGOFFSET):this._shaderValues.addDefine($.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector($.TILINGOFFSET,e)}get albedoColorR(){return this._ColorR}set albedoColorR(e){this._ColorR=e}get albedoColorG(){return this._ColorG}set albedoColorG(e){this._ColorG=e}get albedoColorB(){return this._ColorB}set albedoColorB(e){this._ColorB=e}get albedoColorA(){return this._ColorA}set albedoColorA(e){this._ColorA=e}get albedoColor(){return this._albedoColor}set albedoColor(e){var t=this._shaderValues.getVector($.ALBEDOCOLOR);Laya.Vector4.scale(e,this._albedoIntensity,t),this._albedoColor=e,this._shaderValues.setVector($.ALBEDOCOLOR,t)}get albedoIntensity(){return this._albedoIntensity}set albedoIntensity(e){this._AlbedoIntensity=e}get specularColorR(){return this._SpecColorR}set specularColorR(e){this._SpecColorR=e}get specularColorG(){return this._SpecColorG}set specularColorG(e){this._SpecColorG=e}get specularColorB(){return this._SpecColorB}set specularColorB(e){this._SpecColorB=e}get specularColorA(){return this._SpecColorA}set specularColorA(e){this._SpecColorA=e}get specularColor(){return this._shaderValues.getVector($.MATERIALSPECULAR)}set specularColor(e){this._shaderValues.setVector($.MATERIALSPECULAR,e)}get shininess(){return this._Shininess}set shininess(e){this._Shininess=e}get albedoTexture(){return this._shaderValues.getTexture($.ALBEDOTEXTURE)}set albedoTexture(e){e?this._shaderValues.addDefine($.SHADERDEFINE_DIFFUSEMAP):this._shaderValues.removeDefine($.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture($.ALBEDOTEXTURE,e)}get normalTexture(){return this._shaderValues.getTexture($.NORMALTEXTURE)}set normalTexture(e){e?this._shaderValues.addDefine($.SHADERDEFINE_NORMALMAP):this._shaderValues.removeDefine($.SHADERDEFINE_NORMALMAP),this._shaderValues.setTexture($.NORMALTEXTURE,e)}get specularTexture(){return this._shaderValues.getTexture($.SPECULARTEXTURE)}set specularTexture(e){e?this._shaderValues.addDefine($.SHADERDEFINE_SPECULARMAP):this._shaderValues.removeDefine($.SHADERDEFINE_SPECULARMAP),this._shaderValues.setTexture($.SPECULARTEXTURE,e)}get depthWrite(){return this._shaderValues.getBool($.DEPTH_WRITE)}set depthWrite(e){this._shaderValues.setBool($.DEPTH_WRITE,e)}get cull(){return this._shaderValues.getInt($.CULL)}set cull(e){this._shaderValues.setInt($.CULL,e)}get blend(){return this._shaderValues.getInt($.BLEND)}set blend(e){this._shaderValues.setInt($.BLEND,e)}get blendSrc(){return this._shaderValues.getInt($.BLEND_SRC)}set blendSrc(e){this._shaderValues.setInt($.BLEND_SRC,e)}get blendDst(){return this._shaderValues.getInt($.BLEND_DST)}set blendDst(e){this._shaderValues.setInt($.BLEND_DST,e)}get depthTest(){return this._shaderValues.getInt($.DEPTH_TEST)}set depthTest(e){this._shaderValues.setInt($.DEPTH_TEST,e)}clone(){var e=new $;return this.cloneTo(e),e}cloneTo(e){super.cloneTo(e);var t=e;t._enableLighting=this._enableLighting,t._albedoIntensity=this._albedoIntensity,t._enableVertexColor=this._enableVertexColor,this._albedoColor.cloneTo(t._albedoColor)}}$.RENDERMODE_OPAQUE=0,$.RENDERMODE_CUTOUT=1,$.RENDERMODE_TRANSPARENT=2,$.ALBEDOTEXTURE=Laya.Shader3D.propertyNameToID("u_DiffuseTexture"),$.NORMALTEXTURE=Laya.Shader3D.propertyNameToID("u_NormalTexture"),$.SPECULARTEXTURE=Laya.Shader3D.propertyNameToID("u_SpecularTexture"),$.ALBEDOCOLOR=Laya.Shader3D.propertyNameToID("u_DiffuseColor"),$.MATERIALSPECULAR=Laya.Shader3D.propertyNameToID("u_MaterialSpecular"),$.SHININESS=Laya.Shader3D.propertyNameToID("u_Shininess"),$.TILINGOFFSET=Laya.Shader3D.propertyNameToID("u_TilingOffset"),$.CULL=Laya.Shader3D.propertyNameToID("s_Cull"),$.BLEND=Laya.Shader3D.propertyNameToID("s_Blend"),$.BLEND_SRC=Laya.Shader3D.propertyNameToID("s_BlendSrc"),$.BLEND_DST=Laya.Shader3D.propertyNameToID("s_BlendDst"),$.DEPTH_TEST=Laya.Shader3D.propertyNameToID("s_DepthTest"),$.DEPTH_WRITE=Laya.Shader3D.propertyNameToID("s_DepthWrite"),$.SHADERDEFINE_DIFFUSEMAP=null,$.SHADERDEFINE_NORMALMAP=null,$.SHADERDEFINE_SPECULARMAP=null,$.SHADERDEFINE_TILINGOFFSET=null,$.SHADERDEFINE_ENABLEVERTEXCOLOR=null;class K{constructor(){$.initShader()}static init(){null==K._instance&&(K._instance=new K,Laya.loader.load("shaderconfig.json",Laya.Handler.create(this,e=>{for(const t in e)if(e.hasOwnProperty(t)){const i=e[t];for(let e=0;e<i.length;e++){let a=i[e],s=new Laya.ShaderVariant(Laya.Shader3D.find(t),a.subShaderIndex,a.passIndex,a.defineNames);Laya.Shader3D.debugShaderVariantCollection.add(s)}}Laya.Shader3D.debugShaderVariantCollection.compile()})))}}K._instance=null;class J extends i.mainUI{constructor(){super(...arguments),this.moveSpeed=1,this.tabNum=0,this.tabWidth=0,this.tabArray=[],this.tabIconArray=[],this.diArray=[],this.tabNameArray=[],this.pageArray=[],this.curIndex=2,this.tweenTarget=null,this.isTweening=!1,this.lastIndex=0,this.signPosDiff=0,this.signStartX=0,this.pageStartX=0,this.diamondLocal=null,this.goldLocal=null,this.mainShow=null,this.isLotteryOpen=!1,this.buyRecord=0}onAwake(){k.instance,K.init(),window.UserInfo={nickName:"快乐的男孩",avatarUrl:"guide/Ui_bear.png"},this.getUserInfo(),_.Instance.guideFinish&&this.getAuthorize(),this.mainShow=u.getRes("Main.ls"),this.mainShow.name="MainShow",this.mainShowBox.addChild(this.mainShow),this.changeSceneShader(),2==this.curIndex?this.mainShow.active=!0:this.mainShow.active=!1,this.initMainShow(),this.diamondLocal=f.get("diamond"),this.goldLocal=f.get("gold"),Laya.timer.loop(60,this,this.onFrameLoop),this.tabArray.push(this.tab1),this.tabArray.push(this.tab2),this.tabArray.push(this.tab3),this.tabArray.push(this.tab4),this.tabArray.push(this.tab5),this.diArray.push(this.di1),this.diArray.push(this.di2),this.diArray.push(this.di3),this.diArray.push(this.di4),this.pageArray.push(this.page_0),this.pageArray.push(this.page_1),this.pageArray.push(this.page_2),this.pageArray.push(this.page_3),this.pageArray.push(this.page_4),this.tabIconArray.push(this.tab1.getChildByName("icon")),this.tabIconArray.push(this.tab2.getChildByName("icon")),this.tabIconArray.push(this.tab3.getChildByName("icon")),this.tabIconArray.push(this.tab4.getChildByName("icon")),this.tabIconArray.push(this.tab5.getChildByName("icon")),this.tabNameArray.push(this.tab1.getChildByName("name")),this.tabNameArray.push(this.tab2.getChildByName("name")),this.tabNameArray.push(this.tab3.getChildByName("name")),this.tabNameArray.push(this.tab4.getChildByName("name")),this.tabNameArray.push(this.tab5.getChildByName("name")),this.tab1.on(Laya.Event.CLICK,this,this.onTabEvent,[0]),this.tab2.on(Laya.Event.CLICK,this,this.onTabEvent,[1]),this.tab3.on(Laya.Event.CLICK,this,this.onTabEvent,[2]),this.tab4.on(Laya.Event.CLICK,this,this.onTabEvent,[3]),this.tab5.on(Laya.Event.CLICK,this,this.onTabEvent,[4]),this.addMoney.on(Laya.Event.CLICK,this,this.onMouseEvent,["addMoney"]),this.addDiamond.on(Laya.Event.CLICK,this,this.onMouseEvent,["addDiamond"]),this.addPower.on(Laya.Event.CLICK,this,this.onMouseEvent,["addPower"]),this.tabNum=this.tabArray.length,this.tabWidth=Laya.stage.width/(this.tabNum+1),this.moveSign.width=2*this.tabWidth,this.initTab(),this.goldLabel.text=this.goldLocal.valueStr,this.diamondLabel.text=this.diamondLocal.valueStr,this.powerLabel.text=k.instance.power+"",this.registerCustomEvent(),this.onLotteryOpen(!1),u.playMusic("MainBGM.mp3",0)}onMouseEvent(e,t){if(t.stopPropagation(),"addMoney"==e){let e=k.instance.buyGoldTimeLeft;e>0&&(k.instance.buyGoldTimeLeft=e-1,this.openAdd(1))}else if("addDiamond"==e){let e=k.instance.buyDiamondTimeLeft;e>0&&(k.instance.buyDiamondTimeLeft=e-1,this.openAdd(2))}else"addPower"==e&&this.openAdd(3)}openAdd(e){Laya.Scene.load(s.addMoney,Laya.Handler.create(this,t=>{t.setMoneyType(e),t.open(!1)}))}getMonsterNames(e){let t=[],i=[];for(let a=0;a<e.length;a++){const s=e[a];let n=s.skin.split("-");for(let e=0;e<n.length;e++){const a=n[e];-1==i.indexOf(a)&&(i.push(a),1==s.type?(t.push(`Player2_${a}1.lh`),t.push(`Player2_${a}2.lh`),t.push(`Player2_${a}3.lh`),t.push("Player2.lh")):2==s.type?(t.push(`Player1_${a}1.lh`),t.push(`Player1_${a}2.lh`),t.push(`Player1_${a}3.lh`),t.push("Player1.lh")):3==s.type&&(t.push(`Player3_${a}1.lh`),t.push(`Player3_${a}2.lh`),t.push(`Player3_${a}3.lh`),t.push("Player3.lh")))}}return t}onNewGuideTaskEvent(e){if("开始欢迎语"==e)mpsdk.Report.reportEvent(13),_.Instance.showGuide(e,null);else if("点击卡组"==e)mpsdk.Report.reportEvent(14),_.Instance.showGuide(e,this.tab4);else if("点击选择一张卡片"==e)Laya.timer.once(400,this,()=>{let t=this.page_3,i=t.houseList.getCell(0);t.houseList.scrollBar.touchScrollEnable=!1,t.houseList.scrollBar.mouseWheelEnable=!1,_.Instance.showGuide(e,i)});else if("点击出战"==e){mpsdk.Report.reportEvent(15);let t=this.page_3.houseList.getCell(0);_.Instance.showGuide(e,t.out)}else if("战斗前激励语"==e)_.Instance.showGuide(e,null);else if("点击战斗"==e)mpsdk.Report.reportEvent(16),_.Instance.showGuide(e,this.tab3);else if("点击当前关卡"==e)Laya.timer.once(800,this,()=>{let t=this.page_2;_.Instance.showGuide(e,t.levelBtn)});else if("购买灵兽提示语"==e)_.Instance.showGuide(e,null);else if("点击商店"==e)_.Instance.showGuide(e,this.tab1),mpsdk.Report.reportEvent(23);else if("点击第一张双足卡片"==e)Laya.timer.once(400,this,()=>{let t=this.page_0;for(let i=0;i<t.houseList.length;i++){let a=t.houseList.getCell(i);if(2==a.cell.dataSource.type)return 0==this.buyRecord?mpsdk.Report.reportEvent(24):mpsdk.Report.reportEvent(25),void _.Instance.showGuide(e,a)}});else if("提示解锁合成系统"==e)_.Instance.showGuide(e,null);else if("点击合成"==e)mpsdk.Report.reportEvent(26),_.Instance.showGuide(e,this.tab2);else if("点击第一张合成卡牌"==e)Laya.timer.once(400,this,()=>{let t=this.page_1.houseList.getCell(0);_.Instance.showGuide(e,t)});else if("点击普通合成"==e){let t=this.page_1;_.Instance.showGuide(e,t.goldCompose),mpsdk.Report.reportEvent(27)}else"使用合成卡牌提示语"==e&&_.Instance.showGuide(e,null)}onOpened(){0==_.Instance.guideFinish&&_.Instance.sendNewGuideTaskEvent()}destroy(){this.mainShowBox.removeChild(this.mainShow),super.destroy()}onDestroy(){this.cancleCustomEvent(),this.clearMainShow()}registerCustomEvent(){p.on("DataChange",this,this.onDataChange),p.on(a.NextChange,this,this.onNextChange),p.on(a.JumpPage,this,this.onTabEvent),p.on(a.SelectCardChange,this,this.initMainShow),p.on(a.MainShowOpen,this,this.onMainShowOpen),p.on(a.LotteryOpen,this,this.onLotteryOpen),p.on(a.OnShow,this,this.onShow),C.on(S.NEWGUIDETASK,this,this.onNewGuideTaskEvent),C.on(S.UserDataChange,this,this.onUserDataChange)}onUserDataChange(e){"_power"==e&&(this.powerLabel.text=k.instance.power+"")}onShow(){u.playMusic("MainBGM.mp3",0)}cancleCustomEvent(){p.off("DataChange",this,this.onDataChange),p.off(a.NextChange,this,this.onNextChange),p.off(a.JumpPage,this,this.onTabEvent),p.off(a.SelectCardChange,this,this.initMainShow),p.off(a.MainShowOpen,this,this.onMainShowOpen),p.off(a.LotteryOpen,this,this.onLotteryOpen),p.off(a.OnShow,this,this.onShow),C.off(S.NEWGUIDETASK,this,this.onNewGuideTaskEvent),C.off(S.UserDataChange,this,this.onUserDataChange)}onMainShowOpen(e){this.mainShow.active=e}onLotteryOpen(e){e&&(this.lotteryPageBox.visible=!0,this.isLotteryOpen=!0,Laya.Scene.load(s.lottery,Laya.Handler.create(this,e=>{this.lotteryPageBox.addChild(e),e.closeHandler=Laya.Handler.create(this,()=>{this.isLotteryOpen=!1,this.lotteryPageBox.visible=!1})})))}onNextChange(e){if("show"==e){if(1==this.nextArrow.alpha||this.nextShow.wrapMode==Laya.FrameAnimation.WRAP_POSITIVE&&this.nextShow.isPlaying)return;this.nextJump.wrapMode=Laya.FrameAnimation.WRAP_PINGPONG,this.nextJump.play(0,!0),this.nextShow.wrapMode=Laya.FrameAnimation.WRAP_POSITIVE,this.nextShow.play(0,!1)}else if("hide"==e){if(0==this.nextArrow.alpha||this.nextShow.wrapMode==Laya.FrameAnimation.WRAP_REVERSE&&this.nextShow.isPlaying)return;this.nextJump.isPlaying&&this.nextJump.stop(),this.nextShow.wrapMode=Laya.FrameAnimation.WRAP_REVERSE,this.nextShow.play(0,!1)}}onDataChange(e){"gold"==e?this.goldLabel.text=this.goldLocal.valueStr:"diamond"==e&&(this.diamondLabel.text=this.diamondLocal.valueStr)}initTab(){let e=0;for(let t=0;t<this.tabArray.length;t++){const i=this.tabArray[t],a=this.tabIconArray[t],s=this.tabNameArray[t],n=this.pageArray[t],r=this.diArray[t];i.x=e,t==this.curIndex?(i.width=2*this.tabWidth,this.moveSign.x=i.x,a.centerY=-60,a.scale(1.2,1.2),s.alpha=1):(i.width=this.tabWidth,a.centerY=0,a.scale(1,1),s.alpha=0),e+=i.width,r&&(r.x=e-r.width/2),n.y=0,n.x=(t-this.curIndex)*Laya.stage.width}}onTabEvent(e,t){if(this.curIndex!=e&&!this.isTweening&&!this.isLotteryOpen){u.playSound("Click.mp3"),2==e?(this.initMainShow(),this.mainShow.active=!0):this.mainShow.active=!1,3==e?_.Instance.finishTask("点击卡组"):2==e?_.Instance.finishTask("点击战斗"):0==e?_.Instance.finishTask("点击商店"):1==e&&_.Instance.finishTask("点击合成"),this.lastIndex=this.curIndex,this.curIndex=e,this.isTweening=!0,this.signPosDiff=this.curIndex*this.tabWidth-this.moveSign.x,this.signStartX=this.moveSign.x,this.pageStartX=this.pageArray[this.curIndex].x,this.tweenTarget={progress:0};for(let e=0;e<this.pageArray.length;e++){const t=this.pageArray[e];this.curIndex==e?t.onSelect():t.isSelect=!1}Laya.Tween.to(this.tweenTarget,{progress:1,update:Laya.Handler.create(this,this.onTweenUpdate,null,!1)},380,Laya.Ease.backOut,Laya.Handler.create(this,this.onTweenComplete))}}onTweenUpdate(){let e=0;for(let t=0;t<this.tabArray.length;t++){const i=this.tabArray[t],a=this.tabIconArray[t],s=this.tabNameArray[t],n=this.pageArray[t],r=this.diArray[t];i.x=e,t==this.curIndex?(i.width=this.tabWidth+this.tabWidth*this.tweenTarget.progress,this.moveSign.x=this.tweenTarget.progress*this.signPosDiff+this.signStartX,a.scale(1+.2*this.tweenTarget.progress,1+.2*this.tweenTarget.progress),a.centerY=-60*this.tweenTarget.progress,s.alpha=this.tweenTarget.progress):t==this.lastIndex?(i.width=2*this.tabWidth-this.tabWidth*this.tweenTarget.progress,a.scale(1.2-.2*this.tweenTarget.progress,1.2-.2*this.tweenTarget.progress),a.centerY=60*this.tweenTarget.progress-60,s.alpha=1-this.tweenTarget.progress):i.width=this.tabWidth,t==this.curIndex?n.x=this.pageStartX-this.pageStartX*this.tweenTarget.progress:n.x=this.pageArray[this.curIndex].x+(t-this.curIndex)*Laya.stage.width,e+=i.width,r&&(r.x=e-r.width/2)}}onTweenComplete(){this.isTweening=!1}onFrameLoop(){this.bg.x-=this.moveSpeed,this.bg.y-=this.moveSpeed,this.bg.x<=-168&&(this.bg.x=0,this.bg.y=0)}clearMainShow(){if(this.mainShow)for(let e=0;e<6;e++)this.mainShow.getChildByName(`MianPoint${e+1}`).destroyChildren()}initMainShow(){if(1==f.get("curLevel").value)return;this.clearMainShow();let e=f.get("group1").value,t=this.getMonsterNames(e);u.create(t).then(()=>{for(let t=0;t<e.length;t++){const i=e[t];if(0!=i.id){let e=this.createRole(i);for(let t=0;t<6;t++){let i=this.mainShow.getChildByName(`MianPoint${t+1}`);if(0==i.numChildren){0!=t&&"Player3"==e.name&&(e.transform.localPosition=new Laya.Vector3(0,3,0)),i.addChild(e),this.playStandAnimation(e);break}}}}})}playStandAnimation(e){if(e)for(let t=0;t<e.numChildren;t++){let i=e.getChildAt(t).getComponent(Laya.Animator);i&&i.play("Stand",0,0)}}createRole(e){let t=e.skin.split("-"),i="";2==e.type?i="Player1":1==e.type?i="Player2":3==e.type&&(i="Player3");let a=u.getRes(`${i}.lh`),s=u.getRes(`${i}_${t[0]}1.lh`),n=u.getRes(`${i}_${t[1]}3.lh`),r=u.getRes(`${i}_${t[2]}2.lh`),o=Laya.Sprite3D.instantiate(a),l=Laya.Sprite3D.instantiate(s),h=Laya.Sprite3D.instantiate(n),c=Laya.Sprite3D.instantiate(r);return o.addChild(l),o.addChild(h),o.addChild(c),l.transform.localPosition=new Laya.Vector3,h.transform.localPosition=new Laya.Vector3,c.transform.localPosition=new Laya.Vector3,o}changeSceneShader(){if(this.mainShow){let e=this.mainShow.getChildByName("MainScene");for(let t=0;t<e.numChildren;t++){let i=e.getChildAt(t);if(i instanceof Laya.MeshSprite3D&&i.meshRenderer.sharedMaterial instanceof Laya.BlinnPhongMaterial){let e=new $;i.meshRenderer.sharedMaterial.cloneTo(e),e.albedoTexture=i.meshRenderer.sharedMaterial.albedoTexture,i.meshRenderer.sharedMaterial=e}}}}getUserInfo(){window.wx&&wx.getSetting({success:e=>{e.authSetting["scope.userInfo"]&&wx.getUserInfo({success:e=>{window.UserInfo=e.userInfo,this.playerName.text=window.UserInfo.nickName,this.playerHead.skin=window.UserInfo.avatarUrl}})}})}getAuthorize(){if(window.wx&&"1"!=Laya.LocalStorage.getItem("getUserInfo")){Laya.LocalStorage.setItem("getUserInfo","1");const e=wx.createUserInfoButton({type:"text",text:"",style:{left:0,top:0,width:Laya.stage.width,height:Laya.stage.height}});e.onTap(t=>{t.userInfo&&(window.UserInfo=t.userInfo,this.playerName.text=window.UserInfo.nickName,this.playerHead.skin=window.UserInfo.avatarUrl,mpsdk.Account.setAccountInfo(t.userInfo),mpsdk.Report.reportEvent(31)),e.destroy()})}}}class q extends i.modeUI{constructor(){super(...arguments),this.curGroupDataLocal=null,this.curGroupNumberLocal=null,this.unlockLocal=null,this.curLevelLocal=null,this.isSelect=!1}onAwake(){this.name="mode",this.curLevelLocal=f.get("curLevel"),this.unlockLocal=f.get("unlock"),this.curGroupNumberLocal=f.get("curGroup"),this.levelLabel.text=`第${this.curLevelLocal.valueStr}关`,this.registerPageEvent()}onDestroy(){}registerPageEvent(){this.levelBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["level"]),this.pvpBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["pvp"]),this.signBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["sign"]),this.lotteryBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["lottery"]),this.shopBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["shop"]),this.collectBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["collect"]),this.taskBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["task"]),this.welfareBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["welfare"])}onEnable(){3==this.curLevelLocal.value&&0==f.get("signed").value&&this.onBtnClick("sign")}onMouseEvent(e,t){if(t.stopPropagation(),"level"==e){p.event("BreakPoint",["关卡进度",this.curLevelLocal.value]),p.event("BreakPoint",["关卡开始",this.curLevelLocal.value]),this.curGroupDataLocal=f.get(`group${this.curGroupNumberLocal.value}`);for(let e=0;e<this.unlockLocal.value;e++){const t=this.curGroupDataLocal.value[e];if(t&&0!=t.id)return _.Instance.finishTask("点击当前关卡"),_.Instance.hideGuide(),u.playSound("Click.mp3"),void Laya.Scene.open(s.bigMap,!1,null,Laya.Handler.create(this,e=>{}))}u.playSound("Error.mp3"),Laya.Scene.load(s.cardTip,Laya.Handler.create(this,e=>{Laya.Dialog.manager.maskLayer.alpha=.5,e.open(),e.closeHandler=Laya.Handler.create(this,()=>{p.event(a.JumpPage,3)})}))}else"pvp"==e||"sign"==e||"lottery"==e||"shop"==e||"task"==e||"collect"==e?this.onBtnClick(e):t.target==this.welfareBtn&&Laya.Scene.open(s.welfare)}onBtnClick(e){if(u.playSound("Click.mp3"),"lottery"==e)p.event(a.LotteryOpen,!0);else if("shop"==e);else if("task"==e)Laya.Scene.open(s.task,!1,null,Laya.Handler.create(this,e=>{}));else if("collect"==e);else{this.playBox.visible=!1;let t=s.pvp;"sign"==e&&(t=s.sign),Laya.Scene.load(t,Laya.Handler.create(this,e=>{e.isModal=!0,e.width=Laya.stage.width,e.height=Laya.stage.height,e.open(!1),e.closeHandler=Laya.Handler.create(this,()=>{this.playBox.visible=!0,p.event(a.MainShowOpen,!0)})}))}}onSelect(){this.isSelect=!0,p.event(a.NextChange,"hide")}}class Z extends i.outCellUI{constructor(){super(...arguments),this.original=null,this.originalIndex=-1,this.isTweening=!1,this.cellArray=null,this._cardData=null,this._cost=10,this._cd=8,this.increaseSpeed=0,this.fightData=null}onAwake(){this.cost=10}onEnable(){}onDisable(){}set dataSource(e){if(!e)return;if(this.bg.disabled=!1,this.cellArray&&this.cellArray.length>0)for(let t=0;t<this.cellArray.length;t++){const i=this.cellArray[t];if(i.dataSource&&i.dataSource.id>0&&i.dataSource.id==e.id){this.bg.disabled=!0;break}}if(this._cardData=e,0==e.id)return void(this.bg.visible=!1);this.bg.visible=!0,this.setRaceIcon(e.type);let t=L.instance.getColorByEXP(e.exp);this.setColor(t);let i=L.instance.getFightLevelByEXP(e.exp);if(this.fightData=L.instance.getFightData(e.datatype,i),this.propList.array=[{icon:{skin:"compose/Ui_Attribute1.png"},prop:{text:this.fixed(this.fightData.atk)}},{icon:{skin:"compose/Ui_Attribute2.png"},prop:{text:this.fixed(this.fightData.hp)}},{icon:{skin:"compose/Ui_Attribute3.png"},prop:{text:this.fixed(Math.floor((2e3-this.fightData.atkgap)/10))}},{icon:{skin:"compose/Ui_Attribute4.png"},prop:{text:this.fixed(this.fightData.speed)}}],this.propList.refresh(),""!=e.skin){let t=e.skin.split("-");1==e.type?(this.foot1.visible=!0,this.head.skin=`part/${t[0]}1.png`,this.foot1.skin=`part/${t[2]}2.png`,this.body.skin=`part/${t[1]}3.png`,this.foot.skin=`part/${t[2]}4.png`):(this.foot1.visible=!1,this.head.skin=`part/${t[0]}1.png`,this.body.skin=`part/${t[1]}2.png`,this.foot.skin=`part/${t[2]}3.png`)}}setRaceIcon(e){let t="";1==e?t="card/Ui_LightP.png":2==e?t="card/Ui_LightY.png":3==e&&(t="card/Ui_LightG.png"),this.flagIcon.skin=t}fixed(e){return e%1!=0?e.toFixed(1):`${e}`}setColor(e){let t="",i="";this.cardLight.visible=!1,"white"==e?(t="card/Ui_CardBg0.png",i="card/Ui_CardBlack0.png"):"green"==e?(t="card/Ui_CardBg1.png",i="card/Ui_CardBlack1.png",this.cardLight.skin="card/Ui_Cardlight1.png",this.cardLight.visible=!0):"blue"==e?(t="card/Ui_CardBg2.png",i="card/Ui_CardBlack2.png",this.cardLight.skin="card/Ui_Cardlight2.png",this.cardLight.visible=!0):"purple"==e&&(t="card/Ui_CardBg3.png",i="card/Ui_CardBlack3.png",this.cardLight.skin="card/Ui_Cardlight3.png",this.cardLight.visible=!0),this.cardBlack.skin=i,this.bg.skin=t}get dataSource(){return this._cardData}clone(){let e=new Z;return e.original=this,e.width=this.width,e.height=this.height,e.dataSource=JSON.parse(JSON.stringify(this._cardData)),e}get cost(){return this._cost}set cost(e){this._cost=e}setOutFight(e,t){this.originalIndex=t,this.isTweening=!0,this._cardData=e.dataSource,this.visible=!1;let i=this.parent.parent,a=i.localToGlobal(new Laya.Point(this.x,this.y),!1,this.scene.parent.scene),s=i.scaleX*this.scaleX*this.width,n=i.scaleY*this.scaleY*this.height;Laya.Tween.to(e,{width:s,height:n,x:a.x,y:a.y},300,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.isTweening=!1,this.visible=!0,e.destroy(),this.dataSource=this._cardData,this.bg.disabled=!1}))}setEmpty(){this.originalIndex=-1,this._cardData=L.instance.getCardData(-1),this.dataSource=this._cardData}setNew(e){let t=this.localToGlobal(new Laya.Point,!1);Laya.Tween.to(e,{scaleX:1,scaleY:1,x:t.x,y:t.y},300,Laya.Ease.sineOut,new Laya.Handler(this,()=>{let t=this.parent.parent;t.array[t.array.length-1]=e.dataSource,this.dataSource=e.dataSource,e.destroy()}))}openInfo(e,t){this.selectBg.visible=e,this.info.visible=e,e?(this.showBg.play(0,!1),0==t?(this.next.visible=!0,this.out.visible=!1):1==t&&(this.next.visible=!1,this.out.visible=!0)):(this.next.visible=!1,this.out.visible=!1)}}class Q extends i.selectUI{constructor(){super(...arguments),this.diamondLocal=null,this.curGroupDataLocal=null,this.curGroupNumberLocal=null,this.houseLocal=null,this.unlockLocal=null,this.goldLocal=null,this.sorting=!1,this.unlockOutPage=null,this.curIndex=0,this.isSelect=!1,this.lastSelectIndex=-1,this.lastOutIndex=-1,this.selectType=0,this.curMagicType=0,this.curPageId=-1,this.pointerTweening=!1}onAwake(){this.curMagicType=1,this.tabList.hScrollBarSkin=null,this.houseList.vScrollBarSkin=null,this.magicCardList.hScrollBarSkin=null,this.allBtn.on(Laya.Event.CLICK,this,this.selectStore,[0]),this.standBtn.on(Laya.Event.CLICK,this,this.selectStore,[1]),this.climbBtn.on(Laya.Event.CLICK,this,this.selectStore,[2]),this.flyBtn.on(Laya.Event.CLICK,this,this.selectStore,[3]),this.useBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.upgradeBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.magicBox1.on(Laya.Event.CLICK,this,this.onBtnClick),this.magicBox2.on(Laya.Event.CLICK,this,this.onBtnClick),this.monsterBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.magicBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.houseList.mouseHandler=Laya.Handler.create(this,this.onHouseHandler,null,!1),this.tabList.mouseHandler=Laya.Handler.create(this,this.onSelectHandler,null,!1),this.eventList.mouseHandler=Laya.Handler.create(this,this.onEventHandler,null,!1),this.magicCardList.mouseHandler=Laya.Handler.create(this,this.onMagicHandler,null,!1),this.houseList.scrollBar.changeHandler=Laya.Handler.create(this,this.onScrollBarHandler,null,!1),this.diamondLocal=f.get("diamond"),this.goldLocal=f.get("gold"),this.unlockLocal=f.get("unlock"),this.houseLocal=f.get("house"),this.curGroupNumberLocal=f.get("curGroup"),this.selectTab(this.curGroupNumberLocal.value-1),this.selectStore(0),this.initOutCell(),this.initEventList(),this.updateOutCard(),this.upgradeSelectMagic(1),this.registerCustomEvent(),this.registerPageEvent(),this.switchPage(0),Laya.timer.frameLoop(1,this,this.onFrameLoop),this.magicCardList.scrollBar.changeHandler=Laya.Handler.create(this,this.onMagicScrollBarHandler,null,!1)}onBtnClick(e){let t=k.instance.useMagicType;if(e.target==this.useBtn){if(2==t.length);else if(-1==t.indexOf(this.curMagicType)){let e=this.magicOut1;1==t.length&&(e=this.magicOut2);let i=new Laya.Image;i.skin=`card/Ui_Magic${this.curMagicType}.png`,Laya.stage.addChild(i);let a=this.magicImage.localToGlobal(new Laya.Point,!1);i.x=a.x,i.y=a.y,i.width=159,i.height=195;let s=e.localToGlobal(new Laya.Point,!1);Laya.MouseManager.enabled=!1,this.flyMagicCard(i,{x:s.x,y:s.y,width:172,height:211}).then(()=>{Laya.MouseManager.enabled=!0,i.destroy(),this.updateOutCard()}),t.push(this.curMagicType),k.instance.useMagicType=t}}else if(e.target==this.upgradeBtn){let e=k.instance.magicCardLevel,t=e[this.curMagicType-1],i=this.checkUpgradeCondition(this.curMagicType,t);if(t<6&&i){this.diamondLocal.value-=i.diamond,this.goldLocal.value-=i.gold;let a=k.instance.magicCardNum;a[this.curMagicType-1]-=i.card,k.instance.magicCardNum=a,this.updateMagicInfo(this.curMagicType,t+1),e[this.curMagicType-1]=t+1,k.instance.magicCardLevel=e}}else if(e.target==this.magicBox1){if(!t[0])return;if(this.magicOut1.skin=null,this.magicOut2.skin=null,t[1]){let e=new Laya.Image;e.skin=`card/Ui_Magic${t[1]}.png`,Laya.stage.addChild(e);let i=this.magicOut2.localToGlobal(new Laya.Point,!1);e.x=i.x,e.y=i.y,e.width=172,e.height=211;let a=this.magicOut1.localToGlobal(new Laya.Point,!1);Laya.MouseManager.enabled=!1,this.flyMagicCard(e,{x:a.x,y:a.y,width:172,height:211}).then(()=>{Laya.MouseManager.enabled=!0,e.destroy(),this.updateOutCard()})}t.splice(0,1),k.instance.useMagicType=t}else if(e.target==this.magicBox2){if(!t[1])return;t.splice(1,1),k.instance.useMagicType=t,this.updateOutCard()}else e.target==this.monsterBtn?this.switchPage(0):e.target==this.magicBtn&&this.switchPage(1)}flyMagicCard(e,t){return new Promise(i=>{Laya.Tween.to(e,t,500,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{i()}))})}onFrameLoop(){this.light.x-=2,this.light.x<=-772&&(this.light.x=0)}onDestroy(){Laya.timer.clear(this,this.onFrameLoop),this.cancelCustomEvent()}onMagicScrollBarHandler(e){if(this.pointerTweening)return;let t=Laya.Handler.create(this,()=>{this.pointerTweening=!1}),i=1;e>this.magicCardList.scrollBar.max-201&&(i=0),this.pointerTweening=!0,Laya.Tween.to(this.morePointer,{alpha:i},100,Laya.Ease.sineOut,t)}onScrollBarHandler(e){if(-1!=this.lastSelectIndex){let e=this.houseList.getCell(this.lastSelectIndex);this.infoEventBox.visible=!1,this.outEventBox.visible=!1,e&&(e.openInfo(!1,0),e.zOrder=0,this.lastSelectIndex=-1)}this.isSelect&&e>=0&&(e>=this.houseList.scrollBar.max?p.event(a.NextChange,"hide"):p.event(a.NextChange,"show"))}onHouseDataChange(){let e=this.houseLocal.value;for(let t=0;t<1;t++){let i=f.get(`group${t+1}`).value;for(let t=0;t<i.length;t++){const a=i[t];let s=!1;for(let t=0;t<e.length;t++){const i=e[t];if(a.id==i.id){s=!0;break}}s||(i[t]=L.instance.getCardData(-1))}for(let e=0;e<i.length;e++){let t=i[e];for(let a=e+1;a<i.length;a++){let s=i[a];if(0==t.id&&s.id>0){let n=t;i[e]=s,i[a]=n}}}f.get(`group${t+1}`).value=i,p.event(a.SelectCardChange)}this.selectTab(this.curGroupNumberLocal.value-1),this.selectStore(this.curIndex)}registerPageEvent(){this.infoEventBox.on(Laya.Event.CLICK,this,this.onMouseEvent,["info"]),this.outEventBox.on(Laya.Event.CLICK,this,this.onMouseEvent,["out"])}onMouseEvent(e,t){if(t.stopPropagation(),-1!=this.lastSelectIndex){let e=this.houseList.getCell(this.lastSelectIndex);this.infoEventBox.visible=!1,this.outEventBox.visible=!1,e&&(e.openInfo(!1,0),e.zOrder=0)}if(-1!=this.lastOutIndex){let e=this.outList.getCell(this.lastOutIndex);this.infoEventBox.visible=!1,this.outEventBox.visible=!1,e&&(e.openInfo(!1,0),e.zOrder=0)}if("info"==e)u.playSound("Open.mp3"),Laya.Scene.load(s.buyConfirm,Laya.Handler.create(this,e=>{let t=null;if(1==this.selectType?-1!=this.lastSelectIndex&&(t=this.houseList.getCell(this.lastSelectIndex),this.lastSelectIndex=-1):0==this.selectType&&-1!=this.lastOutIndex&&(t=this.outList.getCell(this.lastOutIndex),this.lastOutIndex=-1),t){e.cell.dataSource=t.dataSource,e.cell.cardBlack.visible=!1,e.hpLabel.text=t.fightData.hp,e.attackLabel.text=t.fightData.atk,e.delayLabel.text=Math.floor((2e3-t.fightData.atkgap)/10).toString(),e.speedLabel.text=t.fightData.speed,e.frameTitle.visible=!0,e.buyBtn.visible=!1;let i="";1==t.dataSource.type?i="shop/Ui_BuyFont2.png":2==t.dataSource.type?i="shop/Ui_BuyFont1.png":3==t.dataSource.type&&(i="shop/Ui_BuyFont3.png"),e.title.skin=i,e.open()}}));else if("out"==e)if(u.playSound("Click.mp3"),1==this.selectType){if(-1!=this.lastSelectIndex){let e=null,i=-1;for(let t=0;t<this.outList.array.length;t++){let s=this.outList.getCell(t);if(this.judgeSameCard(s.dataSource,this.houseList.array[this.lastSelectIndex]))return p.event(a.SendTip,[["已出战!"]]),void(this.lastSelectIndex=-1);0==s.dataSource.id&&-1==i&&(e=this.houseList.getCell(this.lastSelectIndex),i=t)}if(e){if(e.isTweening)return;let s=this.outList.getCell(i),n=new Z;n.dataSource=JSON.parse(JSON.stringify(e.dataSource)),this.outList.array[i]=n.dataSource,this.curGroupDataLocal.value=this.outList.array;let r=e.globalToLocal(new Laya.Point(t.stageX,t.stageY));return n.pos(t.stageX-r.x,t.stageY-r.y),n.width=e.width*e.scaleX*this.houseList.scaleX,n.height=e.height*e.scaleY*this.houseList.scaleY,this.cardView.addChild(n),s.setOutFight(n,i),this.removeOrAddData(e.dataSource,!0),this.lastSelectIndex=-1,_.Instance.finishTask("点击出战"),void p.event(a.SelectCardChange)}this.lastSelectIndex=-1,p.event(a.SendTip,[["位置已满!"]])}}else if(0==this.selectType&&-1!=this.lastOutIndex&&this.lastOutIndex<this.unlockLocal.value){let e=this.outList.getCell(this.lastOutIndex);if(e.isTweening||null==e.dataSource||0==e.dataSource.id)return;let t=0;if(0==this.curIndex?t=0:1==this.curIndex?t=2:2==this.curIndex?t=1:3==this.curIndex&&(t=3),e.dataSource.type==t||0==t){let t=[];for(let e=0;e<this.houseList.array.length;e++){let i=this.houseList.array[e];i&&i.id>0&&t.push(i)}t.push(e.clone().dataSource),this.sortData(t),this.houseList.array=t,this.houseList.refresh()}let i=e.clone(),s=e.localToGlobal(new Laya.Point,!1,this.cardView);i.pos(s.x,s.y),this.cardView.addChild(i),this.flyCenter(i),e.setEmpty(),this.outList.array[this.lastOutIndex]=e.dataSource,this.sortOutCell(this.lastOutIndex),this.lastOutIndex=-1,p.event(a.SelectCardChange)}}registerCustomEvent(){p.on(a.CardHouseChange,this,this.onHouseDataChange),p.on(a.ComposeNewCard,this,this.onHouseDataChange),p.on(a.OutCard,this,this.onMouseEvent)}cancelCustomEvent(){p.off(a.CardHouseChange,this,this.onHouseDataChange),p.off(a.ComposeNewCard,this,this.onHouseDataChange),p.off(a.OutCard,this,this.onMouseEvent)}selectStore(e){if(-1!=this.lastSelectIndex){let e=this.houseList.getCell(this.lastSelectIndex);this.infoEventBox.visible=!1,this.outEventBox.visible=!1,e&&(e.openInfo(!1,0),e.zOrder=0,this.lastSelectIndex=-1)}if(-1!=this.lastOutIndex){let e=this.outList.getCell(this.lastOutIndex);this.infoEventBox.visible=!1,this.outEventBox.visible=!1,e&&(e.openInfo(!1,0),e.zOrder=0,this.lastOutIndex=-1)}this.curIndex=e,this.allBtn.skin="card/Btn_bule.png",this.standBtn.skin="card/Btn_bule.png",this.climbBtn.skin="card/Btn_bule.png",this.flyBtn.skin="card/Btn_bule.png";let t=[];if(0==e){for(let e=0;e<this.houseLocal.value.length;e++){const i=this.houseLocal.value[e];this.inOutList(i)||t.push(i)}this.allBtn.skin="card/Btn_yellow.png"}else if(1==e){for(let e=0;e<this.houseLocal.value.length;e++){const i=this.houseLocal.value[e];2==i.type&&(this.inOutList(i)||t.push(i))}this.standBtn.skin="card/Btn_yellow.png"}else if(2==e){for(let e=0;e<this.houseLocal.value.length;e++){const i=this.houseLocal.value[e];1==i.type&&(this.inOutList(i)||t.push(i))}this.climbBtn.skin="card/Btn_yellow.png"}else if(3==e){for(let e=0;e<this.houseLocal.value.length;e++){const i=this.houseLocal.value[e];3==i.type&&(this.inOutList(i)||t.push(i))}this.flyBtn.skin="card/Btn_yellow.png"}this.sortData(t),this.houseList.array=t,this.houseList.refresh(),this.onScrollBarHandler(this.houseList.scrollBar.value)}onStoreTabHandler(e,t){if(e.type==Laya.Event.CLICK){if(this.sorting||t==this.curIndex)return;u.playSound("Click.mp3"),this.selectStore(t)}}onMagicHandler(e,t){if(e.type==Laya.Event.CLICK){let e=this.magicCardList.getCell(t).dataSource.magicType;if(!k.instance.magicCardUnlock[e-1])return;e!=this.curMagicType&&(this.upgradeMagicList(e),this.upgradeSelectMagic(e),this.curMagicType=e)}}onEventHandler(e,t){e.type==Laya.Event.CLICK&&(this.onCellHandler(e,t),this.onOutHandler(e,t))}onCellHandler(e,t){if(e.type==Laya.Event.CLICK){if(t!=this.unlockLocal.value)return;let e=2e3*(this.unlockLocal.value-3)+2e3;if(this.goldLocal.value<e)return u.playSound("Error.mp3"),void p.event(a.SendTip,[["金币不足!"]]);u.playSound("Click.mp3"),this.unlockOutCell(),this.goldLocal.value-=e}}onSelectHandler(e,t){if(e.type==Laya.Event.CLICK){if(this.sorting)return;this.selectTab(t)}}onOutHandler(e,t){if(e.type==Laya.Event.CLICK){if(this.sorting)return;if(-1!=this.lastSelectIndex){let e=this.houseList.getCell(this.lastSelectIndex);this.infoEventBox.visible=!1,this.outEventBox.visible=!1,e&&(e.openInfo(!1,0),e.zOrder=0,this.lastSelectIndex=-1)}let e=this.outList.getCell(t);if(!e.dataSource||0==e.dataSource.id)return;if(-1!=this.lastOutIndex){let i=this.outList.getCell(this.lastOutIndex);if(this.infoEventBox.visible=!1,this.outEventBox.visible=!1,i&&(i.openInfo(!1,0),i.zOrder=0),t!=this.lastOutIndex){u.playSound("Click.mp3");let i=e.info.localToGlobal(new Laya.Point,!1,this),a=e.out.localToGlobal(new Laya.Point,!1,this);this.infoEventBox.pos(i.x,i.y),this.outEventBox.pos(a.x,a.y),this.infoEventBox.visible=!0,this.outEventBox.visible=!0,e&&(e.openInfo(!0,0),e.zOrder=100),this.lastOutIndex=t,this.selectType=0}else this.lastOutIndex=-1}else{u.playSound("Click.mp3");let i=e.info.localToGlobal(new Laya.Point,!1,this),a=e.out.localToGlobal(new Laya.Point,!1,this);this.infoEventBox.pos(i.x,i.y),this.outEventBox.pos(a.x,a.y),this.infoEventBox.visible=!0,this.outEventBox.visible=!0,e&&(e.openInfo(!0,0),e.zOrder=100),this.lastOutIndex=t,this.selectType=0}this.houseList.updateZOrder()}}onHouseHandler(e,t){if(!this.sorting&&e.type==Laya.Event.CLICK){if(-1!=this.lastOutIndex){let e=this.outList.getCell(this.lastOutIndex);this.infoEventBox.visible=!1,this.outEventBox.visible=!1,e&&(e.openInfo(!1,0),e.zOrder=0,this.lastOutIndex=-1)}let e=this.houseList.getCell(t);if(-1!=this.lastSelectIndex){let i=this.houseList.getCell(this.lastSelectIndex);if(this.infoEventBox.visible=!1,this.outEventBox.visible=!1,i&&(i.openInfo(!1,0),i.zOrder=0),t!=this.lastSelectIndex){u.playSound("Click.mp3");let i=e.info.localToGlobal(new Laya.Point,!1,this),a=e.out.localToGlobal(new Laya.Point,!1,this);this.infoEventBox.pos(i.x,i.y),this.outEventBox.pos(a.x,a.y),this.infoEventBox.visible=!0,this.outEventBox.visible=!0,e&&(e.openInfo(!0,1),e.zOrder=100),this.lastSelectIndex=t,this.selectType=1}else this.lastSelectIndex=-1}else{u.playSound("Click.mp3");let i=e.info.localToGlobal(new Laya.Point,!1,this),a=e.out.localToGlobal(new Laya.Point,!1,this);this.infoEventBox.pos(i.x,i.y),this.outEventBox.pos(a.x,a.y),this.infoEventBox.visible=!0,this.outEventBox.visible=!0,e&&(_.Instance.finishTask("点击选择一张卡片"),e.openInfo(!0,1),e.zOrder=100),this.lastSelectIndex=t,this.selectType=1}this.houseList.updateZOrder()}}judgeSameCard(e,t){return e.id==t.id&&e.attack==t.attack&&e.def==t.def&&e.hp==t.hp&&e.attackDelay==t.attackDelay&&e.attackDistance==t.attackDistance&&e.moveSpeed==t.moveSpeed&&e.color==t.color}selectTab(e){let t=[];for(let i=0;i<3;i++){let a={tabIndex:{text:""+(i+1)},offImage:{visible:!1},onImage:{visible:!0}};i==e?(a.offImage.visible=!1,a.onImage.visible=!0):(a.offImage.visible=!0,a.onImage.visible=!1),t.push(a)}this.tabList.array=t,this.tabList.refresh(),this.curGroupNumberLocal.value=e+1,this.curGroupDataLocal=f.get(`group${this.curGroupNumberLocal.value}`),this.outList.array=this.curGroupDataLocal.value,this.outList.refresh()}initEventList(){this.eventList.array=[{},{},{},{},{},{}],this.eventList.refresh()}initOutCell(){let e=[],t=this.unlockLocal.value;for(let i=0;i<6;i++){let a=0;i>2&&(a=2e3*(i-3)+2e3);let s={unlock:{visible:i<t},lock:{visible:i>=t},moneyUnlock:{visible:i==t,goldNum:{text:a.toString()}},unlockTip:{visible:i>t}};e.push(s)}this.cellList.array=e,this.cellList.refresh()}unlockOutCell(){this.unlockLocal.value++,this.addUnlockCell(),this.initOutCell()}sortOutCell(e){for(let t=e;t<this.outList.array.length;t++){const e=this.outList.getCell(t);let i=this.outList.getCell(t+1);if(t+1<this.outList.array.length&&i&&i.dataSource){let a=i.clone(),s=this.outList.localToGlobal(new Laya.Point(i.x,i.y),!1,this);a.pos(s.x,s.y),this.cardView.addChild(a),e.setOutFight(a,t+1)}else e.setEmpty()}for(let e=0;e<this.outList.array.length;e++){const t=this.outList.getCell(e);this.outList.array[e]=t.dataSource}this.curGroupDataLocal.value=this.outList.array}addUnlockCell(){for(let e=0;e<3;e++){let t=f.get(`group${e+1}`),i=t.value;i.push(L.instance.getCardData(-1)),t.value=i}this.outList.array=f.get(`group${this.curGroupNumberLocal.value}`).value,this.outList.refresh()}onSelect(){this.isSelect=!0,p.event(a.NextChange,"hide")}sortData(e){e.sort((e,t)=>t.attack-e.attack)}inOutList(e){for(let t=0;t<this.outList.array.length;t++)if(e.id==this.outList.array[t].id)return!0;return!1}removeOrAddData(e,t){let i=[];for(let a=0;a<this.houseList.array.length;a++){let s=this.houseList.array[a];t?s&&s.id>0&&s.id!=e.id&&i.push(s):s&&s.id>0&&i.push(s)}t||i.push(e),this.sortData(i),this.houseList.array=i,this.houseList.refresh()}flyCenter(e){let t=(this.cardView.width-e.width)/2,i=(this.cardView.height-e.height)/2;Laya.Tween.to(e,{x:t,y:i,alpha:0},200,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{e.destroy()}))}upgradeSelectMagic(e){this.upgradeMagicList(e),this.magicImage.skin=`card/Ui_Magic${e}.png`;let t=k.instance.magicCardLevel[e-1];this.updateMagicInfo(e,t)}upgradeMagicList(e){let t=[],i=k.instance.magicCardUnlock;for(let a=0;a<7;a++)k.instance.magicCardNum[a]>0&&(i[a]=1),5!=a&&t.push({magicType:a+1,isSelect:a+1==e});k.instance.magicCardUnlock=i,this.magicCardList.array=t,this.magicCardList.refresh()}updateMagicInfo(e,t){this.magicName.skin=`card/Ui_MagicName${e}.png`;let i=L.instance.getMagicCardData(e,t+1),a=i.description,s=(i.param+"").split(",");if(-1!=i.description.indexOf("*"))for(let t=0;t<s.length;t++){if(7==e&&0==t)continue;let i=s[t];(4==e&&0==t||6==e&&0==t)&&(i+="%"),a=a.replace("*",i)}this.magicDesc.text=a;let n=i.upgradeCost.split(",");this.moneyCost.text=`X${n[0]}`,this.diamondCost.text=`X${n[1]}`,this.cardCost.text=`${k.instance.magicCardNum[e-1]}/${n[2]}`}updateOutCard(){for(let e=0;e<2;e++){let t=null;0==e?t=this.magicOut1:1==e&&(t=this.magicOut2);let i=k.instance.useMagicType[e];i?(t.visible=!0,t.skin=`card/Ui_Magic${i}.png`):(t.visible=!1,t.skin=null)}}checkUpgradeCondition(e,t){let i=L.instance.getMagicCardData(e,t+1).upgradeCost.split(","),a=Number(i[0]),s=Number(i[1]),n=Number(i[2]),r=this.goldLocal.value,o=this.diamondLocal.value,l=k.instance.magicCardNum[e-1];return a<=r&&s<=o&&n<=l?{gold:a,diamond:s,card:n}:null}switchPage(e){if(this.curPageId==e)return;this.curPageId=e;let t={progress:0},i=null,a=null;0==e?(this.infoEventBox.visible=!0,this.outEventBox.visible=!0,this.eventList.visible=!0,this.title.visible=!0,this.houseList.visible=!0,this.cellList.visible=!0,this.outList.visible=!0,i=Laya.Handler.create(this,()=>{this.magicBox1.alpha=this.magicBox2.alpha=1-t.progress,this.magicTitle.alpha=1-t.progress,this.magicBox.alpha=1-t.progress,this.frame.height=320+180*t.progress,this.switchBg.x=388+-325*t.progress,this.title.alpha=t.progress,this.houseList.alpha=t.progress,this.cellList.alpha=t.progress,this.outList.alpha=t.progress},null,!1),a=Laya.Handler.create(this,()=>{this.magicBox1.visible=this.magicBox2.visible=!1,this.magicTitle.visible=!1,this.magicBox.visible=!1,Laya.MouseManager.enabled=!0})):(this.infoEventBox.visible=!1,this.outEventBox.visible=!1,this.eventList.visible=!1,this.magicBox1.visible=this.magicBox2.visible=!0,this.magicTitle.visible=!0,this.magicBox.visible=!0,i=Laya.Handler.create(this,()=>{this.magicBox1.alpha=this.magicBox2.alpha=t.progress,this.magicTitle.alpha=t.progress,this.magicBox.alpha=t.progress,this.frame.height=500-180*t.progress,this.switchBg.x=63+325*t.progress,this.magicTitle.top=690-180*t.progress,this.magicBox.top=760-180*t.progress,this.title.alpha=1-t.progress,this.houseList.alpha=1-t.progress,this.cellList.alpha=1-t.progress,this.outList.alpha=1-t.progress},null,!1),a=Laya.Handler.create(this,()=>{this.title.visible=!1,this.houseList.visible=!1,this.cellList.visible=!1,this.outList.visible=!1,Laya.MouseManager.enabled=!0})),Laya.MouseManager.enabled=!1,Laya.Tween.to(t,{progress:1,update:i},500,Laya.Ease.sineOut,a)}}class ee extends i.shopUI{constructor(){super(...arguments),this.diamondLocal=null,this.moneyLocal=null,this.baseLevelLocal=null,this.mineLevelLocal=null,this.shopLocal=null,this.enemyPoolLocal=null,this.curLevelLocal=null,this.shopIdLocal=null,this.isSelect=!1,this.refreshTime=1800,this.cardPackTimeLeft=[0,0,0,0,0,0],this.cardPackCd=[0,0,0,0,0,0]}onAwake(){this.slidePanel.vScrollBarSkin="",this.curLevelLocal=f.get("curLevel"),this.enemyPoolLocal=f.get("enemyPool"),this.shopLocal=f.get("shop"),this.shopIdLocal=f.get("shopId"),this.diamondLocal=f.get("diamond"),this.moneyLocal=f.get("gold"),this.baseLevelLocal=f.get("baseLevel"),this.mineLevelLocal=f.get("mineLevel"),this.moneyList.mouseHandler=Laya.Handler.create(this,this.onMouseHandler,null,!1),this.onRefreshShop(),this.refreshShopTime(),p.on(a.RefreshShop,this,this.onRefreshShop);for(let e=0;e<6;e++)this.packBox.getChildByName("pack"+(e+1)).on(Laya.Event.CLICK,this,this.onCardPackClick);this.refreshCardPackUi(),Laya.timer.loop(1e3,this,this.onLoop)}onCardPackClick(e){let i=Number(e.target.name.replace("pack","")),s=u.getRes("gacha.json")[i-1],n=this.cardPackTimeLeft[i-1],r=k.instance.cardPackOpenTs;if(0==n)if(0==s.price)t.Instance.showVideoAd(()=>{p.event("BreakPoint",["购买卡包",1]),this.openPackage([i]),r[i-1]=Date.now(),k.instance.cardPackOpenTs=r,this.refreshCardPackUi()});else{let e=JSON.parse(s.price);1==e[0]?e[1]<=this.moneyLocal.value?(this.moneyLocal.value-=e[1],this.openPackage([i]),r[i-1]=Date.now(),k.instance.cardPackOpenTs=r,this.refreshCardPackUi()):p.event(a.SendTip,[["金币不足!"]]):e[1]<=this.diamondLocal.value?(this.diamondLocal.value-=e[1],this.openPackage([i]),r[i-1]=Date.now(),k.instance.cardPackOpenTs=r,this.refreshCardPackUi()):p.event(a.SendTip,[["钻石不足!"]])}}refreshShopTime(){let e=f.get("refreshShopTimeStap"),t=Date.now();if(0==e.value||t-e.value>=18e5){this.refreshTime=1800,f.get("refreshShopTimeStap").value=Date.now(),this.refreshShop();let e=this.shopLocal.value;this.houseList.repeatY=Math.ceil(e.length/4),this.houseList.array=e,this.houseList.refresh(),this.refreshUI()}else this.refreshTime=1800-Math.floor((t-e.value)/1e3);let i=Math.floor(this.refreshTime/60),a=this.refreshTime-60*i;this.refreshTip.text=`下次刷新时间${this.format("mm:ss",{min:i,sec:a})}`}onLoop(){for(let e=0;e<this.cardPackTimeLeft.length;e++){let t=this.cardPackTimeLeft[e];t>0&&(t-=1e3)<=0&&(this.cardPackTimeLeft[e]=0,this.refreshCardPackUi())}if(this.refreshTime>0){this.refreshTime--;let e=Math.floor(this.refreshTime/60),t=this.refreshTime-60*e;if(this.refreshTip.text=`下次刷新时间${this.format("mm:ss",{min:e,sec:t})}`,this.refreshTime<=0){this.refreshTime=1800,f.get("refreshShopTimeStap").value=Date.now(),this.refreshShop();let e=this.shopLocal.value;this.houseList.repeatY=Math.ceil(e.length/4),this.houseList.array=e,this.houseList.refresh(),this.refreshUI()}}}onDestroy(){Laya.timer.clearAll(this),p.off(a.RefreshShop,this,this.onRefreshShop)}onMouseHandler(e,t){if(e.type==Laya.Event.CLICK){let e=this.moneyList.array[t],i=Number(e.diamondNum.text),s=0;10==i?s=1e3:50==i?s=5e3:200==i&&(s=2e4),this.diamondLocal.value>=i?(this.diamondLocal.value-=i,this.moneyLocal.value+=s,p.event(a.SendTip,[["购买成功!"]])):p.event(a.SendTip,[["钻石不足!"]])}}onRefreshShop(){let e=this.shopLocal.value;0==e.length&&(f.get("refreshShopTimeStap").value=Date.now(),this.refreshShop(),e=this.shopLocal.value),this.houseList.repeatY=Math.ceil(e.length/4),this.houseList.array=e,this.houseList.refresh(),this.moneyList.array=[{moneyIcon:{skin:"shop/small.png"},diamondNum:{text:10}},{moneyIcon:{skin:"shop/middle.png"},diamondNum:{text:50}},{moneyIcon:{skin:"shop/big.png"},diamondNum:{text:200}}],this.moneyList.refresh(),this.refresh.on(Laya.Event.CLICK,this,this.onMouseEvent,["refresh"]),this.refreshUI()}onMouseEvent(e,i){i.type==Laya.Event.CLICK&&"refresh"==e&&(t.Instance.showVideoEventId=205,t.Instance.showVideoAd(()=>{this.refreshShop();let e=this.shopLocal.value;this.houseList.repeatY=Math.ceil(e.length/4),this.houseList.array=e,this.houseList.refresh(),this.refreshUI()}))}openPackage(e){let t=[],i=u.getRes("gacha.json");for(let a=0;a<e.length;a++){let s=i[e[a]-1],n=L.instance.getCardPackData(s);t.push(n),L.instance.addNewCard(n)}Laya.Scene.load(s.package,Laya.Handler.create(this,i=>{i.isModal=!0,i.isShowEffect=!1,i.width=Laya.stage.width,i.height=Laya.stage.height,i.open(!1),i.showBook(e,t)}))}refreshShop(){let e=[];for(let t=0;t<12;t++)e.push(this.getCard());this.shopLocal.value=e}getCard(){let e=k.instance.curStage,t=10*(e[0]-1)+e[1]+3,i=this.enemyPoolLocal.value,a=v.getRandom(0,i.length-1),s=L.instance.getCardData(i[a]);return s.exp=L.instance.getBaseExpByFightLevel(t),s.id=this.shopIdLocal.value,this.shopIdLocal.value++,s}refreshUI(){let e=[this.title1,this.packBox,this.title2,this.refreshBox,this.houseList,this.title3,this.moneyList],t=0;for(let i=0;i<e.length;i++){let a=e[i];a.y=t,t=t+a.height*a.scaleY+10}}onSelect(){this.isSelect=!0,p.event(a.NextChange,"hide")}format(e,t){var i={"m+":t.min,"s+":t.sec};for(var a in i)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[a]:("00"+i[a]).substr((""+i[a]).length)));return e}refreshCardPackUi(){let e=u.getRes("gacha.json"),t=Date.now(),i=k.instance.cardPackOpenTs;for(let a=0;a<e.length;a++){let s=e[a];this.cardPackCd[a]=s.cooldown;let n=this.packBox.getChildByName("pack"+(a+1)),r=n.getChildByName("refreshTimeLabel"),o=n.getChildByName("moneyNum");if(0==s.price)o.visible=!1;else{let e=JSON.parse(s.price),t=o.getChildByName("moneyImage");o.visible=!0,o.text=e[1]+"",1==e[0]?t.skin="main/Ui_Gold.png":t.skin="main/Ui_Diamonds.png"}let l=60*s.cooldown*1e3-(t-i[a]);if(l=l>0?l:0,this.cardPackTimeLeft[a]=l,0==s.cooldown)r.visible=!1,n.disabled=!1;else if(l>0){let e=Math.floor(l/36e5),t=Math.floor(l%36e5/6e4);r.text=`${e}小时${t}分`,r.visible=!0,n.disabled=!0}else r.visible=!1,n.disabled=!1}}}class te extends i.tipViewUI{constructor(){super(),this.sign="tip"}onAwake(){p.on(a.SendTip,this,this.onSendTip),Laya.timer.frameLoop(1,this,this.onFrameLoop)}onSendTip(e){"金币不足!"==e[0]?(this.tipBg.skin="tip/GoldNotEnough.png",Laya.Scene.load(s.addMoney,Laya.Handler.create(this,e=>{e.setMoneyType(1),e.open(!1)}))):"钻石不足!"==e[0]?(this.tipBg.skin="tip/DiamondtEnough.png",Laya.Scene.load(s.addMoney,Laya.Handler.create(this,e=>{e.setMoneyType(2),e.open(!1)}))):"矿石不足!"==e[0]?this.tipBg.skin="tip/MineNotEnough.png":"位置已满!"==e[0]?this.tipBg.skin="tip/PositionFull.png":"升级成功!"==e[0]?this.tipBg.skin="tip/UpgradeSuccess.png":"冷却中!"==e[0]?this.tipBg.skin="tip/CardCold.png":"购买成功!"==e[0]?this.tipBg.skin="tip/BuySuccess.png":"引导中"==e[0]?this.tipBg.skin="tip/guiding.png":"体力不足"==e[0]&&(this.tipBg.skin="tip/Ui_notili.png",Laya.Scene.load(s.addMoney,Laya.Handler.create(this,e=>{e.setMoneyType(3),e.open(!1)}))),this.tipAni.play(0,!1)}onClosed(){}onFrameLoop(){}showTip(){}onDestroy(){p.off(a.SendTip,this,this.onSendTip)}}class ie extends i.mapCellUI{constructor(){super(...arguments),this.canClick=!1}onAwake(){this.on(Laya.Event.CLICK,this,this.onClick)}set dataSource(e){this._dataSource=e,this.canClick=e.canClick,e&&(this.star1.skin=this.star2.skin=this.star3.skin="map/Ui_PlaceStar2.png",this.stageNum.text=e.level+"",1==e.state?(this.whiteBase.visible=!0,this.starBox.visible=!0,this.balckBase.visible=!1,this.light.visible=!1,this.stageNum.text=e.level.toString(),this.shadow.skin="map/Ui_Place2.png",this.stageNum.y=-25,e.star>=1&&(this.star1.skin="map/Ui_PlaceStar1.png"),e.star>=2&&(this.star2.skin="map/Ui_PlaceStar1.png"),e.star>=3&&(this.star3.skin="map/Ui_PlaceStar1.png")):(this.stageNum.y=10,this.whiteBase.visible=!1,this.starBox.visible=!1,this.balckBase.visible=!0,this.shadow.skin="map/Ui_Place1.png",this.light.visible=!1));let t=this.getIsShowRewardPop();this.rewardPop.visible=t.isShow,t.isShow&&this.setRewardShowData(JSON.parse(t.levelData.rewardShow))}get dataSource(){return this._dataSource}onClick(){this.canClick&&p.event(a.MapCellSelect,this._dataSource.level)}setSelect(e){e?(this.light.visible=!0,this.breath.play(0,!0)):(this.light.visible=!1,this.breath.stop())}setRewardShowData(e){let t=10*(this._dataSource.chapter-1)+this._dataSource.level,i=!1;k.instance.starRecord[t]&&(i=!0);let a=this.getRewardDataArr(e,i);this.rewardPopList.repeatX=a.length,this.rewardPopList.centerX=-1,this.rewardPopList.array=a,this.rewardPopList.centerX=0}getRewardDataArr(e,t=!1){let i=[];for(let a=0;a<e.length/2;a++){let s=e[2*a],n=e[2*a+1],r="";1==s?r="main/Ui_Gold.png":2==s?r="main/Ui_Diamonds.png":3==s?r="main/Ui_power.png":s>=5e4&&s<=50019?(r="map/Ui_WenHaoCard.png",n=1):s>=1101&&s<=1706&&(r="map/Ui_WenHaoCard.png"),i.push({rewardImage:{skin:r},rewardNum:{text:"X"+n},receivedCover:{visible:t}})}return i}getIsShowRewardPop(){let e={isShow:!1,levelData:null},t=this._dataSource.chapter,i=this._dataSource.level,a=k.instance.getNormalizeLevel([t,i]),s=u.getRes("map.json")[a-1];if(e.levelData=s,0!==s.rewardShow){let t=k.instance.curStage,i=k.instance.getNormalizeLevel(t),s=k.instance.starRecord[a-1];e.isShow=a>=i&&(a!=i||null==s)}else e.isShow=!1;return e}}class ae extends i.matchUI{constructor(){super(...arguments),this.isSkeletonPlaying=!1,this.timeRecord=0,this.seconds=0,this.minutes=0}onAwake(){this.playerName.text="自己",this.playerScore.text="100",this.playerDivision.division=1,this.playerName.text=window.UserInfo.nickName,this.playerHead.skin=window.UserInfo.avatarUrl,this.enemyName.text="敌人",this.enemyScore.text="100",this.enemyDivision.division=1,this.timeLabel.text=this.dateFtt("mm:ss",{"m+":this.minutes,"s+":this.seconds}),this.loadSpine2().then(()=>{}),Laya.timer.frameLoop(1,this,this.onFrameLoop)}setEnemyInfo(e){this.enemyName.text=e.nickName,this.enemyHead.skin=e.avatarUrl}onFrameLoop(){this.timeRecord+=Laya.timer.delta,this.timeRecord>=1e3&&(this.timeRecord=0,this.seconds++,60==this.seconds&&(this.seconds=0,this.minutes++),this.timeLabel.text=this.dateFtt("mm:ss",{"m+":this.minutes,"s+":this.seconds}),this.seconds>=5&&(this.setEnemyInfo({nickName:"god",avatarUrl:"match/Ui_vshead.png"}),Laya.timer.clear(this,this.onFrameLoop),this.loadSpine1().then(()=>{b.instance.isPVP=!0,Laya.Scene.open(s.gameLoad)})))}loadSpine1(){return new Promise((e,t)=>{u.loadSpines(["vs.sk"]).then(t=>{this.vsSpine=t[0],this.spineFront.addChild(this.vsSpine),this.vsSpine.scale(1.2,1.2),this.vsSpine.pos(Laya.stage.width/2,Laya.stage.height/2),this.vsSpine.play(0,!1),this.isSkeletonPlaying=!0,this.vsSpine.on(Laya.Event.STOPPED,this,()=>{this.isSkeletonPlaying=!1,e()})})})}loadSpine2(){return new Promise((e,t)=>{u.loadSpines(["di.sk"]).then(t=>{this.diSpine=t[0],this.spineBack.addChild(this.diSpine),this.diSpine.scale(1.2,1.2),this.diSpine.pos(Laya.stage.width/2,Laya.stage.height/2),this.diSpine.play(0,!1),this.isSkeletonPlaying=!0,this.diSpine.on(Laya.Event.STOPPED,this,()=>{this.isSkeletonPlaying=!1}),e()})})}dateFtt(e,t){for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e}onDestroy(){Laya.timer.clearAll(this)}}class se extends i.newCardPopUI{onOpened(){this.goBuy.on(Laya.Event.CLICK,this,this.onBtnClick),this.goComPose.on(Laya.Event.CLICK,this,this.onBtnClick),this.goSelect.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(e){e.target==this.goBuy||(e.target==this.goComPose?p.event(a.JumpPage,1):e.target==this.goSelect&&p.event(a.JumpPage,3)),this.close()}}class ne extends i.packageUI{constructor(){super(...arguments),this.cardScene=null,this.cardList=[],this.uiCardList=[],this.glow1=null,this.glow2=null,this.glow3=null,this.book1=null,this.book2=null,this.book3=null,this.pointStart=null,this.point1=null,this.point2=null,this.point3=null,this.buyBook=null,this.inPositonCardNum=0,this.touchName="OpenBook",this.openCardRecord=[],this.camera=null,this.ray=new Laya.Ray(new Laya.Vector3,new Laya.Vector3),this.cardNum=0,this.packageDataArr=null,this.packageTypeArr=null}onAwake(){if(this.cardScene=u.getRes("Card.ls"),!this.cardScene.getChildByName("Card10")){this.cardScene.name="cardScene";let e=this.cardScene.getChildByName("Card");e.name="Card1";for(let t=0;t<9;t++){let i=e.clone();i.name=`Card${t+2}`,this.cardScene.addChild(i)}}this.node3d.addChild(this.cardScene);for(let e=0;e<10;e++){let t=this.cardScene.getChildByName(`Card${e+1}`);this.cardList.push(t)}this.glow1=this.getChildByUrl(this.cardScene,"CardBook/CardBook/Bone009/Bone001/Bone006/Bone007/Bone008/Glow1"),this.glow2=this.getChildByUrl(this.cardScene,"CardBook/CardBook/Bone009/Bone001/Bone006/Bone007/Bone008/Glow2"),this.glow3=this.getChildByUrl(this.cardScene,"CardBook/CardBook/Bone009/Bone001/Bone006/Bone007/Bone008/Glow3"),this.book1=this.getChildByUrl(this.cardScene,"CardBook/CardBook/CardBook1"),this.book2=this.getChildByUrl(this.cardScene,"CardBook/CardBook/CardBook2"),this.book3=this.getChildByUrl(this.cardScene,"CardBook/CardBook/CardBook3"),this.point1=this.cardScene.getChildByName("CardPoint1"),this.point2=this.cardScene.getChildByName("CardPoint2"),this.point3=this.cardScene.getChildByName("CardPoint3"),this.pointStart=this.cardScene.getChildByName("CardPointStart"),this.camera=this.cardScene.getChildByName("Camera")}getChildByUrl(e,t){let i=e,a=t.split("/");for(let e=0;e<a.length&&null!=i;e++)i=i.getChildByName(a[e]);return i}onOpened(){this.cardScene.active=!0,this.on(Laya.Event.CLICK,this,this.onMouseEvent)}onMouseEvent(e){if("OpenBook"==this.touchName)u.playSound("OpenCardBook.mp3"),this.cardScene.getChildByName("CardBook").getComponent(Laya.Animator).play("CardBookOpen",0,0),this.inPositonCardNum=0,this.touchName="PickCard",Laya.timer.once(1e3,this,()=>{if(this.glow1.active=!1,"CardBook1"==this.buyBook.name)for(let e=0;e<5;e++){let t=300+200*e,i=this.cardList[e],a=this.point1.getChildByName(`CardPoint${e+1}`);Laya.timer.once(t,this,()=>{this.flyCard(i,a.transform.position)})}else if("CardBook2"==this.buyBook.name){this.glow2.active=!1;for(let e=0;e<8;e++){let t=300+200*e,i=this.cardList[e],a=this.point2.getChildByName(`CardPoint${e+1}`);Laya.timer.once(t,this,()=>{this.flyCard(i,a.transform.position)})}}else if("CardBook3"==this.buyBook.name){this.glow3.active=!1;for(let e=0;e<10;e++){let t=300+200*e,i=this.cardList[e],a=this.point3.getChildByName(`CardPoint${e+1}`);Laya.timer.once(t,this,()=>{this.flyCard(i,a.transform.position)})}}});else if("PickCard"==this.touchName){if(this.inPositonCardNum<this.cardNum)return;let t=this.colliderCard(e);t&&-1==this.openCardRecord.indexOf(t)&&(this.openCardRecord.push(t),t.getComponent(Laya.Animator).play("CardOpen",0,0),u.playSound("OpenCard.mp3"),this.show2dCard(t),this.openCardRecord.length==this.cardNum&&(this.touchName="Close"))}else"Close"==this.touchName&&(this.packageDataArr.length>0?this.showBook(this.packageTypeArr,this.packageDataArr):(this.node3d.removeChildByName("cardScene"),this.close()))}onDestroy(){}showBook(e,t){this.touchName="OpenBook",this.openCardRecord.length=0,this.packageDataArr=t,this.packageTypeArr=e;let i=this.packageTypeArr.shift(),a=this.packageDataArr.shift();for(let e=0;e<10;e++){let t=this.cardList[e];t.transform.position=this.pointStart.transform.position.clone(),Laya.timer.once(200*Math.random(),this,()=>{t.getComponent(Laya.Animator).play("CardStand",0,0)})}1==i?(this.book1.active=!0,this.book2.active=!1,this.book3.active=!1,this.glow1.active=!0,this.glow2.active=!1,this.glow3.active=!1,this.buyBook=this.book1,this.cardNum=5):2==i?(this.book1.active=!1,this.book2.active=!0,this.book3.active=!1,this.glow1.active=!1,this.glow2.active=!0,this.glow3.active=!1,this.buyBook=this.book2,this.cardNum=8):(this.book1.active=!1,this.book2.active=!1,this.book3.active=!0,this.glow1.active=!1,this.glow2.active=!1,this.glow3.active=!0,this.buyBook=this.book3,this.cardNum=10),this.cardScene.getChildByName("CardBook").getComponent(Laya.Animator).play("CardBookStand",0,0),this.create2dCard(a)}flyCard(e,t){let i={value:0},a=new Laya.Vector3,s=e.transform.position.clone();Laya.Vector3.subtract(t,s,a),Laya.Tween.to(i,{value:1,update:Laya.Handler.create(this,()=>{let t=new Laya.Vector3,n=new Laya.Vector3;Laya.Vector3.scale(a,i.value,t),Laya.Vector3.add(s,t,n),e.transform.position=n},null,!1)},200,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.inPositonCardNum++}))}colliderCard(e){for(let t=0;t<this.cardNum;t++){let i=this.cardList[t],a=B.projectPos(this.camera,i.transform.position);if(e.stageX>=a.x-79.2&&e.stageX<=a.x+79.2&&e.stageY>=a.y-244*.8/2&&e.stageY<=a.y+244*.8/2)return i}}create2dCard(e){this.node2d.destroyChildren(),this.uiCardList.length=0;for(let t=0;t<e.length;t++){let i=new T;i.dataSource=e[t],this.uiCardList.push(i),this.node2d.addChild(i),i.alpha=0}}show2dCard(e){let t=Number(e.name.replace("Card","")),i=this.uiCardList[t-1];i.scaleX=i.scaleY=.8;let a=B.projectPos(this.camera,e.transform.position);i.pos((a.x-i.width*i.scaleX/2)/Laya.stage.clientScaleX,(a.y-(i.height-75)*i.scaleY/2)/Laya.stage.clientScaleY),Laya.timer.once(500,this,()=>{Laya.Tween.to(i,{alpha:1},500,Laya.Ease.sineOut)})}}class re extends Laya.Script3D{constructor(){super(...arguments),this.hp=0,this.fullHp=0,this.physicsCollider=null,this.gameObject=null,this.type=0,this.isDeath=!1,this.isPlaced=!0,this.bloodProgress=null,this.baseLevelLocal=null,this.curLevelLocal=null,this.baseHpLocal=null,this.upHpLocal=null,this.baseAttackRecord=null,this.baseAni=null,this.bornPoints=null,this.fire=null,this.recoverySpeed=0}onAwake(){this.baseLevelLocal=f.get("baseLevel"),this.curLevelLocal=f.get("curLevel"),this.baseHpLocal=f.get("wallBaseHp"),this.upHpLocal=f.get("wallUpHp"),this.gameObject=this.owner,this.physicsCollider=this.gameObject.getComponent(Laya.PhysicsCollider),Laya.timer.frameLoop(1,this,this.onFrameLoop)}onFrameLoop(){this.bloodProgress&&this.recoverySpeed>0&&this.hp<this.fullHp&&(this.hp+=this.recoverySpeed*Laya.timer.delta/1e3,this.hp=this.hp<this.fullHp?this.hp:this.fullHp,this.bloodProgress.progress=this.hp/this.fullHp)}onDestroy(){}init(e,t){if(Laya.Tween.clearAll(this),this.baseAttackRecord=t,this.type=e,0==e)this.bloodProgress.white.skin="game/Ui_White.png",this.fullHp=this.hp=b.instance.getPropInfo(1002).value+this.baseHpLocal.value,this.recoverySpeed=b.instance.getPropInfo(1003).value;else if(1==e){this.bloodProgress.white.skin="game/Ui_Red.png";let e=1;e=this.curLevelLocal.value<=10?Math.ceil(this.curLevelLocal.value/2):Math.ceil(5)+this.curLevelLocal.value-10,b.instance.isPVP&&(e=3*(f.get("curDivision").value-1)+v.getRandom(1,3)),e=e<999?e:999,this.fullHp=this.hp=(e-1)*this.upHpLocal.value+this.baseHpLocal.value}if(this.bloodProgress.fullValue=this.fullHp,this.bloodProgress.progress=1,this.bloodProgress.visible=!0,this.isDeath=!1,!this.fire){let e=Laya.stage.getChildByName("game");this.fire=e.addChild(u.getRes(`CastleFire${this.type+1}.lh`))}this.setFire(1)}onHurt(e){this.isDeath||b.instance.isGamePause||(this.hp==this.fullHp&&1==this.type&&p.event("EnemyUseFireBall"),this.hp==this.fullHp&&0==this.type&&_.Instance.guideData&&"使用火球术提示语"==_.Instance.guideData.task&&(_.Instance.showGuide("使用火球术提示语",null),b.instance.isGamePause=!0),this.hp-=e,this.hp<=0&&(this.hp=0,this.isDeath=!0,b.instance.isGameOver||(b.instance.isGameOver=!0,p.event(a.BaseExplode,this.type))),this.bloodProgress.progress=this.hp/this.fullHp,this.setFire(this.bloodProgress.progress),this.playDamageAni())}playDamageAni(){this.baseAni&&(0==this.type?this.baseAni.play("SceneGetHit1",0,0):1==this.type&&this.baseAni.play("SceneGetHit2",0,0))}addExplode(e,t){let i=u.getRes(t).clone();Laya.stage.getChildByName("effect").getChildByName("clearNode").addChild(i);let a=this.bornPoints.getChildAt(e).transform.position.clone();0==this.type?a.z+=2:a.z-=2,a.Y+=1,i.transform.position=a,Laya.timer.once(3e3,this,()=>{i.destroy()})}setFire(e){let t=0;if(e<=.1?t=90:e<=.2?t=60:e<=.4&&(t=30),this.fire)for(let e=0;e<this.fire.numChildren;e++)this.fire.getChildAt(e).particleSystem.emission.emissionRate=t}}class oe{}oe.none="None",oe.stand="Stand",oe.death="Death",oe.damage="Damage",oe.run="Run",oe.attack="Attack";class le extends Laya.Script3D{constructor(){super(...arguments),this.gameObject=null,this.animator=null,this.physicsCollider=null,this.rigidbody3D=null,this.curState=oe.none,this.isDeath=!1,this.actorData=null}onAwake(){this.gameObject=this.owner,this.animator=this.gameObject.getComponent(Laya.Animator),this.physicsCollider=this.gameObject.getComponent(Laya.PhysicsCollider),this.rigidbody3D=this.gameObject.getComponent(Laya.Rigidbody3D),!this.physicsCollider&&this.rigidbody3D,this.registerCustomEvent()}onUpdate(){this.isDeath||this.onActorStateStay(this.curState)}onDestroy(){this.cancelCustomEvent()}onCollisionEnter(e){}onCollisionStay(e){}onCollisionExit(e){}onTriggerEnter(e){}onTriggerStay(e){}onTriggerExit(e){}init(e){this.actorData=e}Ani_Attack(e,t,i){this.onAttack(e,t,i)}Ani_AttackEnd(e,t,i){this.onAttackEnd(e,t,i)}onAttack(e,t,i){}onAttackEnd(e,t,i){}onActorStateEnter(e){}onActorStateStay(e){}onActorStateExit(e){}changeActorState(e,t){e!=this.curState&&(this.onActorStateExit(this.curState),this.onAnimationChange(e+t),this.onActorStateEnter(e),this.curState=e)}onAnimationChange(e){this.animator&&this.animator.crossFade(e,.1,0,0)}registerCustomEvent(){}cancelCustomEvent(){}onHurt(e){this.isDeath||(this.actorData.hp-=e,this.actorData.hp<=0?(this.actorData.hp,this.isDeath=!0,this.changeActorState(oe.death,"")):this.changeActorState(oe.damage,""))}}class he extends Laya.AnimatorStateScript{constructor(){super()}onStateEnter(){this.stateEnterHandler&&this.stateEnterHandler.runWith(this.name)}onStateUpdate(){this.stateUpdateHandler&&this.stateUpdateHandler.runWith(this.name)}onStateExit(){this.stateExitHandler&&this.stateExitHandler.runWith(this.name)}}class ce{}ce.bron="TowerBron",ce.stand="TowerStand";class de extends le{constructor(){super(...arguments),this.type=0,this.targetEnemyArray=null,this.targetTowerArray=null,this.roadArray=null,this.roadIndex=0,this.dataClone=null,this.attackTarget=null,this.camera=null,this.cameraOut=new Laya.Vector4,this.bloodProgress=null,this.isTransparent=!1,this.isPlaced=!1,this.attackDelayRecord=0,this.attackDistanceScale=.7,this.launchPoint=null,this.towerState=0,this.weaponSign="123"}onAwake(){super.onAwake(),this.launchPoint=this.gameObject.getChildByName("LaunchPoint1")}init(e){super.init(e),this.isPlaced=!1,this.dataClone=e.clone(),this.changeActorState(ce.stand,""),this.bloodProgress&&(0==this.type?this.bloodProgress.white.skin="game/Ui_White.png":1==this.type&&(this.bloodProgress.white.skin="game/Ui_Red.png"),this.bloodProgress.fullValue=e.hp,this.bloodProgress.progress=1,this.bloodProgress.visible=!1,this.bloodProgress.scaleX=this.bloodProgress.scaleY=.3),this.weaponSign="MissileTower1",1==this.type&&(this.weaponSign="MissileTower2"),this.attackDelayRecord=0}onUpdate(){!this.isPlaced||this.isDeath||b.instance.isGameOver||b.instance.isGamePause||(this.updateTowerState(),this.runAttackDelay(),this.findTarget(),this.attackSelectTarget(),super.onUpdate())}runAttackDelay(){this.attackDelayRecord>0&&(this.attackDelayRecord-=Laya.timer.delta,this.attackDelayRecord<0&&(this.attackDelayRecord=0))}findTarget(){if(this.targetEnemyArray&&(!this.attackTarget||this.attackTarget.isDeath)){let e=1e6,t=[this.targetEnemyArray,this.targetTowerArray];for(let i=0;i<t.length;i++){const a=t[i];let s=null;for(let t=0;t<a.length;t++){let i=a[t],n=Math.abs(this.gameObject.transform.position.z-i.gameObject.transform.position.z);n<e&&(e=n,s=i)}if(e<=this.actorData.attackDistance*this.attackDistanceScale)return this.attackTarget=s,void(this.towerState=1)}}}attackSelectTarget(){1==this.towerState&&this.attackTarget&&0==this.attackTarget.destroyed&&0==this.attackDelayRecord&&(this.createWeapon(),this.attackDelayRecord=this.actorData.attackDelay)}createWeapon(){if(b.instance.isGameOver||b.instance.isGamePause)return;let e=Laya.Pool.getItem(this.weaponSign);if(e)this.gameObject.parent.addChild(e.gameObject);else{let t=u.getRes(`${this.weaponSign}.lh`).clone();e=t.addComponent(pe),this.gameObject.parent.addChild(t)}e.gameObject.transform.position=this.launchPoint.transform.position.clone(),this.attackTarget.gameObject.transform.position.z<=this.gameObject.transform.position.z?e.gameObject.transform.localRotationEuler=new Laya.Vector3(0,180,0):e.gameObject.transform.localRotationEuler=new Laya.Vector3(0,0,0);let t=this.actorData.attack;e.init(!1,this.type,t,this.weaponSign,this.roadIndex,this.actorData.attackDistance,this.targetEnemyArray,this.targetTowerArray,null,!0,this.attackTarget)}updateBloodPositon(){if(this.bloodProgress&&this.camera){let e=this.gameObject.transform.position.clone();e.y+=3,this.cameraOut=B.projectPos(this.camera,e),this.bloodProgress.pos((this.cameraOut.x-this.bloodProgress.width*this.bloodProgress.scaleX/2)/Laya.stage.clientScaleX,(this.cameraOut.y-this.bloodProgress.height*this.bloodProgress.scaleY/2)/Laya.stage.clientScaleY)}}setPlaced(e,t,i,a){this.roadIndex=e,this.roadArray=t,this.targetEnemyArray=i,this.targetTowerArray=a,this.gameObject.active=!0,this.changeActorState(ce.bron,""),this.updateBloodPositon(),this.animator.getControllerLayer(0).getAnimatorState(ce.bron).addScript(he).stateExitHandler=Laya.Handler.create(this,()=>{this.isPlaced=!0,t.push(this),this.changeActorState(ce.stand,"")})}updateTowerState(){this.towerState=0,!this.attackTarget||this.attackTarget.destroyed||this.attackTarget.isDeath||Math.abs(this.gameObject.transform.position.z-this.attackTarget.gameObject.transform.position.z)<=this.actorData.attackDistance*this.attackDistanceScale&&(this.towerState=1)}onHurt(e){this.isDeath||b.instance.isGameOver||b.instance.isGamePause||(this.bloodProgress&&(this.bloodProgress.visible=!0),this.actorData.hp-=e,this.actorData.hp<=0&&(this.actorData.hp,this.isDeath=!0,this.bloodProgress.visible=!1,this.onDeath()),this.bloodProgress.progress=this.actorData.hp/this.dataClone.hp)}onDeath(){let e="TowerDeath1";1==this.type&&(e="TowerDeath2"),this.gameObject.active=!1;let t=u.getRes(`${e}.lh`),i=Laya.Sprite3D.instantiate(t,this.gameObject.parent,!1,this.gameObject.transform.position.clone()),a=this.roadArray.indexOf(this);a>=0&&this.roadArray.splice(a,1),Laya.timer.once(2e3,this,()=>{let e={y:i.transform.position.y};Laya.Tween.to(e,{y:-2,update:Laya.Handler.create(this,()=>{if(i){let t=i.transform.position.clone();t.y=e.y,i.transform.position=t}},null,!1)},1e3,Laya.Ease.linearNone,Laya.Handler.create(this,()=>{Laya.timer.once(500,this,()=>{this.gameObject.destroy(),i.destroy()})}))})}addExplode(e){let t=u.getRes(e).clone();Laya.stage.getChildByName("effect").getChildByName("clearNode").addChild(t);let i=this.gameObject.transform.position.clone();"Player3"==this.gameObject.name?i.y=4.2:"Player2"==this.gameObject.name?i.y=1:(this.gameObject.name,i.y=1),t.transform.position=i,Laya.timer.once(3e3,this,()=>{t.destroy()})}onDestroy(){super.onDestroy(),Laya.timer.clearAll(this),this.bloodProgress&&this.bloodProgress.destroy()}}class pe extends Laya.Script3D{constructor(){super(...arguments),this.gameObject=null,this.type=0,this.damage=0,this.moveDir=null,this.translation=null,this.sign="weapon",this.roadIndex=0,this.moveDistance=0,this.isDragon=!1,this.moveSpeed=8,this.roadEnemyArr=null,this.roadTowerArr=null,this.enemyFort=null,this.isTower=!1,this.towerTarget=null}onAwake(){this.gameObject=this.owner,this.translation=new Laya.Vector3}onDestroy(){}onUpdate(){if(!b.instance.isGameOver&&!this.isDragon&&"MissileSizu1"!=this.gameObject.name&&"MissileSizu2"!=this.gameObject.name){if(Laya.Vector3.scale(this.moveDir,this.moveSpeed*Laya.timer.delta/1e3,this.translation),this.moveDistance-=this.translation.z,this.gameObject.transform.translate(this.translation),this.moveDistance<=0)return void p.event(a.RecoveryWeapon,this);this.detectCollision()}}hitThing(e){let t="";"MissileShuangzu1"==this.gameObject.name||"MissileTower1"==this.gameObject.name||"MissileTower2"==this.gameObject.name?t="ExplodeShuangzu1.lh":"MissileSizu1"==this.gameObject.name||"MissileSizu2"==this.gameObject.name?t="ExplodeSizu1.lh":"MissileDragon1"==this.gameObject.name?t="ExplodeDragon1.lh":"MissileDragon2"==this.gameObject.name?t="ExplodeDragon2.lh":"MissileDragon3"==this.gameObject.name&&(t="ExplodeDragon3.lh");let i=this.damage,s=this.roadIndex;this.isDragon?Laya.timer.once(200,this,()=>{u.playSound("Hit.mp3"),e instanceof ue?(e.addExplode(t),e.onHurt(i)):e instanceof re?(1==e.type&&(e.baseAttackRecord[s]=1),e.addExplode(s,t),e.onHurt(i)):e instanceof de&&(e.addExplode(t),e.onHurt(i))}):"MissileSizu1"!=this.gameObject.name&&"MissileSizu2"!=this.gameObject.name?(u.playSound("Hit.mp3"),e instanceof ue?(e.addExplode(t),e.onHurt(i)):e instanceof re?(1==e.type&&(e.baseAttackRecord[s]=1),e.addExplode(s,t),e.onHurt(i)):e instanceof de&&(e.addExplode(t),e.onHurt(i)),p.event(a.RecoveryWeapon,this)):Laya.timer.once(600,this,()=>{u.playSound("Hit1.mp3"),e instanceof ue?(e.addExplode(t),e.onHurt(i)):e instanceof re?(1==e.type&&(e.baseAttackRecord[s]=1),e.addExplode(s,t),e.onHurt(i)):e instanceof de&&(e.addExplode(t),e.onHurt(i))})}init(e,t,i,s,n,r,o,l,h,c=!1,d=null){this.isTower=c,this.towerTarget=d,this.roadEnemyArr=o,this.roadTowerArr=l,this.enemyFort=h,this.moveDistance=r,this.isDragon=e,this.sign=s,this.type=t,this.roadIndex=n,this.damage=i,this.moveDir=new Laya.Vector3(0,0,1),this.isDragon?(this.detectCollision(),Laya.timer.once(1e3,this,()=>{p.event(a.RecoveryWeapon,this)})):"MissileSizu1"!=s&&"MissileSizu2"!=s||(this.detectCollision(),Laya.timer.once(2e3,this,()=>{p.event(a.RecoveryWeapon,this)}))}detectCollision(){if(this.isTower)this.towerTarget&&0==this.towerTarget.destroyed&&0==this.towerTarget.isDeath&&Math.abs(this.gameObject.transform.position.z-this.towerTarget.gameObject.transform.position.z)<=.3&&this.hitThing(this.towerTarget);else{let e=[];for(let t=0;t<this.roadEnemyArr.length;t++){const i=this.roadEnemyArr[t];e.push({z:i.gameObject.transform.position.z,index:t,targetArr:this.roadEnemyArr})}for(let t=0;t<this.roadTowerArr.length;t++){const i=this.roadTowerArr[t];e.push({z:i.gameObject.transform.position.z,index:t,targetArr:this.roadTowerArr})}if(0==this.type?e.sort((e,t)=>t.z-e.z):e.sort((e,t)=>e.z-t.z),this.isDragon){for(let t=0;t<e.length;t++){let i=e[t];if(0==this.type&&i.z>=this.gameObject.transform.position.z-this.moveDistance||1==this.type&&i.z<=this.gameObject.transform.position.z+this.moveDistance){let e=i.targetArr[i.index];this.hitThing(e)}}(0==this.type&&this.enemyFort.gameObject.transform.position.z>=this.gameObject.transform.position.z-this.moveDistance||1==this.type&&this.enemyFort.gameObject.transform.position.z<=this.gameObject.transform.position.z+this.moveDistance)&&this.hitThing(this.enemyFort)}else{if("MissileSizu1"==this.gameObject.name||"MissileSizu2"==this.gameObject.name){if(e.length>0){let t=e[0],i=t.targetArr[t.index];return void this.hitThing(i)}return void this.hitThing(this.enemyFort)}if(e.length>0){let t=e[0];if(0==this.type&&(t.z>this.gameObject.transform.position.z||this.gameObject.transform.position.z-t.z<=.3)){let e=t.targetArr[t.index];return void this.hitThing(e)}if(1==this.type&&(t.z<this.gameObject.transform.position.z||t.z-this.gameObject.transform.position.z<=.3)){let e=t.targetArr[t.index];return void this.hitThing(e)}}if(0==this.type&&(this.enemyFort.gameObject.transform.position.z>this.gameObject.transform.position.z||this.gameObject.transform.position.z-this.enemyFort.gameObject.transform.position.z<=.3))return void this.hitThing(this.enemyFort);if(1==this.type&&(this.enemyFort.gameObject.transform.position.z<this.gameObject.transform.position.z||this.enemyFort.gameObject.transform.position.z-this.gameObject.transform.position.z<=.3))return void this.hitThing(this.enemyFort)}}}}class ge{}ge.bron="Bron";class ue extends le{constructor(){super(...arguments),this.moveDir=new Laya.Vector3,this.translation=new Laya.Vector3,this.animators=null,this.targetEnemyArray=null,this.targetTowerArray=null,this.roadArray=null,this.roadIndex=0,this.targetFort=null,this.isPlaced=!1,this.isTransparent=!1,this.sign="123",this.weaponPoint1=null,this.weaponPoint2=null,this.weaponEffect=null,this.weaponEffect1=null,this.type=0,this.bloodProgress=null,this.dataClone=null,this.moveSpeedScale=.1,this.attackDelayScale=.1,this.attackDistanceScale=.7,this.attackDelayRecord=0,this.camera=null,this.cameraOut=new Laya.Vector4,this.attackType=0,this.missilePointParticalArr=[],this.missilePointParticalArr1=[],this.doubleAttack=!1,this.doubleMove=!1,this.useEncourageMagic=!1,this.isRecoverying=!1,this.useCurseMagic=!1,this.refreshExtraTime=3e3,this.roleOriginalValue=null}onAwake(){if(super.onAwake(),this.getAnimators(),"Player1"==this.owner.name){this.weaponPoint1=this.gameObject.getChildByName("LaunchPoint1"),this.weaponPoint2=this.gameObject.getChildByName("LaunchPoint2"),this.sign="MissileShuangzu1",this.weaponEffect=u.getRes("MissilePoint1.lh").clone(),this.weaponEffect1=u.getRes("MissilePoint1.lh").clone();let e=this.getChildByUrl(this.animators[2].owner,"Bip001/Bip001 Pelvis/Bip001 Spine/Bip001 Spine1/Bip001 Neck/Bip001 R Clavicle/Bip001 R UpperArm/Bip001 R Forearm/Bip001 R Hand"),t=this.getChildByUrl(this.animators[2].owner,"Bip001/Bip001 Pelvis/Bip001 Spine/Bip001 Spine1/Bip001 Neck/Bip001 L Clavicle/Bip001 L UpperArm/Bip001 L Forearm/Bip001 L Hand");this.weaponEffect.transform.localPosition=new Laya.Vector3,this.weaponEffect.transform.localRotationEuler=new Laya.Vector3,this.weaponEffect1.transform.localPosition=new Laya.Vector3,this.weaponEffect1.transform.localRotationEuler=new Laya.Vector3,e.addChild(this.weaponEffect),t.addChild(this.weaponEffect1)}else"Player2"==this.owner.name?this.sign="MissileSizu":"Player3"==this.owner.name&&(this.owner.getChildByName("Player3_FireDragon1")?this.sign="MissileDragon1":this.owner.getChildByName("Player3_IceDragon1")?this.sign="MissileDragon2":this.owner.getChildByName("Player3_PoisonDragon1")?this.sign="MissileDragon3":this.owner.getChildByName("Player3_DesertDragon1")&&(this.sign="MissileDragon1"));this.weaponEffect&&(this.missilePointParticalArr.push(this.weaponEffect.getChildByName("Glow1")),this.missilePointParticalArr.push(this.weaponEffect.getChildByName("Sparkle1")),this.missilePointParticalArr.push(this.weaponEffect.getChildByName("Sparkle2"))),this.weaponEffect1&&(this.missilePointParticalArr1.push(this.weaponEffect1.getChildByName("Glow1")),this.missilePointParticalArr1.push(this.weaponEffect1.getChildByName("Sparkle1")),this.missilePointParticalArr1.push(this.weaponEffect1.getChildByName("Sparkle2"))),3==this.missilePointParticalArr.length&&(this.missilePointParticalArr[0].particleSystem.playOnAwake=!1,this.missilePointParticalArr[1].particleSystem.playOnAwake=!1,this.missilePointParticalArr[2].particleSystem.playOnAwake=!1),3==this.missilePointParticalArr1.length&&(this.missilePointParticalArr1[0].particleSystem.playOnAwake=!1,this.missilePointParticalArr1[1].particleSystem.playOnAwake=!1,this.missilePointParticalArr1[2].particleSystem.playOnAwake=!1)}onStart(){this.playMissilePartical(!1,"Attack1"),this.playMissilePartical(!1,"Attack")}playMissilePartical(e,t){"Attack1"==t?3==this.missilePointParticalArr.length&&(e?(this.missilePointParticalArr[0].particleSystem.play(),this.missilePointParticalArr[1].particleSystem.play(),this.missilePointParticalArr[2].particleSystem.play()):(this.missilePointParticalArr[0].particleSystem.stop(),this.missilePointParticalArr[1].particleSystem.stop(),this.missilePointParticalArr[2].particleSystem.stop())):3==this.missilePointParticalArr1.length&&(e?(this.missilePointParticalArr1[0].particleSystem.play(),this.missilePointParticalArr1[1].particleSystem.play(),this.missilePointParticalArr1[2].particleSystem.play()):(this.missilePointParticalArr1[0].particleSystem.stop(),this.missilePointParticalArr1[1].particleSystem.stop(),this.missilePointParticalArr1[2].particleSystem.stop()))}onEnable(){this.changeActorState(oe.stand,"")}onDisable(){this.curState=oe.none}onUpdate(){this.updateBloodPositon(),!this.isPlaced||this.isDeath||b.instance.isGameOver||b.instance.isGamePause||(this.recoveryBlood(),this.lostBlood(),this.runAttackDelay(),this.runRefreshExtraTime(),this.findTarget(),super.onUpdate())}registerCustomEvent(){p.on(a.BaseExplode,this,this.onBaseExplode),p.on(a.RuneFinish,this,this.onRuneFinish),p.on(a.MagicFinish,this,this.onMagicFinish)}cancelCustomEvent(){p.off(a.BaseExplode,this,this.onBaseExplode),p.off(a.RuneFinish,this,this.onRuneFinish),p.on(a.MagicFinish,this,this.onMagicFinish)}onDestroy(){super.onDestroy(),Laya.timer.clearAll(this),this.bloodProgress&&this.bloodProgress.destroy()}onTriggerEnter(e){e.owner.name.indexOf("Rune")}onRuneFinish(e,t,i){e==this.type&&i==this.roadIndex&&this.useRune(t,!1)}onMagicFinish(e,t){4==e?this.type==t&&this.useMagicBuff(e,!1):6==e&&this.type!=t&&this.useMagicBuff(e,!1)}init(e){0==this.type&&0==_.Instance.guideFinish&&(e.attack*=2),super.init(e),this.dataClone=e.clone(),this.roleOriginalValue=[this.dataClone.attack,this.dataClone.hp,this.dataClone.moveSpeed,this.dataClone.attackDelay],this.updateRoleProp(),this.bloodProgress&&(0==this.type?this.bloodProgress.white.skin="game/Ui_White.png":1==this.type&&(this.bloodProgress.white.skin="game/Ui_Red.png"),this.bloodProgress.fullValue=e.hp,this.bloodProgress.progress=1,this.bloodProgress.visible=!1,this.bloodProgress.scaleX=this.bloodProgress.scaleY=.3),this.attackDelayRecord=0}onActorStateExit(e){}onActorStateEnter(e){if(e==oe.death){let e=this.roadArray.indexOf(this);e>=0&&this.roadArray.splice(e,1),Laya.timer.once(2e3,this,()=>{let e={y:this.gameObject.transform.position.y};Laya.Tween.to(e,{y:-2,update:Laya.Handler.create(this,()=>{if(this.gameObject){let t=this.gameObject.transform.position.clone();t.y=e.y,this.gameObject.transform.position=t}},null,!1)},1e3,Laya.Ease.linearNone,Laya.Handler.create(this,()=>{Laya.timer.once(500,this,()=>{this.gameObject.destroy()})}))})}}onActorStateStay(e){if(e==oe.run){let e=this.actorData.moveSpeed*this.moveSpeedScale*Laya.timer.delta/1e3,t=1;this.doubleMove&&(t+=1),b.instance.randomBuffState[b.instance.acidId-1]&&(t-=b.instance.acidSpeedSlowPer),this.useEncourageMagic&&(t+=b.instance.encouragePer),this.useCurseMagic&&(t-=b.instance.cursePer),1!=b.instance.randomBuffState[b.instance.redSunId-1]&&1!=b.instance.randomBuffState[b.instance.blueSunId-1]&&1!=b.instance.randomBuffState[b.instance.purpleSunId-1]||(t-=b.instance.sunProp[this.actorData.type-1][1]),e*=t,Laya.Vector3.scale(this.moveDir,e,this.translation),this.gameObject.transform.translate(this.translation)}}findTarget(){if(!this.targetEnemyArray||!this.targetFort||!this.targetTowerArray)return;let e=1e6;for(let t=0;t<this.targetEnemyArray.length;t++){const i=this.targetEnemyArray[t];let a=Math.abs(this.gameObject.transform.position.z-i.gameObject.transform.position.z);a<e&&(e=a)}for(let t=0;t<this.targetTowerArray.length;t++){const i=this.targetTowerArray[t];let a=Math.abs(this.gameObject.transform.position.z-i.gameObject.transform.position.z);a<e&&(e=a)}if(e<=this.actorData.attackDistance*this.attackDistanceScale){if(0==this.attackDelayRecord){let e=0;"Player1"==this.owner.name?e=2:"Player2"==this.owner.name?e=2:"Player3"==this.owner.name&&(e=1),this.attackType=v.getRandom(1,e),this.changeActorState(oe.attack,this.attackType.toString())}return}if((e=Math.abs(this.gameObject.transform.position.z-this.targetFort.gameObject.transform.position.z))<=this.actorData.attackDistance*this.attackDistanceScale){if(0==this.attackDelayRecord){let e=0;"Player1"==this.owner.name?e=2:"Player2"==this.owner.name?e=2:"Player3"==this.owner.name&&(e=1),this.attackType=v.getRandom(1,e),this.changeActorState(oe.attack,this.attackType.toString())}return}let t=0;"Player1"==this.owner.name?t=3:"Player2"==this.owner.name?t=1:"Player3"==this.owner.name&&(t=1),this.changeActorState(oe.run,v.getRandom(1,t).toString())}onAttack(e,t,i){"Player2"!=this.gameObject.name&&(u.playSound("Attack.mp3"),this.playMissilePartical(!1,"Attack1"),this.createWeapon())}onAttackEnd(e,t,i){this.attackDelayRecord=this.actorData.attackDelay;let a=1;this.useEncourageMagic&&(a-=b.instance.encouragePer),this.useCurseMagic&&(a+=b.instance.cursePer),this.attackDelayRecord*=a,this.isDeath||this.changeActorState(oe.stand,"")}setTransparent(e){if(e==this.isTransparent)return;this.isTransparent=e;let t=[];if(null==this.gameObject&&console.error(this),this.getSkinnedMeshInChildren(this.gameObject,t),e)for(let e=0;e<t.length;e++){const i=t[e];i.skinnedMeshRenderer.material.albedoColorA=.5,i.skinnedMeshRenderer.material.renderMode=2}else for(let e=0;e<t.length;e++){const i=t[e];i.skinnedMeshRenderer.material.albedoColorA=1,i.skinnedMeshRenderer.material.renderMode=0}}setPlaced(e,t,i,a,s=null){this.roadIndex=e,this.roadArray=t,this.targetEnemyArray=i,this.targetTowerArray=a,this.setTransparent(!1),this.gameObject.active=!1,s&&(Laya.timer.once(5e3,this,()=>{s.owner.removeSelf(),s.owner.destroy()}),s.callBack1=(()=>{this&&(this.gameObject.active=!0,this.changeActorState(ge.bron,""),Laya.timer.once(1500,this,()=>{this.isPlaced=!0}))}))}getSkinnedMeshInChildren(e,t){for(let i=0;i<e.numChildren;i++){const a=e.getChildAt(i);a instanceof Laya.SkinnedMeshSprite3D&&t.push(a),a.numChildren>0&&this.getSkinnedMeshInChildren(a,t)}}createWeapon(){if(b.instance.isGameOver||b.instance.isGamePause)return;let e=this.sign;"Player2"==this.gameObject.name&&(e=this.sign+`${this.attackType}`);let t=Laya.Pool.getItem(e);if(t)this.gameObject.parent.addChild(t.gameObject);else{let i=u.getRes(`${e}.lh`).clone();t=i.addComponent(pe),this.gameObject.parent.addChild(i)}"MissileShuangzu1"==t.gameObject.name&&Laya.timer.frameOnce(1,this,()=>{t.gameObject.getChildByName("Trail").trailFilter.time=.2}),this.weaponPoint1&&this.weaponPoint2?1==this.attackType?t.gameObject.transform.position=this.weaponPoint1.transform.position.clone():2==this.attackType&&(t.gameObject.transform.position=this.weaponPoint2.transform.position.clone()):t.gameObject.transform.position=this.gameObject.transform.position.clone(),0==this.type?t.gameObject.transform.localRotationEuler=new Laya.Vector3(0,180,0):t.gameObject.transform.localRotationEuler=new Laya.Vector3(0,0,0);let i=this.actorData.attack,a=1;this.doubleAttack&&(a+=1),1!=b.instance.randomBuffState[b.instance.redSunId-1]&&1!=b.instance.randomBuffState[b.instance.blueSunId-1]&&1!=b.instance.randomBuffState[b.instance.purpleSunId-1]||(a+=b.instance.sunProp[this.actorData.type-1][0]),i*=a,t.init("Player3"==this.gameObject.name,this.type,i,e,this.roadIndex,this.actorData.attackDistance,this.targetEnemyArray,this.targetTowerArray,this.targetFort)}runAttackDelay(){this.attackDelayRecord>0&&(this.attackDelayRecord-=Laya.timer.delta,this.attackDelayRecord<0&&(this.attackDelayRecord=0))}runRefreshExtraTime(){this.refreshExtraTime>0&&(this.refreshExtraTime-=Laya.timer.delta,this.refreshExtraTime<=0&&(this.refreshExtraTime=0,this.updateRoleProp(),this.bloodProgress.fullValue=this.dataClone.hp,this.bloodProgress.progress=this.actorData.hp/this.dataClone.hp))}onAnimationChange(e){"Attack1"==e||"Attack2"==e?(this.playMissilePartical(!0,e),"Player2"==this.gameObject.name&&(Laya.timer.once(300,this,()=>{u.playSound("AttackClaw.mp3")}),this.playMissilePartical(!1,e),this.createWeapon())):this.playMissilePartical(!1,e);for(let t=0;t<this.animators.length;t++){const i=this.animators[t];i&&i.play(e,0,0)}}onHurt(e){this.isDeath||b.instance.isGameOver||b.instance.isGamePause||(this.bloodProgress&&(this.bloodProgress.visible=!0),this.actorData.hp-=e,this.actorData.hp<=0&&(this.actorData.hp,this.isDeath=!0,this.bloodProgress.visible=!1,this.changeActorState(oe.death,""),p.event(a.RoleDeath,[this.type,this.gameObject.transform.position.clone()])),this.bloodProgress.progress=this.actorData.hp/this.dataClone.hp)}updateBloodPositon(){if(this.bloodProgress&&this.camera){let e=this.gameObject.transform.position.clone();e.y+=3,this.cameraOut=B.projectPos(this.camera,e),this.bloodProgress.pos((this.cameraOut.x-this.bloodProgress.width*this.bloodProgress.scaleX/2)/Laya.stage.clientScaleX,(this.cameraOut.y-this.bloodProgress.height*this.bloodProgress.scaleY/2)/Laya.stage.clientScaleY)}}onBaseExplode(e){this.isDeath||this.changeActorState(oe.stand,"")}getChildByUrl(e,t){let i=e,a=t.split("/");for(let e=0;e<a.length&&null!=i;e++)i=i.getChildByName(a[e]);return i}addExplode(e){let t=u.getRes(e).clone();Laya.stage.getChildByName("effect").getChildByName("clearNode").addChild(t);let i=this.gameObject.transform.position.clone();"Player3"==this.gameObject.name?i.y=4.2:"Player2"==this.gameObject.name?i.y=1:"Player1"==this.gameObject.name&&(i.y=1),t.transform.position=i,Laya.timer.once(3e3,this,()=>{t.destroy()})}useRune(e,t){if(this.isDeath)return;let i=`RuneBuff${e}`;this.openBuffEffect(i,t),1==e?this.doubleAttack=t:2==e?this.doubleMove=t:3==e&&(this.isRecoverying=t)}useMagicBuff(e,t){4==e?(this.useEncourageMagic=t,this.openBuffEffect("Skill6Buff",t)):6==e&&(this.useCurseMagic=t)}useBuff(e,t){this.isDeath||(e==b.instance.weakId?t&&this.onHurt(this.actorData.hp/2):e==b.instance.thunderId&&t&&this.onHurt(b.instance.thunderDamage))}recoveryBlood(){this.isRecoverying&&(this.actorData.hp+=b.instance.recoverySec*Laya.timer.delta/1e3,this.actorData.hp=this.actorData.hp<this.dataClone.hp?this.actorData.hp:this.dataClone.hp,this.bloodProgress.progress=this.actorData.hp/this.dataClone.hp)}lostBlood(){if(b.instance.randomBuffState[b.instance.acidId-1]){let e=b.instance.acidDamageSec*Laya.timer.delta/1e3;e<this.actorData.hp&&this.onHurt(e)}}getAnimators(){this.animators=[];for(let e=0;e<this.gameObject.numChildren;e++){let t=this.gameObject.getChildAt(e).getComponent(Laya.Animator);t&&this.animators.push(t)}}openBuffEffect(e,t){let i=this.gameObject.getChildByName(e);i||(i=u.getRes(e+".lh").clone(),"Player1"==this.gameObject.name?i.transform.position=new Laya.Vector3(0,3.5,0):"Player2"==this.gameObject.name?i.transform.position=new Laya.Vector3(0,2.5,0):"Player3"==this.gameObject.name&&(i.transform.position=new Laya.Vector3(0,6,0)),this.gameObject.addChild(i)),i&&(t?i.particleSystem.play():i.particleSystem.stop())}updateRoleProp(){let e=this.actorData.hp,t=31001,i=30001;2==this.actorData.type?(t=21001,i=20001):3==this.actorData.type&&(t=41001,i=40001);let a=[0,0,0,0];for(let s=0;s<4;s++)if(a[s]+=this.roleOriginalValue[s],3!=s)a[s]+=b.instance.getPropInfo(11001+s).value,a[s]+=b.instance.getPropInfo(t+s).value,this.refreshExtraTime>0?(a[s]+=b.instance.getPropInfo(10001+s).value,a[s]+=b.instance.getPropInfo(i+s).value):1==s&&(e-=b.instance.getPropInfo(10001+s).value,e=(e-=b.instance.getPropInfo(10001+s).value)>0?e:0);else{let e=0;e+=b.instance.getPropInfo(11001+s).value,e+=b.instance.getPropInfo(t+s).value,this.refreshExtraTime>0&&(e+=b.instance.getPropInfo(10001+s).value,e+=b.instance.getPropInfo(i+s).value);let n=1-e;n=n>0?n:0,a[s]*=n}this.dataClone.attack=a[0],this.actorData.attack=a[0],this.dataClone.hp=a[1],this.refreshExtraTime>0?this.actorData.hp=a[1]:this.actorData.hp=e,this.dataClone.moveSpeed=a[2],this.actorData.moveSpeed=a[2],this.dataClone.attackDelay=a[3],this.actorData.attackDelay=a[3]}}class me extends ue{onAwake(){super.onAwake(),this.type=0,this.moveDir=new Laya.Vector3(0,0,1),this.gameObject.transform.lookAt(new Laya.Vector3(0,0,1),new Laya.Vector3(0,1,0),!0)}init(e){super.init(e)}}class ye extends ue{onAwake(){super.onAwake(),this.type=1,this.moveDir=new Laya.Vector3(0,0,1),this.gameObject.transform.lookAt(new Laya.Vector3(0,0,-1),new Laya.Vector3(0,1,0))}init(e){super.init(e)}}class fe{constructor(e=null){this.hp=100,e&&(this.hp=e.hp)}clone(){return new fe(this)}}class ve extends fe{constructor(e=null){super(e),this.attack=30,this.attackDelay=0,this.attackDistance=3,this.moveSpeed=1,this.def=0,this.type=0,e&&(this.attack=e.atk,this.hp=e.hp,this.attackDistance=e.atkRange,this.moveSpeed=e.speed,this.attackDelay=e.atkgap,this.def=e.def)}clone(){let e=new ve;return e.attack=this.attack,e.hp=this.hp,e.attackDistance=this.attackDistance,e.moveSpeed=this.moveSpeed,e.attackDelay=this.attackDelay,e.def=this.def,e.type=this.type,e}}class Le extends Laya.Script3D{constructor(){super(...arguments),this.roleBase=null,this.gameObject=null}onAwake(){this.gameObject=this.owner,this.roleBase=this.gameObject.parent.getComponent(ue)}Ani_Attack(e,t,i){this.roleBase&&this.roleBase.onAttack(e,t,i)}Ani_AttackEnd(e,t,i){this.roleBase&&this.roleBase.onAttackEnd(e,t,i)}}class Ce extends i.bloodUI{constructor(){super(...arguments),this._progress=0,this._fullValue=0,this._barwidth=0}onAwake(){this._barwidth=this.bar.width}set progress(e){this.hpLabel&&(this.hpLabel.text=`${Math.floor(e*this._fullValue)}/${this._fullValue}`),this._progress=e,this.bar.width=this._barwidth*this._progress,Laya.Tween.to(this.white,{width:this.bar.width},1400,Laya.Ease.sineOut)}get progress(){return this._progress}set fullValue(e){this._fullValue=e,this.hpLabel.text=`${this._fullValue}/${this._fullValue}`}onDestroy(){Laya.Tween.clearAll(this)}}class Se extends Laya.Script3D{constructor(){super(...arguments),this.animator=null,this.curState="None"}onAwake(){this.animator=this.owner.getComponent(Laya.Animator),this.changeState("CameraStand")}changeState(e){this.curState!=e&&(this.animator.play(e,0,0),this.curState=e)}Ani_End(){this.changeState("CameraStand")}}class ke extends Laya.Script3D{Ani_FireDrath(e,t,i){p.event(a.SkillBallHit,[t,this.roadIndex,this.type])}}class be extends Laya.Script3D{constructor(){super(...arguments),this.callBack1=null,this.callBack2=null}onAwake(){}Ani_Bron(e,t,i){this.callBack1&&this.callBack1()}Ani_BronEnd(e,t,i){this.callBack2&&this.callBack2(),this.owner.removeSelf(),this.owner.destroy()}}class we extends i.playUI{constructor(){super(...arguments),this.playerMonsterArray=null,this.enemyMonsterArray=null,this.pickUpUnitArr=null,this.playerFort=null,this.enemyFort=null,this.playerCannonArr=null,this.enemyCannonArr=null,this.obsArr=null,this.weaponArr=null,this.doubleFootIdArray=[],this.fourFootIdArray=[],this.dragonIdArray=[],this.playerBornPoints=null,this.enemyBornPoints=null,this.camera=null,this.ray=new Laya.Ray(new Laya.Vector3,new Laya.Vector3),this.cameraRuntime=null,this.cameraNode=null,this.sceneInfo=null,this.scene3D=null,this.pickCard=null,this.pickIndex=-1,this.pickRole=null,this.dragPoint=null,this.cellWidth=0,this.cellHeight=0,this.colNum=5,this.rowNum=13,this.mapOrigin=null,this.killExtraEnergy=0,this.realStoneNum=12,this.mineStoneNum=12,this.curGroupDataLocal=null,this.mineLevelLocal=null,this.curGroupNumberLocal=null,this.enemyPoolLocal=null,this.curLevelLocal=null,this.diamondLocal=null,this.mineBaseLocal=null,this.mineUpLocal=null,this.startRefreshMonster=!1,this.refreshTimeDelay=[0,0,0],this.refreshWaveRec=[0,0,0],this.roadPickRecord=[0,0,0,0,0],this.baseAttackRecord=[0,0,0,0,0],this.enableRoad=null,this.clearNode=null,this.originalY=0,this.selectPointer=null,this.groundAnimator=null,this.skeleton=null,this.isSkeletonPlaying=!1,this.isMoving=!1,this.isDestroying=!1,this.standerdY=-1,this.fireBallSkillData=null,this.guideRefreshMonster=!1,this.playerPlaceRoad=[],this.freeTryCard=null,this.thunderLeftTime=0,this.benefitLeftTime=0,this.lastStormRoadIndex=-1,this.playerBuffTime=[{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0}],this.enemyBuffTime=[{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0}],this.playerMagicBuffTime={encourageMagicTime:0,curseMagicTime:0},this.enemyMagicBuffTime={encourageMagicTime:0,curseMagicTime:0},this.curDivisionLocal=null,this.killNum=0,this.outRecord=0,this.playTime=0,this.isSlideTaskRunning=!1,this.enemyCount=3}onAwake(){this.playerHead.skin=window.UserInfo.avatarUrl,u.playMusic("BattleBGM.mp3",0),this.diamondLocal=f.get("diamond"),this.mineLevelLocal=f.get("mineLevel"),this.curLevelLocal=f.get("curLevel"),this.enemyPoolLocal=f.get("enemyPool"),this.curGroupNumberLocal=f.get("curGroup"),this.mineBaseLocal=f.get("mineBaseCreate"),this.mineUpLocal=f.get("mineUpCreate"),this.curDivisionLocal=f.get("curDivision"),this.curGroupDataLocal=f.get(`group${this.curGroupNumberLocal.value}`),this.killExtraEnergy=b.instance.getPropInfo(1004).value,b.instance.initGiftData(),this.stoneLabel.text=this.mineStoneNum.toString(),this.countPage.close(),this.playerMonsterArray=[[],[],[],[],[]],this.enemyMonsterArray=[[],[],[],[],[]],this.playerCannonArr=[[],[],[],[],[]],this.enemyCannonArr=[[],[],[],[],[]],this.pickUpUnitArr=[[],[],[],[],[]],this.initEnergyIncreaseSpeed(),this.initSplitMonsterIdArr(),this.initRefreshTimeDelay(),this.dragPoint=new Laya.Vector2,this.otherBlood.bar.skin="game/Ui_Progress2.png";let e="";e=b.instance.isPVP?"LevelVS.ls":`Level${b.instance.playStage[0]}.ls`,this.scene3D=Laya.stage.addChildAt(u.getRes(e),0),this.scene3D.name="game",this.clearNode=this.scene3D.addChild(new Laya.Sprite3D),this.clearNode.name="clearNode";let t=this.scene3D.addChild(u.getRes("MainCamera.lh"));this.camera=t.getChildByName("MainCamera").getChildByName("Camera"),this.cameraRuntime=t.addComponent(Se),this.sceneInfo=this.scene3D.addChild(u.getRes("SceneInfo.lh")),this.effectScene3D=Laya.stage.addChild(new Laya.Scene3D),this.effectScene3D.name="effect",this.effectClearNode=this.effectScene3D.addChild(new Laya.Sprite3D),this.effectClearNode.name="clearNode",this.effectCameraNode=this.effectScene3D.addChild(t.clone()),this.effectCameraNode.transform.position=t.transform.position.clone(),this.effectCamera=this.effectCameraNode.getChildByName("MainCamera").getChildByName("Camera"),this.effectCameraRuntime=this.effectCameraNode.getComponent(Se),this.effectCamera.clearFlag=Laya.CameraClearFlags.DepthOnly,this.effectCamera.fieldOfView=50,this.changeSceneShader(),this.scene3D.getChildByName("Scene").getChildByName("Castle1").active=!0,this.scene3D.getChildByName("Scene").getChildByName("Castle2").active=!0,this.cameraRuntime.changeState("CameraStand"),this.effectCameraRuntime.changeState("CameraStand"),this.scene3D.addChild(this.clearNode);let i=this.scene3D.getChildByName("Scene").getComponent(Laya.Animator);this.playerBornPoints=this.sceneInfo.getChildByName("RevivePonit1"),this.enemyBornPoints=this.sceneInfo.getChildByName("RevivePonit2"),this.playerFort=this.sceneInfo.getChildByName("Flag1").addComponent(re),this.playerFort.bloodProgress=this.selfBlood,this.playerFort.baseAni=i,this.playerFort.bornPoints=this.playerBornPoints,this.playerFort.init(0,this.baseAttackRecord),this.enemyFort=this.sceneInfo.getChildByName("Flag2").addComponent(re),this.enemyFort.bloodProgress=this.otherBlood,this.enemyFort.baseAni=i,this.enemyFort.bornPoints=this.enemyBornPoints,this.enemyFort.init(1,this.baseAttackRecord),this.levelLabel.text=`第${this.curLevelLocal.value}关`,this.killNum=0,this.setCardListData(),this.setMineProgress(0),this.slideHand(!1,-1),this.curLevelLocal.value<=2&&(this.surrender.visible=!1),this.thunderLeftTime=b.instance.thunderTimeGap,this.benefitLeftTime=b.instance.electricityTimeGap,this.playWeatherEffect(),this.updateSceneInfo(),this.initCannonTower(),this.initRoadBlockEffect(),b.instance.countStar=[0,0,0,0],Laya.timer.loop(6e4,this,this.onGameTime)}onShowCb(){u.playMusic("BattleBGM.mp3",0),Laya.timer.resume(),Laya.updateTimer.resume(),Laya.physicsTimer.resume(),Laya.stage.renderingEnabled=!0,b.instance.isGamePause=!1}onHideCb(){Laya.timer.pause(),Laya.updateTimer.pause(),Laya.physicsTimer.pause(),Laya.stage.renderingEnabled=!1,b.instance.isGamePause=!0}adaptTopBox(){if(Laya.Browser.onWeiXin){let e=wx.getSystemInfoSync();this.topBox.y=e.statusBarHeight}}collisionTest(){this.pickUpUnitCollisionTest()}pickUpUnitCollisionTest(){let e=[this.playerMonsterArray,this.enemyMonsterArray];for(let t=0;t<e.length;t++){let i=e[t];for(let e=0;e<i.length;e++){let t=i[e],a=this.pickUpUnitArr[e];for(let i=0;i<t.length;i++){let s=t[i];for(let t=0;t<a.length;t++){let i=a[t],n=s.gameObject.transform.position.z;if(i.transform){let r=i.transform.position.z;if(0==s.type&&n>=r&&n-r<=.5||1==s.type&&n<=r&&r-n<=.5){if("RuneStand"==i.getComponent(Laya.Animator).getControllerLayer(0).getCurrentPlayState().animatorState.name){let n=Number(i.name[i.name.length-1]);a.splice(t,1),Laya.timer.frameOnce(1,this,()=>{i.destroy()}),4!=n?(u.playSound(`Audio_Buff${n}.mp3`),this.onEatRune(s.type,n,e)):0==s.type&&this.addCrystal(20,i.transform.position.clone())}break}}else console.error(i)}}}}}addCrystal(e,t){let i="AddCrystal.lh";10==e?i="AddCrystal10.lh":20==e?i="AddCrystal20.lh":30==e&&(i="AddCrystal30.lh");let a=u.getRes(i).clone();this.clearNode.addChild(a),a.transform.position=t;let s=e;1==b.instance.randomBuffState[b.instance.energyId-1]&&(s+=b.instance.energyAdd),this.addStoneNum(s),Laya.timer.once(1e3,this,()=>{a.destroy()})}addStoneNum(e){this.realStoneNum+=e,this.mineStoneNum+=e,this.stoneLabel.text=this.mineStoneNum+""}registerPageEvent(){this.cardList.mouseHandler=Laya.Handler.create(this,this.onListMouse,null,!1),this.scene.on(Laya.Event.MOUSE_MOVE,this,this.onMouseEvent,["scene"]),this.scene.on(Laya.Event.MOUSE_UP,this,this.onMouseEvent,["scene"]),this.surrender.on(Laya.Event.CLICK,this,this.onMouseEvent,["surrender"])}registerCustomEvent(){p.on(a.RecoveryWeapon,this,this.onRecoveryWeapon),p.on(a.BaseExplode,this,this.onBaseExplode),p.on(a.RoleDeath,this,this.onRoleDeath),p.on("EnemyUseFireBall",this,this.onEnemyUseFireBallSkill),p.on(a.SkillBallHit,this,this.skill),p.on(a.OnShow,this,this.onShowCb),p.on(a.OnHide,this,this.onHideCb),C.on(S.NEWGUIDETASK,this,this.onNewGuideTaskEvent)}releaseCustomEvent(){p.off(a.RecoveryWeapon,this,this.onRecoveryWeapon),p.off(a.BaseExplode,this,this.onBaseExplode),p.off(a.RoleDeath,this,this.onRoleDeath),p.off("EnemyUseFireBall",this,this.onEnemyUseFireBallSkill),p.off(a.SkillBallHit,this,this.skill),p.off(a.OnShow,this,this.onShowCb),p.off(a.OnHide,this,this.onHideCb),C.off(S.NEWGUIDETASK,this,this.onNewGuideTaskEvent)}onOpened(){u.loadSpines(["StartVS.sk"]).then(e=>{u.playSound("BattleBegin.mp3"),this.skeleton=e[0],this.addChild(this.skeleton),this.skeleton.scale(1.2,1.2),this.skeleton.pos(Laya.stage.width/2,Laya.stage.height/2),this.skeleton.play(0,!1),this.isSkeletonPlaying=!0,this.skeleton.on(Laya.Event.STOPPED,this,()=>{this.isSkeletonPlaying=!1,this.registerPageEvent(),this.registerCustomEvent(),_.Instance.guideFinish?this.curGroupDataLocal.value.length<6&&1!=this.curLevelLocal.value?Laya.Scene.load(s.freeTry,Laya.Handler.create(this,e=>{e.isModal=!0,e.open(),e.closeHandler=Laya.Handler.create(this,t=>{"yes"==t&&(this.freeTryCard=e.card.dataSource,this.freeTryCard.cost=8,this.setCardListData()),b.instance.isPVP||(this.startRefreshMonster=!0),b.instance.isPVP&&this.refreshRune(),Laya.timer.frameLoop(1,this,this.onFrameLoop)})})):(b.instance.isPVP||(this.startRefreshMonster=!0),b.instance.isPVP&&this.refreshRune(),Laya.timer.frameLoop(1,this,this.onFrameLoop)):_.Instance.sendNewGuideTaskEvent()})})}onNewGuideTaskEvent(e){if("矿石增长"==e)_.Instance.showGuide(e,this.mineBar);else if("灵兽消耗矿石"==e)mpsdk.Report.reportEvent(19),_.Instance.showGuide(e,this.cardList.getCell(0));else if("拖动卡牌到战线上"==e)_.Instance.showGuide(e,null);else if("点击拖动一张卡牌"==e)mpsdk.Report.reportEvent(20),_.Instance.hideGuide(),this.slideHand(!0,0);else if("召唤更多提示语"==e)mpsdk.Report.reportEvent(21),_.Instance.showGuide(e,null,!0),this.guideRefreshMonster=!0,Laya.timer.frameLoop(1,this,this.onFrameLoop);else if("使用火球术提示语"==e)this.refreshSuicide(2);else if("点击放置火球牌"==e)mpsdk.Report.reportEvent(29),_.Instance.hideGuide(),this.slideHand(!0,this.cardList.length-1);else if("合理利用火球牌提示语"==e)_.Instance.showGuide(e,null,!1);else if("派出沙龙提示语"==e)this.freeTryCard=L.instance.getCardData(16),this.freeTryCard.cost=8,this.setCardListData(),this.addStoneNum(8),Laya.timer.frameOnce(1,this,()=>{let t=this.cardList.getCell(0);_.Instance.showGuide(e,t,!0)});else if("点击放置沙龙"==e){this.slideHand(!0,0);for(let e=0;e<this.cardList.length;e++)this.cardList.getCell(e).zOrder=e;this.cardList.refresh()}else if(""==e){this.slideHand(!0,0);for(let e=0;e<this.cardList.length;e++)this.cardList.getCell(e).zOrder=e;this.cardList.refresh()}}onRoleDeath(e,t){1==e?(this.killNum++,this.addCrystal(1+this.killExtraEnergy,t),_.Instance.guideData&&"点击拖动一张卡牌"==_.Instance.guideData.task&&_.Instance.finishTask("点击拖动一张卡牌")):b.instance.countStar[2]++}onEatRune(e,t,i){let a=this.playerMonsterArray,s=this.playerBuffTime,n=`PlayerRuneLight${t}_${i}`;if(1==e&&(a=this.enemyMonsterArray,s=this.enemyBuffTime,n=`EnemyRuneLight${t}_${i}`),4!=t){let a=this.clearNode.getChildByName(n);a||((a=u.getRes(`RuneLight${t}.lh`).clone()).name=n,this.clearNode.addChild(a),0==e?a.transform.position=this.getRevivePointPos(0,i):(a.transform.position=this.getRevivePointPos(1,i),a.transform.localRotationEuler=new Laya.Vector3(0,180,0))),this.openRuneLight(a,!0)}if(3==t){let e=b.instance.recoveryTime;s[i].recoveryTime||console.log(1111111111),s[i].recoveryTime+=e;for(let e=0;e<a[i].length;e++)a[i][e].useRune(3,!0)}else for(let e=i-1;e<i+2;e++)if(1==t){s[e].doubleAttackTime+=1e4;for(let t=0;t<a[e].length;t++)a[e][t].useRune(1,!0)}else if(2==t){s[e].doubleMoveTime+=1e4;for(let t=0;t<a[e].length;t++)a[e][t].useRune(2,!0)}}judgePlaceUseRune(e,t){let i=null;0==e.type?i=this.playerBuffTime:1==e.type&&(i=this.enemyBuffTime);let a=i[t];a.doubleAttackTime>0&&e.useRune(1,!0),a.doubleMoveTime>0&&e.useRune(2,!0),a.recoveryTime>0&&e.useRune(3,!0)}judegePlaceUseMagic(e){this.playerMagicBuffTime.encourageMagicTime>0&&0==e.type&&e.useMagicBuff(4,!0),this.enemyMagicBuffTime.encourageMagicTime>0&&1==e.type&&e.useMagicBuff(4,!0),this.playerMagicBuffTime.curseMagicTime>0&&1==e.type&&e.useMagicBuff(6,!0),this.enemyMagicBuffTime.curseMagicTime>0&&0==e.type&&e.useMagicBuff(6,!0)}runMagicBuffTime(){let e=[this.playerMagicBuffTime,this.enemyMagicBuffTime];for(let t=0;t<e.length;t++){let i=t;for(const s in e[t])if(e[t].hasOwnProperty(s)&&(e[t][s]-=Laya.timer.delta,e[t][s]<=0)){e[t][s]=0;let n=4;if("curseMagicTime"==s&&(n=6),4==n){let e=u.getRes("Skill6.lh");this.openRuneLight(e,!1)}p.event(a.MagicFinish,[n,i])}}}runBuffTime(){let e=[this.playerBuffTime,this.enemyBuffTime];for(let t=0;t<e.length;t++){let i=t,s="PlayerRuneLight";1==t&&(s="EnemyRuneLight");for(let n=0;n<e[t].length;n++){let r=e[t][n];for(const e in r)if(r.hasOwnProperty(e)&&(r[e]-=Laya.timer.delta,r[e]<=0)){r[e]=0;let t=1;"doubleMoveTime"==e?t=2:"recoveryTime"==e&&(t=3);let o=this.clearNode.getChildByName(s+`${t}_${n}`);o&&this.openRuneLight(o,!1),p.event(a.RuneFinish,[i,t,n])}}}}onBaseExplode(e){Laya.timer.clear(this,this.onGameTime),this.cancelCasting(),u.playSound("Audio_CastleBoom.mp3");let t=u.getRes(`Castle${e+1}_Boom.lh`).clone();this.clearNode.addChild(t),0==e?(this.scene3D.getChildByName("Scene").getChildByName("Castle1").active=!1,this.cameraRuntime.changeState("CameraLost"),this.effectCameraRuntime.changeState("CameraLost")):(this.scene3D.getChildByName("Scene").getChildByName("Castle2").active=!1,this.cameraRuntime.changeState("CameraWin"),this.effectCameraRuntime.changeState("CameraWin")),Laya.timer.once(3e3,this,()=>{u.playSound("Open.mp3"),this.countPage.killNumLabel.text=this.killNum.toString(),this.countPage.lifePercentLabel.text=`${Math.floor(100*this.playerFort.bloodProgress.progress)}%`,this.countPage.setSuccess(0!=e),this.countPage.open(),this.countPage.closeHandler=Laya.Handler.create(this,e=>{"next"==e&&this.again()})})}onFrameLoop(){if(b.instance.isGameOver||b.instance.isGamePause)return;this.runThunderBuff(),this.runBenefitBuff(),this.runBuffTime(),this.runMagicBuffTime(),this.refreshMonster(),this.collisionTest(),this.playTime<6e4&&(this.playTime+=Laya.timer.delta,this.playTime>=6e4&&p.event("EnemyUseFireBall")),this.realStoneNum+=this.increaseSpeed/60*Laya.timer.delta/1e3,this.enemyRealStoneNum+=this.enemyIncreaseSpeed/60*Laya.timer.delta/1e3,this.enemyCd>0?(this.enemyCd-=Laya.timer.delta,this.enemyCd<=0&&(this.enemyCd=0)):this.pvpRefreshMonster()&&(this.enemyCd=800,this.curLevelLocal.value<=4?this.enemyNum=1:this.enemyNum=v.getRandom(1,2));let e=Math.floor(this.realStoneNum);this.setMineProgress(this.realStoneNum-e);for(let e=0;e<this.cardList.length;e++)this.cardList.getCell(e).realStoneNum=this.realStoneNum;e>this.mineStoneNum&&(this.addMIneNum.isPlaying||this.addMIneNum.play(0,!1),this.mineStoneNum=e,this.stoneLabel.text=this.mineStoneNum.toString()),this.runSlideTask()}onMouseEvent(e,t){if(!this.isSkeletonPlaying)if(t.stopPropagation(),"cardList"==e)t.type==Laya.Event.MOUSE_DOWN||t.type==Laya.Event.MOUSE_MOVE||t.type==Laya.Event.MOUSE_UP||(t.type,Laya.Event.MOUSE_OUT);else if("scene"==e){if(t.type==Laya.Event.MOUSE_DOWN);else if(t.type==Laya.Event.MOUSE_MOVE){if(this.dragPoint.x=t.stageX,this.dragPoint.y=t.stageY,this.pickCard){let e=this.pickCard.y+this.pickCard.height*this.pickCard.scaleY/2,t=Math.abs(this.originalY-e),i=200,a=t/i>1?1:t/i;if(this.pickCard.scale(1-.5*a,1-.5*a),this.pickCard.x=this.dragPoint.x-this.pickCard.width*this.pickCard.scaleX/2,this.pickCard.y=this.dragPoint.y-this.pickCard.height*this.pickCard.scaleY/2,this.pickCard.scaleX-.5>.05)this.pickRole&&(this.pickRole.gameObject.active=!1),this.selectPointer&&1==this.selectPointer.active&&(this.selectPointer.active=!1);else{let e=this.getRolePlacePoint(this.dragPoint);e.point&&(this.pickCard.isMagic||this.pickRole&&!this.isRoadBlock(e.index)&&(this.pickRole.gameObject.active||(this.pickRole.gameObject.active=!0),this.pickRole.gameObject.transform.position=e.point.transform.position.clone())),this.updateSelectPointerPos(this.pickCard,e)}}}else if(t.type==Laya.Event.MOUSE_UP){if(this.selectPointer&&1==this.selectPointer.active&&(this.selectPointer.active=!1),this.showRangeLight(!1),this.isDestroying)return;if(this.pickCard&&this.pickCard.scaleX-.5>.05)this.cancelCasting();else{let e=this.getRolePlacePoint(this.dragPoint);if(e.point&&!this.isRoadBlock(e.index)){if(this.pickCard)if(this.pickCard.cost<=this.mineStoneNum)if(this.pickCard.isMagic)if(!this.pickCard.isCd&&this.checkCannonSkillCondition(this.pickCard.magicType)){let t=!1;1==this.pickCard.magicType?_.Instance.guideData&&"点击放置火球牌"==_.Instance.guideData.task?2==e.index&&(this.useFireBallSkill(0,e.index),t=!0,this.slideHand(!1,-1),this.isSlideTaskRunning=!1,_.Instance.finishTask("点击放置火球牌",2e3),b.instance.isGamePause=!1,this.addStoneNum(0)):1!=_.Instance.visible&&(this.useFireBallSkill(0,e.index),t=!0,this.slideHand(!1,-1),this.isSlideTaskRunning=!1,this.runSlideTask()):2==this.pickCard.magicType?(this.useArrowRainSkill(0,e.touchPoint),t=!0):3==this.pickCard.magicType?(this.placeCannonTower(this.pickRole,e.index,this.selectPointer.transform.position.clone()),t=!0):4==this.pickCard.magicType?(this.useWholeMapMagicSkill(4,0),t=!0):5==this.pickCard.magicType?(this.useHelpSkill(0,this.selectPointer.transform.position),t=!0):6==this.pickCard.magicType?(this.useWholeMapMagicSkill(6,0),t=!0):7==this.pickCard.magicType&&(this.useRecoverySkill(0,e.index),t=!0),this.pickRole=null,this.playShowCard(!1),this.pickCard.original&&(this.pickCard.original.lightFrame.visible=!1),this.pickCard.visible=!1,this.selectPointer.active=!1,t&&(this.addStoneNum(-this.pickCard.cost),b.instance.countStar[0]++,this.cardList.getCell(this.pickIndex).useCard())}else p.event(a.SendTip,[["冷却中!"]]),this.cancelCasting();else{if(3==this.pickCard.dataSource.type&&this.refreshDragonSacrificeMonster(e.index),b.instance.countStar[0]++,this.addStoneNum(-this.pickCard.cost),this.cardList.getCell(this.pickIndex).useCard(),this.outRecord++,this.outRecord%2==0&&this.guideRefreshMonster){let e=this.getRandomCardDataByTypeArr([1,2]),t=this.playerPlaceRoad[v.getRandom(0,this.playerPlaceRoad.length-1)],i=this.createRole(1,e,1);this.placeRole(i,t),this.playerPlaceRoad=[]}this.playerPlaceRoad.push(e.index),this.placeRole(this.pickRole,e.index,e.point.transform.position),this.pickCard.original&&(this.pickCard.original.realStoneNum=this.realStoneNum,this.pickCard.original.lightFrame.visible=!1),this.pickCard.visible=!1,this.selectPointer.active=!1,this.pickRole=null,this.playShowCard(!1),_.Instance.guideData&&("点击拖动一张卡牌"==_.Instance.guideData.task?(this.stoneLabel.text=Math.floor(this.realStoneNum).toString(),Laya.timer.once(4e3,this,()=>{let e=this.getRandomCardDataByTypeArr([2]),t=this.selectRoad(!1),i=this.createRole(1,e,1);this.placeRole(i,t)})):"点击放置沙龙"==_.Instance.guideData.task&&(_.Instance.finishTask("点击放置沙龙"),this.enemyCount=2,this.refreshSuicide(e.index),this.guideRefreshMonster=!0,Laya.timer.frameLoop(1,this,this.onFrameLoop))),this.slideHand(!1,-1),this.isSlideTaskRunning=!1,this.runSlideTask()}else p.event(a.SendTip,[["矿石不足!"]]),this.cancelCasting()}else this.cancelCasting()}}}else if("surrender"==e){if(1==_.Instance.visible)return;Laya.Scene.load(s.surrender,Laya.Handler.create(this,e=>{e.open(),e.closeHandler=Laya.Handler.create(this,e=>{"yes"==e&&this.playerFort.onHurt(this.playerFort.hp)})}))}}cancelCasting(){this.pickRole&&(this.pickRole.gameObject.active=!1),this.playShowCard(!1),this.destroyPickRole(),this.destroyPickCard()}setCardListData(){let e=k.instance.useMagicType,t=this.curGroupDataLocal.value,i=[];this.freeTryCard&&i.push(this.freeTryCard);for(let e=0;e<t.length;e++){const a=t[e];if(!(a.id>0))break;i.push(a)}for(let t=0;t<e.length;t++)i.push({magicType:e[t]});this.cardList.repeatX=i.length,this.cardList.width=90*i.length+60,this.cardList.array=i;for(let e=0;e<this.cardList.length;e++)this.cardList.getCell(e).zOrder=e;this.cardList.refresh()}getRolePlacePoint(e){let t=this.convert3dTo2d(this.getRevivePointPos(0,0)),i=this.convert3dTo2d(this.getRevivePointPos(0,1)).x-t.x,a=null,s=-1;for(let t=0;t<this.playerBornPoints.numChildren;t++){let n=this.playerBornPoints.getChildAt(t);const r=this.convert3dTo2d(n.transform.position);if(0==t){if(e.x<=r.x+i/2){s=t,a=n;break}}else if(4==t){if(e.x>=r.x-i/2){s=t,a=n;break}}else if(e.x>=r.x-i/2&&e.x<=r.x+i/2){s=t,a=n;break}}return{point:a,index:s,touchPoint:this.getTouchPoint(e)}}getTouchPoint(e){this.camera.viewportPointToRay(e,this.ray);let t=new Laya.Vector3(0,1,0),i=(0-Laya.Vector3.dot(this.ray.origin,t))/Laya.Vector3.dot(this.ray.direction,t),a=new Laya.Vector3,s=new Laya.Vector3;return Laya.Vector3.scale(this.ray.direction,i,s),Laya.Vector3.add(this.ray.origin,s,a),a}convert3dTo2d(e){let t=B.projectPos(this.camera,e);return{x:t.x/Laya.stage.clientScaleX,y:t.y/Laya.stage.clientScaleX}}onListMouse(e,t){if(e.type==Laya.Event.MOUSE_DOWN){if(this.pickCard||this.isMoving||this.isSkeletonPlaying||b.instance.isGameOver)return;let i=this.cardList.getCell(t);if(_.Instance.visible)return;if(_.Instance.guideData){if("点击放置火球牌"==_.Instance.guideData.task&&!i.isMagic)return void p.event(a.SendTip,[["引导中"]]);if("点击放置沙龙"==_.Instance.guideData.task&&3!=i.dataSource.type)return void p.event(a.SendTip,[["引导中"]]);if("使用火球术提示语"==_.Instance.guideData.task||"合理利用火球牌提示语"==_.Instance.guideData.task)return void p.event(a.SendTip,[["引导中"]])}i.lightFrame.visible=!0,u.playSound("Click.mp3"),this.pickCard=i.clone(),this.pickIndex=t,this.pickCard.alpha=.5,this.dragPoint.x=e.stageX,this.dragPoint.y=e.stageY,this.pickCard.isMagic?3==this.pickCard.magicType&&(this.pickRole=this.createCannonTower(0,b.instance.cannonId)):(0==_.Instance.guideFinish&&(this.pickCard.dataSource.attack*=2),this.pickRole=this.createRole(0,this.pickCard.dataSource,0)),this.chooseMagicPointer(this.pickCard),this.pickCard&&(this.originalY=i.localToGlobal(new Laya.Point(i.width/2,i.height/2)).y,this.pickCard.x=this.dragPoint.x-this.pickCard.width*this.pickCard.scaleX/2,this.pickCard.y=this.dragPoint.y-this.pickCard.height*this.pickCard.scaleY/2,this.cardBox.addChild(this.pickCard),this.playShowCard(!0))}}destroyPickCard(){if(!this.pickCard)return;this.selectPointer.active=!1;let e=new Laya.Point(0,0);this.pickCard.original.localToGlobal(e),Laya.Tween.to(this.pickCard,{x:e.x,y:e.y,scaleX:1,scaleY:1},200,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.pickCard&&(this.pickCard.original.lightFrame.visible=!1,this.pickCard.destroy(),this.pickCard=null)}))}changeSceneShader(){if(this.scene3D){let e=this.scene3D.getChildByName("Scene");for(let t=0;t<e.numChildren;t++){let i=e.getChildAt(t);if("Ground2"==i.name&&(window.groundAnimator=this.groundAnimator=i.getComponent(Laya.Animator)),i instanceof Laya.MeshSprite3D&&i.meshRenderer.sharedMaterial instanceof Laya.BlinnPhongMaterial){let e=new $;i.meshRenderer.sharedMaterial.cloneTo(e),e.albedoTexture=i.meshRenderer.sharedMaterial.albedoTexture,i.meshRenderer.sharedMaterial=e}}}}createRole(e,t,i){let a=t.skin.split("-"),s="";2==t.type?s="Player1":1==t.type?s="Player2":3==t.type&&(s="Player3");let n=u.getRes(`${s}.lh`),r=u.getRes(`${s}_${a[0]}1.lh`),o=u.getRes(`${s}_${a[1]}3.lh`),l=u.getRes(`${s}_${a[2]}2.lh`),h=Laya.Sprite3D.instantiate(n),c=Laya.Sprite3D.instantiate(r),d=Laya.Sprite3D.instantiate(o),p=Laya.Sprite3D.instantiate(l);h.addChild(c),h.addChild(d),h.addChild(p),"Player3"!=s?(c.transform.localPosition=new Laya.Vector3,d.transform.localPosition=new Laya.Vector3,p.transform.localPosition=new Laya.Vector3):(c.transform.localPosition=new Laya.Vector3(0,3,0),d.transform.localPosition=new Laya.Vector3(0,3,0),p.transform.localPosition=new Laya.Vector3(0,3,0)),h.getChildByName(`${s}_${a[0]}1`).addComponent(Le);let g=null;(g=0==e?h.addComponent(me):h.addComponent(ye)).type=e,g.camera=this.camera,g.bloodProgress=this.createRoleBloodProgress(e),this.clearNode.addChild(h),i=i||L.instance.getFightLevelByEXP(t.exp);let m=this.createRoleData(t.datatype,i,t.type);return g.init(m),h.active=!1,g.setTransparent(!0),g}createRoleData(e,t,i){let a=L.instance.getFightData(e,t),s=new ve(a);return s.type=i,s}placeRole(e,t,i=null){u.playSound("Bron.mp3");let a=this.enemyMonsterArray,s=this.playerMonsterArray,n=this.enemyCannonArr,r=this.enemyFort;1==e.type&&(a=this.playerMonsterArray,s=this.enemyMonsterArray,n=this.playerCannonArr,r=this.playerFort),i||(i=0==e.type?this.getRevivePointPos(0,t):this.getRevivePointPos(1,t)),e.targetFort=r,s[t].push(e);let o=u.getRes("BronEffect.lh"),l=Laya.Sprite3D.instantiate(o,this.clearNode,!1,i.clone()).addComponent(be);e.gameObject.transform.position=i.clone(),e.setPlaced(t,s[t],a[t],n[t],l),1==b.instance.randomBuffState[b.instance.weakId-1]&&e.useBuff(b.instance.weakId,!0),this.judgePlaceUseRune(e,t),this.judegePlaceUseMagic(e)}placeCannonTower(e,t,i=null){let a=this.enemyMonsterArray,s=this.enemyCannonArr,n=this.playerCannonArr;1==e.type?(a=this.playerMonsterArray,s=this.playerCannonArr,n=this.enemyCannonArr):(this.cameraRuntime.changeState("CameraSkill5"),this.effectCameraRuntime.changeState("CameraSkill5")),e.gameObject.transform.position=i.clone(),e.setPlaced(t,n[t],a[t],s[t]);let r=u.getRes("FX_TowerBron.lh"),o=Laya.Sprite3D.instantiate(r,this.clearNode,!1,e.gameObject.transform.position.clone());Laya.timer.once(5e3,this,()=>{o.destroy()})}refreshRune(){Laya.timer.once(3e4,this,()=>{if(!b.instance.isGameOver){if(!b.instance.isGamePause){let e=v.getRandom(2,4),t=this.getRevivePointPos(0,e-1),i=this.getRevivePointPos(1,e-1),a=new Laya.Vector3(t.x,t.y,(t.z+i.z)/2+2*Math.random()-1),s=v.getRandom(1,4),n=this.bornRune(s,a);this.pickUpUnitArr[e-1].push(n)}this.refreshRune()}})}bornRune(e,t){let i=Laya.Sprite3D.instantiate(u.getRes(`Rune${e}.lh`),this.clearNode,!1,t);return Laya.timer.frameOnce(160,this,()=>{i&&i.getComponent(Laya.Animator).play("RuneStand",0,0)}),i}refreshMonster(){this.startRefreshMonster&&(this.runRefreshTimeDelay(),this.refreshSmall(),this.refreshBig(),this.refreshDragon())}pvpRefreshMonster(){let e=!1;if(b.instance.isGameOver||!b.instance.isPVP||b.instance.isGamePause)return;let t=this.getRandomCardDataByTypeArr([1,2]);if(t.cost<=this.enemyRealStoneNum){this.enemyRealStoneNum-=t.cost,this.enemyNum--,0==this.enemyNum&&(e=!0),t.cost+=1,t.count>0&&t.count%3==0&&(t.count+=1);let i=this.createRole(1,t,1),a=this.selectRoad(!1);this.placeRole(i,a,this.getRevivePointPos(1,a)),this.roadPickRecord=[0,0,0,0,0]}return e}runRefreshTimeDelay(){for(let e=0;e<this.refreshTimeDelay.length;e++){let t=this.refreshTimeDelay[e];t>0&&((t-=Laya.timer.delta)<=0&&(t=0),this.refreshTimeDelay[e]=t)}}refreshSmall(){if(b.instance.isGameOver||b.instance.isGamePause)return;if(this.refreshTimeDelay[0]>0)return;let e=b.instance.refreshMonster[0][0],t=b.instance.refreshMonster[0][1],i=b.instance.refreshMonster[0][2],a=this.refreshWaveRec[0],s=e;if(0!=s){for(let e=0;e<s;e++){let e=null,t=this.selectRoad(!1);e=this.curLevelLocal.value<=4?this.getRandomCardDataByTypeArr([2]):this.getRandomCardDataByTypeArr([1,2]);let a=this.createRole(1,e,i);this.placeRole(a,t)}this.roadPickRecord=[0,0,0,0,0],this.refreshWaveRec[0]++,a=this.refreshWaveRec[0],this.refreshTimeDelay[0]=1e3*(5+t*a)}}refreshBig(){if(b.instance.isGameOver||b.instance.isGamePause)return;if(this.refreshTimeDelay[1]>0)return;let e=b.instance.refreshMonster[1][1],t=b.instance.refreshMonster[1][0],i=b.instance.refreshMonster[1][2],a=this.refreshWaveRec[1],s=t;if(0!=s){for(let e=0;e<s;e++){let e=null,t=this.selectRoad(!1);e=this.curLevelLocal.value<=3?this.getRandomCardDataByTypeArr([2]):this.getRandomCardDataByTypeArr([3]);let a=this.createRole(1,e,i);this.placeRole(a,t)}this.roadPickRecord=[0,0,0,0,0],this.refreshWaveRec[1]++,a=this.refreshWaveRec[1],this.refreshTimeDelay[1]=e*(a+1)*1e3}}refreshDragon(){if(b.instance.isGameOver||b.instance.isGamePause)return;let e=b.instance.refreshMonster[2][1];if(0==e||this.refreshTimeDelay[2]>0)return;let t=b.instance.refreshMonster[2][0],i=b.instance.refreshMonster[2][2],a=this.refreshWaveRec[2],s=t;if(0!=s){for(let e=0;e<s;e++){let e=this.getRandomCardDataByTypeArr([3]),t=this.selectRoad(!0),a=this.createRole(1,e,i);this.placeRole(a,t)}this.roadPickRecord=[0,0,0,0,0],this.refreshWaveRec[2]++,a=this.refreshWaveRec[2],this.refreshTimeDelay[2]=e*(a+1)*1e3}}selectRoad(e){if(b.instance.isPVP){let e=[];for(let t=0;t<this.playerMonsterArray.length;t++)this.playerMonsterArray[t].length>0&&e.push(t);return e.length>0?e[v.getRandom(0,e.length-1)]:v.getRandom(0,4)}if(e)return this.enableRoad[v.getRandom(0,this.enableRoad.length-1)];{for(let e=0;e<this.baseAttackRecord.length;e++){const t=this.baseAttackRecord[e],i=this.roadPickRecord[e];if(i<1&&t>0)return this.roadPickRecord[e]=i+1,this.baseAttackRecord[e]=0,e}for(let e=0;e<this.playerMonsterArray.length;e++){const t=this.playerMonsterArray[e],i=this.enemyMonsterArray[e],a=this.roadPickRecord[e];if(a<1&&t.length>0&&0==i.length)return this.roadPickRecord[e]=a+1,this.baseAttackRecord[e]=0,e}let e=[],t=0;for(let t=0;t<this.roadPickRecord.length;t++)this.roadPickRecord[t]<1&&-1!=this.enableRoad.indexOf(t)&&e.push(t);0==e.length?(this.roadPickRecord=[0,0,0,0,0],t=this.enableRoad[v.getRandom(0,this.enableRoad.length-1)]):t=e[v.getRandom(0,e.length-1)];let i=this.roadPickRecord[t];return this.roadPickRecord[t]=i+1,this.baseAttackRecord[t]=0,t}}onRecoveryWeapon(e){e.gameObject.removeSelf(),"MissileShuangzu1"==e.gameObject.name&&(e.gameObject.getChildByName("Trail").trailFilter.time=0),Laya.Pool.recover(e.sign,e)}clearBattleGround(){this.clearNode.destroyChildren(),this.effectClearNode.destroyChildren(),Laya.Pool.clearBySign("MissileShuangzu1"),Laya.Pool.clearBySign("MissileSizu1"),Laya.Pool.clearBySign("MissileSizu2"),Laya.Pool.clearBySign("MissileDragon1"),Laya.Pool.clearBySign("MissileDragon2"),Laya.Pool.clearBySign("MissileDragon3"),Laya.Pool.clearBySign("MissileTower1"),Laya.Pool.clearBySign("MissileTower2")}onGameTime(){b.instance.countStar[3]++}again(){Laya.timer.clearAll(this),this.startRefreshMonster=!1,b.instance.countStar=[0,0,0,0],u.playMusic("BattleBGM.mp3",0),this.refreshWaveRec=[0,0,0],this.initRefreshTimeDelay(),b.instance.updateMapBuffData(),this.removeWeatherEffect(),this.playWeatherEffect(),this.playerBuffTime=[{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0}],this.enemyBuffTime=[{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0},{doubleAttackTime:0,doubleMoveTime:0,recoveryTime:0}],this.selectPointer&&(this.selectPointer.active=!1),this.playerMagicBuffTime={encourageMagicTime:0,curseMagicTime:0},this.enemyMagicBuffTime={encourageMagicTime:0,curseMagicTime:0},this.thunderLeftTime=b.instance.thunderTimeGap,this.benefitLeftTime=b.instance.electricityTimeGap,this.killNum=0,this.setMineProgress(0),this.skeleton&&(u.playSound("BattleBegin.mp3"),this.isSkeletonPlaying=!0,this.skeleton.play(0,!1)),this.curLevelLocal.value<999&&this.curLevelLocal.value++,p.event("BreakPoint",["关卡开始",this.curLevelLocal.value]),this.levelLabel.text=`第${this.curLevelLocal.value}关`,this.cameraRuntime.changeState("CameraStand"),this.effectCameraRuntime.changeState("CameraStand"),this.initSplitMonsterIdArr(),this.playerFort.init(0,this.baseAttackRecord),this.enemyFort.init(1,this.baseAttackRecord),this.scene3D.getChildByName("Scene").getChildByName("Castle1").active=!0,this.scene3D.getChildByName("Scene").getChildByName("Castle2").active=!0,Laya.timer.loop(6e4,this,this.onGameTime),this.clearBattleGround(),this.playerMonsterArray=[[],[],[],[],[]],this.enemyMonsterArray=[[],[],[],[],[]],this.playerCannonArr=[[],[],[],[],[]],this.enemyCannonArr=[[],[],[],[],[]],this.pickUpUnitArr=[[],[],[],[],[]],this.pickIndex=-1,this.realStoneNum=12,this.mineStoneNum=12,this.enemyRealStoneNum=12,this.stoneLabel.text="0",this.roadPickRecord=[0,0,0,0,0];for(let e=0;e<this.baseAttackRecord.length;e++)this.baseAttackRecord[e]=0;this.originalY=0,this.setCardListData(),this.selectPointer.active=!1,b.instance.isPVP||(this.startRefreshMonster=!0),this.initCannonTower(),this.initRoadBlockEffect(),Laya.timer.frameLoop(1,this,this.onFrameLoop)}initRefreshTimeDelay(){this.refreshTimeDelay=[0,0,0];let e=b.instance.refreshMonster[2][1];this.refreshTimeDelay[2]=1e3*e,e=b.instance.refreshMonster[1][1],this.refreshTimeDelay[1]=1e3*e}useBuff(e,t=null){if(e==b.instance.thunderId){let e=v.getRandom(0,4),t=v.getRandom(1,10),i=this.getObsPos(e,t),a=Laya.Sprite3D.instantiate(u.getRes("FX_Flash.lh"),this.clearNode,!1,i);Laya.timer.once(500,this,()=>{Laya.timer.once(2e3,this,()=>{a.destroy()});for(let e=0;e<5;e++){for(let t=0;t<this.playerMonsterArray[e].length;t++){let a=this.playerMonsterArray[e][t];Laya.Vector3.distance(i,a.gameObject.transform.position)<=2&&a.useBuff(b.instance.thunderId,!0)}for(let t=0;t<this.enemyMonsterArray[e].length;t++){let a=this.enemyMonsterArray[e][t];Laya.Vector3.distance(i,a.gameObject.transform.position)<=2&&a.useBuff(b.instance.thunderId,!0)}}})}}runThunderBuff(){1==b.instance.randomBuffState[b.instance.thunderId-1]&&this.thunderLeftTime>0&&(this.thunderLeftTime-=Laya.timer.delta,this.thunderLeftTime<=0&&(this.thunderLeftTime=b.instance.thunderTimeGap,this.useBuff(b.instance.thunderId)))}runBenefitBuff(){if(1==b.instance.randomBuffState[b.instance.electricityId-1]&&this.benefitLeftTime>0&&(this.benefitLeftTime-=Laya.timer.delta,this.benefitLeftTime<=0)){let e=this.enableRoad[v.getRandom(0,this.enableRoad.length-1)],t=this.getRevivePointPos(0,e),i=this.getRevivePointPos(1,e),a=new Laya.Vector3(t.x,t.y,(t.z+i.z)/2+2*Math.random()-1),s=4,n=this.bornRune(s,a);this.pickUpUnitArr[e-1].push(n),this.benefitLeftTime=b.instance.electricityTimeGap}}createRoleBloodProgress(e){let t=new Ce;return 0==e||1==e&&(t.bar.skin="game/Ui_Progress2.png"),t.hpLabel.visible=!1,this.addChild(t),t}onEnemyUseFireBallSkill(){if(!b.instance.isPVP)return;let e=v.getRandom(1,10);Laya.timer.once(1e3*e,this,()=>{let e=-1,t=-1;for(let i=0;i<this.playerMonsterArray.length;i++){const a=this.playerMonsterArray[i];a.length>e&&(t=i,e=a.length)}this.useFireBallSkill(1,t)})}skill(e,t,i){u.playSound("Fireball2.mp3");let a=this.getRevivePointPos(0,t),s=this.getRevivePointPos(1,t),n=(a.z-s.z)/8,r=this.enemyMonsterArray[t];1==i&&(r=this.playerMonsterArray[t]);for(let t=0;t<r.length;t++){const o=r[t];0==i?o.gameObject.transform.position.z>a.z-e*n&&o.onHurt(b.instance.fireballDamage):o.gameObject.transform.position.z<s.z+e*n&&o.onHurt(b.instance.fireballDamage)}}onDestroy(){Laya.timer.clearAll(this),this.clearBattleGround(),this.clearNode.destroy(),this.effectScene3D.destroy(),this.playerFort.setFire(1),this.enemyFort.setFire(1),this.playerFort.destroy(),this.enemyFort.destroy(),this.removeWeatherEffect(),this.releaseCustomEvent()}playShowCard(e){this.pickCard&&(-1==this.standerdY&&(this.standerdY=this.pickCard.original.y),e?(this.isMoving=!0,this.pickCard.original.zOrder=1e3,Laya.Tween.to(this.pickCard.original,{y:this.standerdY-20},200,Laya.Ease.backOut)):(this.isDestroying=!0,this.pickCard.original.lightFrame.visible=!1,this.refreshListZOrder(),this.cardList.updateZOrder(),Laya.Tween.to(this.pickCard.original,{y:this.standerdY},200,Laya.Ease.backOut,Laya.Handler.create(this,()=>{this.isMoving=!1,this.isDestroying=!1,this.pickCard&&(this.pickCard.destroy(),this.pickCard=null)}))))}destroyPickRole(){this.pickRole&&(this.pickRole.destroy(),this.pickRole=null)}refreshListZOrder(){for(let e=0;e<this.cardList.length;e++)this.cardList.getCell(e).zOrder=e}setMineProgress(e){this.mineProgress.width=657*e}openRuneLight(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);t?a.particleSystem.play():a.particleSystem.stop()}}refreshSuicide(e){let t=L.instance.getCardData(0),i=this.createRole(1,t,1);this.placeRole(i,e),this.enemyCount--,Laya.timer.once(1e3,this,()=>{this.enemyCount>0&&this.refreshSuicide(e)})}slideHand(e,t){this.handBox.visible=e;let i=this.cardList.getCell(t);if(i){let e=i.localToGlobal(new Laya.Point,!1);this.handBox.x=e.x,this.handBox.y=e.y}e?this.handMove.isPlaying||(this.handMove.wrapMode=Laya.FrameAnimation.WRAP_POSITIVE,this.handMove.play(0,!0)):this.handMove.stop()}runSlideTask(){if(!(this.curLevelLocal.value>2||this.isSlideTaskRunning))for(let e=0;e<this.cardList.length;e++){let t=this.cardList.getCell(e);if(!t.isMagic&&this.mineStoneNum>=t.cost)return this.slideHand(!0,e),void(this.isSlideTaskRunning=!0)}}isRoadBlock(e){return!!b.instance.roadBlock&&-1!=b.instance.roadBlock.indexOf(e+1)}getObsPos(e,t){let i=this.mapOrigin.clone();return i.x=this.mapOrigin.x+this.cellWidth*e,i.z=this.mapOrigin.z-this.cellHeight*t,i}getHelpSkillPos(e,t){let i=this.getObsPos(e,t);return i.x=i.x+this.cellWidth/2,i.z=i.z-this.cellHeight/2,i}updateSceneInfo(){let e=this.getRevivePointPos(0,3),t=this.getRevivePointPos(1,3);this.mapOrigin=this.getRevivePointPos(0,0),this.cellWidth=e.x,this.cellHeight=(e.z-t.z)/(this.rowNum-1)}playWeatherEffect(){let e=["Weather_Fog","Weather_Rain","Weather_Flash","Weather_Wind","Weather_Sun1","Weather_Sun2","Weather_Sun3","Weather_Electric"],t=[b.instance.weakId,b.instance.acidId,b.instance.thunderId,b.instance.energyId,b.instance.redSunId,b.instance.blueSunId,b.instance.purpleSunId,b.instance.electricityId];for(let i=0;i<t.length;i++)if(1==b.instance.randomBuffState[t[i]-1]){let t=e[i],a=u.getRes(`${t}.lh`);this.scene3D.getChildByName(t)||this.scene3D.addChild(a)}}removeWeatherEffect(){for(let e=0;e<this.scene3D.numChildren;e++){let t=this.scene3D.getChildAt(e);-1!=t.name.indexOf("Weather")&&t.removeSelf()}}useFireBallSkill(e,t){let i=this.getRevivePointPos(e,t),a=Laya.Sprite3D.instantiate(u.getRes("Skill1.lh"),this.clearNode,!1,i);1==e&&(a.transform.localRotationEuler=new Laya.Vector3(0,180,0));let s=a.addComponent(ke);s.type=e,s.roadIndex=t,u.playSound("Fireball1.mp3"),this.cameraRuntime.changeState("CameraSkill1"),this.effectCameraRuntime.changeState("CameraSkill1"),a.getComponent(Laya.Animator).play("Skill_FireBall",0,0),Laya.timer.once(1e4,this,()=>{a.destroy()})}useArrowRainSkill(e,t){let i=b.instance.arrowRainDamage,a=this.enemyMonsterArray;1==e&&(a=this.playerMonsterArray);let s=20,n=i/s,r=()=>{i-=n;let e=n;0==--s&&(Laya.timer.clear(this,r),e=i);for(let i=0;i<a.length;i++)for(let s=0;s<a[i].length;s++){let n=a[i][s];Laya.Vector3.distance(n.gameObject.transform.position,t)<=6.875&&n.onHurt(e)}};Laya.timer.frameLoop(5,this,r);let o=Laya.Sprite3D.instantiate(u.getRes("Skill2.lh"),this.clearNode,!1,t);Laya.timer.once(1e4,this,()=>{o.destroy()}),this.cameraRuntime.changeState("CameraSkill2"),this.effectCameraRuntime.changeState("CameraSkill2")}useRecoverySkill(e,t){this.onEatRune(e,3,t)}useHelpSkill(e,t){let i=b.instance.helpUnitDataArr;for(let a=0;a<i.length;a++){let s=i[a],n=t.clone(),r=-1;for(let e=0;e<this.playerBornPoints.numChildren;e++){let i=this.getRevivePointPos(0,e);if(t.x<i.x){r=e;break}}0==a?(n.x=n.x-this.cellWidth/2,n.z=n.z+this.cellHeight/2,r-=1):1==a?(n.x=n.x-this.cellWidth/2,n.z=n.z-this.cellHeight/2,r-=1):2==a?(n.x=n.x+this.cellWidth/2,n.z=n.z-this.cellHeight/2):3==a&&(n.x=n.x+this.cellWidth/2,n.z=n.z+this.cellHeight/2);let o=this.createRole(e,s,1);this.placeRole(o,r,n)}}useWholeMapMagicSkill(e,t){let i=this.playerMonsterArray,a=this.playerMagicBuffTime,s=b.instance.encourageTime;6==t&&(s=b.instance.curseTime),1==e&&(a=this.enemyMagicBuffTime),4==t?(1==e&&(i=this.enemyMonsterArray),a.encourageMagicTime+=s):6==t&&(0==e&&(i=this.enemyMonsterArray),a.curseMagicTime+=s);for(let e=0;e<i.length;e++)for(let a=0;a<i[e].length;a++)i[e][a].useMagicBuff(t,!0);let n=u.getRes("Skill6.lh");this.scene3D.getChildByName("skill6")||(this.scene3D.addChild(n),n.transform.position=this.getRevivePointPos(e,2)),this.openRuneLight(n,!0)}checkHelpSkillCondition(e){return!1}checkCannonSkillCondition(e){if(3!=e)return!0;let t=!1;return this.selectPointer&&"SelectLightSkill5_2"!=this.selectPointer.name&&(t=!0),t}chooseMagicPointer(e){let t="SelectLight";e.isMagic&&(1==e.magicType?t="SelectLightSkill1":2==e.magicType?t="SelectLightSkill2":7==e.magicType?t="SelectLightSkill3":5==e.magicType?t="SelectLightSkill4":3==e.magicType&&(t="SelectLightSkill5_1",this.showRangeLight(!0))),this.selectPointer=u.getRes(t+".lh"),this.scene3D.getChildByName(t)||this.scene3D.addChild(this.selectPointer),this.selectPointer.active=!1}changeTowerLight(e){this.selectPointer&&(this.selectPointer.active=!1);let t="SelectLightSkill5_1";e>5&&(t="SelectLightSkill5_2"),this.selectPointer=u.getRes(t+".lh"),this.scene3D.getChildByName(this.selectPointer.name)||this.scene3D.addChild(this.selectPointer),this.selectPointer.active=!0}showRangeLight(e){let t=u.getRes("SelectLightSkill5_Range.lh");this.scene3D.getChildByName(t)||this.scene3D.addChild(t),t.active=e}updateSelectPointerPos(e,t){if(this.selectPointer.active||(this.selectPointer.active=!0),!e.isMagic&&t.point){if(this.isRoadBlock(t.index))return;this.selectPointer.transform.position=t.point.transform.position.clone()}else if(1==e.magicType&&t.point){if(this.isRoadBlock(t.index))return;let e=t.point.transform.position.clone();e.z=e.z-3,this.selectPointer.transform.position=e}else if(2==e.magicType&&t.touchPoint)this.selectPointer.transform.position=t.touchPoint;else if(7==e.magicType&&t.touchPoint){if(this.isRoadBlock(t.index))return;this.selectPointer.transform.position=t.point.transform.position.clone()}else if(5==e.magicType&&t.touchPoint){if(this.isRoadBlock(t.index))return;let e=1e7,i=null;for(let a=0;a<4;a++)for(let s=1;s<11;s++){let n=this.getHelpSkillPos(a,s),r=Laya.Vector3.distance(t.touchPoint,n);r<e&&(e=r,i=n)}this.selectPointer.transform.position=i}else if(3==e.magicType&&t.touchPoint){if(this.isRoadBlock(t.index))return;let e=1e7,i=null,a=0;for(let s=0;s<5;s++)for(let n=1;n<12;n++){let r=this.getObsPos(s,n),o=Laya.Vector3.distance(t.touchPoint,r);o<e&&(e=o,i=r,a=n)}this.selectPointer.transform.position=i,this.changeTowerLight(a)}}initEnergyIncreaseSpeed(){if(b.instance.isPVP)this.increaseSpeed=(this.mineLevelLocal.value-1)*this.mineUpLocal.value+this.mineBaseLocal.value,this.enemyIncreaseSpeed=(this.mineLevelLocal.value-1)*this.mineUpLocal.value+this.mineBaseLocal.value,this.enemyRealStoneNum=12,this.enemyNum=1,this.levelLabel.visible=!1;else{let e=b.instance.getPropInfo(1001);this.increaseSpeed=this.mineBaseLocal.value+e.value,1==b.instance.randomBuffState[b.instance.electricityId-1]&&(this.increaseSpeed=Math.floor(this.increaseSpeed*(1-b.instance.electricitySlowPer)))}}initSplitMonsterIdArr(){this.doubleFootIdArray=[],this.fourFootIdArray=[],this.dragonIdArray=[];let e=u.getRes("unit.json"),t=this.enemyPoolLocal.value;for(let i=0;i<t.length;i++){let a=t[i],s=e[a].type;1==s?this.fourFootIdArray.push(a):2==s&&this.doubleFootIdArray.push(a)}this.dragonIdArray.push(16,17,18,19)}getRandomCardDataByTypeArr(e){let t=0,i=[];-1!=e.indexOf(1)?(t+=this.fourFootIdArray.length,i.push(this.fourFootIdArray.length)):i.push(0),-1!=e.indexOf(2)?(t+=this.doubleFootIdArray.length,i.push(this.doubleFootIdArray.length)):i.push(0),-1!=e.indexOf(3)?(t+=this.dragonIdArray.length,i.push(this.dragonIdArray.length)):i.push(0);let a=v.getRandom(0,t-1),s=-1;return a<i[0]?s=this.fourFootIdArray[a]:a<i[0]+i[1]?s=this.doubleFootIdArray[a-i[0]]:a<i[0]+i[1]+i[2]&&(s=this.dragonIdArray[a-i[0]-i[1]]),L.instance.getCardData(s)}initCannonTower(){if(!b.instance.mapCannonPos)return;let e=b.instance.mapCannonPos,t=b.instance.mapCannonId;for(let i=0;i<e.length/2;i++){let a=e[2*i]-1,s=e[2*i+1],n=this.getObsPos(a,s),r=this.createCannonTower(1,t);this.placeCannonTower(r,a,n)}}createCannonTower(e,t){let i="Tower1.lh";1==e&&(i="Tower2.lh");let a=u.getRes(i),s=u.getRes("unit.json")[20+t%5e3-1],n=Laya.Sprite3D.instantiate(a,this.clearNode),r=n.addComponent(de);r.type=e,r.camera=this.camera,r.bloodProgress=this.createRoleBloodProgress(e);let o=new ve(s);return o.type=s.type,r.init(o),n.active=!1,r}initRoadBlockEffect(){if(this.enableRoad=[0,1,2,3,4],b.instance.roadBlock){this.enableRoad=[];let e=u.getRes("NoEntry.lh");for(let t=0;t<5;t++)if(b.instance.roadBlock.indexOf(t+1)>=0){let i=this.getRevivePointPos(0,t);Laya.Sprite3D.instantiate(e,this.clearNode,!1,i)}else this.enableRoad.push(t)}}getRevivePointPos(e,t){let i=this.playerBornPoints;return 1==e&&(i=this.enemyBornPoints),i.getChildByName(`RevivePonit${t+1}`).transform.position.clone()}refreshDragonSacrificeMonster(e){let t=k.instance.curStage;if(1==t[0]&&2==t[1])for(let t=0;t<2;t++){let t=L.instance.getCardData(0),i=this.createRole(1,t,1);this.placeRole(i,e,this.getRevivePointPos(1,e))}}}class Ie extends i.pvpUI{constructor(){super(...arguments),this.curIndex=1,this.tweenTarget=null,this.isTweening=!1,this.lastIndex=0,this.pageArray=[],this.tabArray=[],this.signPosDiff=0,this.signStartX=0,this.pageStartX=0}onAwake(){this.back.on(Laya.Event.CLICK,this,this.onMouseEvent,["back"]),this.startMatch.on(Laya.Event.CLICK,this,this.onMouseEvent,["match"]),this.tab0.on(Laya.Event.CLICK,this,this.onTabEvent,[0]),this.tab1.on(Laya.Event.CLICK,this,this.onTabEvent,[1]),this.tab2.on(Laya.Event.CLICK,this,this.onTabEvent,[2]),this.pageArray.push(this.page_0),this.pageArray.push(this.page_1),this.pageArray.push(this.page_2),this.tabArray.push(this.tab0),this.tabArray.push(this.tab1),this.tabArray.push(this.tab2),this.initTab()}onTabEvent(e,t){if(this.curIndex==e||this.isTweening)return;u.playSound("Click.mp3"),this.lastIndex=this.curIndex,this.curIndex=e,this.isTweening=!0;let i=this.tabArray[e];this.signPosDiff=i.x-this.moveSign.x,this.signStartX=this.moveSign.x,this.pageStartX=this.pageArray[this.curIndex].x,this.tweenTarget={progress:0},Laya.Tween.to(this.tweenTarget,{progress:1,update:Laya.Handler.create(this,this.onTweenUpdate,null,!1)},380,Laya.Ease.backOut,Laya.Handler.create(this,this.onTweenComplete))}onTweenUpdate(){for(let e=0;e<this.pageArray.length;e++){const t=this.pageArray[e];e==this.curIndex&&(this.moveSign.x=this.tweenTarget.progress*this.signPosDiff+this.signStartX),e==this.curIndex?(t.x=this.pageStartX-this.pageStartX*this.tweenTarget.progress,t.alpha=this.tweenTarget.progress):(t.alpha=1-this.tweenTarget.progress,t.x=this.pageArray[this.curIndex].x+(e-this.curIndex)*Laya.stage.width)}}initTab(){for(let e=0;e<this.tabArray.length;e++){const t=this.tabArray[e],i=this.pageArray[e];e==this.curIndex?(this.moveSign.x=t.x,i.alpha=1):i.alpha=0,i.y=0,i.x=(e-this.curIndex)*Laya.stage.width}}onTweenComplete(){this.isTweening=!1}onMouseEvent(e,t){"back"==e?(p.event(a.MainShowOpen,!1),this.close()):"match"==e&&(this.close(),Laya.Scene.open(s.match))}}class _e extends i.rankCellUI{constructor(){super(...arguments),this._index=0,this._isSelf=!1}get dataSource(){return this._dataSource}set dataSource(e){super.dataSource=e,this._dataSource&&(this.playerName.text=this._dataSource.name,this.playerScore.text=this._dataSource.score)}get index(){return this._index}set index(e){this._index=e,1==this._index?(this.rankIcon.visible=!0,this.rankLabel.visible=!1,this.rankIcon.skin="rank/Ui_paihnagfrist.png",this.cellBg.skin="rank/Ui_paihang1.png"):2==this._index?(this.rankIcon.visible=!0,this.rankLabel.visible=!1,this.rankIcon.skin="rank/Ui_paihangsecond.png",this.cellBg.skin="rank/Ui_paihang2.png"):3==this._index?(this.rankIcon.visible=!0,this.rankLabel.visible=!1,this.rankIcon.skin="rank/Ui_paihnagthird.png",this.cellBg.skin="rank/Ui_paihang3.png"):(this.rankIcon.visible=!1,this.rankLabel.visible=!0,this.rankLabel.text=this._index.toString(),4==this._index?this.cellBg.skin="rank/Ui_paihang4.png":this.cellBg.skin="rank/Ui_paihang6.png")}get isSelf(){return this._isSelf}set isSelf(e){this._isSelf=e,this._isSelf?this.selfLight.visible=!0:this.selfLight.visible=!1}onAwake(){}}class xe extends i.rankUI{constructor(){super(...arguments),this.rankCellArr=[]}onAwake(){this.initRank()}initRank(){this.rankPanel.vScrollBarSkin="";let e=[{name:"我是个人的名字",score:1e3,division:1},{name:"我是个人的名字",score:1e3,division:1},{name:"我是个人的名字",score:1e3,division:1},{name:"我是个人的名字",score:1e3,division:1},{name:"我是个人的名字",score:1e3,division:1},{name:"我是个人的名字",score:1e3,division:1},{name:"我是个人的名字",score:1e3,division:1},{name:"我是个人的名字",score:1e3,division:1},{name:"我是个人的名字",score:1e3,division:1},{name:"我是个人的名字",score:1e3,division:1}],t=15;for(let i=0;i<e.length;i++){let a=e[i],s=new _e;0==i?s.scale(1,1):1==i?s.scale(.96,.96):s.scale(.91,.91),s.isSelf=0==i,s.y=t,t=t+s.height*s.scaleY+5,s.dataSource=a,s.index=i+1,this.rankPanel.addChild(s),this.rankCellArr.push(s)}}}class Te extends i.shopCellUI{constructor(){super(...arguments),this.curLevelLocal=null}onAwake(){this.curLevelLocal=f.get("curLevel"),this.cell.on(Laya.Event.CLICK,this,this.onCellClick)}onMouseEvent(){}onCellClick(){u.playSound("Open.mp3"),2==this.cell.dataSource.type&&_.Instance.finishTask("点击第一张双足卡片",500),Laya.Scene.load(s.buyConfirm,Laya.Handler.create(this,e=>{e.cell.dataSource=this.cell.dataSource,e.cell.cardBlack.visible=!1,e.cost=this.cell.fightData.price,e.moneyLabel.text=this.cell.fightData.price.toString(),e.hpLabel.text=this.cell.fightData.hp,e.attackLabel.text=this.cell.fightData.atk,e.delayLabel.text=Math.floor((2e3-this.cell.fightData.atkgap)/10).toString(),e.speedLabel.text=this.cell.fightData.speed,e.frameTitle.visible=!1,e.buyBtn.visible=!0;let t="";1==this.cell.dataSource.type?t="shop/Ui_BuyFont2.png":2==this.cell.dataSource.type?t="shop/Ui_BuyFont1.png":3==this.cell.dataSource.type&&(t="shop/Ui_BuyFont3.png"),e.title.skin=t,e.open()}))}set dataSource(e){if(!e)return;this.cell.dataSource=e;let t=0;e.color,0==e.id?this.visible=!1:this.visible=!0}}class Pe extends i.signUI{constructor(){super(...arguments),this.signCellArr=[],this.enemyPoolLocal=null,this.curLevelLocal=null,this.shopIdLocal=null,this.signDataArr=null}onAwake(){this.curLevelLocal=f.get("curLevel"),this.enemyPoolLocal=f.get("enemyPool"),this.shopIdLocal=f.get("shopId");let e=0;e=this.curLevelLocal.value<=3?0:this.curLevelLocal.value<=10?.1:this.curLevelLocal.value<=60?1/30:this.curLevelLocal.value<=160?.04:this.curLevelLocal.value<=320?.05:this.curLevelLocal.value<=560?1/15:.1,this.signDataArr=[{desc:"普通卡包",value:[1],type:"package"},{desc:"钻石卡包",value:[3],type:"package"},{desc:"卡牌 X3",value:[{id:1,type:3,skin:"FireDragon-FireDragon-FireDragon",datatype:8,exp:9},{id:1,type:1,skin:"Lion-Lion-Lion",datatype:5,exp:9},{id:1,type:1,skin:"Tiger-Tiger-Tiger",datatype:6,exp:9}],type:"card"},{desc:"+688",value:688,type:"gold"},{desc:"钻石卡包",value:[3],type:"package"},{desc:"+888",value:888,type:"gold"},{desc:"钻石卡包 X3",value:[3,3,3],type:"package"}],this.signCellArr.push(this.day1Cell),this.signCellArr.push(this.day2Cell),this.signCellArr.push(this.day3Cell),this.signCellArr.push(this.day4Cell),this.signCellArr.push(this.day5Cell),this.signCellArr.push(this.day6Cell),this.signCellArr.push(this.day7Cell);let t=f.get("signTimeStap"),i=f.get("signed"),a=f.get("signDay"),s=new Date(t.value),n=new Date;t.value>0&&(n.getFullYear()>s.getFullYear()||n.getMonth()>s.getMonth()||n.getDay()>s.getDay())&&1==i.value&&(a.value++,i.value=0,a.value>7&&(a.value=1)),this.refreshCell()}refreshCell(){let e=f.get("signed"),t=f.get("signDay");for(let i=0;i<this.signCellArr.length;i++){let a=this.signCellArr[i],s=0;i+1<t.value?s=2:i+1==t.value&&(0==e.value?(s=1,this.receiveBtn.visible=!0,this.receivedBtn.visible=!1):(s=2,this.receiveBtn.visible=!1,this.receivedBtn.visible=!0)),a.setData(i+1,this.signDataArr[i],s)}}onOpened(){this.backBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["back"]),this.receiveBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["receive"])}onMouseEvent(e){if(u.playSound("Click.mp3"),"back"==e)p.event(a.MainShowOpen,!1),this.close();else if("receive"==e){mpsdk.Report.reportEvent(32),this.receiveBtn.visible=!1,this.receivedBtn.visible=!0,f.get("signTimeStap").value=Date.now(),f.get("signed").value=1;let e=f.get("signDay"),t=this.signDataArr[e.value-1];Laya.Scene.load(s.lotteryResult,Laya.Handler.create(this,e=>{e.open(!1),e.setData(t),mpsdk.Report.reportEvent(33)})),this.refreshCell()}}openPackage(e){let t=[],i=u.getRes("gacha.json");for(let a=0;a<e.length;a++){let s=i[e[a]-1],n=L.instance.getCardPackData(s);t.push(n),L.instance.addNewCard(n)}Laya.Scene.load(s.package,Laya.Handler.create(this,i=>{i.isModal=!0,i.isShowEffect=!1,i.width=Laya.stage.width,i.height=Laya.stage.height,i.open(!1),i.showBook(e,t)}))}}class Be extends i.signCellUI{setData(e,t,i){0==i?(this.dayFrame.skin=`sign/Ui_frameday${e}.png`,this.day.skin=`sign/Ui_day${e}.png`,this.canReceiveTag.visible=!1,this.dayMask.visible=!1):1==i?(this.dayFrame.skin=`sign/Ui_frameday${e}2.png`,this.day.skin=`sign/Ui_day${e}1.png`,this.canReceiveTag.visible=!0,this.dayMask.visible=!1):2==i&&(this.dayFrame.skin=`sign/Ui_frameday${e}.png`,this.day.skin=`sign/Ui_day${e}.png`,this.canReceiveTag.visible=!1,this.dayMask.visible=!0,this.dayMask.width=this.dayFrame.width,this.dayMask.height=this.dayFrame.height),"普通卡包"==t.desc?this.rewardNameImage.skin="sign/Ui_word1.png":"钻石卡包"==t.desc?this.rewardNameImage.skin="sign/Ui_word2.png":"卡牌 X3"==t.desc?this.rewardNameImage.skin="sign/Ui_word3.png":"+688"==t.desc?this.rewardNameImage.skin="sign/Ui_word4.png":"+888"==t.desc?this.rewardNameImage.skin="sign/Ui_word5.png":"钻石卡包 X3"==t.desc&&(this.rewardNameImage.skin="sign/Ui_word6.png"),"gold"==t.type?(this.moneyImage.visible=!0,this.secretImage.visible=!1,this.cardCell1.visible=!1,this.cardCell2.visible=!1,this.cardCell3.visible=!1,this.packageLight.visible=!1):"card"==t.type?(1==t.value.length?(this.cardCell1.visible=!1,this.cardCell2.visible=!0,this.cell2.rotation=19,this.cardCell3.visible=!1,this.cardCell2.dataSource=t.value[0]):(this.cardCell1.visible=!0,this.cardCell2.visible=!0,this.cell2.rotation=-15,this.cardCell3.visible=!0,this.cardCell1.dataSource=t.value[0],this.cardCell2.dataSource=t.value[1],this.cardCell3.dataSource=t.value[2]),this.packageLight.visible=!1,this.moneyImage.visible=!1,this.secretImage.visible=!1):"package"==t.type&&(this.moneyImage.visible=!1,this.secretImage.visible=!0,this.cardCell1.visible=!1,this.cardCell2.visible=!1,this.cardCell3.visible=!1,this.packageLight.visible=!1,-1!=t.value.indexOf(1)?this.secretImage.skin="shop/Ui_bao1.png":-1!=t.value.indexOf(2)?this.secretImage.skin="shop/Ui_bao2.png":-1!=t.value.indexOf(3)&&(3==t.value.length?(this.packageLight.visible=!0,this.secretImage.skin="sign/Ui_kabaothree.png"):this.secretImage.skin="shop/Ui_bao3.png")),this.rewardNameFrame.width=this.dayFrame.width-70}}class Ee extends i.surrenderUI{onAwake(){this.yesBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["yes"]),this.noBtn.on(Laya.Event.CLICK,this,this.onMouseEvent,["no"])}onMouseEvent(e,t){"no"==e?this.close("no"):"yes"==e&&this.close("yes")}}class Re extends i.taskUI{constructor(){super(...arguments),this.curIndex=-1,this.activeValueArr=null}onAwake(){this.taskList.vScrollBarSkin=null,this.showTask(0)}onOpened(){this.dayTask.on(Laya.Event.CLICK,this,this.onPageEvent),this.achieveTask.on(Laya.Event.CLICK,this,this.onPageEvent),this.receiveBtn.on(Laya.Event.CLICK,this,this.onPageEvent),p.on(a.ReceiveTaskReward,this,this.receiveTaskReward)}onPageEvent(e){e.target==this.dayTask?(this.titleBg.x=65,this.showTask(0)):e.target==this.achieveTask?(this.titleBg.x=373,this.showTask(1)):(e.target,this.receiveBtn)}onDestroy(){p.off(a.ReceiveTaskReward,this,this.receiveTaskReward)}receiveTaskReward(){let e=this.curIndex;this.curIndex=-1,this.showTask(e)}showTask(e){if(e==this.curIndex)return;this.curIndex=e;let t=u.getRes("task.json"),i=[];if(0==this.curIndex){this.activeBox.visible=!0,this.activeValueArr=[];let e=k.instance.dayTaskId;for(let a=0;a<e.length;a++){let s=t[e[a]%1e3+19-1];i.push(s)}}else{this.activeBox.visible=!1;for(let e=0;e<19;e++){let a=t[(1001+e)%1e3-1];i.push(a)}}this.taskList.array=i,0==this.curIndex&&this.refreshActiveValue()}refreshActiveValue(){let e=0;for(let t=0;t<this.taskList.array.length;t++){let i=k.instance.dayTaskReceive[t],a=this.taskList.array[t].activeValue;i&&(e+=a)}this.activeNum1.text=`${e}/120`,this.activeNum2.text=e+"";let t=e/120;t=t<1?t:1,this.activeBar.width=456*t,this.receiveBtn.disabled=!(e>=120)}}class Ae extends i.taskCellUI{constructor(){super(...arguments),this.record=null,this.reward=null,this.goldLen=0}onAwake(){this.goBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}set dataSource(e){e&&(this._dataSource=e,this.reward=JSON.parse(e.reward),this.record=this.getRecordById(e.id),this.desc.text=e.descrption.replace("%",this.record.goal),2==this.reward[0]?this.rewardIcon.skin="main/Ui_Gold.png":this.rewardIcon.skin="main/Ui_Diamonds.png",e.activeValue>0?(this.activeLabel.visible=!0,this.activeLabel.text=e.activeValue+""):this.activeLabel.visible=!1,this.rewardNum.text=this.reward[1].toString(),this.record.goal<=this.record.now?this.record.receive?(this.goBtn.visible=!1,this.finishIcon.visible=!0,this.bg.skin="task/Ui_Kuang3.png"):this.showGoBtn(!0):this.showGoBtn(!1))}getRecordById(e){let t=e%1e3-1,i=0,a=0,s=0;if(e>2e3)a=k.instance.dayTaskRecord[t],i=this._dataSource.param,s=k.instance.dayTaskReceive[t];else{let e=k.instance.achieveTaskStage[t],n=JSON.parse(this._dataSource.param);this.goldLen=n.length,a=k.instance.achieveTaskRecord[t],i=n[e],s=k.instance.achieveTaskReceive[t]}return{index:t,now:a,goal:i,receive:s}}showGoBtn(e){e?(this.goBtn.skin="task/Btn_WanCheng.png",this.bg.skin="task/Ui_Kuang2.png"):(this.goBtn.skin="task/Btn_QianWang.png",this.bg.skin="task/Ui_Kuang3.png"),this.goBtn.visible=!0,this.finishIcon.visible=!1,this.progressLabel.text=`${this.record.now}/${this.record.goal}`;let t=this.record.now/this.record.goal;t=t<1?t:1,this.progressBar.width=119*t}onBtnClick(){if("task/Btn_WanCheng.png"==this.goBtn.skin){let e={desc:"+688",value:688,type:"gold",isDirect:!0,from:"task"};2==this.reward[0]?e.type="gold":e.type="diamond",e.value=this.reward[1],e.desc="+"+this.reward[1],Laya.Scene.load(s.lotteryResult,Laya.Handler.create(this,t=>{t.open(!1),t.setData(e)}))}else{let e=[1011],t=[1003,2003],i=[1001,1002,1013,1014,2001,2002],a=[1008,1009,1012],n=[1015,1016,1017,1018,1019,2009];-1!=[1004,1005,1006,1007,1010,2004,2005,2006,2007,2008,2010].indexOf(this._dataSource.id)||-1!=e.indexOf(this._dataSource.id)||-1!=t.indexOf(this._dataSource.id)||-1!=i.indexOf(this._dataSource.id)||-1!=a.indexOf(this._dataSource.id)||n.indexOf(this._dataSource.id),Laya.Scene.close(s.task)}}}class De extends i.tipUI{constructor(){super()}onEnable(){}onDisable(){}setTip(e){this.tipLabel.text=e,this.width=this.tipLabel.width+20}}class Me extends i.upDivisionUI{onMouseEvent(){this.goldLocal.value+=Number(this.moneyAdd.text);let e=Math.ceil(this.division/3),t=this.divisionRecordLocal.value;t[e-1]=1,this.divisionRecordLocal.value=t;let i=f.get("house"),s=f.get("newCardId"),n=i.value;for(let e=0;e<3;e++){let t;0==e?t=this.fightCell1.dataSource:1==e?t=this.fightCell2.dataSource:2==e&&(t=this.fightCell3.dataSource),t.id=s.value,s.value++,n.push(t),i.value=n}p.event(a.CardHouseChange),this.initReward()}onAwake(){this.divisionRecordLocal=f.get("divisionRecord"),this.goldLocal=f.get("gold"),this.receiveBtn.on(Laya.Event.CLICK,this,this.onMouseEvent)}initReward(){let e=Math.ceil(this.division/3);1==this.divisionRecordLocal.value[e-1]?(this.receiveBtn.skin="rank/Btn_received.png",this.receiveBtn.mouseEnabled=!1):(this.receiveBtn.skin="rank/Btn_receive.png",this.receiveBtn.mouseEnabled=!0);let t=f.get("pvp");this.moneyAdd.text=t[this.division-1].rankRewardCoin;let i=JSON.parse(t[this.division-1].rankRewardCard),a=f.get("unit"),s=0;for(let e=0;e<i.length;e++){let t=i[e];for(let e=0;e<a.length;e++){let i=a[e];if(t==i.id){let e=`${i.name}-${i.name}-${i.name}`,t={id:i.id+1,type:i.type,skin:e,attackDelay:i.atkgap,hp:i.hp,attackDistance:i.atkRange,def:i.def,moveSpeed:i.speed,color:"green",cost:i.cost};0==s?this.fightCell1.dataSource=t:1==s?this.fightCell2.dataSource=t:2==s&&(this.fightCell3.dataSource=t),s++}}}}setDivision(e){this.division=e,this.curDivision.division=this.division,this.lastDivision.division=this.division-1,this.initReward()}}class Ue extends i.welfareUI{constructor(){super(...arguments),this.slideDir=0}onAwake(){this.adList.vScrollBarSkin=null,mpsdk.Ad.getExcitationList(!0,0,100).then(e=>{console.log("激励广告列表",e),this.adList.dataSource=e}),this.slideDir=1,Laya.timer.frameLoop(1,this,this.onFrameLoop)}onFrameLoop(){this.adList.scrollBar.max>0&&(1==this.slideDir?(this.adList.scrollBar.value+=.1,this.adList.scrollBar.value>=this.adList.scrollBar.max&&(this.slideDir=2)):2==this.slideDir&&(this.adList.scrollBar.value-=.1,this.adList.scrollBar.value<=this.adList.scrollBar.min&&(this.slideDir=1)))}onOpened(){p.on(a.OnShow,this,this.onShow),p.on(a.OnShow,this,this.onHide)}onClosed(){p.event(a.MainShowOpen,!0)}onDestroy(){p.off(a.OnShow,this,this.onShow),p.off(a.OnShow,this,this.onHide),Laya.timer.clearAll(this)}onHide(){Ue.isTry&&(Ue.jumpSuccess=!0)}onShow(){if(Ue.isTry){Ue.isTry=!1,Ue.jumpSuccess=!1;let e=Number(localStorage.getItem("tryPlayTimestamp"));if(e&&e>0&&Date.now()-e>=3e4){let e={desc:"+10",value:10,type:"diamond",isDirect:!0};Laya.Scene.load(s.lotteryResult,Laya.Handler.create(this,t=>{t.open(!1),t.setData(e)}))}}}}Ue.isTry=!1,Ue.jumpSuccess=!1;class Ne extends i.welfareCellUI{set dataSource(e){e&&(this._dataSource=e,this.gameIcon.skin=e.icon,this.gameName.text=e.title,this.desc.text="试玩30秒，返回即可领取",this.rewardNum.text="10")}onAwake(){this.playBtn.on(Laya.Event.CLICK,this,()=>{mpsdk.Ad.click(this._dataSource),Ue.isTry=!0,localStorage.setItem("tryPlayTimestamp",Date.now().toString())})}}class Oe{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("game/runtime/AddMoneyRuntime.ts",d),e("game/runtime/BigMapRuntime.ts",I),e("game/runtime/BuyConfirmRuntime.ts",x),e("game/runtime/FightCellRuntime.ts",T),e("game/runtime/ComposeRuntime.ts",P),e("game/runtime/ComposeShowRuntime.ts",E),e("game/runtime/CountRuntime.ts",R),e("game/runtime/DivisionRuntime.ts",A),e("game/runtime/DivisionRewardRuntime.ts",D),e("game/runtime/FreeTryRuntime.ts",M),e("game/runtime/GameCellRuntime.ts",U),e("game/runtime/GameLoadRuntime.ts",N),e("game/runtime/GiftRuntime.ts",V),e("game/runtime/GiftCellRuntime.ts",O),e("game/runtime/HandBookRuntime.ts",G),e("game/runtime/HandBookCellRuntime.ts",F),e("game/runtime/HandBookNewRewardRuntime.ts",H),e("game/runtime/LoadRuntime.ts",W),e("game/runtime/LotteryRuntime.ts",Y),e("game/runtime/LotteryResultRuntime.ts",j),e("game/runtime/MagicCardRuntime.ts",z),e("game/runtime/MainRuntime.ts",J),e("game/runtime/ModeRuntime.ts",q),e("game/runtime/SelectRuntime.ts",Q),e("game/runtime/ShopRuntime.ts",ee),e("game/runtime/TipViewRuntime.ts",te),e("game/runtime/MapCellRuntime.ts",ie),e("game/runtime/MapPageRuntime.ts",w),e("game/runtime/MatchRuntime.ts",ae),e("game/runtime/NewCardPopRuntime.ts",se),e("game/runtime/OutCellRuntime.ts",Z),e("game/runtime/PackageRuntime.ts",ne),e("game/runtime/GameRuntime.ts",we),e("game/runtime/ProgressRuntime.ts",Ce),e("game/runtime/PvpRuntime.ts",Ie),e("game/runtime/RankRuntime.ts",xe),e("game/runtime/RankCellRuntime.ts",_e),e("game/runtime/ShopCellRuntime.ts",Te),e("game/runtime/SignRuntime.ts",Pe),e("game/runtime/SignCellRuntime.ts",Be),e("game/runtime/SurrenderRuntime.ts",Ee),e("game/runtime/TaskRuntime.ts",Re),e("game/runtime/TaskCellRuntime.ts",Ae),e("game/runtime/TipRuntime.ts",De),e("game/runtime/UpDivisionRuntime.ts",Me),e("game/runtime/WelfareRuntime.ts",Ue),e("game/runtime/WelfareCellRuntime.ts",Ne)}}Oe.width=720,Oe.height=1800,Oe.scaleMode="fixedwidth",Oe.screenMode="vertical",Oe.alignV="top",Oe.alignH="left",Oe.startScene="load.scene",Oe.sceneRoot="",Oe.debug=!1,Oe.stat=!1,Oe.physicsDebug=!1,Oe.exportSceneToJson=!0,Oe.init(),new class{constructor(){window.Laya3D?Laya3D.init(Oe.width,Oe.height):Laya.init(Oe.width,Oe.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=Oe.scaleMode,Laya.stage.screenMode=Oe.screenMode,Laya.stage.alignV=Oe.alignV,Laya.stage.alignH=Oe.alignH,Laya.URL.exportSceneToJson=Oe.exportSceneToJson,Laya.Shader3D.debugMode=!0,(Oe.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),Oe.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),Oe.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){Oe.startScene&&Laya.Scene.open(Oe.startScene)}}}();