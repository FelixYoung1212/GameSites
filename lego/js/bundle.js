!function(){"use strict";class e{static init(){e._disp||(e._disp=new Laya.EventDispatcher)}static event(t,i){return e._disp.event(t,i)}static on(t,i,a,s){return e._disp.on(t,i,a,s)}static once(t,i,a,s){return e._disp.once(t,i,a,s)}static off(t,i,a,s){return e._disp.off(t,i,a,s)}static offAll(t){return e._disp.offAll(t)}static isMouseEvent(t){return e._disp.isMouseEvent(t)}static hasListener(t){return e._disp.hasListener(t)}}class t{static init(){t.CUR_PLATFORM=t.BROWSER;let e=window.navigator.userAgent;-1==e.indexOf("OPPO")&&e.indexOf("MiniGame")>-1&&"wx"in window&&("tt"in window?t.CUR_PLATFORM=t.TT:"qq"in window?t.CUR_PLATFORM=t.QQ:t.CUR_PLATFORM=t.WX),e.indexOf("OPPO")>-1&&e.indexOf("MiniGame")>-1&&(t.CUR_PLATFORM=t.OPPO),e.indexOf("VVGame")>-1&&(t.CUR_PLATFORM=t.VIVO),console.log("当前小游戏运行平台",t.CUR_PLATFORM)}}var i,a;t.CUR_PLATFORM=null,t.OPPO="OPPO",t.VIVO="VIVO",t.WX="WX",t.TT="TT",t.QQ="QQ",t.BROWSER="BROWSER",function(e){e[e.NATIVE_AD_GAME=0]="NATIVE_AD_GAME",e[e.NATIVE_AD_FINISH=1]="NATIVE_AD_FINISH"}(i||(i={})),function(e){e[e.BLOCK_AD_GAME=0]="BLOCK_AD_GAME",e[e.BLOCK_AD_TIP=1]="BLOCK_AD_TIP"}(a||(a={}));class s{constructor(){this.nativeAd={},this.nativeAdData={},this.blockAd={},this.isFirstInGame=!0,this.appVersion="1.0.0",this.resVersion="1.0.0",this.NativeAdType=i,this.BlockAdType=a,this.isTTAdMode=!1,this.isOpen=!1,this.adAutoClickNum=0,this.delayTime=30,this.nativeUpNum=100}initSdk(){}hasShortcutInstalled(e){}loadSubpackage(e,t){}showBannerAd(e="10"){}isShowPlatformGameAd(){return!1}showPlatformBannerGameAd(){}hidePlatformBannerGameAd(){}showPlatformDrawerGameAd(){}hideBannerAd(){}destroyBannerAd(){}showInsertAd(e="20"){}showBlockAd(e,t){}destroyBlockAd(e){}showAppBoxAd(){}showNativeBigAd(e,t){}showNativeMiniAd(e,t){}showNativeIconAd(e,t){}onNativeAdClick(e,t){}onNativeDestroy(e){}showVideoAd(e="30",t){}navigateToMiniGame(e,t,i,a){}isShowMoreGamesModal(){return!1}showMoreGamesModal(){}startRecorder(){}stopRecorder(){}shareRecorder(e){}onBegin(e){}onCompleted(e){}onFailed(e){}onEvent(e){}getSysTime(){return Math.floor((new Date).getTime()/1e3)}vibrateShort(){}vibrateLong(){}cleanCache(e,t){}fileExist(e){return!1}downloadFile(e,t,i,a,s){}removeFile(e,t){}showToast(e){}playMusic(e,t=!0,i=!1,a=1,s=null,n=null){return null}musicObj_play(e){}musicObj_pause(e){}musicObj_resume(e){}musicObj_stop(e){}musicObj_getCurrentTime(e){return 0}musicObj_getDuration(e){return 0}musicObj_seek(e,t,i){}onHide(e){}offHide(e){}}class n extends s{initSdk(){console.log("PCSDK init")}loadSubpackage(e,t){t.run()}showBannerAd(){console.log("PCSDK showBannerAd")}hideBannerAd(){console.log("PCSDK hideBannerAd")}destroyBannerAd(){console.log("PCSDK destroyBannerAd")}showNativeBigAd(e,t){console.log("PCSDK showNativeBigAd:"+e),t()}onNativeAdClick(e,t){console.log("PCSDK onNativeAdClick:"+e)}onNativeDestroy(e){console.log("PCSDK onNativeDestroy:"+e)}navigateToMiniGame(e,t,i,a){console.log("PCSDK navigateToMiniGame:"+e)}onBegin(e){console.log("PCSDK onBegin:"+e)}onCompleted(e){console.log("PCSDK onCompleted:"+e)}onFailed(e){console.log("PCSDK onFailed:"+JSON.stringify(e))}onEvent(e){console.log("PCSDK onEvent:"+JSON.stringify(e))}showVideoAd(e="30",t){console.log("PCSDK show video AD"),null!=t&&t(0)}startRecorder(){console.log("PCSDK startRecorder")}stopRecorder(){console.log("PCSDK stopRecorder")}shareRecorder(e){e(0)}showInsertAd(){console.log("PCSDK showInsertAd")}downloadFile(e,t,i,a,s){this.downloadProgressCallback=i,this.downloadFinishCallback=a,this.downloadFailedCallback=s,Laya.loader.on(Laya.Event.ERROR,this,this.onEvent_resLoadFailed),Laya.loader.load(e,Laya.Handler.create(this,this.onEvent_resLoading),Laya.Handler.create(this,this.onEvent_resLoadFinished,null,!1),null,0,!0)}onEvent_resLoading(e){null!=this.downloadProgressCallback&&this.downloadProgressCallback(e)}onEvent_resLoadFinished(){null!=this.downloadFinishCallback&&this.downloadFinishCallback(),this.downloadProgressCallback=null,this.downloadFinishCallback=null,Laya.loader.off(Laya.Event.ERROR,this,this.downloadFailedCallback),this.downloadFailedCallback=null}onEvent_resLoadFailed(){null!=this.downloadFailedCallback&&this.downloadFailedCallback(),this.downloadProgressCallback=null,this.downloadFinishCallback=null,Laya.loader.off(Laya.Event.ERROR,this,this.downloadFailedCallback),this.downloadFailedCallback=null}playMusic(e,t=!0,i=!0,a=1,s=null,n=null){this.musicCompleteCallback=n;let o=Laya.SoundManager.playMusic(e,i?0:1,Laya.Handler.create(this,this.onEvent_callback_audioFinished));return o.volume=a,0==t&&o.pause(),Laya.Tween.to(this,{},1,null,Laya.Handler.create(this,function(){null!=s&&s()})),o}onEvent_callback_audioFinished(){null!=this.musicCompleteCallback&&this.musicCompleteCallback()}musicObj_play(e){console.log(e),null!=e&&e.play()}musicObj_pause(e){null!=e&&e.pause()}musicObj_resume(e){null!=e&&e.play()}musicObj_stop(e){null!=e&&(e.completeHandler=null,e.stop())}musicObj_getCurrentTime(e){return e.position}musicObj_getDuration(e){return e.duration}musicObj_seek(e,t,i){let a=e.completeHandler;e.completeHandler=null;let s=Laya.SoundManager.playMusic(e.url,e.loops,a,t);s.volume=e.volume,null!=i&&i(s)}}class o extends s{constructor(){super(...arguments),this.apiName="wx",this.BANNER_ID="adunit-148fcb9524189657",this.INSERT_ID="adunit-4d22dc25cc441e4b",this.VIDEO_ID="adunit-15b421f7362508e9",this.tdSdk=Laya.Browser.window.tdAppSdk}initSdk(){console.log("WXSDK init"),o.instance=this,this.api=Laya.Browser.window[this.apiName],this.systemInfo=this.api.getSystemInfoSync(),this.screenWidth=this.systemInfo.screenWidth,this.screenHeight=this.systemInfo.screenHeight,console.log("系统信息："+JSON.stringify(this.systemInfo)),this.api.showShareMenu({withShareTicket:!1})}initBannerAd(){this.createBannerAd(!1),this.api.onHide(()=>{console.log("wx.onhide"),this.isFirstInGame||this.createBannerAd(!0)})}createBannerAd(e=!1){this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null);this.bannerAd=this.api.createBannerAd({adUnitId:this.BANNER_ID,style:{width:200,top:0,left:0}}),this.bannerAd.onResize(function(){o.instance.bannerAd.style.left=o.instance.screenWidth/2-o.instance.bannerAd.style.realWidth/2+.1,o.instance.bannerAd.style.top=o.instance.screenHeight-o.instance.bannerAd.style.realHeight+.1}),this.bannerAd.onLoad(()=>{e&&o.instance.showBannerAd()}),this.bannerAd.onError(e=>{console.log("错误监听：",JSON.stringify(e))})}showBannerAd(e="10"){null!=this.bannerAd?(this.bannerAd.show(),this.isFirstInGame=!1):this.createBannerAd(!0)}hideBannerAd(){null!=this.bannerAd&&this.bannerAd.hide()}destroyBannerAd(){null!=this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}createInsertAd(){null!=this.insertAd&&this.insertAd.destroy(),this.insertAd=this.api.createInterstitialAd({adUnitId:this.INSERT_ID}),this.insertAd.onLoad(function(){console.log("插屏广告加载")}),this.insertAd.onClose(function(){console.log("插屏广告关闭"),o.instance.createInsertAd(),o.instance.showBannerAd()}),this.insertAd.onError(function(e){console.log("插屏广告出错：",JSON.stringify(e))})}showInsertAd(e="20"){null!=this.insertAd?(o.instance.hideBannerAd(),this.insertAd.show().catch(e=>{console.log("插屏广告展示错误:"+JSON.stringify(e)),o.instance.createBannerAd(!0)})):(console.log("没有插屏广告，直接退出"),o.instance.createBannerAd(!0))}showNativeAd(e="1",t){}onNativeAdClick(e){}onNativeDestroy(){}navigateToMiniGame(e,t,i,a){}createVideoAd(){try{console.log("创建微信激励视频广告"),this.videoAd=this.api.createRewardedVideoAd({adUnitId:this.VIDEO_ID}),this.videoAd.load().then(function(){console.log("ad loaded")}).catch(e=>{console.log("激励视频 广告显示失败")}),this.videoAd.onClose(e=>{null==e?o.instance.videoAdCallBack(0):(console.log("==> rewardedVideoAd onClose",e),e.isEnded?o.instance.videoAdCallBack(0):(o.instance.videoAdCallBack(1),console.log("广告没看完")))}),this.videoAd.onError(e=>{console.log("onError:",e.errMsg)})}catch(e){console.log("wxRewardVideoAd error",e)}}showVideoAd(e="30",t){this.videoAdCallBack=t,this.videoAd&&this.videoAd.show().then(()=>{console.log("广告显示成功")}).catch(e=>{console.log("广告组件出现问题",e),o.instance.videoAd.load().then(()=>{console.log("手动加载成功"),o.instance.videoAd.show()})})}onBegin(e){console.log("开始第"+e+"关"),this.api.aldStage.onStart({stageId:e,stageName:"第"+e+"关"})}onCompleted(e){console.log("结束第"+e+"关"),this.api.aldStage.onEnd({stageId:e,stageName:"第"+e+"关",event:"complete",params:{desc:"关卡完成"}})}onFailed(e){console.log("失败第"+e.missionId+"关"),this.api.aldStage.onEnd({stageId:e.missionId,stageName:"第"+e.missionId+"关",event:"fail",params:{desc:e.cause}})}onEvent(e){console.log("onEvent:"+JSON.stringify(e)),this.tdSdk.event({id:e.id,label:e.label,params:e.params})}vibrateLong(){this.api.vibrateLong()}vibrateShort(){this.api.vibrateShort()}}class l{}l.UserDataChange="UserDataChange",l.NEWGUIDETASK="NEWGUIDETASK",l.MOUSE_EVENT="MOUSE_EVENT",l.GAME_START="GAME_START",l.CREATE_NUM="CREATE_NUM",l.OPEN_BOX="OPEN_BOX",l.START_BUILD="START_BUILD",l.EVENT_NATIVE_AD="EVENT_NATIVE_AD";class r{static clamp(e,t,i){return e>i?i:e<t?t:e}static clamp01(e){return r.clamp(e,0,1)}static lerp(e,t,i){return i>0&&i<1?(t-e)*i+e:i<=0?e:t}static RandomNum(e){var t=100*e;return this.random(0,100)<t}static random(e,t){return Math.round(Math.random()*(t-e))+e}static similar(e,t,i=.1){let a=e-t;return a>-i&&a<i}static isInRegion(e,t){let i,a,s,n,o,l,r=0,h=t.length;for(let d=0;d<h;d++){if(e.x==t[d].x&&e.y==t[d].y)return!0;if(i=t[d%h],a=t[(d+1)%h],s=i.x,o=a.x,(n=i.y)==(l=a.y))continue;if(e.y<Math.min(n,l))continue;if(e.y>Math.max(n,l))continue;o-(o-s)*(l-e.y)/(l-n)<e.x||r++}return r%2==1}static get2VectorAngle(e,t){let i=e.x*t.x+e.y*t.y,a=Math.sqrt(e.x*e.x+e.y*e.y)*Math.sqrt(t.x*t.x+t.y*t.y);return 0!=a?i/a:0}static getAngleByVector(e,t){if(0===t){if(e<0)return 270;if(e>=0)return 90}if(0===e)return t>=0?0:180;let i=Math.abs(t)/Math.abs(e),a=0;return t>0&&e<0?a=270+180*Math.atan(i)/Math.PI:t>0&&e>0?a=90-180*Math.atan(i)/Math.PI:t<0&&e<0?a=270-180*Math.atan(i)/Math.PI:t<0&&e>0&&(a=90+180*Math.atan(i)/Math.PI),a}static changeAngle(e,t,i){let a,s,n,o,l,r,h,d,c,g;return a=Math.cos(.5*i),s=Math.sin(.5*i),l=Math.cos(.5*t),{qx:d=a*(r=Math.sin(.5*t))*(n=Math.cos(.5*e))+s*l*(o=Math.sin(.5*e)),qy:c=a*l*o-s*r*n,qz:g=s*l*n-a*r*o,qw:h=a*l*n+s*r*o}}static getRandomArray(e,t,i){const a=[];for(let i=e;i<=t;i++)a.push(i);const s=[],n=a.length>=i?i:a.length;for(let e=0;e<=n-1;e++){const e=Math.floor(Math.random()*a.length);s.push(a[e]),a.splice(e,1)}return s}static randomArray(e,t=5){let i=e.length;for(;0!=t;){t--;let a=r.random(0,i-1),s=r.random(0,i-1),n=e[a];e[a]=e[s],e[s]=n}}static angle2rad(e){return.017453293*e}static rad2angle(e){return e/.017453293}static get2DAngle(e,t,i,a){let s=i-e,n=a-t;if(0===n){if(s<0)return 270;if(s>=0)return 90}if(0===s){if(n>=0)return 0;if(n<0)return 180}let o=0;return 0!=s&&(o=Math.atan(n/s)/Math.PI*180),s<0&&(o+=180),o<0&&(o+=360),o}static getNewUuid(){return++r.globalId}static plucker(e,t){return[e[0]*t[1]-t[0]*e[1],e[0]*t[2]-t[0]*e[2],e[0]-t[0],e[1]*t[2]-t[1]*e[2],e[2]-t[2],t[1]-e[1]]}static sideOp(e,t){return e[0]*t[4]+e[1]*t[5]+e[2]*t[3]+e[3]*t[2]+e[4]*t[0]+e[5]*t[1]}static checkLineAndTriangle(e,t,i,a,s){let n=this.plucker(a,i),o=this.plucker(s,a),l=this.plucker(i,s),r=this.plucker(e,t),h=this.sideOp(r,n),d=this.sideOp(r,o),c=this.sideOp(r,l);return 0==h&&0==d&&0==c?1:h>0&&d>0&&c>0||h<0&&d<0&&c<0?2:0==h&&d*c>0||0==d&&h*c>0||0==c&&h*d>0?3:0==h&&0==d||0==h&&0==c||0==d&&0==c?4:0}static CROSS(e,t,i){e[0]=t[1]*i[2]-t[2]*i[1],e[1]=t[2]*i[0]-t[0]*i[2],e[2]=t[0]*i[1]-t[1]*i[0]}static DOT(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}static SUB(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}static intersect_triangle(e,t,i,a,s){let n=[],o=[],l=[],h=[],d=[];this.SUB(n,a,i),this.SUB(o,s,i),this.CROSS(h,t,o);let c=this.DOT(n,h);if(c>-r.EPSILON&&c<r.EPSILON)return[];let g=1/c;this.SUB(l,e,i);let u=this.DOT(l,h)*g;if(u<0||u>1)return[];this.CROSS(d,l,n);let m=this.DOT(t,d)*g;return m<0||u+m>1?[]:[this.DOT(o,d)*g,u,m]}}r.globalId=Math.floor(516*Math.random()),r.EPSILON=1e-10;class h extends s{constructor(){super(...arguments),this.apiName="qg",this.BANNER_ID="276287",this.BANNER_GAME_ID="276295",this.DRAWER_GAME_ID="276294",this.NATIVE_ID=["276291","276292"],this.VIDEO_ID="276293",this.startTime=0,this.isFirstShowPortalAd=!0,this.baseUrl="https://heygame.oss-cn-shanghai.aliyuncs.com/resources/",this.heyGameInfo=Laya.Browser.window.heyGameConfig}initSdk(){console.log("OPPOSDK init"),h.instance=this,this.api=Laya.Browser.window[this.apiName],this.systemInfo=this.api.getSystemInfoSync(),this.fs=this.api.getFileSystemManager(),this.startTime=this.getSysTime(),this.appVersion=this.heyGameInfo.versionName,this.initBannerAd(),this.initBannerGameAd(),this.initDrawerGameAd(),this.createVideoAd(),this.initHeyGameConfig()}initBannerAd(){this.createBannerAd(!1)}hasShortcutInstalled(e){this.api.hasShortcutInstalled({success:function(t){0==t?h.instance.api.installShortcut({success:function(e){},fail:function(t){e(1)},complete:function(){e(1)}}):(e(0),h.instance.showToast("图标已添加"))},fail:function(t){e(1)},complete:function(){e(1)}})}loadSubpackage(e,t){this.api.loadSubpackage({name:e,success:function(){console.log("loadSubpackage success:"+e),null!=t&&t.run()},fail:function(t){console.log(e+"加载分包失败--"+JSON.stringify(t))}}).onProgressUpdate(function(e){})}initHeyGameConfig(){let e=this.baseUrl+this.heyGameInfo.appName+"/OppoGameConfig.json?"+this.getSysTime();console.log("initHeyGameConfig=url"+e),Laya.loader.load(e,Laya.Handler.create(this,t=>{if(console.log("initHeyGameConfig + loading"),t){var i=Laya.loader.getRes(e);i[this.appVersion]&&(this.isOpen=!0),i.adAutoClickNum&&(this.adAutoClickNum=i.adAutoClickNum,console.log("adClick="+this.adAutoClickNum)),i.delayTime&&(this.delayTime=i.delayTime,console.log("delayTime="+this.delayTime)),i.nativeUpNum&&(this.nativeUpNum=i.nativeUpNum,console.log("nativeUpNum="+this.nativeUpNum))}}))}createBannerAd(e=!1){console.log("createBannerAd"),this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null),this.bannerAd=this.api.createBannerAd({adUnitId:this.BANNER_ID}),this.bannerAd.onResize(function(e){console.log("[Banner广告] banner 宽度："+e.width+", banner 高度："+e.height+", banner 位置X : "+e.left+", banner 位置y : "+e.top)}),this.bannerAd.onLoad(()=>{console.log("[Banner广告] 广告加载成功")}),this.bannerAd.onError(e=>{console.log("错误监听：",JSON.stringify(e))}),e&&h.instance.showBannerAd()}showBannerAd(e="10"){console.log("showBannerAd"),this.getSysTime()-this.startTime<65||(null!=this.bannerAd?this.bannerAd.show():this.createBannerAd(!0))}hideBannerAd(){console.log("请求隐藏BannerAD : HOME"),null!=this.bannerAd&&this.bannerAd.hide()}destroyBannerAd(){console.log("请求毁掉BannerAD : HOME"),null!=this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}createNativeAd(e,t){let i=this.api.createNativeAd({adUnitId:e});return console.log("createNativeAd:"),i.onLoad(a=>{console.log("createNativeAd==>"+JSON.stringify(a)),a.adList&&a.adList.length>0?(console.log("原生广告加载成功-"+e),r.RandomNum(this.nativeUpNum/100)&&i.reportAdShow({adId:a.adList[0].adId.toString()}),this.nativeAdData[e]=a.adList[0],console.log("onLoad nativeAdData:",this.nativeAdData[e]),t(a.adList[0])):t(null)}),i.onError(e=>{console.log("nativeAd:"+JSON.stringify(e))}),i.load(),i}showNativeBigAd(e,t){this.getSysTime()-this.startTime<30||(console.log("showNativeBigAd:",e),console.log("nativeAdData:",this.nativeAdData[this.NATIVE_ID[e]]),this.nativeAdData[this.NATIVE_ID[e]]?t(this.nativeAdData[this.NATIVE_ID[e]]):(console.log("showNativeBigAd new:",e),this.nativeAd[e]=this.createNativeAd(this.NATIVE_ID[e],t)))}showNativeIconAd(e,t){this.getSysTime()-this.startTime<30||(this.nativeAd[e]=this.createNativeAd(this.NATIVE_ID[e],t))}onNativeAdClick(e,t){console.log("onNativeClick:"),this.nativeAd[e]&&(this.nativeAd[e].reportAdClick({adId:t.toString()}),console.log("原生广告点击-"+e),this.onNativeDestroy(e))}onNativeDestroy(e){console.log("onNativeDestroy:",e),this.nativeAd[e]&&(this.nativeAd[e].offLoad(),this.nativeAd[e].offError(),this.nativeAd[e].destroy(),this.nativeAd[e]=null,this.nativeAdData[this.NATIVE_ID[e]]=null,console.log("原生广告销毁-"+e))}showInsertAd(e="20"){super.showInsertAd(e)}createVideoAd(){try{console.log("创建OPPO激励视频广告"),this.videoAd=this.api.createRewardedVideoAd({adUnitId:this.VIDEO_ID}),this.videoAd.onLoad(function(){h.instance.videoAd.show()}),this.videoAd.onError(e=>{console.log("onError:",e.errMsg),h.instance.showToast("暂时没有广告了")}),this.videoAd.onClose(e=>{null==e?h.instance.videoAdCallBack(0):(console.log("==> oppoRewardVideoAd onClose",e),e.isEnded?h.instance.videoAdCallBack(0):(h.instance.videoAdCallBack(1),console.log("广告没看完")))})}catch(e){console.log("oppoRewardVideoAd error",e)}}showVideoAd(e="30",t){this.videoAdCallBack=t,null!=this.videoAd?this.videoAd.load():this.createVideoAd()}isShowPlatformGameAd(){return this.systemInfo.platformVersionCode>=1076}initBannerGameAd(){this.isShowPlatformGameAd()&&(this.gameBannerAd=this.api.createGameBannerAd({adUnitId:this.BANNER_GAME_ID}),this.gameBannerAd.onLoad(()=>{console.log("互推盒子横幅广告加载成功")}))}showPlatformBannerGameAd(){this.isShowPlatformGameAd()&&this.gameBannerAd.show().then(()=>{console.log("gameBannerAd show success")}).catch(e=>{console.log("gameBannerAd show fail with:"+e.errCode+","+e.errMsg)})}hidePlatformBannerGameAd(){this.isShowPlatformGameAd()&&this.gameBannerAd.hide().then(()=>{console.log("gameBannerAd hide success")}).catch(e=>{console.log("gameBannerAd hide fail with:"+e.errCode+","+e.errMsg)})}initDrawerGameAd(){this.isShowPlatformGameAd()&&(this.gamePortalAd=this.api.createGamePortalAd({adUnitId:this.DRAWER_GAME_ID}),this.gamePortalAd.onLoad(()=>{this.isFirstShowPortalAd||this.gamePortalAd.show().then(()=>{console.log("gamePortalAd show success"),e.event(l.EVENT_NATIVE_AD,!1)}).catch(e=>{console.log("gamePortalAd show fail with:"+e.errCode+","+e.errMsg)})}),this.gamePortalAd.onClose(()=>{console.log("互推盒子九宫格广告关闭"),e.event(l.EVENT_NATIVE_AD,!0)}))}showPlatformDrawerGameAd(){this.isShowPlatformGameAd()&&(this.isFirstShowPortalAd?(this.isFirstShowPortalAd=!1,this.gamePortalAd.show().then(()=>{console.log("gamePortalAd show success"),e.event(l.EVENT_NATIVE_AD,!1)}).catch(t=>{this.showToast("暂无更多游戏"),console.log("gamePortalAd show fail with:"+t.errCode+","+t.errMsg),e.event(l.EVENT_NATIVE_AD,!0)})):this.gamePortalAd.load().then(()=>{console.log("gamePortalAd load success")}).catch(t=>{this.showToast("暂无更多游戏"),console.log("gamePortalAd load fail with:"+t.errCode+","+t.errMsg),e.event(l.EVENT_NATIVE_AD,!0)}))}navigateToMiniGame(e,t,i,a){this.api.navigateToMiniGame({pkgName:e,path:t,extraData:{from:i},success:function(){a(!0)},fail:function(e){console.log("navigateToMiniGame:"+JSON.stringify(e)),a(!1)}})}showToast(e=""){this.api.showToast({title:e,icon:"none",duration:1500})}onBegin(e){}onCompleted(e){}onFailed(e){}onEvent(e){}cleanCache(e,t){this.fs.getSavedFileList({success(e){let i=0,a=null,s=0;e.fileList.forEach(e=>{e.createTime>s&&(s=e.createTime,a=e),i+=e.size}),i>47185920?h.instance.fs.removeSavedFile({filePath:a.filePath,success(e){console.log(`${a.filePath} 删除成功`),null!=t&&t()},fail(e){console.error(`${a.filePath} 删除失败`,e.errMsg),null!=t&&t()}}):null!=t&&t()},fail(e){console.log("获取缓存资源失败 : "+JSON.stringify(e)),null!=t&&t()}})}fileExist(e){return!1}downloadFile(e,t,i,a,s){t=this.api.env.USER_DATA_PATH+"/"+t;let n=function(){let n=h.instance.api.downloadFile({url:e,filePath:t,success(e){console.log("下载成功 : "+JSON.stringify(e)),null!=a&&a()},fail(e){console.log("下载失败 : "+JSON.stringify(e)),null!=s&&s()},complete(){console.log("download complete")}});null!=i&&n.onProgressUpdate(i)};this.fs.access({path:t,success(){console.log("有本地文件，直接返回成功"),a&&a()},fail(e){console.log("没有本地文件，需要去服务器下载");let i=t.replace(/\/[^\/]+$/,"");h.instance.fs.access({path:i,success(){console.log("本地有对应的路径，直接开始下载"),n()},fail(e){console.log("本地没有对应的路径，先创建路径在开始下载"),h.instance.fs.mkdir({dirPath:i,recursive:!0,success(){console.log("创建文件夹成功："+i),n()},fail(e){console.log("创建文件夹失败"+i),null!=s&&s()}})}})}})}removeFile(e,t){this.fs.unlink({filePath:this.api.env.USER_DATA_PATH+"/"+e,success(i){console.log(`${e} 删除成功`),null!=t&&t()},fail(i){console.error(`${e} 删除失败`,i.errMsg),null!=t&&t()}})}playMusic(e,t=!0,i=!0,a=1,s=null,n=null){var o=this.api.createInnerAudioContext();o.loop=i,o.volume=a,o.autoplay=!1;var l=function(){null!=s&&s(),null!=n&&o.onEnded(n),o.offCanplay(l),t&&o.play()};return o.onError(e=>{console.log("audio.onError"+JSON.stringify(e))}),o.onCanplay(l),o.src=this.api.env.USER_DATA_PATH+"/"+e,o}musicObj_play(e){e.play()}musicObj_pause(e){e.pause()}musicObj_resume(e){e.play()}musicObj_stop(e){e.stop(),e.destroy()}musicObj_getCurrentTime(e){return Number.parseFloat(e.currentTime)}musicObj_getDuration(e){return e.duration}musicObj_seek(e,t,i){this._seekCallback=i,this._seekAudio=e,this._seekFinishCallback=this.musicObj_seekFinished.bind(this),e.onSeeked(this._seekFinishCallback),e.seek(t)}musicObj_seekFinished(){this._seekAudio.offSeeked(this._seekFinishCallback),null!=this._seekCallback&&(this._seekCallback(this._seekAudio),this._seekCallback=null),this._seekAudio=null}onHide(e){this.api.onHide(e)}offHide(e){this.api.offHide(e)}vibrateLong(){this.api.vibrateLong()}vibrateShort(){this.api.vibrateShort()}}class d extends s{constructor(){super(...arguments),this.apiName="qg",this.BANNER_ID="252fe15001614911b32baa353c1b7dc9",this.INSERT_ID="3486a84587f9473d98cf46587b7fda30",this.VIDEO_ID="a941ec2b40354280b9d265345f60a0a6",this.NATIVE_ID="ab48436a4cac489787ec655a243315cd",this.nativeAdCallBack=null,this.videoStartTime=0}initSdk(){console.log("VIVOSDK init"),d.instance=this,this.api=Laya.Browser.window[this.apiName],this.initBannerAd(),this.createInsertAd(),this.createVideoAd(),this.api.onShow(function(){console.log("VIVO_JSB game enter foreground")}),this.api.onHide(function(){console.log("VIVO_JSB game enter background")})}initBannerAd(){this.createBannerAd(!1)}createBannerAd(e=!1){console.log("createBannerAd"),this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null),this.bannerAd=this.api.createBannerAd({posId:this.BANNER_ID,style:{}}),this.bannerAd.onResize(function(e){console.log("[Banner广告] banner 宽度："+e.width+", banner 高度："+e.height+", banner 位置X : "+e.left+", banner 位置y : "+e.top)}),this.bannerAd.onLoad(()=>{console.log("[Banner广告] 广告加载成功"),e&&d.instance.showBannerAd()}),this.bannerAd.onError(e=>{console.log("错误监听：",JSON.stringify(e))})}showBannerAd(e="10"){null!=this.bannerAd?this.bannerAd.show().then(()=>{console.log("banner广告展示完成")}).catch(e=>{console.log("banner广告展示失败",JSON.stringify(e))}):this.createBannerAd(!0)}hideBannerAd(){console.log("请求隐藏BannerAD : HOME"),null!=this.bannerAd&&this.bannerAd.hide()}destroyBannerAd(){console.log("请求毁掉BannerAD : HOME"),null!=this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}createInsertAd(){console.log("createInsertAd"),this.insertAd=this.api.createInterstitialAd({posId:this.INSERT_ID,style:{}}),this.insertAd.onLoad(function(){console.log("插屏广告加载")}),this.insertAd.onClose(function(){console.log("插屏广告关闭"),d.instance.createInsertAd(),d.instance.showBannerAd("16")}),this.insertAd.onError(function(e){console.log("插屏广告出错：",JSON.stringify(e)),30002===e.errCode&&d.instance.createInsertAd()})}showInsertAd(e="20"){if(this.insertAd){let e=this.insertAd.show();null!=e&&e&&e.then(()=>{console.log("插屏广告展示成功")}).catch(e=>{d.instance.showBannerAd("13"),console.log("插屏广告展示失败",JSON.stringify(e))})}else this.createInsertAd()}createNativeAd(e,t){console.log("createNativeAd");let i=this.api.createNativeAd({posId:this.NATIVE_ID});return i.onLoad(e=>{if(console.log("createNativeAd:"+JSON.stringify(e)),e.adList&&e.adList.length>0){let a=e.adList.pop();t(a),i.reportAdShow({adId:a.adId.toString()})}else t(null)}),i.onError(e=>{console.log("nativeAd:"+JSON.stringify(e))}),i}showNativeBigAd(e,t){console.log("vivo sdk showNativeBigAd"),this.nativeAd[e]=this.createNativeAd(this.NATIVE_ID[e],t),this.nativeAd&&(console.log("showNativeBigAd:--load"),this.nativeAd[e].load())}showNativeIconAd(e,t){console.log("vivo sdk showNativeIconAd")}onNativeAdClick(e,t){console.log("onNativeClick:"),this.nativeAd[e]&&this.nativeAd[e].reportAdClick({adId:t.toString()})}onNativeDestroy(e){console.log("onNativeDestroy:")}createVideoAd(){console.log("createVideoAd");try{console.log("创建VIVO激励视频广告"),this.videoAd=this.api.createRewardedVideoAd({posId:this.VIDEO_ID}),this.videoAd.onLoad(function(e){console.log("激励视频广告加载完成-onload触发",JSON.stringify(e))}),this.videoAd.onError(e=>{console.log("rewardedVideoAd onError:",e.errMsg),this.api.showToast({message:"对不起，暂时没有广告了！"})}),this.videoAd.onClose(e=>{e&&e.isEnded?(console.log("正常播放结束，可以下发游戏奖励"),d.instance.videoAdCallBack(0)):(console.log("播放中途退出，不下发游戏奖励"),d.instance.videoAdCallBack(1))})}catch(e){console.log("vivoRewardVideoAd error",e)}}loadVideoAdAuto(){console.log("激励视频广告加载"),setTimeout(function(){console.log("激励视频广告加载中"),this.videoAd.load()}.bind(this),6e4)}showVideoAd(e="30",t){if(this.videoAdCallBack=t,this.getSysTime()-this.videoStartTime>60)if(null!=this.videoAd){this.videoStartTime=this.getSysTime();let e=this.videoAd.show();null!=e&&e&&e.then(()=>{console.log("激励视频广告播放成功"),d.instance.loadVideoAdAuto()}).catch(e=>{console.log("激励视频广告展示失败",JSON.stringify(e))})}else this.createVideoAd();else this.api.showToast({message:"广告播放太频繁，请一分钟后再试！"})}navigateToMiniGame(e,t,i,a){this.api.navigateToMiniGame({pkgName:e,path:t,extraData:{from:i},success:function(){a(!0)},fail:function(e){console.log("navigateToMiniGame:"+JSON.stringify(e)),a(!1)}})}onBegin(e){}onCompleted(e){}onFailed(e){}onEvent(e){}}class c extends s{constructor(){super(...arguments),this.heyGameInfo=window.GameGlobal.heyGameConfig,this.apiName="tt",this.BANNER_ID="o7kd1b3bgbhr858m5m",this.INSERT_ID="1mgikh6fmelf28a1ir",this.VIDEO_ID="1na9h5ojcm9glnirh5",this.TEMPLATE_ID="2o23kwd3e4g1f99ja0",this.isToutiaio=!1,this.recStartTime=0,this.recEndTime=0,this.isInsertAdNew=!1,this.recVideoPath=""}initSdk(){console.log("TTSDK init"),c.instance=this,this.api=Laya.Browser.window[this.apiName],this.appVersion=this.heyGameInfo.versionName,this.resVersion=this.heyGameInfo.resVersion,this.systemInfo=this.api.getSystemInfoSync(),this.isToutiaio="Toutiao"===this.systemInfo.appName,this.screenWidth=this.systemInfo.windowWidth,this.screenHeight=this.systemInfo.windowHeight,console.log("系统信息："+JSON.stringify(this.systemInfo)),this.fs=this.api.getFileSystemManager(),this.isLoginTT(),this.initBannerAd(),this.createInsertAd(),this.createVideoAd(),this.initRecorder()}showLoginDialog(){this.api.showModal({title:"提示",content:"检测到未登录，是否进行登录",success(e){e.confirm?(c.instance.loginTT(!0,null),console.log("confirm, continued")):e.cancel&&console.log("cancel, cold")},fail(e){console.log("showModal调用失败")}})}isLoginTT(){this.loginTT(!1,function(e){e&&c.instance.showLoginDialog()})}loginTT(e,t){this.api.login({force:e,success(e){e.isLogin?null!=t&&t(!1):null!=t&&t(!0),console.log(`login调用成功${e.code} ${e.anonymousCode}`)},fail(e){console.log("login调用失败"),null!=t&&t(!1)}})}initBannerAd(){this.createBannerAd(!1)}createBannerAd(e=!1){if(console.log("isToutiaio:"+this.isToutiaio),this.isToutiaio){this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null);let t=200;this.bannerAd=this.api.createBannerAd({adUnitId:this.BANNER_ID,style:{width:t,top:this.screenHeight-t/16*9}}),this.bannerAd.style.left=(this.screenWidth-t)/2,this.bannerAd.onResize(function(e){console.log(e.width,e.height),c.instance.bannerAd.style.left=(c.instance.screenWidth-e.width)/2,c.instance.bannerAd.style.top=c.instance.screenHeight-e.height}),this.bannerAd.onLoad(()=>{e&&c.instance.showBannerAd()}),this.bannerAd.onError(e=>{console.log("错误监听：",JSON.stringify(e))})}}showBannerAd(e="10"){this.isToutiaio&&(null!=this.bannerAd?(this.bannerAd.show(),this.isFirstInGame=!1):this.createBannerAd(!0))}hideBannerAd(){null!=this.bannerAd&&this.bannerAd.hide()}destroyBannerAd(){null!=this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}createInsertAd(){this.isToutiaio&&(this.isInsertAdNew=!0,null!=this.insertAd&&this.insertAd.destroy(),this.insertAd=this.api.createInterstitialAd({adUnitId:this.INSERT_ID}),this.insertAd.onClose(function(){console.log("插屏广告关闭"),c.instance.createInsertAd(),c.instance.showBannerAd()}),this.insertAd.onError(function(e){console.log("插屏广告出错：",JSON.stringify(e))}))}showInsertAd(e="20"){this.isToutiaio&&(this.isInsertAdNew||this.createInsertAd(),this.insertAd.load().then(()=>{c.instance.hideBannerAd(),c.instance.insertAd.show().catch(e=>{c.instance.showBannerAd("13")})}).catch(e=>{console.log("插屏广告出错:"+e)}),this.isInsertAdNew=!1)}showNativeAd(e="1",t){}onNativeAdClick(e){}onNativeDestroy(){}navigateToMiniGame(e,t,i,a){}createVideoAd(){try{console.log("创建头条激励视频广告"),this.videoAd=this.api.createRewardedVideoAd({adUnitId:this.VIDEO_ID}),this.videoAd.load().then(function(){console.log("ad loaded")}).catch(e=>{console.log("激励视频 广告显示失败")}),this.videoAd.onLoad(e=>{console.log("==> rewardedVideoAd onLoad",JSON.stringify(e))}),this.videoAd.onClose(e=>{e.isEnded?c.instance.videoAdCallBack(0):(c.instance.videoAdCallBack(1),console.log("广告没看完"))}),this.videoAd.onError(e=>{console.log("onError:",e.errMsg)})}catch(e){console.log("wxRewardVideoAd error",e)}}showVideoAd(e="30",t){this.videoAdCallBack=t,this.videoAd&&this.videoAd.show().then(()=>{console.log("广告显示成功")}).catch(e=>{console.log("广告组件出现问题",e),this.videoAd.load().then(()=>{console.log("手动加载成功"),c.instance.videoAd.show()})})}isShowMoreGamesModal(){return"ios"!==this.systemInfo.platform}showMoreGamesModal(){this.api.showMoreGamesModal?this.api.showMoreGamesModal({appLaunchOptions:[],success(e){console.log("success",e.errMsg)},fail(e){console.log("fail",e.errMsg)}}):this.api.showModal({title:"提示",content:"当前客户端版本过低，无法使用该功能，请升级客户端或关闭后重启更新。"})}initRecorder(){this.ttRecorder=this.api.getGameRecorderManager()}startRecorder(){this.recStartTime=this.getSysTime();try{this.ttRecorder.onStart(e=>{console.log("录屏开始")}),this.ttRecorder.start({duration:120})}catch(e){}}stopRecorder(){this.recEndTime=this.getSysTime(),console.log("录屏结束");try{this.ttRecorder.onStop(e=>{console.log("stopRecorder"+e.videoPath),c.instance.recVideoPath=e.videoPath}),this.ttRecorder.stop()}catch(e){}}shareRecorder(e){this.recEndTime-this.recStartTime>=3?0!=this.recVideoPath.length?this.api.shareAppMessage({channel:"video",title:"做一个有节奏的枪王",desc:"跟随节奏射击起来吧",imageUrl:"",templateId:this.TEMPLATE_ID,query:"",extra:{videoPath:this.recVideoPath,videoTopics:["跟随节奏射击起来吧"],withVideoId:!0},success(){console.log("分享视频成功"),e&&e(0)},fail(t){console.log("分享视频失败:"+JSON.stringify(t)),e&&e(1),c.instance.showToastMsg("分享视频失败")}}):c.instance.showToastMsg("视频录制失败"):c.instance.showToastMsg("录屏时长低于3秒")}showToastMsg(e){this.api.showToast({title:e,duration:2e3,success(e){console.log(`${e}`)},fail(e){console.log("showToast调用失败")}})}onBegin(e){console.log("开始第"+e+"关")}onCompleted(e){console.log("结束第"+e+"关")}onFailed(e){console.log("失败第"+e.missionId+"关")}onEvent(e){}cleanCache(e,t){this.fs.getSavedFileList({success(e){let i=0,a=null,s=0;e.fileList.forEach(e=>{e.createTime>s&&(s=e.createTime,a=e),i+=e.size}),i>47185920?c.instance.fs.removeSavedFile({filePath:a.filePath,success(e){console.log(`${a.filePath} 删除成功`),null!=t&&t()},fail(e){console.error(`${a.filePath} 删除失败`,e.errMsg),null!=t&&t()}}):null!=t&&t()},fail(e){console.log("获取缓存资源失败 : "+JSON.stringify(e)),null!=t&&t()}})}fileExist(e){return!1}downloadFile(e,t,i,a,s){t=this.api.env.USER_DATA_PATH+"/"+t;let n=function(){let t=c.instance.api.downloadFile({url:e,success(e){console.log("下载成功 : "+JSON.stringify(e)),200===e.statusCode?o(e.tempFilePath):null!=s&&s()},fail(e){console.log("下载失败 : "+JSON.stringify(e)),null!=s&&s()},complete(){console.log("download complete")}});null!=i&&t.onProgressUpdate(i)},o=function(e){c.instance.fs.saveFile({tempFilePath:e,filePath:t,success(i){null!=a&&a(),console.log(`文件已经从 ${e} 移动到 ${t}`)},fail(e){null!=s&&s(),console.log("保存失败",e.errMsg)}})};this.fs.access({path:t,success(){console.log("有本地文件，直接返回成功"),a&&a()},fail(e){console.log("没有本地文件，需要去服务器下载");let i=t.replace(/\/[^\/]+$/,"");c.instance.fs.access({path:i,success(){console.log("本地有对应的路径，直接开始下载"),n()},fail(e){console.log("本地没有对应的路径，先创建路径在开始下载"),c.instance.fs.mkdir({dirPath:i,recursive:!0,success(){console.log("创建文件夹成功："+i),n()},fail(e){console.log("创建文件夹失败"+i),null!=s&&s()}})}})}})}removeFile(e,t){this.fs.unlink({filePath:this.api.env.USER_DATA_PATH+"/"+e,success(i){console.log(`${e} 删除成功`),null!=t&&t()},fail(i){console.error(`${e} 删除失败`,i.errMsg),null!=t&&t()}})}playMusic(e,t=!0,i=!0,a=1,s=null,n=null){var o=this.api.createInnerAudioContext();o.loop=i,o.volume=a,o.autoplay=!1;var l=function(){null!=s&&s(),null!=n&&o.onEnded(n),o.offCanplay(l),t&&o.play()};return o.onError(e=>{console.log("audio.onError"+JSON.stringify(e))}),o.onCanplay(l),o.src=this.api.env.USER_DATA_PATH+"/"+e,o}musicObj_play(e){e.play()}musicObj_pause(e){e.pause()}musicObj_resume(e){e.play()}musicObj_stop(e){e.stop(),e.destroy()}musicObj_getCurrentTime(e){return Number.parseFloat(e.currentTime)}musicObj_getDuration(e){return e.duration}musicObj_seek(e,t,i){this._seekCallback=i,this._seekAudio=e,this._seekFinishCallback=this.musicObj_seekFinished.bind(this),e.onSeeked(this._seekFinishCallback),e.seek(t)}musicObj_seekFinished(){this._seekAudio.offSeeked(this._seekFinishCallback),null!=this._seekCallback&&(this._seekCallback(this._seekAudio),this._seekCallback=null),this._seekAudio=null}onHide(e){this.api.onHide(e)}offHide(e){this.api.offHide(e)}vibrateLong(){this.api.vibrateLong()}vibrateShort(){this.api.vibrateShort()}}class g extends s{constructor(){super(...arguments),this.apiName="bridge"}initSdk(){console.log("APPSDK initSdk"),g.instance=this,this.api=Laya.Browser.window[this.apiName]}showBannerAd(e="10"){this.api.call("showBannerAd",e)}hideBannerAd(){this.api.call("hideBannerAd","")}showInsertAd(e="20"){this.api.call("showInsertAd",e)}showVideoAd(e="30",t){this.api.call("showVideoAd",e,function(e){t(e)})}}class u extends Laya.Script{constructor(){super(),this._sdk=null,u._instance=this,console.log("GamePlatform constructor"),this.init()}onEnable(){console.log("GamePlatform onEnable")}static get instance(){return u._instance}static get isNativeShow(){return Laya.Browser.onQGMiniGame||Laya.Browser.onVVMiniGame||Laya.Browser.onPC||Laya.Browser.onMobile}static get isShowOtherGame(){return Laya.Browser.onQGMiniGame||Laya.Browser.onPC||Laya.Browser.onMobile}static get isWX(){return Laya.Browser.onMiniGame}static get isTT(){return Laya.Browser.onTTMiniGame}static get isOPPO(){return Laya.Browser.onQGMiniGame}static get isVIVO(){return Laya.Browser.onVVMiniGame}static get isPC(){return Laya.Browser.onPC}static get isSubLoad(){return this.isOPPO}get getPlatformId(){return Laya.Browser.onMiniGame?"WX":Laya.Browser.onTTMiniGame?"TT":Laya.Browser.onQQMiniGame?"QQ":Laya.Browser.onQGMiniGame?"OPPO":Laya.Browser.onVVMiniGame?"VIVO":Laya.Browser.window.DBApp?"APP":"LOCAL"}static get SDK(){return u.instance._sdk||(u.instance._sdk=new n),u.instance._sdk}init(){Laya.Browser.onMiniGame?this._sdk=new o:Laya.Browser.onTTMiniGame?this._sdk=new c:Laya.Browser.onQQMiniGame||(Laya.Browser.onQGMiniGame?this._sdk=new h:Laya.Browser.onVVMiniGame?this._sdk=new d:Laya.Browser.window.DBApp?this._sdk=new g:this._sdk=new n),this._sdk.initSdk()}}class m{constructor(){m._resMap=new Map,t.CUR_PLATFORM==t.WX?(m._remote="https://cdn.xxtch.com/monsterwx/",m._resBasePath=wx.env.USER_DATA_PATH+"/cache/res/",m._fileSystemManager=wx.getFileSystemManager(),m._downloadFile=wx.downloadFile,m._loadSubpackage=wx.loadSubpackage,m._fileSystemManager.access({path:m._resBasePath,fail:()=>{m._fileSystemManager.mkdirSync(m._resBasePath,!0)}})):t.CUR_PLATFORM!=t.OPPO&&t.CUR_PLATFORM!=t.VIVO||(m._remote="https://cdn.xxtch.com/monster/",m._resBasePath=qg.env.USER_DATA_PATH+"/cache/res/",m._fileSystemManager=qg.getFileSystemManager(),m._downloadFile=qg.downloadFile,m._loadSubpackage=qg.loadSubpackage,m._fileSystemManager.access({path:m._resBasePath,fail:()=>{m._fileSystemManager.mkdirSync(m._resBasePath,!0)}}))}static init(){return new Promise(e=>{if(null==m._instance){m._instance=new m;let t=Laya.LocalStorage.getItem("zipVersion");t&&(m._zipVersion=JSON.parse(t));let i="resconfig.json";u.isOPPO?i="opporesconfig.json":u.isWX&&(i="wxresconfig.json"),Laya.loader.load(i,Laya.Handler.create(this,t=>{"string"==typeof t&&(t=JSON.parse(t));for(const e in t)if(t.hasOwnProperty(e)){let i=t[e],a=i[0];for(let t=0;t<a.length;t++){let s=a[t];if("local"==i[1]||"sub"==i[1]){let t="res/"+e+"/"+s;u.isOPPO&&"sub"==i[1]&&(t=e+"/"+s),m._resMap.set(s,new p(s,e,i[1],t))}else{let t=m._resBasePath+s;m._resMap.set(s,new p(s,e+"_"+i[2],i[1],t))}}}console.log(m._resMap),e()}))}})}static getRes(e){return Laya.loader.getRes(m._resMap.get(e).url)}static getResClone(e){return Laya.loader.getRes(m._resMap.get(e).url).clone()}static download(e,t=null){return new Promise(i=>{let a=[],s=[];for(let t=0;t<e.length;t++){let i=e[t],n=m._resMap.get(i);if(n||console.error("找不到资源",i),"sub"==n.location)-1==a.indexOf(n.bundleName)&&-1==m._loadedSubNames.indexOf(n.bundleName)&&a.push(n.bundleName);else if("net"==n.location&&-1==s.indexOf(n.bundleName)){let e=n.bundleName.split("_")[0],t=n.bundleName.split("_")[1];m._zipVersion[e]!=t&&s.push(n.bundleName)}}m._loadSubpackages(a,t).then(()=>{m._downloadFiles(s,t).then(()=>{i()})})})}static create(e,t=null){return new Promise(i=>{m.download(e,t).then(()=>{let a=[];for(let t=0;t<e.length;t++)a.push(m._resMap.get(e[t]));m._createRes(a,a.length,t).then(()=>{i()})})})}static _createRes(e,t,i=null){return new Promise(a=>{if(e.length>0){let s=e.shift(),n=s.name.split(".")[0],o=(t-e.length-1)/t;i&&i({type:"create",progress:o,name:n}),Laya.loader.create(s.url,Laya.Handler.create(this,()=>{o=(t-e.length)/t,i&&i({type:"create",progress:o,name:n}),m._createRes(e,t,i).then(()=>{a()})}),Laya.Handler.create(this,e=>{i&&i({type:"create",progress:o,name:n})}))}else a()})}static loadSpines(e){return new Promise(t=>{let i=[];if(e&&e.length>0){let a=e.shift();m.download([a]).then(()=>{let s=new Laya.Skeleton;i.push(s),s.load(m._resMap.get(a).url,Laya.Handler.create(this,()=>{m.loadSpines(e).then(e=>{t(i.concat(e))})}))})}else t(i)})}static loadFonts(e){return new Promise(t=>{if(e&&e.length>0){let i=e.shift();m.download([i]).then(()=>{let a=new Laya.BitmapFont;a.loadFont(m._resMap.get(i).url,Laya.Handler.create(this,a=>{a.setSpaceWidth(10),a.autoScaleSize=!0,Laya.Text.registerBitmapFont(i.split(".")[0],a),m.loadFonts(e).then(()=>{t()})},[a]))})}else t()})}static playSound(e,t=1,i=null,a=null,s=0){m.download([e]).then(()=>Laya.SoundManager.playSound(m._resMap.get(e).url,t,i,a,s))}static playMusic(e,t=0,i=null,a=0){m.download([e]).then(()=>Laya.SoundManager.playMusic(m._resMap.get(e).url,t,i,a))}static _loadSubpackages(e,t=null){return new Promise(i=>{if(e.length>0){let a=e.shift(),s=0;t&&t({type:"download",progress:s,location:"sub",name:a}),m._loadSubpackage({name:a,success:n=>{m._loadedSubNames.push(a),s=1,t&&t({type:"download",progress:s,location:"sub",name:a}),m._loadSubpackages(e,t).then(()=>{i()})},fail:e=>{console.log("loadSubpackageFail",e)}}).onProgressUpdate(e=>{s=(s=e.progress>s?e.progress:s)<1?s:1,t&&t({type:"download",progress:s,location:"sub",name:a,totalBytesWritten:e.totalBytesWritten,totalBytesExpectedToWrite:e.totalBytesExpectedToWrite})})}else i()})}static _downloadFiles(e,t=null){return new Promise(i=>{if(e.length>0){let a=e.shift(),s=a.split("_")[0],n=a.split("_")[1],o=0;t&&t({type:"download",progress:o,location:"net",name:s});let l=m._resBasePath+a+".zip";m._downloadFile({url:m._remote+a+".zip",filePath:l,success:a=>{200===a.statusCode&&m._fileSystemManager.unzip({zipFilePath:l,targetPath:m._resBasePath,success:a=>{m._zipVersion[s]=n,Laya.LocalStorage.setItem("zipVersion",JSON.stringify(m._zipVersion)),o=1,t&&t({type:"download",progress:o,location:"net",name:s}),m._fileSystemManager.unlink({filePath:l}),m._downloadFiles(e,t).then(()=>{i()})},fail:e=>{}})},fail:e=>{}}).onProgressUpdate(e=>{let i=e.progress/100;o=(o=i>o?i:o)<1?o:1,t&&t({type:"download",progress:o,location:"net",name:s})})}else i()})}}m._instance=null,m._fileSystemManager=null,m._resBasePath=null,m._downloadFile=null,m._loadSubpackage=null,m._remote="",m._resMap=null,m._loadedSubNames=[],m._zipVersion={};class p{constructor(e,t,i,a){this._location=null,this._bundleName=null,this._url=null,this._name=null,this._name=e,this._location=i,this._bundleName=t,this._url=a}get location(){return this._location}get bundleName(){return this._bundleName}get url(){return this._url}get name(){return this._name}}class A{constructor(){Laya.Scene.root,Laya.Dialog.manager,A._uiScene=new Laya.Sprite,A._underRoot=new Laya.Sprite,A._underRoot.name="underRoot",Laya.stage.addChildAt(A._underRoot,0),A._upRoot=new Laya.Sprite,A._upRoot.name="upRoot",Laya.stage.addChildAt(A._upRoot,2),A._upDialogManager=new Laya.Sprite,A._upDialogManager.name="upDialogManager",A._upDialogManager.zOrder=1001,Laya.stage.updateZOrder()}static init(){A._sceneManager||(A._sceneManager=new A)}static open(e){let t=new e;return t.open(),t}static close(e){for(let t=0;t<Laya.Dialog.manager.numChildren;t++){let i=Laya.Dialog.manager.getChildAt(t);if(i instanceof e)return void i.close()}for(let t=0;t<Laya.Scene.root.numChildren;t++){let i=Laya.Scene.root.getChildAt(t);if(i instanceof e)return void i.close()}}static get uiScene(){return A._uiScene}static get underRoot(){return A._underRoot}static get upRoot(){return A._upRoot}static get upDialogManager(){return A._upDialogManager}}class y{constructor(){}static init(){null==y._instance&&(y._instance=new y,Laya.loader.load("shaderconfig.json",Laya.Handler.create(this,e=>{for(const t in e)if(e.hasOwnProperty(t)){const i=e[t];for(let e=0;e<i.length;e++){let a=i[e],s=new Laya.ShaderVariant(Laya.Shader3D.find(t),a.subShaderIndex,a.passIndex,a.defineNames);Laya.Shader3D.debugShaderVariantCollection.add(s)}}Laya.Shader3D.debugShaderVariantCollection.compile()})))}}y._instance=null;class w{constructor(){this._curStage=[2,0]}static get instance(){if(!w._instance){let e=localStorage.getItem("UserData");w._instance=new w;let t=null;e&&e.length>0&&(t=JSON.parse(e)),w._instance.init(t),window.UserDataManager=w._instance}return w._instance}init(e){if(e)for(const t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}get curStage(){return this._curStage}set curStage(e){w.instance.changeValue("_curStage",e)}changeValue(t,i){this[t]=i,localStorage.setItem("UserData",JSON.stringify(w._instance)),e.event(l.UserDataChange,t)}}var f,L=Laya.View,v=Laya.ClassUtils.regClass;!function(e){!function(e){class t extends L{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/load")}}e.loadUI=t,v("ui.pages.loadUI",t);class i extends L{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/main")}}e.mainUI=i,v("ui.pages.mainUI",i)}(e.pages||(e.pages={}))}(f||(f={}));class S extends f.pages.loadUI{onAwake(){t.init(),A.init(),y.init(),e.init(),m.init().then(()=>{m.loadSpines(["Ui_JiaZai.sk"]).then(e=>{let t=e[0];this.addChild(t),t.x=Laya.stage.width/2+100,t.y=this.progressBar.y-100,t.play(0,!0)});let e=["CaiDai.lh","Package.lh","Package1.lh","Box0.lh","Box1.lh","Box2.lh","Box3.lh","Box4.lh","Box5.lh","Part1.lh","MainCamera.lh","MainLight.lh","GameScene.ls"],t=w.instance.curStage,i=t[0]<5?t[0]:5,a=[];for(let e=0;e<i;e++)a.push(`Level${e+1}.lh`);e=e.concat(a),m.loadFonts(["Num.fnt","MoneyNum.fnt"]).then(()=>{m.create(e,this.onProgress.bind(this)).then(()=>{Laya.Scene.open("pages/main.scene")})})})}onProgress(e){this.progressMask.width=595*e.progress}}class E extends Laya.Script3D{onAwake(){this.scene3d=this.owner,this.camera=this.scene3d.getChildByName("MainCamera"),this.light=this.scene3d.getChildByName("MainLight")}convert3DTo2DPosition(e){let t=new Laya.Vector4;return this.camera.viewport.project(e.transform.position,this.camera.projectionViewMatrix,t),new Laya.Point(t.x/Laya.stage.clientScaleX,t.y/Laya.stage.clientScaleY)}}class P{static findNodeByUrl(e,t){let i=t.split("/"),a=e;for(let e=0;e<i.length;e++)a=a.getChildByName(i[e]);return a}static findNodeByName(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);return a.name==t?a:this.findNodeByName(a,t)}}static findNodeByType(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);return a instanceof t?a:this.findNodeByType(a,t)}}static findNodesByType(e,t){let i=[];for(let a=0;a<e.numChildren;a++){let s=e.getChildAt(a);s instanceof t&&i.push(s),s.numChildren>0&&(i=i.concat(this.findNodeByType(s,t)))}return i}static getComponent(e,t){return e.getComponent(t)}static getComponents(e,t){return e.getComponents(t)}static getComponentInChildren(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i),s=this.getComponent(a,t);return s||this.getComponentInChildren(a,t)}}static getComponentsInChildren(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i),s=this.getComponents(a,t);return s||this.getComponentsInChildren(a,t)}}static tweenTo(e,t,i,a,s){let n={};for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){n[i+"Start"]=e.transform[i].clone();let a=new Laya.Vector3;a.x=-e.transform[i].x+t[i].x,a.y=-e.transform[i].y+t[i].y,a.z=-e.transform[i].z+t[i].z,n[i+"Diff"]=a}let o={value:0};return Laya.Tween.to(o,{value:1,update:Laya.Handler.create(this,()=>{for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let t=new Laya.Vector3,a=new Laya.Vector3;Laya.Vector3.scale(n[i+"Diff"],o.value,a),Laya.Vector3.add(n[i+"Start"],a,t),e.transform[i]=t,"localRotationEuler"==i&&console.log(t)}},null,!1)},i,a,s)}static projectPos(e,t){let i=new Laya.Vector4;return e.viewport.project(t,e.projectionViewMatrix,i),i}}class C{static fixNumber(e,t){return e?-1!=e.toString().indexOf(".")?Number(e.toFixed(t)):e:0}static getRandom(e,t){return Math.floor(e+Math.random()*(t-e+1))}}class O{}class b extends E{constructor(){super(...arguments),this.legoRoot=null,this.originalLEGO=null,this.originalLEGOPart=null,this.cloneLEGO=null,this.originalLEGOModel=null,this.originalLEGOPartArr=null,this.packArr=null,this.cloneLEGOPartArr=null,this.cloneLEGOPartMap=null,this.holoMaterial=null,this.originalMaterial=null,this.box=null,this.boxAnimator=null,this.plank=null,this.holoPart=null,this.middlePartNum=0,this.smallPartNum=0,this.curMiddleIndex=0,this.curSmallIndex=0,this.mainScene=null,this.boxNode=null,this.smallPartNode=null,this.packSelect=null,this.packSelectAnimator=null,this.isRotateFinishLEGO=!1,this.shopNode=null,this.plankNode=null,this.showCaseNode=null,this.fireWork=null,this.isPlayingOpenBox=!1,this.mouseEventType=0,this.isPlayingOpenPack=!1,this.lastSlideX=-1,this.packNode=null,this.isFinishSlide=!1,this.cloneLEGOScaleArr=null}onAwake(){super.onAwake(),this.initScene3d(),this.initShowCase(),this.getHoloMat(),this.initLevelData(),window.GameRuntime=this;let t=w.instance.curStage;0==t[1]?(this.moveCamera(1,!1),window.MainRuntime.startBtn.visible=!0,window.MainRuntime.buildBtn.visible=!1,this.curMiddleIndex=0):(this.initDesk(),this.moveCamera(2,!1),this.curMiddleIndex=t[1]-1,window.MainRuntime.startBtn.visible=!1,window.MainRuntime.logo.visible=!1,window.MainRuntime.showViewAdBtn(),Laya.timer.once(750,this,()=>{window.MainRuntime.buildBtn.visible=!0,this.curMiddleIndex,this.originalLEGOPartArr.length,window.MainRuntime.videoLogo.visible=!1})),e.on(l.GAME_START,this,this.onGameStart),e.on(l.OPEN_BOX,this,this.onOpenBox)}noThanks(){let e=this.getPlacePos(1);this.playFinishFirework(e),window.MainRuntime.buildBtn.visible=!1,this.finishLevel()}onUpdate(){this.rotateFinishLEGO()}onStartBuild(t){window.MainRuntime.buildBtn.visible=!1,e.off(l.START_BUILD,this,this.onOpenBox),this.moveNewPack()}onOpenBox(e){e.type==Laya.Event.MOUSE_DOWN?(this.isPlayingOpenBox||(this.showKnife(this.box,!0),this.moveCamera(6,!0,-1),this.isPlayingOpenBox=!0,this.boxAnimator.play("Open1",0,0),Laya.timer.frameLoop(3,this,this.checkOpenBoxPlayFinish)),this.boxAnimator.speed=1):e.type==Laya.Event.MOUSE_OUT&&(this.boxAnimator.speed=0)}checkOpenBoxPlayFinish(){if(this.boxAnimator.getControllerLayer(0).getCurrentPlayState().normalizedTime>=1){let t=w.instance.curStage;t[1]=1,w.instance.curStage=t,Laya.timer.clear(this,this.checkOpenBoxPlayFinish),e.off(l.OPEN_BOX,this,this.onOpenBox),window.MainRuntime.openTipClose.play(0,!1),this.boxAnimator.speed=1,this.boxAnimator.play("Open2",0,0),Laya.timer.once(100,this,()=>{m.playSound("shake.mp3")}),this.createBoxPackage(),this.dropPack(),Laya.timer.once(800,this,()=>{this.moveCamera(2,!0,-1),window.MainRuntime.showViewAdBtn(),Laya.timer.once(2e3,this,()=>{window.MainRuntime.buildBtn.visible=!0,window.MainRuntime.noThanks.visible=!1,window.MainRuntime.videoLogo.visible=!1,e.on(l.START_BUILD,this,this.onStartBuild)})}),Laya.timer.once(4e3,this,()=>{this.box.removeSelf()})}}onGameStart(){if(w.instance.curStage[0]>5)return;window.MainRuntime.startBtn.visible=!1,window.MainRuntime.logo.visible=!1,Laya.stage.mouseEnabled=!1;let e=w.instance.curStage[0];this.moveCamera(5,!0,e).then(()=>{let e=this.box.transform.position.clone();e.z+=.2,this.moveAndRotPart(this.box,e,null,null,500,Laya.Ease.sineOut).then(()=>{Laya.timer.once(500,this,()=>{m.playSound("throwBox.mp3")}),this.moveCamera(2,!0,-1).then(()=>{this.box.transform.rotationEuler=new Laya.Vector3(0,16,0),this.box.transform.position=new Laya.Vector3(0,0,1);let e=new Laya.Vector3(-1.58,0,.8);e.y+=.2,this.moveAndRotPart(this.box,e,null,null,500,Laya.Ease.sineOut).then(()=>{e.y-=.2,this.moveAndRotPart(this.box,e,null,null,500,Laya.Ease.backIn).then(()=>{window.MainRuntime.openTipOpen.play(0,!1),this.originalLEGO.transform.position=this.getPlacePos(1)})})})})})}moveNewPack(){return new Promise(t=>{if(0==this.packArr.length)return;window.MainRuntime.progressClose.play(0,!1),e.off(l.MOUSE_EVENT,this,this.onMouseEvent),this.isPlayingOpenPack=!1,this.moveCamera(3,!0),this.packSelect=this.packArr.shift(),this.packSelectAnimator=this.packSelect.getComponent(Laya.Animator);let i=this.plank.transform.position.clone();i.y+=.1;let a=this.getClosestRot(this.packSelect.transform.localRotationEuler,new Laya.Vector3(-60,0,0));this.moveAndRotPart(this.packSelect,i,a,null,1e3,Laya.Ease.sineOut).then(()=>{window.MainRuntime.packOpen.play(0,!1),this.mouseEventType=1,e.on(l.MOUSE_EVENT,this,this.onMouseEvent),Laya.timer.frameLoop(5,this,this.checkOpenPack)})})}checkOpenPack(){this.packSelectAnimator.speed=0;let t=this.packSelectAnimator.getControllerLayer(0).getCurrentPlayState();"Open1"==t.animatorState.name&&t.normalizedTime>=1&&(e.off(l.MOUSE_EVENT,this,this.onMouseEvent),Laya.timer.clear(this,this.checkOpenPack),this.packSelectAnimator.speed=1,this.packSelectAnimator.play("Open2"),window.MainRuntime.packClose.play(0,!1),this.sortCloneLEGO(),this.getNormalizeScale(),this.disassembleCloneLEGO(),this.dropModelPart(),Laya.timer.once(1e3,this,()=>{Laya.timer.once(3e3,this,()=>{this.originalLEGOModel=this.getOriginalLegoModel(this.curMiddleIndex+1),this.mainScene.addChild(this.originalLEGOModel),this.refreshOriginalLEGOScale(this.originalLEGOModel);let t=this.getPlacePos(0),i=this.getModelPos();t.x+=-i.x,t.y+=-i.y,t.z+=-i.z,this.originalLEGOModel.transform.position=t,this.createPartNums(),window.MainRuntime.slideOpen.play(0,!1),Laya.timer.once(500,this,()=>{this.showFindPart(),this.showHoloPart(),this.mouseEventType=0,e.on(l.MOUSE_EVENT,this,this.onMouseEvent)})})}),Laya.timer.once(4e3,this,()=>{this.packSelect.destroy(),this.packSelect=null,this.packSelectAnimator=null}))}dropModelPart(){for(let e=0;e<this.cloneLEGOPartMap.length;e++)for(let t=0;t<this.cloneLEGOPartMap[e].length;t++){let i=this.cloneLEGOPartMap[e][t],a=this.cloneLEGOScaleArr[e][t].clone();Laya.Vector3.scale(a,1,a);let s=i.transform.position.clone();this.plank.addChild(i),i.transform.position=s,i.getChildByName("Point");let n=i.getChildByName("Point").transform.localPosition,o=this.getArrangePos(e);o.y+=.05,o.x-=n.x*i.transform.localScaleX,o.y-=n.y*i.transform.localScaleY,o.z-=n.z*i.transform.localScaleZ,this.dropPart(i,o,a)}Laya.timer.once(1500,this,()=>{m.playSound("dropPack.mp3")})}getHoloMat(){let e=m.getRes("Part1.lh");this.holoMaterial=e.meshRenderer.material}onDestroy(){e.off(l.MOUSE_EVENT,this,this.onMouseEvent)}onMouseEvent(t){if(0==this.mouseEventType){if(t.type==Laya.Event.MOUSE_DOWN){let i=this.getSelectPart(t.stageX,t.stageY);if(i){m.playSound("partClick.mp3"),i.active=!0;let t=this.getNormalizeRot(this.holoPart.transform.localRotationEuler),a=this.getClosestRot(i.transform.localRotationEuler,t),s=this.getUpDirPos(this.holoPart.transform,.05),n=this.holoPart.transform.localPosition.clone(),o=i.transform.position;this.holoPart.parent.addChild(i),i.transform.position=o,Laya.MouseManager.enabled=!1,m.playSound("partFly.mp3"),this.moveAndRotPart(i,s,a,new Laya.Vector3(1,1,1),500,Laya.Ease.sineOut).then(()=>{Laya.timer.once(50,this,()=>{m.playSound("partDrop.mp3"),this.moveAndRotPart(i,n,a,null,250,Laya.Ease.backIn).then(()=>{if(i.destroy(),this.changePartMat(this.holoPart,!1),this.curSmallIndex++,this.curSmallIndex==this.originalLEGOPartArr[this.curMiddleIndex].length){this.curSmallIndex=0,this.curMiddleIndex++,window.MainRuntime.clearPartNumNode(),window.MainRuntime.clearShowRoot(),window.MainRuntime.slideClose.play(0,!1),e.off(l.MOUSE_EVENT,this,this.onMouseEvent),this.moveCamera(2,!0,-1).then(()=>{});let t=this.getPlacePos(1);t.y+=.1,this.moveAndRotPart(this.originalLEGOModel,t,null,null,1e3,Laya.Ease.sineOut).then(()=>{this.originalLEGO.addChild(this.originalLEGOModel),this.originalLEGOModel.transform.localPosition=new Laya.Vector3(0,.1,0),this.mouseEventType=2,window.MainRuntime.slideDownTip.visible=!0,e.on(l.MOUSE_EVENT,this,this.onMouseEvent)})}else this.showFindPart(),this.showHoloPart();Laya.timer.frameOnce(1,this,()=>{Laya.MouseManager.enabled=!0})})})})}else console.error("未选中")}}else if(1==this.mouseEventType)t.type==Laya.Event.MOUSE_MOVE?this.isPlayingOpenPack?t.stageX>this.lastSlideX&&(this.lastSlideX=t.stageX,this.packSelectAnimator.speed=1):(this.isPlayingOpenPack=!0,this.packSelectAnimator.play("Open1",0,0),this.packSelectAnimator.speed=1,this.lastSlideX=t.stageX):t.type==Laya.Event.MOUSE_UP?this.lastSlideX=-1:t.type==Laya.Event.MOUSE_DOWN&&(this.lastSlideX=t.stageX);else if(2==this.mouseEventType&&t.type==Laya.Event.MOUSE_MOVE){let t=this.originalLEGOModel.transform.position.clone();t.y-=.005,this.originalLEGOModel.transform.position=t,t.y<=0&&(e.off(l.MOUSE_EVENT,this,this.onMouseEvent),this.originalLEGOModel.transform.localPosition=new Laya.Vector3,this.playFinishFirework(this.originalLEGOModel.transform.position),window.MainRuntime.slideDownTip.visible=!1,this.finishModel(),window.MainRuntime.progressOpen.play(0,!1),Laya.timer.once(200,this,()=>{window.MainRuntime.setProgress(this.curMiddleIndex/this.originalLEGOPartArr.length)}),this.curMiddleIndex==this.originalLEGOPartArr.length?(m.playSound("firework.mp3"),this.finishLevel()):(m.playSound("finish.mp3"),window.MainRuntime.showViewAdBtn(),Laya.timer.once(750,this,()=>{window.MainRuntime.buildBtn.visible=!0,this.curMiddleIndex,this.originalLEGOPartArr.length,window.MainRuntime.videoLogo.visible=!1})))}}finishLevel(){let e=w.instance.curStage;e[0]++,e[1]=0,w.instance.curStage=e,window.MainRuntime.continueBtn.visible=!0,this.isRotateFinishLEGO=!0}finishModel(){let e=w.instance.curStage;e[1]++,w.instance.curStage=e}placeFinishLEGOShowCase(){window.MainRuntime.continueBtn.visible=!1,this.isRotateFinishLEGO=!1;let e=w.instance.curStage,t=this.getShopCell(e[0]-1);t.z+=.2,this.originalLEGO.transform.localRotationEuler=new Laya.Vector3,this.originalLEGO.transform.localScale=new Laya.Vector3(.75,.75,.75),this.moveAndRotPart(this.originalLEGO,t,null,null,1e3,Laya.Ease.sineOut).then(()=>{this.clearDesk(),t.z-=.2,this.moveAndRotPart(this.originalLEGO,t,null,null,1e3,Laya.Ease.sineOut).then(()=>{if(window.MainRuntime.logo.visible=!0,window.MainRuntime.progressClose.play(!0,0),this.moveCamera(1,!0,-1),this.showCaseNode.addChild(this.originalLEGO),this.originalLEGO=null,e[0]>5)Laya.timer.once(1e3,this,()=>{window.MainRuntime.startBtn.visible=!0});else{let t=`Level${e[0]}.lh`;m.create([t]).then(()=>{this.initLevelData(),window.MainRuntime.startBtn.visible=!0})}})}),this.moveCamera(5,!0,e[0]-1)}analysisLEGO(e){let t=m.getRes(e);this.legoRoot=this.createLegoRoot(t,null),console.log(this.legoRoot)}createLegoRoot(e,t){let i=new O;if(i.name=e.name,i.position=e.transform.localPosition.clone(),i.rotationEuler=e.transform.localRotationEuler.clone(),e.numChildren>0){i.child=[];for(let t=0;t<e.numChildren;t++){let a=e.getChildAt(t);i.child.push(this.createLegoRoot(a,i))}}return i}hideOriginalLEGOPart(e){if(e.numChildren>0)for(let t=0;t<e.numChildren;t++){let i=e.getChildAt(t);this.hideOriginalLEGOPart(i)}else"Point"!=e.name&&(e.parent.active=!1)}getNormalizeScale(){this.cloneLEGOScaleArr=[];for(let e=0;e<this.cloneLEGOPartMap.length;e++){let t=[];for(let i=0;i<this.cloneLEGOPartMap[e].length;i++){let a=this.cloneLEGOPartMap[e][i];t.push(a.transform.localScale.clone())}this.cloneLEGOScaleArr.push(t)}}mapLEGOPart(e){let t=[];if(e.numChildren>2)for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);a.numChildren>2?t.push(this.mapLEGOPart(a)):"Point"!=a.name&&t.push(a)}return t}analysisLEGOData(){this.middlePartNum=0,this.smallPartNum=0,this.middlePartNum=this.originalLEGOPartArr.length;for(let e=0;e<this.originalLEGOPartArr.length;e++){let t=this.originalLEGOPartArr[e];this.smallPartNum+=t.length}console.log(`该乐高由${this.middlePartNum}个中部件和${this.smallPartNum}个小部件组成`)}getLEGOPart(e,t){return this.originalLEGOPartArr[e][t]}changePartMat(e,t){let i=e.getChildAt(0);t?(this.originalMaterial=i.meshRenderer.material,i.meshRenderer.material=this.holoMaterial):i.meshRenderer.material=this.originalMaterial}disassembleCloneLEGO(){if(!this.packNode){this.packNode=new Laya.Sprite3D,this.scene3d.addChild(this.packNode);let e=this.plank.transform.position.clone();e.y+=.3,this.packNode.transform.position=e}for(let e=0;e<this.cloneLEGOPartArr[this.curMiddleIndex].length;e++){let t=this.cloneLEGOPartArr[this.curMiddleIndex][e];t.transform.localPosition=this.getRandomPos(),t.transform.localRotationEuler=this.getRandomRot(),t.transform.localScale=new Laya.Vector3,this.packNode.addChild(t)}}sortCloneLEGO(){this.cloneLEGOPartMap=[];let e=[];for(let t=0;t<this.cloneLEGOPartArr[this.curMiddleIndex].length;t++){let i=this.cloneLEGOPartArr[this.curMiddleIndex][t],a=i.name.split("_"),s=e.indexOf(a[3]),n=null;-1==s?(n=[],this.cloneLEGOPartMap.push(n),e.push(a[3]),i.active=!0):(n=this.cloneLEGOPartMap[s],i.active=!1),n.push(i)}let t=this.cloneLEGOPartMap.length,i=this.cloneLEGOPartMap.length;for(let e=0;e<t;e++)i--,this.cloneLEGOPartMap.push(this.cloneLEGOPartMap.splice(C.getRandom(0,i),1)[0])}dropPart(e,t,i){let a=e.transform.localPosition.clone();a.y=.2;let s=500*Math.random();Laya.timer.once(s,this,()=>{this.moveAndRotPart(e,a,null,i,1e3,Laya.Ease.sineIn).then(()=>{t&&this.moveAndRotPart(e,t,new Laya.Vector3(-90,0,0),null,1e3,Laya.Ease.sineIn).then(()=>{})})},null,!1)}dropSingle(e,t){let i=500*Math.random();Laya.timer.once(i,this,()=>{this.moveAndRotPart(e,t,null,new Laya.Vector3(1,1,1),1e3,Laya.Ease.sineIn).then(()=>{})},null,!1)}getRandomPos(){let e=new Laya.Vector3;return e.x=0*Math.random()-0,e.y=0*Math.random()-0,e.z=0*Math.random()-0,e}getRandomRot(){let e=new Laya.Vector3;return e.x=360*Math.random(),e.y=360*Math.random(),e.z=360*Math.random(),e}showHoloPart(){this.curMiddleIndex!=this.middlePartNum&&(this.holoPart=this.getLEGOPart(this.curMiddleIndex,this.curSmallIndex),this.holoPart.active=!0,this.changePartMat(this.holoPart,!0))}showFindPart(){if(this.curMiddleIndex==this.middlePartNum)return;let e=this.getLEGOPart(this.curMiddleIndex,this.curSmallIndex).clone();e.transform.localScale=new Laya.Vector3(5,5,5),window.MainRuntime.addLEGOPart(e)}moveAndRotPart(e,t,i,a,s,n){return new Promise(o=>{let l=Laya.Handler.create(this,()=>{o()}),r={};t&&(r.localPosition=t),i&&(r.localRotationEuler=i),a&&(r.localScale=a),P.tweenTo(e,r,s,n,l)})}getNormalizeRot(e){let t=new Laya.Vector3;return t.x=(e.x%360+360)%360,t.y=(e.y%360+360)%360,t.z=(e.z%360+360)%360,t}getClosestRot(e,t){let i=new Laya.Vector3;return Math.abs(t.x-e.x)>180?e.x<180?i.x=t.x-360:i.x=t.x+360:i.x=t.x,Math.abs(t.y-e.y)>180?e.y<180?i.y=t.y-360:i.y=t.y+360:i.y=t.y,Math.abs(t.z-e.z)>180?e.z<180?i.z=t.z-360:i.z=t.z+360:i.z=t.z,i}getSelectPart(e,t){for(let i=0;i<this.cloneLEGOPartMap.length;i++)for(let a=0;a<this.cloneLEGOPartMap[i].length;a++){let s=this.cloneLEGOPartMap[i][a],n=this.convert3DTo2DPosition(s);if(e>=n.x-75&&e<=n.x+75&&t>=n.y-75&&t<=n.y+75)return this.judgeRight(s)?(s=this.cloneLEGOPartMap[i].splice(0,1)[0],this.cloneLEGOPartMap[i].length>0&&(this.cloneLEGOPartMap[i][0].active=!0),window.MainRuntime.updatePartNumLabel(i,this.cloneLEGOPartMap[i].length),s):(console.error("选择不正确"),null)}return null}getUpDirPos(e,t){let i=e.localPosition.clone(),a=new Laya.Vector3(0,1,0);return Laya.Vector3.scale(a,t,a),Laya.Vector3.add(i,a,i),i}getArrangePos(e){let t=this.cloneLEGOPartMap.length,i=Math.ceil(Math.sqrt(t)),a=.53/(i+1),s=.73/(Math.ceil(t/i)+1),n=new Laya.Vector3;n.x=-.265,n.z=-.365;let o=e%i,l=Math.floor(e/i),r=new Laya.Vector3;return r.x=n.x+a*(o+1),r.z=n.z+s*(l+1),r}moveCamera(e,t,i=-1){return new Promise(a=>{let s=null,n=null;if(1==e?(s=new Laya.Vector3(6.8,.33,3.55),n=new Laya.Vector3(-5.5,0,0)):2==e?(s=new Laya.Vector3(-1.6,1.6,1.9),n=new Laya.Vector3(-44,0,0)):3==e?(s=new Laya.Vector3(0,1.4,1.32),n=new Laya.Vector3(-55,0,0)):4==e?(s=new Laya.Vector3(-1.68,.95,1.27),n=new Laya.Vector3(-33.5,0,0)):5==e?((s=this.getShopCell(i)).z+=1,n=new Laya.Vector3(-5.5,0,0)):6==e&&(s=new Laya.Vector3(-1.6,1.6,1.9),n=new Laya.Vector3(-44,0,0)),t){let e={};s&&(e.localPosition=s),n&&(e.localRotationEuler=n),P.tweenTo(this.camera,e,1e3,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{a()}))}else s&&(this.camera.transform.localPosition=s),n&&(this.camera.transform.localRotationEuler=n)})}getShopCell(e){return P.findNodeByUrl(this.scene3d,`MainScene/Point/Point_Level${e}`).transform.position.clone()}playOpenBox(e){e.getChildByName("Box").getComponent(Laya.Animator).play("Open")}showKnife(e,t){P.findNodeByUrl(e,"Box/Bone002/Knife1").active=t}createBoxPackage(){if(this.packArr=[],!this.boxNode){let e=P.findNodeByUrl(this.box,"Box/Bone001/Box1_Body");this.boxNode=new Laya.Sprite3D,e.addChild(this.boxNode),this.boxNode.transform.localPosition=new Laya.Vector3}for(let e=0;e<this.originalLEGOPartArr.length;e++){let t=null;(t=e==this.originalLEGOPartArr.length-1?m.getResClone("Package1.lh"):m.getResClone("Package.lh")).transform.localPosition=this.getRandomPos(),t.transform.localRotationEuler=new Laya.Vector3(90,360*Math.random(),0),t.transform.localScale=new Laya.Vector3,this.boxNode.addChild(t),this.packArr.push(t)}}dropPack(){for(let e=0;e<this.packArr.length;e++){let t=this.packArr[e],i=t.transform.position.clone();this.mainScene.addChild(t),t.transform.localPosition=i;let a=new Laya.Vector3(-1.58,0,.7);a.y=0,this.dropSingle(t,a)}Laya.timer.once(1500,this,()=>{m.playSound("dropPack.mp3")})}judgeRight(e){return this.holoPart.name.split("_")[3]==e.name.split("_")[3]}initLevelData(){let e=w.instance.curStage,t=`Level${e[0]}.lh`;this.box=m.getRes(`Box${e[0]}.lh`),this.boxAnimator=this.box.getChildByName("Box").getComponent(Laya.Animator),this.originalLEGO=m.getRes(t),this.cloneLEGO=this.originalLEGO.clone(),this.hideOriginalLEGOPart(this.originalLEGO),this.originalLEGOPartArr=this.mapLEGOPart(this.originalLEGO),this.cloneLEGOPartArr=this.mapLEGOPart(this.cloneLEGO),this.analysisLEGOData(),this.scene3d.addChild(this.originalLEGO),this.showKnife(this.box,!1),e[1]>0?this.curMiddleIndex=e[1]-1:this.curMiddleIndex=0}rotateFinishLEGO(){this.isRotateFinishLEGO&&this.originalLEGO&&this.originalLEGO.transform.rotate(new Laya.Vector3(0,.01,0))}playFinishFirework(e){let t=this.fireWork.clone();t.transform.position=e,this.scene3d.addChild(t),Laya.timer.once(5e3,this,()=>{t.destroy()})}initShowCase(){let e=w.instance.curStage,t=new Laya.Vector3(90,-16,0);this.showCaseNode||(this.showCaseNode=new Laya.Sprite3D,this.showCaseNode.name="showCaseNode",this.scene3d.addChild(this.showCaseNode));for(let i=1;i<5;i++){let a=m.getRes(`Box${i+1}.lh`),s=m.getRes(`Level${i+1}.lh`),n=this.getShopCell(i+1);i+1==e[0]?0==e[1]&&(this.showCaseNode.addChild(a),a.transform.position=n,a.transform.localScale=new Laya.Vector3(.5,.5,.5),a.transform.localRotationEuler=t.clone(),this.showKnife(a,!1)):i+1<e[0]?(this.showCaseNode.addChild(s),s.transform.position=n,s.transform.localScale=new Laya.Vector3(.75,.75,.75)):(this.showCaseNode.addChild(a),a.transform.position=n,a.transform.localScale=new Laya.Vector3(.5,.5,.5),a.transform.localRotationEuler=t.clone(),this.showKnife(a,!1))}}initDesk(){let t=w.instance.curStage;if(0!=t[1]){this.packArr=[],this.originalLEGO.transform.position=this.getPlacePos(1),this.scene3d.addChild(this.originalLEGO);for(let e=0;e<t[1]-1;e++){let t=this.originalLEGO.getChildByName("Modle"+(e+1));for(let e=0;e<t.numChildren;e++){t.getChildAt(e).active=!0}this.refreshOriginalLEGOScale(t)}for(let e=t[1]-1;e<this.middlePartNum;e++){let t=null;t=e==this.originalLEGOPartArr.length-1?m.getResClone("Package1.lh"):m.getResClone("Package.lh");let i=new Laya.Vector3(-1.58,0,.7);t.transform.localPosition=i,t.transform.localRotationEuler=new Laya.Vector3(90,360*Math.random(),0),this.mainScene.addChild(t),this.packArr.push(t)}e.on(l.START_BUILD,this,this.onStartBuild)}}clearDesk(){if(this.packArr&&this.packArr.length>0){for(let e=0;e<this.packArr.length;e++)this.packArr[e].destroy();this.packArr=[]}}initScene3d(){this.mainScene=P.findNodeByUrl(this.scene3d,"MainScene"),this.plank=P.findNodeByUrl(this.scene3d,"MainScene/Plank1"),this.fireWork=m.getRes("CaiDai.lh")}createPartNums(){for(let e=0;e<this.cloneLEGOPartMap.length;e++){let t=this.cloneLEGOPartMap[e],i=this.convert3DTo2DPosition(t[0]);window.MainRuntime.createPartNum(t.length,i)}}getOriginalLegoModel(e){return this.originalLEGO.getChildByName(`Modle${e}`)}getPlacePos(e){return 0==e?P.findNodeByUrl(this.scene3d,"MainScene/Point/Place").transform.position.clone():1==e?P.findNodeByUrl(this.scene3d,"MainScene/Point/Place2").transform.position.clone():void 0}getModelPos(){return P.findNodeByUrl(this.originalLEGOModel,"Point").transform.localPosition.clone()}refreshOriginalLEGOScale(e){for(let t=0;t<e.numChildren;t++){e.getChildAt(t).transform.localScale=new Laya.Vector3(1,1,1)}}}class M extends Laya.Box{constructor(){super(),this.adData=null,this.closeCallback=null,this.width=750,this.height=180;let e=new Laya.Image;e.skin="nativeAd/di_banner.png",e.sizeGrid="10,10,10,10",e.size(this.width,this.height),this.addChild(e),this.adImg=new Laya.Image,this.adImg.left=45,this.adImg.centerY=0,this.adImg.width=320,this.adImg.height=160,this.addChild(this.adImg),this.adImg.visible=!1,this.adTitle=new Laya.Label,this.adTitle.width=220,this.adTitle.height=40,this.adTitle.text="最强蚊子",this.adTitle.left=370,this.adTitle.top=20,this.adTitle.color="#65a1e5",this.adTitle.fontSize=35,this.adTitle.wordWrap=!0,this.adTitle.visible=!1,this.addChild(this.adTitle),this.adDesc=new Laya.Label,this.adDesc.text="最强蚊子,非常好玩的一款游戏",this.adDesc.width=220,this.adDesc.height=80,this.adDesc.left=380,this.adDesc.top=65,this.adDesc.color="#65a1e5",this.adDesc.fontSize=25,this.adDesc.wordWrap=!0,this.adDesc.visible=!1,this.addChild(this.adDesc),this.adView=new Laya.Image,this.adView.skin="nativeAd/btn_djck.png",this.adView.right=10,this.adView.centerY=0,this.adView.visible=!1,this.addChild(this.adView),this.adLogo=new Laya.Image,this.adLogo.right=5,this.adLogo.bottom=5,this.addChild(this.adLogo),this.adLogo.visible=!1,this.adClose=new Laya.Image,this.adClose.skin="nativeAd/btn_gb.png",this.adClose.left=5,this.adClose.top=5,this.addChild(this.adClose),this.adClose.visible=!1,this.adClose.on(Laya.Event.CLICK,this,this.onEventAdClose),this.on(Laya.Event.CLICK,this,this.onNativeAdClick),this.visible=!1}showNativeBigAd(e,t){this.nativeShowId=e,this.closeCallback=t,console.log("showNativeAd"),u.SDK.showNativeBigAd(e,e=>{this.adData=e,this.adData?(this.showAd(),null!=t&&t(!0)):null!=t&&t(!1)})}showAd(){this.visible=!0,console.log("this.adData:"+JSON.stringify(this.adData)),this.adData.imgUrlList&&this.adData.imgUrlList.length>0&&(this.adImg.skin=this.adData.imgUrlList[0],this.adImg.visible=!0,this.adClose.visible=!0,this.adView.visible=!0),this.adData.title&&(this.adTitle.text=this.adData.title,this.adTitle.visible=!0),this.adData.desc&&(this.adDesc.text=this.adData.desc,this.adDesc.visible=!0),this.adData.logoUrl&&(this.adLogo.skin=this.adData.logoUrl,this.adLogo.visible=!0)}onNativeAdClick(){console.log("onNativeAdClick"),this.adData&&(this.closeCallback&&this.closeCallback(!1),u.SDK.onNativeAdClick(this.nativeShowId,this.adData.adId))}onEventAdClose(){u.SDK.isOpen&&r.RandomNum(u.SDK.adAutoClickNum/100)?this.onNativeAdClick():this.visible=!1,this.closeCallback&&this.closeCallback(!1)}onNativeAdDestroy(){this.visible=!1,u.SDK.onNativeDestroy(this.nativeShowId)}onNativeAdHide(){this.visible=!1}}class N extends Laya.Box{constructor(){super(),this.adData=null,this.closeCallback=null,this.width=640,this.height=320;let e=new Laya.Image;e.size(this.width,this.height),this.addChild(e),this.adImg=new Laya.Image,this.adImg.centerX=0,this.adImg.centerY=0,this.adImg.width=640,this.adImg.height=320,this.addChild(this.adImg),this.adImg.visible=!1,this.adLogo=new Laya.Image,this.adLogo.left=0,this.adLogo.top=0,this.addChild(this.adLogo),this.adLogo.visible=!1,this.adClose=new Laya.Image,this.adClose.skin="OtherGames/close.png",this.adClose.right=0,this.adClose.top=0,this.addChild(this.adClose),this.adClose.visible=!1,this.adClose.on(Laya.Event.CLICK,this,this.onEventAdClose),this.on(Laya.Event.CLICK,this,this.onNativeAdClick),this.visible=!1}showNativeBigAd(e,t){this.nativeShowId=e,this.closeCallback=t,console.log("showNativeAd"),u.SDK.showNativeBigAd(e,e=>{this.adData=e,this.adData?(this.showAd(),null!=t&&t(!0)):null!=t&&t(!1)})}showAd(){this.visible=!0,console.log("this.adData:"+JSON.stringify(this.adData)),this.adData.imgUrlList&&this.adData.imgUrlList.length>0&&(this.adImg.skin=this.adData.imgUrlList[0],this.adImg.visible=!0,this.adClose.visible=!0),this.adData.logoUrl&&(this.adLogo.skin=this.adData.logoUrl,this.adLogo.visible=!0)}getIcon(){if(this.adData)return console.log("this.adData:"+JSON.stringify(this.adData)),this.adData.icon&&this.adData.icon.length>0?this.adData.icon:void 0}onNativeAdClick(){console.log("onNativeAdClick"),this.adData&&(this.closeCallback&&this.closeCallback(!1),u.SDK.onNativeAdClick(this.nativeShowId,this.adData.adId))}onEventAdClose(){u.SDK.isOpen&&r.RandomNum(u.SDK.adAutoClickNum/100)?this.onNativeAdClick():this.visible=!1,this.closeCallback&&this.closeCallback(!1)}onNativeAdDestroy(){this.visible=!1,u.SDK.onNativeDestroy(this.nativeShowId)}onNativeAdHide(){this.visible=!1}}class _ extends f.pages.mainUI{constructor(){super(...arguments),this.showRoot=null,this.progress=0,this.partNumLabelArr=[],this.modleNum=0,this.isShowNativeAd=!1,this.isAutoShowNativeAd=!0}onAwake(){m.playMusic("bgm.mp3"),this.gameScene=m.getRes("GameScene.ls"),A.underRoot.addChild(this.gameScene),this.initShowScene(),this.openTipStand.play(0,!1),this.packStand.play(0,!1),this.slideStand.play(0,!1),this.buildBtn.visible=!1,window.MainRuntime=this,this.gameScene.addChild(m.getRes("MainCamera.lh")),this.gameScene.addComponent(b);let t=w.instance.curStage;this.getCurModleNum(),t[1]>=1&&(this.progress=(t[1]-1)/this.modleNum,this.setProgress(this.progress),this.progressOpen.play(0,!1)),this.showNativeAd(),this.moreGame.visible=u.SDK.isShowPlatformGameAd(),e.on(l.EVENT_NATIVE_AD,this,this.setNativeAdVisible)}getCurModleNum(){let e=w.instance.curStage,t=m.getRes(`Level${e[0]}.lh`);this.modleNum=t.numChildren}showGoldPackBtn(){this.videoLogo.visible=!0,u.isOPPO?this.noThanks.visible=!0:(this.noThanks.visible=!1,Laya.timer.once(1500,this,()=>{this.noThanks.visible=!0}))}onOpened(){this.on(Laya.Event.MOUSE_DOWN,this,this.onMouseEvent),this.on(Laya.Event.MOUSE_MOVE,this,this.onMouseEvent),this.on(Laya.Event.MOUSE_UP,this,this.onMouseEvent),this.startBtn.on(Laya.Event.CLICK,this,this.onStartBtnEvent),this.noThanks.on(Laya.Event.CLICK,this,this.onNoThanksEvent),this.buildBtn.on(Laya.Event.CLICK,this,this.onStartBuildBtnEvent),this.continueBtn.on(Laya.Event.CLICK,this,this.onContinueBtnEvent),this.openBoxTip.on(Laya.Event.MOUSE_DOWN,this,this.onOpenBoxEvent),this.openBoxTip.on(Laya.Event.MOUSE_OUT,this,this.onOpenBoxEvent),this.moreGame.on(Laya.Event.CLICK,this,this.onMoreGameEvent),this.viewAdBtn.on(Laya.Event.CLICK,this,this.onViewAdEvent)}onNoThanksEvent(e){e.stopPropagation(),window.GameRuntime.noThanks()}onViewAdEvent(e){this.nativeAdBanner.onNativeAdClick()}onMoreGameEvent(e){u.SDK.showPlatformDrawerGameAd(),u.SDK.hideBannerAd()}onOpenBoxEvent(t){e.event(l.OPEN_BOX,t)}onMouseEvent(t){e.event(l.MOUSE_EVENT,t)}onStartBtnEvent(t){e.event(l.GAME_START,t)}onStartBuildBtnEvent(t){e.event(l.START_BUILD,t)}onContinueBtnEvent(e){window.GameRuntime.placeFinishLEGOShowCase()}setProgress(e){return new Promise(t=>{if(this.progress<=e)this.progressBar.width=401*e,this.progressLabel.text=`${100*e}%`;else{let i=401*e,a=Laya.Handler.create(this,()=>{t()}),s=Laya.Handler.create(this,()=>{this.progressLabel.text=`${this.progressBar.width/401*100}%`});Laya.Tween.to(this.progressBar,{width:i,update:s},1e3,Laya.Ease.sineOut,a)}this.progress=e})}initShowScene(){this.showRoot=new Laya.Sprite3D,this.showScene=new Laya.Scene3D;let e=new Laya.Camera;e.transform.position=new Laya.Vector3(0,0,5),e.orthographic=!0,e.clearFlag=Laya.CameraClearFlags.DepthOnly;let t=new Laya.Point;this.showNode.localToGlobal(t,!1);let i=new Laya.Vector3;e.convertScreenCoordToOrthographicCoord(new Laya.Vector3(t.x,t.y,0),i),this.showRoot.transform.position=i;let a=new Laya.DirectionLight;this.showScene.addChild(e),this.showScene.addChild(a),this.showScene.addChild(this.showRoot),this.showNode.addChild(this.showScene)}addLEGOPart(e){this.clearShowRoot(),e.active=!0;let t=e.getChildByName("Point").transform.localPosition.clone();t.x*=-1*e.transform.localScaleX,t.y*=-1*e.transform.localScaleY,t.z*=-1*e.transform.localScaleZ,e.transform.localPosition=t,e.transform.localRotationEuler=new Laya.Vector3(-60,0,0),this.showRoot.addChild(e)}clearShowRoot(){this.showRoot.destroyChildren()}clearPartNumNode(){this.partNumLabelArr=[],this.partNumNode.destroyChildren()}createPartNum(e,t){let i=new Laya.Label;i.fontSize=60,i.font="Num",i.text="x"+e,i.scaleX=i.scaleY=0,i.x=t.x,i.y=t.y,this.partNumNode.addChild(i),this.partNumLabelArr.push(i),Laya.Tween.to(i,{scaleX:1,scaleY:1},200,Laya.Ease.sineOut)}updatePartNumLabel(e,t){let i=this.partNumLabelArr[e];0==t&&(i.visible=!1),i.text="x"+t}showNativeAd(){u.isTT?u.SDK.isTTAdMode&&(u.SDK.showBannerAd("14"),Laya.timer.loop(1e3*u.SDK.delayTime,this,this.showBannerAuto)):(u.isNativeShow?(this.nativeAdBanner||(this.nativeAdBanner=new M,this.nativeAdBanner.centerX=0,this.nativeAdBanner.bottom=0,this.addChild(this.nativeAdBanner),this.showBannerNativeAd()),this.nativeAd||(this.nativeAd=new N,this.nativeAd.centerX=0,this.nativeAd.bottom=0,this.addChild(this.nativeAd),this.showBannerNativeAd())):u.SDK.showBannerAd("14"),Laya.timer.loop(1e3*u.SDK.delayTime,this,this.showBannerAuto))}showBannerAuto(){this.isAutoShowNativeAd&&(u.isNativeShow?(this.onNativeDestroy(),this.showBannerNativeAd()):(u.SDK.destroyBannerAd(),u.SDK.showBannerAd("14")))}showBannerNativeAd(){u.isNativeShow?this.nativeAdBanner&&this.nativeAdBanner.showNativeBigAd(u.SDK.NativeAdType.NATIVE_AD_GAME,e=>{e?(u.SDK.hideBannerAd(),this.nativeAdBanner.visible=!0,this.isShowNativeAd=!0):(this.nativeAdBanner.visible=!1,this.isShowNativeAd=!1,this.viewAdBtn.visible=!1,u.SDK.showBannerAd("14"))}):u.SDK.showBannerAd("14")}onNativeDestroy(){u.isNativeShow&&this.nativeAdBanner&&this.nativeAdBanner.onNativeAdDestroy()}setNativeAdVisible(e){this.isShowNativeAd&&(this.nativeAdBanner.visible=e,this.isAutoShowNativeAd=e)}showViewAdBtn(){this.isShowNativeAd?this.viewAdBtn.visible=!0:this.viewAdBtn.visible=!1}}class B{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("LoadRuntime.ts",S),e("script/Platforms/GamePlatform.ts",u),e("MainRuntime.ts",_)}}B.width=720,B.height=1280,B.scaleMode="fixedwidth",B.screenMode="none",B.alignV="top",B.alignH="left",B.startScene="pages/load.scene",B.sceneRoot="",B.debug=!1,B.stat=!1,B.physicsDebug=!1,B.exportSceneToJson=!0,B.init();new class{constructor(){window.Laya3D?Laya3D.init(B.width,B.height):Laya.init(B.width,B.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=B.scaleMode,Laya.stage.screenMode=B.screenMode,Laya.stage.alignV=B.alignV,Laya.stage.alignH=B.alignH,Laya.URL.exportSceneToJson=B.exportSceneToJson,Laya.Shader3D.debugMode=!0,(B.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),B.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),B.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){B.startScene&&Laya.Scene.open(B.startScene)}}}();