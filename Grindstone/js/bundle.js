!function(){"use strict";class e{static init(){e.CUR_PLATFORM=e.BROWSER;let t=window.navigator.userAgent;-1==t.indexOf("OPPO")&&t.indexOf("MiniGame")>-1&&"wx"in window&&("tt"in window?e.CUR_PLATFORM=e.TT:"qq"in window?e.CUR_PLATFORM=e.QQ:e.CUR_PLATFORM=e.WX),t.indexOf("OPPO")>-1&&t.indexOf("MiniGame")>-1&&(e.CUR_PLATFORM=e.OPPO),t.indexOf("VVGame")>-1&&(e.CUR_PLATFORM=e.VIVO),console.log("当前小游戏运行平台",e.CUR_PLATFORM)}}e.CUR_PLATFORM=null,e.OPPO="OPPO",e.VIVO="VIVO",e.WX="WX",e.TT="TT",e.QQ="QQ",e.BROWSER="BROWSER";class t{constructor(){t._resMap=new Map,e.CUR_PLATFORM==e.WX?(t._remote="https://demo.xxtch.com/grindstone/res/wx/",t._resBasePath=wx.env.USER_DATA_PATH+"/cache/res/",t._fileSystemManager=wx.getFileSystemManager(),t._downloadFile=wx.downloadFile,t._loadSubpackage=wx.loadSubpackage,t._fileSystemManager.access({path:t._resBasePath,fail:()=>{t._fileSystemManager.mkdirSync(t._resBasePath,!0)}})):e.CUR_PLATFORM==e.QQ?(t._remote="https://h5game.99aly.com/5agamewx/alywx/swzb/qq/",t._resBasePath=qq.env.USER_DATA_PATH+"/cache/res/",t._fileSystemManager=qq.getFileSystemManager(),t._downloadFile=qq.downloadFile,t._loadSubpackage=qq.loadSubpackage,t._fileSystemManager.access({path:t._resBasePath,fail:()=>{t._fileSystemManager.mkdirSync(t._resBasePath,!0)}})):e.CUR_PLATFORM!=e.OPPO&&e.CUR_PLATFORM!=e.VIVO||(t._remote="https://cdn.xxtch.com/grindstone/res/oppo/",t._resBasePath=qg.env.USER_DATA_PATH+"/cache/res/",t._fileSystemManager=qg.getFileSystemManager(),t._downloadFile=qg.downloadFile,t._loadSubpackage=qg.loadSubpackage,t._fileSystemManager.access({path:t._resBasePath,fail:()=>{t._fileSystemManager.mkdirSync(t._resBasePath,!0)}}))}static init(){return new Promise(a=>{if(null==t._instance){t._instance=new t;let s=Laya.LocalStorage.getItem("zipVersion");s&&(t._zipVersion=JSON.parse(s));let n="resconfig.json";if(e.CUR_PLATFORM==e.WX){let e="wx",i="1.0";n=t._remote+`resconfig_${e}_${i}.json`,n+="?ran="+1e6*Math.random()}else if(e.CUR_PLATFORM==e.QQ){let e="qq",i="1.0";n=t._remote+`resconfig_${e}_${i}.json`,n+="?ran="+1e6*Math.random()}else if(e.CUR_PLATFORM==e.OPPO){let e="oppo",i="1.0";n=t._remote+`resconfig_${e}_${i}.json`,n+="?ran="+1e6*Math.random()}else if(e.CUR_PLATFORM==e.VIVO){let e="vivo",i="1.0";n=t._remote+`resconfig_${e}_${i}.json`,n+="?ran="+1e6*Math.random()}Laya.loader.load(n,Laya.Handler.create(this,s=>{"string"==typeof s&&(s=JSON.parse(s));for(const a in s)if(s.hasOwnProperty(a)){let n=s[a],o=n[0];for(let s=0;s<o.length;s++){let r=o[s];if("local"==n[1]||"sub"==n[1]){let s="res/"+a+"/"+r;e.CUR_PLATFORM==e.OPPO&&"sub"==n[1]&&(s=a+"/"+r),t._resMap.set(r,new i(r,a,n[1],s))}else{let e=t._resBasePath+r;t._resMap.set(r,new i(r,a+"_"+n[2],n[1],e))}}}console.log(t._resMap),a()}))}})}static getRes(e){return t._resMap.get(e)||console.error(e),Laya.loader.getRes(t._resMap.get(e).url)}static getResClone(e){return Laya.loader.getRes(t._resMap.get(e).url).clone()}static download(e,i=null){return new Promise(a=>{let s=[],n=[];for(let i=0;i<e.length;i++){let a=e[i],o=t._resMap.get(a);if(o||console.error("找不到资源",a),"sub"==o.location)-1==s.indexOf(o.bundleName)&&-1==t._loadedSubNames.indexOf(o.bundleName)&&s.push(o.bundleName);else if("net"==o.location&&-1==n.indexOf(o.bundleName)){let e=o.bundleName.split("_")[0],i=o.bundleName.split("_")[1];t._zipVersion[e]!=i&&n.push(o.bundleName)}}t._loadSubpackages(s,i).then(()=>{t._downloadFiles(n,i).then(()=>{a()})})})}static create(e,i=null){return new Promise(a=>{t.download(e,i).then(()=>{let s=[];for(let i=0;i<e.length;i++)s.push(t._resMap.get(e[i]));t._createRes(s,s.length,i).then(()=>{a()})})})}static _createRes(e,i,a=null){return new Promise(s=>{if(e.length>0){let n=e.shift(),o=n.name.split(".")[0],r=(i-e.length-1)/i;a&&a({type:"create",progress:r,name:o}),Laya.loader.create(n.url,Laya.Handler.create(this,()=>{r=(i-e.length)/i,a&&a({type:"create",progress:r,name:o}),t._createRes(e,i,a).then(()=>{s()})}),Laya.Handler.create(this,e=>{a&&a({type:"create",progress:r,name:o})}))}else s()})}static loadSpines(e){return new Promise(i=>{let a=[];if(e&&e.length>0){let s=e.shift();t.download([s]).then(()=>{let n=new Laya.Skeleton;a.push(n),n.load(t._resMap.get(s).url,Laya.Handler.create(this,()=>{t.loadSpines(e).then(e=>{i(a.concat(e))})}))})}else i(a)})}static loadFonts(e){return new Promise(i=>{if(e&&e.length>0){let a=e.shift();t.download([a]).then(()=>{let s=new Laya.BitmapFont;s.loadFont(t._resMap.get(a).url,Laya.Handler.create(this,s=>{s.setSpaceWidth(10),s.autoScaleSize=!0,Laya.Text.registerBitmapFont(a.split(".")[0],s),t.loadFonts(e).then(()=>{i()})},[s]))})}else i()})}static playSound(e,i=1,a=null,s=null,n=0){t.download([e]).then(()=>{if(t.soundOpen)return Laya.SoundManager.playSound(t._resMap.get(e).url,i,a,s,n)})}static stopSound(e){Laya.SoundManager.stopSound(t._resMap.get(e).url)}static playMusic(e,i=0,a=null,s=0){t.download([e]).then(()=>{if(t.musicOpen)return Laya.SoundManager.playMusic(t._resMap.get(e).url,i,a,s)})}static _loadSubpackages(e,i=null){return new Promise(a=>{if(e.length>0){let s=e.shift(),n=0;i&&i({type:"download",progress:n,location:"sub",name:s}),console.log("loadSubpackageStart"+s);let o={name:s,success:o=>{t._loadedSubNames.push(s),n=1,i&&i({type:"download",progress:n,location:"sub",name:s}),t._loadSubpackages(e,i).then(()=>{a()})},fail:e=>{console.log("loadSubpackageFail",JSON.stringify(e),s)}};console.log(o),t._loadSubpackage(o).onProgressUpdate(e=>{n=(n=e.progress>n?e.progress:n)<1?n:1,i&&i({type:"download",progress:n,location:"sub",name:s,totalBytesWritten:e.totalBytesWritten,totalBytesExpectedToWrite:e.totalBytesExpectedToWrite})})}else a()})}static _downloadFiles(e,i=null){return new Promise(a=>{if(e.length>0){let s=e.shift(),n=s.split("_")[0],o=s.split("_")[1],r=0;i&&i({type:"download",progress:r,location:"net",name:n});let h=t._resBasePath+s+".zip";t._downloadFile({url:t._remote+s+".zip",filePath:h,success:s=>{200===s.statusCode&&t._fileSystemManager.unzip({zipFilePath:h,targetPath:t._resBasePath,success:s=>{t._zipVersion[n]=o,Laya.LocalStorage.setItem("zipVersion",JSON.stringify(t._zipVersion)),r=1,i&&i({type:"download",progress:r,location:"net",name:n}),t._fileSystemManager.unlink({filePath:h}),t._downloadFiles(e,i).then(()=>{a()})},fail:e=>{}})},fail:e=>{}}).onProgressUpdate(e=>{let t=e.progress/100;r=(r=t>r?t:r)<1?r:1,i&&i({type:"download",progress:r,location:"net",name:n})})}else a()})}}t._instance=null,t._fileSystemManager=null,t._resBasePath=null,t._downloadFile=null,t._loadSubpackage=null,t._remote="",t._resMap=null,t._loadedSubNames=[],t._zipVersion={},t.musicOpen=!0,t.soundOpen=!0,t.vibrateOpen=!0;class i{constructor(e,t,i,a){this._location=null,this._bundleName=null,this._url=null,this._name=null,this._name=e,this._location=i,this._bundleName=t,this._url=a}get location(){return this._location}get bundleName(){return this._bundleName}get url(){return this._url}get name(){return this._name}}class a{static init(){a._disp||(a._disp=new Laya.EventDispatcher)}static event(e,t){return a._disp.event(e,t)}static on(e,t,i,s){return a._disp.on(e,t,i,s)}static once(e,t,i,s){return a._disp.once(e,t,i,s)}static off(e,t,i,s){return a._disp.off(e,t,i,s)}static offAll(e){return a._disp.offAll(e)}static isMouseEvent(e){return a._disp.isMouseEvent(e)}static hasListener(e){return a._disp.hasListener(e)}}class s{}s.UserDataChange="UserDataChange",s.ControllerEvent="ControllerEvent",s.UpdateStep="UpdateStep",s.UpdateKillNum="UpdateKillNum",s.UpdateAttack="UpdateAttack",s.UpdatePointer="UpdatePointer",s.UpdateKillBtn="UpdateKillBtn",s.OnStateExit="OnStateExit",s.UseSkill="UseSkill",s.ShowWrongTip="ShowWrongTip",s.OnStateTrigger="OnStateTrigger",s.AttackMove="AttackMove",s.AttackDamage="AttackDamage",s.EnemyAttack="EnemyAttack",s.AttackEnd="AttackEnd",s.ShowCombo="ShowCombo",s.BigBlood="BigBlood",s.AttackNotEnoughTip="AttackNotEnoughTip",s.ConnectTip="ConnectTip",s.PlayerRevive="PlayerRevive",s.ShowBossAttackDiff="ShowBossAttackDiff",s.UpdateShopList="UpdateShopList",s.UpdateMainPlayer="UpdateMainPlayer",s.UpdateTask="UpdateTask",s.NewGuideEvent="NewGuideEvent",s.ShowPlayerPointer="ShowPlayerPointer",s.PopTip="PopTip",s.UpdateRed="UpdateRed",s.MainRedUpdate="MainRedUpdate";class n{constructor(){n._uiMap=new Map}static init(){n._UIManager||(n._UIManager=new n)}static open(e,t=!0){let i=n._uiMap.get(e.name);return null==i&&(i=new e,n._uiMap.set(e.name,i)),t&&n.closeAll(i),i.open(t),console.log(n._uiMap),i}static close(e){let t=n._uiMap.get(e.name);t&&(t.close(),t.autoDestroyAtClosed&&n._uiMap.set(e.name,null)),console.log(n._uiMap)}static closeAll(e){n._uiMap.forEach((t,i)=>{!(t&&e instanceof Laya.Dialog&&t instanceof Laya.Dialog&&e!=t)&&(!t||e instanceof Laya.Dialog||t instanceof Laya.Dialog||e==t)||(t.close(),t.autoDestroyAtClosed&&n._uiMap.set(i,null))})}}var o,r,h,l,p,d,c,g,y=Laya.View,u=Laya.Dialog,m=Laya.ClassUtils.regClass;!function(e){!function(e){class t extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(t.uiView)}}t.uiView={type:"Dialog",props:{width:720,runtime:"uilogic/CountLogic.ts",mouseEnabled:!0,isModal:!0,height:1280,autoDestroyAtClosed:!0},compId:2,child:[{type:"Box",props:{y:0,x:0,width:720,var:"countBox",height:1280},compId:30,child:[{type:"Sprite",props:{y:181,x:167,var:"loseLogo",texture:"count/Ui_Lose.png"},compId:11},{type:"Sprite",props:{y:169,x:171,var:"winLogo",texture:"count/Ui_Win.png"},compId:12},{type:"Sprite",props:{y:769,x:480,var:"again",texture:"count/Btn_Again.png"},compId:45},{type:"Image",props:{y:762,x:245.5,var:"countCheckAd",skin:"count/Btn_GoWatch.png",scaleY:1,scaleX:1},compId:6},{type:"Image",props:{y:769,x:30,var:"back",skin:"count/Btn_Home.png",scaleY:1,scaleX:1,name:"back"},compId:8},{type:"Sprite",props:{y:769,x:480,var:"next",texture:"count/Btn_Next.png"},compId:44},{type:"Sprite",props:{y:473,x:165,var:"lossFrame",texture:"count/Ui_FrameLose.png"},compId:36,child:[{type:"Sprite",props:{y:1,x:33,var:"lossStep",texture:"count/Ui_FrameLose1.png"},compId:37},{type:"Sprite",props:{y:11.5,x:33,var:"lossKill",texture:"count/Ui_FrameLose2.png"},compId:38,child:[{type:"Image",props:{y:-7,x:211,var:"lossKiller",skin:"play/Ui_Monster10.png",scaleY:.8,scaleX:.8},compId:39}]}]}]},{type:"Box",props:{y:0,x:0,width:720,var:"reviveBox",height:1280},compId:22,child:[{type:"Image",props:{y:618,var:"reviveBtn",skin:"count/Btn_Revive.png",centerX:0},compId:32,child:[{type:"Sprite",props:{y:121,x:88,var:"reviveNoBtn",texture:"count/Btn_No.png"},compId:33}]},{type:"Image",props:{y:460,var:"reviveTitle",skin:"count/Ui_ReviveWord.png",centerX:0},compId:34},{type:"Image",props:{y:160,x:227,var:"reviveIcon",skin:"count/Ui_TitleRevive.png"},compId:35}]},{type:"Box",props:{y:0,x:0,width:720,var:"rewardBox",height:1280},compId:23,child:[{type:"Image",props:{y:161,x:227,skin:"count/Ui_TitleGift.png"},compId:24},{type:"Image",props:{y:456,x:283,skin:"count/Ui_FrameGift.png"},compId:26},{type:"Image",props:{y:464,var:"rewardImage",skin:"sign/Ui_tongqian.png",centerX:3},compId:19},{type:"Label",props:{y:555,x:319,var:"moenyLabel",text:"X133",fontSize:35,color:"#000000",centerY:-68,centerX:0},compId:20},{type:"Sprite",props:{y:758,x:248,visible:!0,var:"checkAd",texture:"count/Btn_GoWatch.png"},compId:28},{type:"Image",props:{y:868,width:74,var:"receiveBtn",skin:"count/Btn_Get.png",height:35,centerX:0},compId:15},{type:"Image",props:{y:760,x:248,var:"videoReward",skin:"count/Btn_ThreeGet.png"},compId:46}]}],loadList:["count/Ui_Lose.png","count/Ui_Win.png","count/Btn_Again.png","count/Btn_GoWatch.png","count/Btn_Home.png","count/Btn_Next.png","count/Ui_FrameLose.png","count/Ui_FrameLose1.png","count/Ui_FrameLose2.png","play/Ui_Monster10.png","count/Btn_Revive.png","count/Btn_No.png","count/Ui_ReviveWord.png","count/Ui_TitleRevive.png","count/Ui_TitleGift.png","count/Ui_FrameGift.png","sign/Ui_tongqian.png","count/Btn_Get.png","count/Btn_ThreeGet.png"],loadList3D:[]},e.countUI=t,m("ui.pages.countUI",t);class i extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(i.uiView)}}i.uiView={type:"Dialog",props:{width:498,runtime:"uilogic/GetPropLogic.ts",isModal:!0,height:420,autoDestroyAtClosed:!0},compId:2,child:[{type:"Image",props:{y:0,x:0,skin:"play/Ui_FrameDaoJu.png"},compId:3},{type:"Image",props:{y:309,var:"videoGet",skin:"play/Btn_Get.png",centerX:0},compId:5},{type:"Image",props:{y:-22,x:423,var:"closeBtn",skin:"main/Btn_Close.png"},compId:7}],loadList:["play/Ui_FrameDaoJu.png","play/Btn_Get.png","main/Btn_Close.png"],loadList3D:[]},e.getPropUI=i,m("ui.pages.getPropUI",i);class a extends y{constructor(){super()}createChildren(){super.createChildren(),this.createView(a.uiView)}}a.uiView={type:"View",props:{y:0,x:0,width:720,runtime:"uilogic/LoadLogic.ts",height:1280,autoDestroyAtClosed:!0},compId:2,child:[{type:"Box",props:{y:0,x:0,var:"loadBox"},compId:8,child:[{type:"Image",props:{y:0,x:0,width:720,skin:"load/Ui_LoadingBg.png",height:1600},compId:11},{type:"Sprite",props:{y:179,x:18,width:516,texture:"load/logo2.png",height:249},compId:4},{type:"Image",props:{width:712,skin:"load/Ui_LoadingBg3.png",height:802,centerY:0,centerX:0},compId:13},{type:"Image",props:{skin:"load/tip.png",centerX:0,bottom:50},compId:10},{type:"Image",props:{y:1343,x:98,var:"progressBar",skin:"load/Ui_Loading5.png",centerX:0,bottom:230},compId:6,child:[{type:"Sprite",props:{y:0,x:0,width:524,var:"progressMask",renderType:"mask",height:27},compId:9}]},{type:"Image",props:{skin:"load/Ui_Loading4.png",name:"",centerX:0,bottom:200},compId:5,child:[{type:"Label",props:{y:27,var:"progressLabel",text:"100%",fontSize:30,color:"#ffffff",centerX:-1,bold:!0},compId:7}]}]},{type:"Box",props:{width:720,var:"spineBox",height:1600},compId:14,child:[{type:"Image",props:{skin:"load/logo1.png",centerX:0,bottom:50},compId:16}]}],loadList:["load/Ui_LoadingBg.png","load/logo2.png","load/Ui_LoadingBg3.png","load/tip.png","load/Ui_Loading5.png","load/Ui_Loading4.png","load/logo1.png"],loadList3D:[]},e.loadUI=a,m("ui.pages.loadUI",a);class s extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(s.uiView)}}s.uiView={type:"Dialog",props:{width:720,isModal:!0,height:1280,autoDestroyAtClosed:!0},compId:2,child:[{type:"Box",props:{width:720,top:0,scaleY:.85,scaleX:.85,height:1280,centerX:0},compId:14,child:[{type:"Sprite",props:{y:260,x:0,texture:"lottery/Ui_yunyun.png"},compId:10},{type:"Sprite",props:{y:934,x:325,texture:"lottery/Ui_frameliusu.png"},compId:8},{type:"Sprite",props:{y:16,x:17,texture:"lottery/Ui_titlezhaunpan.png"},compId:4},{type:"Sprite",props:{y:242,x:17,texture:"lottery/Ui_framezhaunpan.png"},compId:5,child:[{type:"Sprite",props:{y:30,x:36,texture:"main/Ui_framezhaunpan2.png"},compId:13}]},{type:"Image",props:{y:882,x:404,var:"freeLottery",skin:"lottery/Btn_suangua1.png",name:"freeLottery"},compId:6},{type:"Image",props:{y:882,x:404,var:"videoLottery",skin:"lottery/Btn_suangua2.png",name:"videoLottery"},compId:7},{type:"Sprite",props:{y:43,x:17,texture:"lottery/Ui_huahua.png"},compId:9},{type:"Sprite",props:{y:579,x:372,width:338,var:"selectFrame",texture:"lottery/Ui_frameslecte.png",rotation:0,pivotY:442,pivotX:198,height:379},compId:11},{type:"Image",props:{y:1029,x:573,var:"closeBtn",skin:"lodge/Btn_back.png",name:"closeBtn",centerY:443},compId:12}]}],loadList:["lottery/Ui_yunyun.png","lottery/Ui_frameliusu.png","lottery/Ui_titlezhaunpan.png","lottery/Ui_framezhaunpan.png","main/Ui_framezhaunpan2.png","lottery/Btn_suangua1.png","lottery/Btn_suangua2.png","lottery/Ui_huahua.png","lottery/Ui_frameslecte.png","lodge/Btn_back.png"],loadList3D:[]},e.lotteryUI=s,m("ui.pages.lotteryUI",s);class n extends y{constructor(){super()}createChildren(){super.createChildren(),this.createView(n.uiView)}}n.uiView={type:"View",props:{width:720,top:0,right:0,left:0,height:1280,bottom:0,autoDestroyAtClosed:!0},compId:2,child:[{type:"Box",props:{y:0,x:0,var:"sceneBox"},compId:38},{type:"Button",props:{y:194,x:607,var:"setting",stateNum:1,skin:"main/Btn_setting.png",name:"setting"},compId:5},{type:"Sprite",props:{y:81,x:75.5,texture:"main/Ui_frameenergy.png"},compId:32,child:[{type:"Image",props:{y:0,x:-72,width:90,var:"userHead",skin:"main/Ui_head2.png",height:90},compId:33},{type:"Image",props:{y:0,x:-72,skin:"main/Ui_head.png"},compId:29},{type:"Label",props:{y:12,x:36,var:"userName",text:"江湖小虾米",fontSize:30,bold:!0},compId:34}]},{type:"money",props:{y:127,x:465,runtime:"uilogic/MoneyBoxLogic.ts"},compId:30},{type:"Image",props:{x:74,var:"lodge",skin:"main/Btn_shop.png",centerY:-190,anchorY:.5,anchorX:.5},compId:39,child:[{type:"Sprite",props:{y:6,x:103,width:46,var:"shopRed",texture:"main/Ui_YellowPoint.png",pivotY:26,pivotX:23,height:52},compId:53}]},{type:"Image",props:{x:70,var:"task",skin:"main/Btn_task.png",centerY:-86,anchorY:.5,anchorX:.5},compId:40,child:[{type:"Sprite",props:{y:-10,x:90,var:"taskRed",texture:"main/Ui_RedPoint.png"},compId:54}]},{type:"Box",props:{y:393,x:364,width:227,var:"start",height:101,anchorY:.5,anchorX:.5},compId:41,child:[{type:"Image",props:{y:127,x:149,var:"hand",skin:"main/Ui_hand.png"},compId:51}]},{type:"Button",props:{x:19.5,var:"sign",stateNum:1,skin:"main/Btn_qiandao.png",centerY:130},compId:36,child:[{type:"Sprite",props:{y:-10,x:90,var:"signRed",texture:"main/Ui_RedPoint.png"},compId:55}]},{type:"Button",props:{x:17,var:"lottery",stateNum:1,skin:"main/Btn_zhaunpan.png",centerY:24},compId:37,child:[{type:"Sprite",props:{y:-10,x:90,var:"lotteryRed",texture:"main/Ui_RedPoint.png"},compId:56}]},{type:"Image",props:{x:360,width:260,var:"levelmage",skin:"main/Ui_GuanQia.png",height:94,centerY:-171,anchorY:.5,anchorX:.5},compId:42,child:[{type:"Label",props:{y:8,var:"levelNum",value:"1",text:"1",styleSkin:"play/Atk_Num10.png",sheet:"0123456789",fontSize:40,font:"Num1",centerX:4},compId:43},{type:"Label",props:{y:53,var:"level1",value:"1",text:"1",styleSkin:"play/Atk_Num10.png",sheet:"0123456789",fontSize:40,font:"Num1",centerX:-100},compId:44},{type:"Label",props:{y:53,var:"level2",value:"1",text:"1",styleSkin:"play/Atk_Num10.png",sheet:"0123456789",fontSize:40,font:"Num1",centerX:7},compId:45},{type:"Label",props:{y:53,var:"level3",value:"1",text:"1",styleSkin:"play/Atk_Num10.png",sheet:"0123456789",fontSize:40,font:"Num1",centerX:109},compId:46},{type:"Image",props:{y:41,x:-3,width:60,var:"icon1",skin:"main/Ui_M9.png",height:58},compId:48},{type:"Image",props:{y:41,x:99,width:60,var:"icon2",skin:"main/Ui_M9.png",height:58},compId:50},{type:"Image",props:{y:41,x:209,width:60,var:"icon3",skin:"main/Ui_M9.png",height:58},compId:49}]}],animations:[{nodes:[{target:51,keyframes:{y:[{value:127,tweenMethod:"sineOut",tween:!0,target:51,key:"y",index:0},{value:50.5,tweenMethod:"linearNone",tween:!0,target:51,key:"y",index:60}],x:[{value:149,tweenMethod:"sineOut",tween:!0,target:51,key:"x",index:0},{value:113.5,tweenMethod:"linearNone",tween:!0,target:51,key:"x",index:60}]}}],name:"ani1",id:1,frameRate:60,action:0},{nodes:[{target:53,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:53,key:"scaleY",index:0},{value:1.3,tweenMethod:"linearNone",tween:!0,target:53,key:"scaleY",index:20}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:53,key:"scaleX",index:0},{value:1.3,tweenMethod:"linearNone",tween:!0,target:53,key:"scaleX",index:20}]}}],name:"ani2",id:2,frameRate:60,action:2}],loadList:["main/Btn_setting.png","main/Ui_frameenergy.png","main/Ui_head2.png","main/Ui_head.png","main/Btn_shop.png","main/Ui_YellowPoint.png","main/Btn_task.png","main/Ui_RedPoint.png","main/Ui_hand.png","main/Btn_qiandao.png","main/Btn_zhaunpan.png","main/Ui_GuanQia.png","play/Atk_Num10.png","main/Ui_M9.png"],loadList3D:[]},e.mainUI=n,m("ui.pages.mainUI",n);class o extends y{constructor(){super()}createChildren(){super.createChildren(),this.createView(o.uiView)}}o.uiView={type:"View",props:{width:252,runtime:"uilogic/MoneyBoxLogic.ts",height:67},compId:2,child:[{type:"Image",props:{y:0,x:0,skin:"main/Ui_framemoney.png"},compId:4,child:[{type:"Image",props:{y:-2,x:13,skin:"main/Ui_money.png"},compId:8},{type:"Label",props:{y:12,x:64,var:"gold",text:"0000",fontSize:40,font:"Num1",color:"#ffffff"},compId:9},{type:"Button",props:{y:1,x:174,var:"goldAdd",stateNum:1,skin:"main/Btn_plus.png",name:"goldAdd"},compId:10}]}],loadList:["main/Ui_framemoney.png","main/Ui_money.png","main/Btn_plus.png"],loadList3D:[]},e.moneyUI=o,m("ui.pages.moneyUI",o);class r extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(r.uiView)}}r.uiView={type:"Dialog",props:{width:720,runtime:"uilogic/MoneyGodLogic.ts",isShowEffect:!1,isModal:!0,height:1280,autoDestroyAtClosed:!0},compId:2,child:[{type:"Image",props:{x:43.5,skin:"main/Ui_FrameCaiShen.png",centerY:-70},compId:3,child:[{type:"Image",props:{y:171,x:262,var:"rewardImage",skin:"sign/Ui_tongqian.png"},compId:6},{type:"Label",props:{y:260,x:270.129638671875,var:"moenyLabel",text:"X133",fontSize:35,color:"#000000"},compId:7},{type:"Image",props:{y:538,x:202.0859375,var:"videoGetBtn",skin:"play/Btn_Get.png"},compId:14},{type:"Image",props:{y:635,x:202,var:"checkAdBtn",skin:"count/Btn_GoWatch.png"},compId:11},{type:"Label",props:{y:759,var:"freeGet",text:"领取",styleSkin:"play/Btn_Get.png",fontSize:30,color:"#ffffff",centerX:38,bold:!0},compId:4},{type:"Sprite",props:{y:643,x:288,var:"receiveNoBtn",texture:"count/Btn_No.png"},compId:15}]}],loadList:["main/Ui_FrameCaiShen.png","sign/Ui_tongqian.png","play/Btn_Get.png","count/Btn_GoWatch.png","count/Btn_No.png"],loadList3D:[]},e.moneyGodUI=r,m("ui.pages.moneyGodUI",r);class h extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(h.uiView)}}h.uiView={type:"Dialog",props:{width:503,runtime:"uilogic/PauseLogic.ts",isModal:!0,height:653,autoDestroyAtClosed:!0},compId:2,child:[{type:"Sprite",props:{y:0,x:0,texture:"count/Ui_FrameStop.png"},compId:3},{type:"Sprite",props:{y:514,x:73,var:"continueBtn",texture:"count/Btn_Continue.png"},compId:5},{type:"Sprite",props:{y:508,x:271,var:"backBtn",texture:"count/Btn_BackHome.png"},compId:6},{type:"Sprite",props:{y:189,x:117,texture:"main/Ui_Music2.png"},compId:7},{type:"Sprite",props:{y:277,x:118,texture:"main/Ui_Music1.png"},compId:8},{type:"Sprite",props:{y:186,x:280,var:"musicBtn",texture:"main/Ui_Music4.png"},compId:9},{type:"Sprite",props:{y:270.5,x:284,var:"soundBtn",texture:"main/Ui_Music3.png"},compId:10},{type:"Image",props:{y:214,x:332,var:"musicStateIcon",skin:"main/Btn_MusicYes.png"},compId:11},{type:"Image",props:{y:300.5,x:331,var:"soundStateIcon",skin:"main/Btn_MusicYes.png"},compId:12}],loadList:["count/Ui_FrameStop.png","count/Btn_Continue.png","count/Btn_BackHome.png","main/Ui_Music2.png","main/Ui_Music1.png","main/Ui_Music4.png","main/Ui_Music3.png","main/Btn_MusicYes.png"],loadList3D:[]},e.pauseUI=h,m("ui.pages.pauseUI",h);class l extends y{constructor(){super()}createChildren(){super.createChildren(),this.createView(l.uiView)}}l.uiView={type:"View",props:{y:0,x:0,width:720,top:0,runtime:"uilogic/PlayLogic.ts",right:0,left:0,height:1280,bottom:0,autoDestroyAtClosed:!0},compId:2,child:[{type:"Image",props:{y:277,x:286.0068359375,visible:!1,var:"pointer",skin:"play/Ui_AtkQuan.png",anchorY:.5,anchorX:.5},compId:9,child:[{type:"Image",props:{width:30,skin:"play/Ui_Atk.png",height:30,centerX:0,bottom:-10},compId:27},{type:"FontClip",props:{var:"attackValue",skin:"play/Atk_Num10.png",sheet:"0123456789",centerX:0,bottom:90,anchorY:1},compId:48}]},{type:"Image",props:{top:62,skin:"play/Ui_Target.png",scaleY:1.2,scaleX:1.2,left:0},compId:14,child:[{type:"List",props:{y:55,x:17,var:"openGateList",spaceY:-40},compId:55,child:[{type:"Box",props:{renderType:"render"},compId:56,child:[{type:"Image",props:{skin:"play/Ui_Monster0.png",name:"icon"},compId:57},{type:"Label",props:{y:13,x:170,text:"0/1",name:"num",fontSize:40,font:"Num1",color:"#ffffff"},compId:58}]}]}]},{type:"Image",props:{var:"stepLimitFrame",top:220,skin:"play/Ui_Step.png",left:0},compId:15,child:[{type:"Label",props:{y:45,var:"stepLimit",text:"0",fontSize:50,font:"Num1",color:"#ffffff",centerX:50},compId:16}]},{type:"Button",props:{y:124.5,x:599.5,var:"setting",stateNum:1,skin:"main/Btn_setting.png"},compId:17},{type:"Image",props:{y:509,x:363,var:"MoreTip",skin:"play/Ui_CommboTips2.png",centerX:3,anchorY:1,anchorX:.5},compId:65,child:[{type:"FontClip",props:{y:-4,x:85,var:"moreNum",value:"1",skin:"play/Atk_Num10.png",sheet:"0123456789"},compId:66}]},{type:"Image",props:{y:310,var:"dispelBg",skin:"play/Ui_CommboTips3.png",scaleY:1.2,scaleX:1.2,centerX:0},compId:69,child:[{type:"Label",props:{var:"dispelNum",text:"12",fontSize:40,color:"#ffffff",centerY:2,centerX:62,bold:!0},compId:73}]},{type:"Image",props:{y:220,skin:"play/Ui_GuanQia.png",centerX:0},compId:70,child:[{type:"Label",props:{y:8.5,var:"levelNum",value:"1",text:"1",styleSkin:"play/Atk_Num10.png",sheet:"0123456789",fontSize:60,font:"Num1",centerX:0},compId:71}]},{type:"Sprite",props:{y:238.5,x:595,var:"refresh",texture:"play/Btn_Restart.png"},compId:72},{type:"Image",props:{y:386,var:"attackBossTip",skin:"play/Ui_CommboTips.png",centerX:0},compId:76,child:[{type:"Image",props:{y:9,x:291,width:140,var:"bossName",skin:"play/Ui_Monster7.png",scaleY:.75,scaleX:.75,height:44},compId:77},{type:"FontClip",props:{y:7.5,var:"bossAttackDiff",value:"1",skin:"play/Atk_Num10.png",sheet:"0123456789",centerX:-83},compId:78}]},{type:"Box",props:{y:34,x:24,width:48,var:"playerPointerBox",scaleY:1.5,scaleX:1.5,height:34,anchorY:1,anchorX:.5},compId:84,child:[{type:"Image",props:{y:0,x:0,skin:"play/Ui_Me.png"},compId:83}]},{type:"Image",props:{y:1077,x:4,var:"porpBg",skin:"play/Ui_FrameFaShu.png",centerX:0,bottom:0},compId:13,child:[{type:"Sprite",props:{y:-29,x:631,var:"skillAsk",texture:"play/Btn_Tip.png"},compId:74},{type:"Label",props:{y:138,x:150,var:"skill1Num",text:"1",fontSize:40,font:"Num1",color:"#ffffff"},compId:32},{type:"Label",props:{y:138,x:313,var:"skill2Num",text:"1",fontSize:40,font:"Num1",color:"#ffffff"},compId:38},{type:"Label",props:{y:138,x:473,var:"skill3Num",text:"1",fontSize:40,font:"Num1",color:"#ffffff"},compId:36},{type:"Label",props:{y:138,x:633,var:"skill4Num",text:"1",fontSize:40,font:"Num1",color:"#ffffff"},compId:34},{type:"Image",props:{y:63,x:44,var:"skill1Btn",skin:"shop/Ui_Magic1.png",bottom:28},compId:31},{type:"Image",props:{y:68,x:216,var:"skill2Btn",skin:"shop/Ui_Magic2.png",bottom:37},compId:37},{type:"Image",props:{y:68,x:378,var:"skill3Btn",skin:"shop/Ui_Magic3.png",bottom:47},compId:35},{type:"Image",props:{y:63,x:552,var:"skill4Btn",skin:"shop/Ui_Magic4.png",bottom:46},compId:33},{type:"Sprite",props:{y:-309,x:218,width:466,var:"skillAnswer",texture:"play/Btn_Tip2.png",height:309},compId:75}]}],animations:[{nodes:[{target:9,keyframes:{width:[{value:74,tweenMethod:"linearNone",tween:!0,target:9,key:"width",index:0},{value:85,tweenMethod:"linearNone",tween:!0,target:9,key:"width",index:10}],height:[{value:87,tweenMethod:"linearNone",tween:!0,target:9,key:"height",index:0},{value:100,tweenMethod:"linearNone",tween:!0,target:9,key:"height",index:10}]}}],name:"pointerBreath",id:3,frameRate:24,action:0},{nodes:[{target:9,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:9,key:"scaleY",index:5}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:9,key:"scaleX",index:5}]}}],name:"pointerScale",id:4,frameRate:24,action:0},{nodes:[{target:61,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:61,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:61,key:"alpha",index:20},{value:0,tweenMethod:"linearNone",tween:!0,target:61,key:"alpha",index:40}]}}],name:"lightFlash",id:5,frameRate:60,action:0},{nodes:[{target:83,keyframes:{y:[{value:0,tweenMethod:"sineOut",tween:!0,target:83,key:"y",index:0},{value:-20,tweenMethod:"sineIn",tween:!0,target:83,key:"y",index:30},{value:0,tweenMethod:"linearNone",tween:!0,target:83,key:"y",index:60}]}}],name:"playerPointerJump",id:6,frameRate:60,action:0}],loadList:["play/Ui_AtkQuan.png","play/Ui_Atk.png","play/Atk_Num10.png","play/Ui_Target.png","play/Ui_Monster0.png","play/Ui_Step.png","main/Btn_setting.png","play/Ui_CommboTips2.png","play/Ui_CommboTips3.png","play/Ui_GuanQia.png","play/Btn_Restart.png","play/Ui_CommboTips.png","play/Ui_Monster7.png","play/Ui_Me.png","play/Ui_FrameFaShu.png","play/Btn_Tip.png","shop/Ui_Magic1.png","shop/Ui_Magic2.png","shop/Ui_Magic3.png","shop/Ui_Magic4.png","play/Btn_Tip2.png"],loadList3D:[]},e.playUI=l,m("ui.pages.playUI",l);class p extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(p.uiView)}}p.uiView={type:"Dialog",props:{width:526,runtime:"uilogic/PopLogic.ts",isModal:!0,height:609,autoDestroyAtClosed:!0},compId:2,child:[{type:"Sprite",props:{y:0,x:0,texture:"pop/Ui_frametancahung1.png"},compId:3},{type:"Box",props:{var:"reward"},compId:4,child:[{type:"Sprite",props:{y:39,x:172,texture:"pop/Ui_wordhuode.png"},compId:5},{type:"Sprite",props:{y:114,x:75,texture:"pop/Ui_frametancahung2.png"},compId:7},{type:"Sprite",props:{y:504,x:164,var:"directReceive",texture:"pop/Btn_lingqu4.png",name:"directReceive"},compId:8},{type:"Sprite",props:{y:406,x:166,var:"videoReceive",texture:"pop/Btn_lingqu3.png",name:"videoReceive"},compId:9}]},{type:"Box",props:{y:0,x:0,var:"moneyAdd"},compId:10,child:[{type:"Sprite",props:{y:74,x:123,texture:"pop/Ui_wordtongqianno.png"},compId:16},{type:"Sprite",props:{y:259,x:126.5,texture:"pop/Ui_wordhuoqu.png"},compId:17},{type:"Sprite",props:{y:407,x:167,var:"videoAdd",texture:"pop/Btn_sure.png",name:"videoAdd"},compId:18},{type:"Sprite",props:{y:497,x:210,var:"notAdd",texture:"pop/Ui_wordno.png",name:"notAdd"},compId:19}]}],loadList:["pop/Ui_frametancahung1.png","pop/Ui_wordhuode.png","pop/Ui_frametancahung2.png","pop/Btn_lingqu4.png","pop/Btn_lingqu3.png","pop/Ui_wordtongqianno.png","pop/Ui_wordhuoqu.png","pop/Btn_sure.png","pop/Ui_wordno.png"],loadList3D:[]},e.popUI=p,m("ui.pages.popUI",p);class d extends y{constructor(){super()}createChildren(){super.createChildren(),this.createView(d.uiView)}}d.uiView={type:"View",props:{width:580,runtime:"uilogic/PropCellLogic.ts",height:250},compId:2,child:[{type:"Sprite",props:{texture:"shop/Ui_FrameKeZhan4.png"},compId:3},{type:"Box",props:{width:580,var:"contentBox",height:250},compId:13,child:[{type:"Label",props:{y:87,x:46,wordWrap:!0,width:306,var:"propDesc",height:71,fontSize:30,font:"shop1",color:"#ffffff"},compId:4},{type:"Image",props:{y:21,x:63,var:"propName",skin:"shop/Ui_WordMagic1.png",color:"#ffffff"},compId:5},{type:"Image",props:{y:42,x:411,var:"propImage",skin:"comp/image.png",centerY:-33,centerX:171},compId:6},{type:"Sprite",props:{y:24,x:190,var:"useTag",texture:"lodge/Ui_use1.png"},compId:8},{type:"Image",props:{y:7,x:8,var:"lockImage",skin:"shop/Ui_Lock.png"},compId:9},{type:"Image",props:{y:159,x:377,var:"yellowBtn",skin:"shop/Btn_Buy2.png"},compId:7,child:[{type:"Label",props:{y:36.5,x:106.5,var:"goldCost",text:"100",fontSize:25,color:"#ffffff"},compId:11}]},{type:"Image",props:{y:133,x:380,var:"blueBtn",skin:"shop/Btn_Unlock1.png"},compId:10,child:[{type:"Label",props:{y:42,x:106,var:"unlockCost",text:"100",fontSize:25,color:"#ffffff"},compId:12}]}]}],loadList:["shop/Ui_FrameKeZhan4.png","shop/Ui_WordMagic1.png","comp/image.png","lodge/Ui_use1.png","shop/Ui_Lock.png","shop/Btn_Buy2.png","shop/Btn_Unlock1.png"],loadList3D:[]},e.propCellUI=d,m("ui.pages.propCellUI",d);class c extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(c.uiView)}}c.uiView={type:"Dialog",props:{width:503,runtime:"uilogic/SettingLogic.ts",isModal:!0,height:650,autoDestroyAtClosed:!0},compId:2,child:[{type:"Sprite",props:{y:0,x:0,texture:"main/Ui_FrameSet.png"},compId:3},{type:"Sprite",props:{y:5,x:418,var:"closeBtn",texture:"main/Btn_Close.png"},compId:5},{type:"Sprite",props:{y:296,x:128,texture:"main/Ui_Music1.png"},compId:6},{type:"Sprite",props:{y:209,x:128,texture:"main/Ui_Music2.png"},compId:7},{type:"Sprite",props:{y:392,x:128,texture:"main/Ui_Music5.png"},compId:8},{type:"Sprite",props:{y:393,x:300,var:"vibBtn",texture:"main/Ui_Music6.png"},compId:9},{type:"Sprite",props:{y:291.5,x:297,var:"soundBtn",texture:"main/Ui_Music3.png"},compId:10},{type:"Sprite",props:{y:205,x:291,var:"musicBtn",texture:"main/Ui_Music4.png"},compId:11},{type:"Image",props:{y:234.5,x:342,var:"musicState",skin:"main/Btn_MusicYes.png"},compId:12},{type:"Image",props:{y:421,x:350,var:"vibState",skin:"main/Btn_MusicYes.png"},compId:13},{type:"Image",props:{y:322,x:343,var:"soundState",skin:"main/Btn_MusicYes.png"},compId:14}],loadList:["main/Ui_FrameSet.png","main/Btn_Close.png","main/Ui_Music1.png","main/Ui_Music2.png","main/Ui_Music5.png","main/Ui_Music6.png","main/Ui_Music3.png","main/Ui_Music4.png","main/Btn_MusicYes.png"],loadList3D:[]},e.settingUI=c,m("ui.pages.settingUI",c);class g extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(g.uiView)}}g.uiView={type:"Dialog",props:{width:720,runtime:"uilogic/ShopLogic.ts",isModal:!0,height:1280,autoDestroyAtClosed:!0},compId:2,child:[{type:"Image",props:{skin:"shop/Ui_FrameKeZhan.png",scaleY:.85,scaleX:.85,centerY:-95,centerX:0},compId:6,child:[{type:"Sprite",props:{y:95,x:66,texture:"shop/Ui_FrameHero.png"},compId:8},{type:"Box",props:{y:0,x:0,var:"sceneBox"},compId:37},{type:"Sprite",props:{y:385,x:71,width:597,var:"magicBg",texture:"play/Ui_FrameFaShu.png",height:170},compId:9,child:[{type:"Label",props:{y:106,x:126,var:"prop1Num",text:"2",fontSize:40,font:"Num1",color:"#ffffff"},compId:14},{type:"Sprite",props:{y:48,x:42,width:79,var:"prop1Img",texture:"shop/Ui_Magic1.png",height:95},compId:10},{type:"Label",props:{y:106,x:263,var:"prop2Num",text:"2",fontSize:40,font:"Num1",color:"#ffffff"},compId:15},{type:"Sprite",props:{y:56,x:181,width:86,var:"prop2Img",texture:"shop/Ui_Magic2.png",height:84},compId:11},{type:"Label",props:{y:106,x:397,var:"prop3Num",text:"2",fontSize:40,font:"Num1",color:"#ffffff"},compId:16},{type:"Sprite",props:{y:57,x:313,width:85,var:"prop3Img",texture:"shop/Ui_Magic3.png",height:74},compId:12},{type:"Label",props:{y:106,x:531,var:"prop4Num",text:"2",fontSize:40,font:"Num1",color:"#ffffff"},compId:17},{type:"Sprite",props:{y:54,x:460,width:68,var:"prop4Img",texture:"shop/Ui_Magic4.png",height:83},compId:13}]},{type:"Image",props:{y:559,x:76,var:"tab1Bg",skin:"shop/Btn_Yellow.png"},compId:21,child:[{type:"Sprite",props:{y:30,x:35,texture:"shop/Ui_Word2.png"},compId:22}]},{type:"Image",props:{y:559,x:279,var:"tab2Bg",skin:"shop/Btn_Yellow.png"},compId:23,child:[{type:"Sprite",props:{y:30,x:35,texture:"shop/Ui_Word1.png"},compId:24}]},{type:"Image",props:{y:559,x:504,var:"tab3Bg",skin:"shop/Btn_Yellow.png"},compId:25,child:[{type:"Sprite",props:{y:30,x:35,texture:"shop/Ui_Word3.png"},compId:26}]},{type:"Sprite",props:{y:634,x:50,texture:"shop/Ui_FrameKeZhan2.png"},compId:19,child:[{type:"List",props:{y:11,x:18,width:580,var:"shopList",spaceY:-15,repeatX:1,height:526,elasticEnabled:!0},compId:32,child:[{type:"propCell",props:{renderType:"render",runtime:"uilogic/PropCellLogic.ts"},compId:35}]}]},{type:"Image",props:{y:1133.5,x:631,var:"back",skin:"shop/Btn_Back.png"},compId:7},{type:"money",props:{y:115,x:90,runtime:"uilogic/MoneyBoxLogic.ts"},compId:36}]}],loadList:["shop/Ui_FrameKeZhan.png","shop/Ui_FrameHero.png","play/Ui_FrameFaShu.png","shop/Ui_Magic1.png","shop/Ui_Magic2.png","shop/Ui_Magic3.png","shop/Ui_Magic4.png","shop/Btn_Yellow.png","shop/Ui_Word2.png","shop/Ui_Word1.png","shop/Ui_Word3.png","shop/Ui_FrameKeZhan2.png","shop/Btn_Back.png"],loadList3D:[]},e.shopUI=g,m("ui.pages.shopUI",g);class f extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(f.uiView)}}f.uiView={type:"Dialog",props:{width:720,isModal:!0,height:1280,autoDestroyAtClosed:!0},compId:2,child:[{type:"Box",props:{width:720,top:0,scaleY:.85,scaleX:.85,height:1280,centerX:0},compId:18,child:[{type:"Sprite",props:{y:28,x:0,texture:"sign/Ui_tree.png"},compId:5},{type:"Sprite",props:{y:137,x:12,width:696,texture:"sign/Ui_frameqiandao.png",height:1084},compId:4},{type:"Sprite",props:{y:60,x:467,texture:"sign/Ui_titleqiandao.png"},compId:6},{type:"Button",props:{y:1024,x:125,var:"receiveBtn",stateNum:1,skin:"sign/Btn_lingqu1.png",name:"receiveBtn"},compId:7},{type:"signCell",props:{y:889,x:399,var:"day7",runtime:"ui.pages.signCellUI"},compId:9},{type:"signCell",props:{y:762,x:125,var:"day6",runtime:"ui.pages.signCellUI"},compId:10},{type:"signCell",props:{y:608,x:384,var:"day5",runtime:"ui.pages.signCellUI"},compId:11},{type:"signCell",props:{y:488,x:46,var:"day4",runtime:"ui.pages.signCellUI"},compId:12},{type:"signCell",props:{y:383,x:306,var:"day3",runtime:"ui.pages.signCellUI"},compId:13},{type:"signCell",props:{y:180,x:412,var:"day2",runtime:"ui.pages.signCellUI"},compId:8},{type:"signCell",props:{y:112,x:116,var:"day1",runtime:"ui.pages.signCellUI"},compId:14},{type:"Image",props:{y:1098,x:609,var:"back",skin:"shop/Btn_Back.png"},compId:17}]}],loadList:["sign/Ui_tree.png","sign/Ui_frameqiandao.png","sign/Ui_titleqiandao.png","sign/Btn_lingqu1.png","shop/Btn_Back.png"],loadList3D:[]},e.signUI=f,m("ui.pages.signUI",f);class v extends y{constructor(){super()}createChildren(){super.createChildren(),this.createView(v.uiView)}}v.uiView={type:"View",props:{width:225,height:209},compId:2,child:[{type:"Image",props:{y:0,var:"bg",skin:"sign/Ui_framething6.png",centerX:0},compId:3},{type:"Sprite",props:{y:199,x:12,texture:"sign/Ui_titlejiangli.png"},compId:4},{type:"Image",props:{y:93.5,x:65,var:"rewardImage",skin:"sign/Ui_Thing1.png"},compId:7},{type:"Image",props:{y:53.5,x:183,var:"dayNum",skin:"sign/Ui_day7.png"},compId:5},{type:"Image",props:{y:107.5,x:55,var:"received",skin:"sign/Ui_yilingqu.png"},compId:6}],loadList:["sign/Ui_framething6.png","sign/Ui_titlejiangli.png","sign/Ui_Thing1.png","sign/Ui_day7.png","sign/Ui_yilingqu.png"],loadList3D:[]},e.signCellUI=v,m("ui.pages.signCellUI",v);class k extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(k.uiView)}}k.uiView={type:"Dialog",props:{width:697,runtime:"uilogic/TargetLogic.ts",isModal:!0,height:700,autoDestroyAtClosed:!0},compId:2,child:[{type:"Image",props:{skin:"play/Ui_Target2.png",scaleY:1.4,scaleX:1.4,centerY:-130,centerX:0},compId:3,child:[{type:"List",props:{y:64,x:91,var:"openGateList",scaleY:1.3,scaleX:1.3},compId:5,child:[{type:"Box",props:{renderType:"render"},compId:6,child:[{type:"Image",props:{skin:"play/Ui_Monster0.png",name:"icon"},compId:7},{type:"Label",props:{y:13,x:170,text:"0/1",name:"num",fontSize:40,font:"Num1",color:"#ffffff"},compId:8}]}]},{type:"Sprite",props:{y:-20,x:424.5,width:67,var:"closeBtn",texture:"main/Btn_Close.png",height:66},compId:9},{type:"Image",props:{y:285,x:134.5,var:"checkBtn",skin:"count/Btn_GoWatch.png"},compId:10}]}],loadList:["play/Ui_Target2.png","play/Ui_Monster0.png","main/Btn_Close.png","count/Btn_GoWatch.png"],loadList3D:[]},e.targetUI=k,m("ui.pages.targetUI",k);class w extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(w.uiView)}}w.uiView={type:"Dialog",props:{width:720,runtime:"uilogic/TaskLogic.ts",isModal:!0,height:1280,autoDestroyAtClosed:!0},compId:2,child:[{type:"Box",props:{width:720,top:0,scaleY:.85,scaleX:.85,height:1280,centerX:0},compId:23,child:[{type:"Image",props:{y:170,x:0,width:720,skin:"lodge/Ui_frame.png",height:1089},compId:3},{type:"Button",props:{y:211,x:105,var:"dailyTask",stateNum:1,skin:"task/Ui_framedaytitle.png",name:"dailyTask"},compId:16,child:[{type:"Image",props:{y:0,x:-2,var:"dailyMask",skin:"task/Ui_Mask1.png"},compId:17},{type:"Sprite",props:{y:-11,x:245,var:"dayRed",texture:"main/Ui_RedPoint.png"},compId:22}]},{type:"Button",props:{y:210,x:374,var:"achieveTask",stateNum:1,skin:"task/Ui_frameachievementtitle.png",name:"achieveTask"},compId:18,child:[{type:"Image",props:{y:0,x:0,var:"achieveMask",skin:"task/Ui_Mask2.png"},compId:19},{type:"Sprite",props:{y:-11,x:255,var:"achieveRed",texture:"main/Ui_RedPoint.png"},compId:21}]},{type:"Image",props:{y:297,x:57,var:"dailyFrame",skin:"task/Ui_frameday.png"},compId:15},{type:"Image",props:{y:297,x:53,var:"achieveFrame",skin:"task/Ui_frameachievement.png"},compId:20},{type:"Button",props:{y:1132.5,x:612.5,var:"closeBtn",stateNum:1,skin:"lodge/Btn_back.png",name:"closeBtn"},compId:5},{type:"Image",props:{y:1189,x:375,width:58,skin:"lodge/Btn_arrow.png",rotation:90,height:146,anchorY:.5,anchorX:.5},compId:6},{type:"Image",props:{y:1160,x:155,visible:!1,skin:"task/Btn_change.png",rotation:0,anchorY:.5,anchorX:.5},compId:7},{type:"List",props:{y:335,x:112,width:530,var:"taskList",spaceY:10,repeatY:4,repeatX:1,height:814,elasticEnabled:!0},compId:11,child:[{type:"taskCell",props:{renderType:"render",runtime:"uilogic/TaskCellLogic.ts"},compId:12}]},{type:"Image",props:{y:9,x:0,skin:"task/Ui_zhi.png"},compId:13},{type:"Image",props:{y:101,x:511,skin:"task/Ui_titlexuanshang.png"},compId:14}]}],loadList:["lodge/Ui_frame.png","task/Ui_framedaytitle.png","task/Ui_Mask1.png","main/Ui_RedPoint.png","task/Ui_frameachievementtitle.png","task/Ui_Mask2.png","task/Ui_frameday.png","task/Ui_frameachievement.png","lodge/Btn_back.png","lodge/Btn_arrow.png","task/Btn_change.png","task/Ui_zhi.png","task/Ui_titlexuanshang.png"],loadList3D:[]},e.taskUI=w,m("ui.pages.taskUI",w);class I extends y{constructor(){super()}createChildren(){super.createChildren(),this.createView(I.uiView)}}I.uiView={type:"View",props:{y:0,x:0,width:530,runtime:"uilogic/TaskCellLogic.ts",height:180},compId:2,child:[{type:"Image",props:{var:"bg",top:0,skin:"task/Ui_framecomplete1.png",left:0},compId:3},{type:"Button",props:{var:"receiveBtn",stateNum:1,skin:"task/Btn_lingqu.png",right:0,bottom:0},compId:4},{type:"Label",props:{y:28,x:48.5,wordWrap:!0,width:445,var:"desc",text:"单场",height:65,fontSize:28,color:"#000000",bold:!0},compId:6},{type:"Image",props:{y:113.5,x:103,text:"奖励:",skin:"task/Ui_TaskWord.png",fontSize:30,color:"#ffffff"},compId:8,child:[{type:"Image",props:{y:-11.5,x:77,skin:"main/Ui_money.png"},compId:9},{type:"Label",props:{y:0,x:121,var:"reward",text:"1000",fontSize:30,color:"#ffffff"},compId:10}]}],loadList:["task/Ui_framecomplete1.png","task/Btn_lingqu.png","task/Ui_TaskWord.png","main/Ui_money.png"],loadList3D:[]},e.taskCellUI=I,m("ui.pages.taskCellUI",I);class L extends u{constructor(){super()}createChildren(){super.createChildren(),this.createView(L.uiView)}}L.uiView={type:"Dialog",props:{y:0,x:0,width:720,top:0,runtime:"uilogic/TranslationLogic.ts",right:0,left:0,isShowEffect:!1,isPopupCenter:!1,isModal:!1,height:1280,bottom:0,autoDestroyAtClosed:!0},compId:2,child:[{type:"Image",props:{x:-575,width:1520,skin:"translation/Ui_yun2.png",height:1176,centerY:-202},compId:4},{type:"Image",props:{x:-200,width:1026,skin:"translation/Ui_yun3.png",height:830,centerY:275},compId:5},{type:"Image",props:{x:-135,width:942,skin:"translation/Ui_yun1.png",height:810,centerY:-422},compId:3},{type:"Image",props:{x:-390,width:1134,skin:"translation/Ui_yun4.png",height:974,centerY:346},compId:6},{type:"Image",props:{x:177,var:"progressBar",skin:"translation/Ui_Loading2.png",bottom:152},compId:13,child:[{type:"Image",props:{y:2,x:-1,skin:"translation/Ui_Loading1.png"},compId:14,child:[{type:"Sprite",props:{width:426,var:"progressMask",renderType:"mask",height:86},compId:16}]}]},{type:"Image",props:{x:79,var:"progress",skin:"translation/Ui_Loading3.png",bottom:125},compId:12,child:[{type:"Label",props:{var:"progressLabel",text:"0%",fontSize:60,color:"#000000",centerY:81,centerX:0,bold:!0},compId:15}]}],animations:[{nodes:[{target:6,keyframes:{x:[{value:-390,tweenMethod:"sineIn",tween:!0,target:6,key:"x",index:0},{value:720,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:40}]}},{target:3,keyframes:{x:[{value:-135,tweenMethod:"sineIn",tween:!0,target:3,key:"x",index:0},{value:-1e3,tweenMethod:"linearNone",tween:!0,target:3,key:"x",index:40}]}},{target:5,keyframes:{x:[{value:-200,tweenMethod:"sineIn",tween:!0,target:5,key:"x",index:0},{value:-1100,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:40}]}},{target:4,keyframes:{x:[{value:-575,tweenMethod:"sineIn",tween:!0,target:4,key:"x",index:0},{value:900,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:40}]}}],name:"cloudOpen",id:1,frameRate:60,action:0}],loadList:["translation/Ui_yun2.png","translation/Ui_yun3.png","translation/Ui_yun1.png","translation/Ui_yun4.png","translation/Ui_Loading2.png","translation/Ui_Loading1.png","translation/Ui_Loading3.png"],loadList3D:[]},e.translationUI=L,m("ui.pages.translationUI",L);class x extends u{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/treasure")}}e.treasureUI=x,m("ui.pages.treasureUI",x)}(e.pages||(e.pages={}))}(o||(o={}));class f extends o.pages.taskUI{constructor(){super(...arguments),this.taskType=0}onOpened(){this.closeBtn.on(Laya.Event.CLICK,this,this.onButtonClick),this.dailyTask.on(Laya.Event.CLICK,this,this.onButtonClick),this.achieveTask.on(Laya.Event.CLICK,this,this.onButtonClick)}onAwake(){this.onMainRedUpdate(),this.taskList.vScrollBarSkin=null,this.onDailyTaskClick(),a.on(s.UpdateTask,this,this.onUpdateTask),a.on(s.MainRedUpdate,this,this.onMainRedUpdate)}onDestroy(){a.off(s.UpdateTask,this,this.onUpdateTask),a.off(s.MainRedUpdate,this,this.onMainRedUpdate)}onMainRedUpdate(){this.dayRed.visible=f.dayRed,this.achieveRed.visible=f.achieveRed}onButtonClick(e){t.playSound("click.mp3"),"closeBtn"==e.target.name?n.close(f):"dailyTask"==e.target.name?this.onDailyTaskClick():"achieveTask"==e.target.name&&this.onAchieveTaskClick()}onDailyTaskClick(){this.taskType=0,this.dailyMask.visible=!1,this.achieveMask.visible=!0,this.achieveFrame.visible=!1,this.dailyFrame.visible=!0;let e=k.instance.dayTaskId,t=[];for(let i=0;i<e.length;i++){let a=f.taskConfig1[e[i]],s={};if(s.index=i,s.type=0,s.goal=a.num,s.reward=a.reward,s.desc=a.desc.replace("*",s.goal),k.instance.dayTaskCountRec[i]>=s.goal){let e=k.instance.dayTaskReceiveRec[i];s.state=e?2:1}else s.state=0;t.push(s)}t.sort((e,t)=>1==e.state?-1:1==t.state?1:void 0),this.taskList.array=t,this.taskList.refresh()}onAchieveTaskClick(){this.taskType=1,this.dailyMask.visible=!0,this.achieveMask.visible=!1,this.achieveFrame.visible=!0,this.dailyFrame.visible=!1;let e=[];for(let t=0;t<f.taskConfig2.length;t++){let i=f.taskConfig2[t],a={};a.index=t,a.type=1,a.reward=i.reward;let s=k.instance.achieveTaskStage[t];if(a.goal=i.num[s],a.desc=i.desc.replace("*",a.goal),k.instance.achieveTaskCountRec[t]>=a.goal){let e=k.instance.achieveTaskReceiveRec[t];a.state=e?2:1}else a.state=0;e.push(a)}e.sort((e,t)=>1==e.state?-1:1==t.state?1:void 0),this.taskList.array=e,this.taskList.refresh()}onUpdateTask(){0==this.taskType?this.onDailyTaskClick():this.onAchieveTaskClick()}}f.taskConfig1=[{desc:"消灭*只任意妖灵",num:100,reward:200},{desc:"消灭*只金妖灵",num:50,reward:200},{desc:"消灭*只木妖灵",num:50,reward:200},{desc:"消灭*只水妖灵",num:50,reward:200},{desc:"消灭*只火妖灵",num:50,reward:200},{desc:"消灭*只土妖灵",num:50,reward:200},{desc:"使用*次任意道具",num:5,reward:200},{desc:"使用*次天雷符",num:3,reward:200},{desc:"使用*次八卦盘",num:3,reward:200},{desc:"使用*次踏云靴",num:3,reward:200},{desc:"使用*次补天石",num:4,reward:200},{desc:"通关*次",num:5,reward:200},{desc:"通关*次",num:8,reward:200}],f.taskConfig2=[{desc:"通关*关",num:[5,10,15,20,30,50,100],reward:100},{desc:"消灭*只妖灵",num:[50,200,400,600,800,1e3,2e3],reward:100},{desc:"消灭*只BOSS",num:[5,10,15,20,30,50,100],reward:100},{desc:"使用*次道具",num:[5,10,20,30,50,100,200],reward:100},{desc:"获得全部服装",num:[5],reward:500},{desc:"获得全部武器",num:[5],reward:500}],f.dayRed=!1,f.achieveRed=!1;class v{static getRandom(e,t){return Math.floor(e+Math.random()*(t-e+1))}}class k{constructor(e=null){if(this.energy=500,this.gold=500,this.diamond=500,this.level=1,this.playerID=0,this.playerUnlock=[1,0,0,0,0],this.weaponID=0,this.weaponUnlock=[1,0,0,0,0],this.weaponLevel=[0,0,0,0,0],this.propNum=[0,0,0,0],this.freeLotteryTimestamp=0,this.signDay=0,this.signTimestamp=0,this.signRec=[0,0,0,0,0,0,0],this.dayTaskRefreshTimestamp=0,this.dayTaskId=[0,0,0],this.dayTaskCountRec=[0,0,0],this.dayTaskReceiveRec=[0,0,0],this.achieveTaskCountRec=[0,0,0,0,0,0],this.achieveTaskReceiveRec=[0,0,0,0,0,0],this.achieveTaskStage=[0,0,0,0,0,0],e)for(const t in e)e.hasOwnProperty(t)&&e[t]&&(this[t]=e[t]);this.updateSign(),this.updateDayTask()}static get instance(){if(!k._instance){let e=Laya.LocalStorage.getItem(k._name);e&&(e=JSON.parse(e)),k._instance=new k(e)}return k._instance}onDataChange(e){Laya.LocalStorage.setItem(k._name,JSON.stringify(this)),a.event(s.UserDataChange,e)}finishTask(e,t,i){if(0==e){let e=this.dayTaskId.indexOf(t);-1!=e&&(this.dayTaskCountRec[e]+=i,this.onDataChange("dayTaskCountRec"))}else this.achieveTaskCountRec[t]+=i,this.onDataChange("achieveTaskCountRec")}updateSign(){if(this.signTimestamp>0){Date.now()-this.signTimestamp>864e5&&1==this.signRec[this.signDay]&&(this.signDay++,7==this.signDay&&(this.signDay=0,this.signRec=[0,0,0,0,0,0,0]),this.onDataChange("signDay"),this.onDataChange("signRec"))}}updateDayTask(){let e=Date.now();if(e-this.dayTaskRefreshTimestamp>864e5){let t=[];for(let e=0;e<f.taskConfig1.length;e++)t.push(e);this.dayTaskRefreshTimestamp=e,this.dayTaskId=[],this.dayTaskCountRec=[],this.dayTaskReceiveRec=[];for(let e=0;e<6;e++)this.dayTaskId.push(t.splice(v.getRandom(0,t.length-1),1)[0]),this.dayTaskCountRec.push(0),this.dayTaskReceiveRec.push(0);this.onDataChange("dayTaskRefreshTimestamp"),this.onDataChange("dayTaskId"),this.onDataChange("dayTaskCountRec"),this.onDataChange("dayTaskReceiveRec")}}}k._name="UserData";class w{constructor(){this.mapScene=1}clone(){let e=new w;return e.openGateMonster=this.openGateMonster,e.openGateBoss=this.openGateBoss,e.stepLimit=this.stepLimit,e.obsHp=this.obsHp,e.startAngry=this.startAngry,e.maxAngry=this.maxAngry,e.roundMaxAngry=this.roundMaxAngry,e.commonTreasureHp=this.commonTreasureHp,e.superTreasureHp=this.superTreasureHp,e.direction=this.direction,e.mapScene=this.mapScene,this.dropPercent&&(e.dropPercent=JSON.parse(JSON.stringify(this.dropPercent))),this.angryGrow&&(e.angryGrow=JSON.parse(JSON.stringify(this.angryGrow))),this.superTreasureCfg&&(e.superTreasureCfg=JSON.parse(JSON.stringify(this.superTreasureCfg))),this.commonTreasureCfg&&(e.commonTreasureCfg=JSON.parse(JSON.stringify(this.commonTreasureCfg))),this.bossCfg&&(e.bossCfg=JSON.parse(JSON.stringify(this.bossCfg))),this.monsterType&&(e.monsterType=JSON.parse(JSON.stringify(this.monsterType))),this.openGateSpecifyMonster&&(e.openGateSpecifyMonster=JSON.parse(JSON.stringify(this.openGateSpecifyMonster))),e}}class I{constructor(){this.levelConfig=null,this.levelData=null,this.levelDataClone=null,this.bossConfig=null,this.baseAttack=0,this.isPlayerOperate=!1,this.isPlayerKill=!1,this.isPlayerSkill=!1,this.isPlayerOther=!1,this.isOnlyThunder=!1,this.playLevel=1}static get Instance(){return this._instance||(this._instance=new I),this._instance}init(){this.levelConfig=t.getRes("level.json").layers[I.Instance.playLevel-1],this.bossConfig=t.getRes("bossproperty.json"),this.levelData=new w;let e=this.levelConfig.properties;for(let t=0;t<e.length;t++){const i=e[t];this.levelData[i.name]=JSON.parse(i.value)}this.levelDataClone=this.levelData.clone(),this.conditionArr=[],this.levelData.openGateSpecifyMonster&&this.conditionArr.push(0),this.levelData.openGateMonster&&this.conditionArr.push(1),this.levelData.openGateBoss&&this.conditionArr.push(2),this.bossTypeArr=[];for(const e in this.levelData.bossCfg)if(Object.prototype.hasOwnProperty.call(this.levelData.bossCfg,e)){let t=this.levelData.bossCfg[e];t.length>0&&this.bossTypeArr.push(t[0])}let i=k.instance.weaponLevel[k.instance.weaponID],a=3*k.instance.weaponID+i,s=t.getRes("shop.json");this.baseAttack=s[a].atk,window.GameDataManager=this}}!function(e){e.unknown="unknown",e.qq="qq",e.wechat="wx",e.tt="tt",e.oppo="oppo",e.vivo="vivo",e.editor="editor"}(r||(r={}));class L{constructor(){this.platform=r.unknown,this.adUnitId_Config={wx:{bannerId:"adunit-600e5803b384a747",videoId:"adunit-83207a1c986aa19e",interstitialId:"adunit-6bf85b548a02bcc8"},qq:{bannerId:"ad2918d389e3686713d15e9dd4aa85b2",videoId:"f643227e68419423ff634b594dc139a8",appBoxId:["8795f01ae515971a67967322f0a8bbfe","e7543f1deacad96dff7ad9a1d919c7bf"],blockId:"89bd30f53749f7b662ab31b5e8ee7614",interstitialId:"fc02726f82ae326434122b8d01664d58"},tt:{bannerId:null,videoId:null},oppo:{appId:"30500725",nativeId:["302929","302930"],videoId:"302928",bannerId:null,interstitialId:null,boxId:null},vivo:{appId:"100012178",nativeId:["fa3581708725480992aa5885d48a8a4c","c19765a97fef4481b9eaffd06d033fd4","29beaf0e15d0413b8b593cddd36c283c","a28c6641cdc34f4299513f829ccc6c04","5bad1eae21d547c9bb0ab28979b3d13b","48be9800f7da4cbc80bee9cfa0dd9323","94b31ba1dd614c28835f34e6fee80501","4d4d53ee56b54ac789c2f4ac04702cbf","a592cb77f0314063ac30acd8703c147e","181f8927cad849af82b7bb886ed7f494"],videoId:"081915e69c89445698fa91eb33a14442",bannerId:"0b2a4a8ed49d4b63897237331c9c5e19",interstitialId:"72e488c74a584e028551f6c8ecd6dc55"}},this.recommendConfig=[{name:"我冲的贼快",appId:"30444933",pkgName:"com.wcdzk.xxtch.nearme.gamecenter"},{name:"兽王争霸",appId:"30428233",pkgName:"com.monsterking.xxtch.nearme.gamecenter"},{name:"撞飞糖豆人",appId:"30439515",pkgName:"com.zftdr.xxtch.nearme.gamecenter"},{name:"音速少女",appId:"30348185",pkgName:"com.speedgirl.xxtch.nearme.gamecenter"},{name:"肥仔大冲撞",appId:"30439517",pkgName:"com.fzdcz.xxtch.nearme.gamecenter"},{name:"剁手狂欢",appId:"30439516",pkgName:"com.xx.cutmyhand.nearme.gamecenter"}],this.adUnitId_Banner=null,this.adUnitId_Video=null,this.adUnitId_AppBox=null,this.adUnitId_BlockAd=null,this.adUnitId_Interstitial=null,this.adUnitId_Native=null,this.adUnitId_OppoBox=null,this.rewardedVideoAd=null,this.bannerAd=null,this.interstitialAd=null,this.appBoxs=null,this.blockAd=null,this.nativeAd=[],this.nativeAdData=[],this.showAdList=[],this.boxAdSelf=null,this.boxAdOfficial=null,this.banner_Width=300,this.banner_Height=120,this.margin_Bottom=0,this.nativeLoadTime=0,this.video_OnLoad_Callback=null,this.video_OnClose_Callback=null,this.native_OnLoad_Callback=null,this.adList=[],this.isCheat=0,this.isShowNative=0,this.exchangeTime=0,this.delayTime=0,this.defaultOpen=0,this.oppoLimit=0,this.oppoShowBanner=0,this.boxTimeLimit=4,this.boxType=0,this.isOfficial=1,this.freeTry=0,this.showVideoEventId=0,this.isOld=0,this.forceAd=0,this.forceTimeDelay=18e4,this.forceTimeLeft=1,this.tryDelayTime=0,this.packDelayTime=0,this.reportShowPer=[],this.reportShowTimeLeft=2,this.refreshNativeTimeDelay=[],this.nativePer=[100,10,100,50,50,1],this.isNativeInsertShow=!1,this.mistakeSwitch=0,this.mistakeTimeDelay=0,this.pullTimeDelay=60,this.secondReportPer=0,this.nativeRefreshTimeDelay=10,this.thirdNativeBelong=0,this.improveExpPer=.3,this.rewardPurplePer=.02,this.moneyGodPer=0}static get Instance(){return null==this._instance&&(this._instance=new L),window.AllPlatformAdMgr=this._instance,this._instance}getPlatform(){if(window.wx)this.platform=r.wechat,window.tt&&(this.platform=r.tt),window.qq&&(this.platform=r.qq);else if(window.qg){let e=qg.getSystemInfoSync();"OPPO"==e.brand?this.platform=r.oppo:"vivo"==e.brand&&(this.platform=r.vivo)}else this.platform=r.editor}init(){this.getPlatform(),this.initAdId(),this.getCheatState().then(()=>{this.initAdComponent()})}initAdId(){switch(this.platform){case r.wechat:this.adUnitId_Video=this.adUnitId_Config.wx.videoId,this.adUnitId_Banner=this.adUnitId_Config.wx.bannerId,this.adUnitId_Interstitial=this.adUnitId_Config.wx.interstitialId;break;case r.qq:this.adUnitId_Video=this.adUnitId_Config.qq.videoId,this.adUnitId_Banner=this.adUnitId_Config.qq.bannerId,this.adUnitId_AppBox=this.adUnitId_Config.qq.appBoxId,this.adUnitId_BlockAd=this.adUnitId_Config.qq.blockId,this.adUnitId_Interstitial=this.adUnitId_Config.qq.interstitialId;break;case r.tt:this.adUnitId_Video=this.adUnitId_Config.tt.videoId,this.adUnitId_Banner=this.adUnitId_Config.tt.bannerId;break;case r.oppo:this.adUnitId_Video=this.adUnitId_Config.oppo.videoId,this.adUnitId_Interstitial=this.adUnitId_Config.oppo.interstitialId,this.adUnitId_Native=this.adUnitId_Config.oppo.nativeId,this.adUnitId_Banner=this.adUnitId_Config.oppo.bannerId,this.adUnitId_OppoBox=this.adUnitId_Config.oppo.boxId;break;case r.vivo:this.adUnitId_Video=this.adUnitId_Config.vivo.videoId,this.adUnitId_Interstitial=this.adUnitId_Config.vivo.interstitialId,this.adUnitId_Native=this.adUnitId_Config.vivo.nativeId,this.adUnitId_Banner=this.adUnitId_Config.vivo.bannerId}}initAdComponent(){switch(this.platform){case r.wechat:this.initVideoAd(),this.initBannerAd(),this.initInterstitialAd();break;case r.qq:this.initVideoAd(),this.initBannerAd(),this.initAppBox(),this.initBlockAd(),this.initInterstitialAd();break;case r.tt:break;case r.oppo:this.initVideoAd(),this.initBannerAd(),this.initNativeAd(),this.initBox(),this.refreshNativeAd(),this.updateReportShowTimeLeft();break;case r.vivo:this.initVideoAd(),this.initBannerAd(),this.initNativeAd(),this.initInterstitialAd(),this.refreshNativeAd(),this.updateReportShowTimeLeft()}}getCheatState(){return new Promise(e=>{let t=this.getAdconfigUrl();Laya.loader.load(t,Laya.Handler.create(this,t=>{t&&(this.isCheat=t.isCheat,this.isShowNative=t.isShowNative,this.exchangeTime=t.exchangeTime,this.delayTime=t.delayTime,this.defaultOpen=t.defaultOpen,this.oppoLimit=t.oppoLimit,this.oppoShowBanner=t.oppoShowBanner,this.isOfficial=t.isOfficial,this.freeTry=t.freeTry?t.freeTry:0,this.isOld=t.isOld?t.isOld:0,this.forceAd=t.forceAd?t.forceAd:0,this.tryDelayTime=t.tryDelayTime?t.tryDelayTime:0,this.mistakeSwitch=t.mistakeSwitch?t.mistakeSwitch:0,this.mistakeTimeDelay=t.mistakeTimeDelay?t.mistakeTimeDelay:0,this.packDelayTime=t.packDelayTime?t.packDelayTime:0,this.forceAd&&Laya.timer.once(12e4,this,()=>{this.forceTimeDelay=0}),this.reportShowPer=t.reportShowPer?t.reportShowPer:this.reportShowPer,this.refreshNativeTimeDelay=t.refreshNativeTimeDelay?t.refreshNativeTimeDelay:this.refreshNativeTimeDelay,this.nativePer=t.nativePer?t.nativePer:this.nativePer,this.pullTimeDelay=t.pullTimeDelay?t.pullTimeDelay:this.pullTimeDelay,this.secondReportPer=t.secondReportPer?t.secondReportPer:this.secondReportPer,this.nativeRefreshTimeDelay=t.nativeRefreshTimeDelay?t.nativeRefreshTimeDelay:this.nativeRefreshTimeDelay,this.thirdNativeBelong=t.thirdNativeBelong?t.thirdNativeBelong:this.thirdNativeBelong,this.adUnitId_Native=t.nativeId?t.nativeId:this.adUnitId_Native,this.improveExpPer=t.improveExpPer?t.improveExpPer:this.improveExpPer,this.rewardPurplePer=t.rewardPurplePer?t.rewardPurplePer:this.rewardPurplePer,this.moneyGodPer=t.moneyGodPer?t.moneyGodPer:this.moneyGodPer,e())}))})}getAdconfigUrl(){return`https://demo.xxtch.com/grindstone/adconfig/adconfig_${this.platform}_1.0.json?ran=${Math.floor(1e6*Math.random())}`}initBox(){if(this.platform===r.oppo){Laya.timer.once(60*this.boxTimeLimit*1e3,this,()=>{this.boxTimeLimit=0}),this.boxAdSelf=new Laya.Image("ads/Ui_Commontuijian.png"),this.boxAdSelf.width=Laya.stage.width,this.boxAdSelf.height=275;for(let e=0;e<this.recommendConfig.length;e++){let t=this.recommendConfig[e];if(t.appId==this.adUnitId_Config.oppo.appId){let i=new Laya.Image("ads/icon"+t.appId+".png");i.anchorY=.5,i.y=168,i.width=i.height=128,i.x=52+148*e,i.on(Laya.Event.CLICK,this,()=>{qg.navigateToMiniGame({pkgName:t.pkgName})}),this.boxAdSelf.addChild(i)}}qg.getSystemInfoSync().platformVersionCode>=1076&&(this.boxAdOfficial=qg.createGameBannerAd({adUnitId:this.adUnitId_OppoBox}),this.boxAdOfficial.onError(e=>{console.error(e)}),this.boxAdOfficial.onLoad(e=>{console.log(e)}))}}showBox(){(this.boxAdSelf||this.boxAdOfficial)&&(this.isOfficial&&this.boxAdOfficial?this.boxAdOfficial.show():(this.boxAdSelf.x=0,this.boxAdSelf.y=Laya.stage.height-this.boxAdSelf.height,Laya.stage.addChild(this.boxAdSelf)))}hideBox(){(this.boxAdSelf||this.boxAdOfficial)&&(this.isOfficial&&this.boxAdOfficial?this.boxAdOfficial.hide():Laya.stage.removeChild(this.boxAdSelf))}initBlockAd(){if(this.adUnitId_BlockAd&&this.platform===r.qq){let e=this.blockAd;e&&e.destroy();let t=qq.getSystemInfoSync();this.blockAd=qq.createBlockAd({adUnitId:this.adUnitId_BlockAd,style:{left:0,top:0},size:5,orientation:"landscape"}),(e=this.blockAd).onError(e=>{console.log(e)}),e.onResize(i=>{console.log(i);let a=t.screenHeight-i.height-300/t.pixelRatio,s=(t.screenWidth-i.width)/2;e.style.top=a,e.style.left=s})}}showBlockAd(){this.blockAd&&this.blockAd.show()}hideBlockAd(){this.blockAd&&this.initBlockAd()}getBannerStyle(){if(this.bannerAd&&this.platform==r.qq){return this.bannerAd.style}}initBannerAd(){if(this.adUnitId_Banner)if(this.platform===r.wechat){let e=this.bannerAd;e&&e.destroy();let t=wx.getSystemInfoSync();this.banner_Width=t.screenWidth;let i=(t.screenWidth-this.banner_Width)/2,a=t.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=wx.createBannerAd({adUnitId:this.adUnitId_Banner,adIntervals:30,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(e=this.bannerAd).onError(e=>{console.log(e)}),e.onResize(i=>{this.banner_Height=i.height,e.style.top=t.screenHeight-this.banner_Height-this.margin_Bottom})}else if(this.platform===r.qq){let e=this.bannerAd;e&&e.destroy();let t=qq.getSystemInfoSync(),i=(t.screenWidth-this.banner_Width)/2,a=t.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=qq.createBannerAd({adUnitId:this.adUnitId_Banner,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(e=this.bannerAd).onResize(i=>{this.banner_Height=i.height,e.style.top=t.screenHeight-this.banner_Height-this.margin_Bottom})}else if(this.platform===r.tt){this.banner_Width=208;let e=tt.getSystemInfoSync(),t=(e.screenWidth-this.banner_Width)/2,i=e.screenHeight-this.banner_Height-this.margin_Bottom,a=this.bannerAd;a&&a.destory(),this.bannerAd=tt.createBannerAd({adUnitId:this.adUnitId_Banner,adIntervals:30,style:{left:t,top:i,width:this.banner_Width}}),(a=this.bannerAd).onError(e=>{console.log(e)}),a.onResize(t=>{this.banner_Height=t.height,a.style.top=e.screenHeight-this.banner_Height-this.margin_Bottom})}else if(this.platform===r.oppo){let e=this.bannerAd;if(e)return;let t=qg.getSystemInfoSync();this.banner_Width=t.screenWidth;let i=(t.screenWidth-this.banner_Width)/2,a=t.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=qg.createBannerAd({adUnitId:this.adUnitId_Banner,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(e=this.bannerAd).onError(e=>{console.error(e)}),e.onResize(i=>{this.banner_Height=i.height,this.banner_Width=i.width,e.style.top=t.screenHeight-this.banner_Height-this.margin_Bottom,e.style.width=i.width,e.style.left=(t.screenWidth-i.width)/2})}else if(this.platform===r.vivo){let e=this.bannerAd;if(e)return;let t=qg.getSystemInfoSync();this.banner_Width=t.screenWidth;let i=(t.screenWidth-this.banner_Width)/2,a=t.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=qg.createBannerAd({posId:this.adUnitId_Banner,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(e=this.bannerAd).onError(e=>{console.error(e)}),e.onResize(i=>{this.banner_Height=i.height,this.banner_Width=i.width,e.style.top=t.screenHeight-this.banner_Height-this.margin_Bottom,e.style.width=i.width,e.style.left=(t.screenWidth-i.width)/2})}}initVideoAd(){if(this.adUnitId_Video)switch(this.platform){case r.wechat:this.rewardedVideoAd=wx.createRewardedVideoAd({adUnitId:this.adUnitId_Video});let e=this.rewardedVideoAd;e.onError(e=>{console.log(e)}),e.onClose(e=>{e.isEnded?(this.video_OnClose_Callback&&this.video_OnClose_Callback(),this.showVideoEventId&&(this.showVideoEventId=0)):this.showVideoEventId&&(this.showVideoEventId=0),this.video_OnClose_Callback=null});break;case r.qq:this.rewardedVideoAd=qq.createRewardedVideoAd({adUnitId:this.adUnitId_Video});let t=this.rewardedVideoAd;t.onError(e=>{console.log(e)}),t.onClose(e=>{e.isEnded?(this.video_OnClose_Callback&&this.video_OnClose_Callback(),qq.aly&&window.videoPosition&&(qq.aly.videoDot(window.videoPosition,"success"),window.videoPosition=void 0)):qq.aly&&window.videoPosition&&(qq.aly.videoDot(window.videoPosition,"fail"),window.videoPosition=void 0),this.video_OnClose_Callback=null});break;case r.tt:this.rewardedVideoAd=tt.createRewardedVideoAd({adUnitId:this.adUnitId_Video}),this.rewardedVideoAd.onError(e=>{console.log(e)});break;case r.oppo:this.rewardedVideoAd=qg.createRewardedVideoAd({adUnitId:this.adUnitId_Video});let i=this.rewardedVideoAd;i.onError(e=>{console.error(e),qg.showToast({title:"视频广告加载失败",icon:"none"})}),i.onClose(e=>{e.isEnded&&this.video_OnClose_Callback&&this.video_OnClose_Callback()}),i.onLoad(()=>{i.show()});break;case r.vivo:this.rewardedVideoAd=qg.createRewardedVideoAd({posId:this.adUnitId_Video});let a=this.rewardedVideoAd;a.onError(e=>{console.error(e),qg.showToast({title:"视频广告加载失败",icon:"none"})}),a.onClose(e=>{a.load(),e.isEnded&&this.video_OnClose_Callback&&this.video_OnClose_Callback(),Laya.SoundManager.musicMuted=!1}),a.onLoad(()=>{})}}initAppBox(){if(this.adUnitId_AppBox){this.appBoxs=[];for(let e=0;e<this.adUnitId_AppBox.length;e++){let t=this.adUnitId_AppBox[e],i=qq.createAppBox({adUnitId:t});this.appBoxs.push(i)}}}initInterstitialAd(){if(this.adUnitId_Interstitial)switch(this.platform){case r.wechat:this.interstitialAd=wx.createInterstitialAd({adUnitId:this.adUnitId_Interstitial}),this.interstitialAd.onError(e=>{console.log(e)});break;case r.qq:this.interstitialAd=qq.createInterstitialAd({adUnitId:this.adUnitId_Interstitial});let e=this.interstitialAd;e.onError(e=>{console.error("qq插屏广告加载失败",e)}),e.onLoad(()=>{console.log("qq插屏广告加载成功")});break;case r.oppo:this.interstitialAd=qg.createInsertAd({adUnitId:this.adUnitId_Interstitial});let t=this.interstitialAd;t.onError(e=>{console.error("oppo插屏广告加载失败",e)}),t.onLoad(()=>{console.log("oppo插屏广告加载成功")})}}initNativeAd(){if(this.adUnitId_Native&&(this.platform==r.oppo||this.platform==r.vivo)){if(this.nativeAd.length>0){for(let e=0;e<this.nativeAd.length;e++)this.nativeAd.shift().destroy();this.nativeAdData=[],this.showAdList=[]}if(this.platform==r.oppo){this.reportShowPer=[],this.refreshNativeTimeDelay=[];for(let e=0;e<this.adUnitId_Native.length;e++){let t=qg.createNativeAd({adUnitId:this.adUnitId_Native[e]});this.nativeAd.push(t),this.nativeAdData.push([]),this.showAdList.push([]),this.loadNativeAd(e),this.reportShowPer.push(1),this.refreshNativeTimeDelay.push(0)}}else if(this.platform==r.vivo)for(let e=0;e<this.adUnitId_Native.length;e++){let t=e;Laya.timer.once(5e3*t,this,()=>{let e=qg.createNativeAd({posId:this.adUnitId_Native[t]});this.nativeAd.push(e),this.nativeAdData.push([]),this.showAdList.push([]),this.loadNativeAd(t),this.reportShowPer.push(1),this.refreshNativeTimeDelay.push(0)})}}}loadNativeAd(e,t=!1){return new Promise(i=>{let a=this.nativeAd[e],s=this.nativeAdData[e],n=t=>{console.error("oppo原生广告出错"+e,t),a.offError(n),a.offLoad(o),i()},o=t=>{console.log("oppo原生广告加载成功"+e,t),this.nativeLoadTime++,2==this.nativeLoadTime&&Laya.timer.once(45e3,this,()=>{this.nativeLoadTime=0});for(let e=0;e<t.adList.length;e++){let i=t.adList[e];if(s.length>0)for(let e=0;e<s.length;e++){s[e].adId!=i.adId&&s.push(i)}else s.push(i)}a.offError(n),a.offLoad(o),i()};a.onError(n),a.onLoad(o),t?a.load():s.length>0?i():a.load()})}refreshNativeAd(){for(let e=0;e<this.nativeAd.length;e++){let t=this.refreshNativeTimeDelay[e];if(t>0){let i=e;Laya.timer.loop(1e3*t,this,()=>{this.loadNativeAd(i,!0)})}}}showNativeAd(e,t){this.platform!=r.editor&&(e=e<this.nativeAd.length?e:0,this.loadNativeAd(e).then(()=>{let i=this.nativeAdData[e],a=this.showAdList[e];for(let s=0;s<i.length;s++){let n=i[i.length-1-s];if(-1==a.indexOf(n))return t&&t(n),void this.reportNativeAdShow(e,n)}t&&t(null)}))}hideNativeAd(e,t){e=e<this.nativeAd.length?e:0;let i=this.showAdList[e];if(!i)return;let a=i.indexOf(t);console.log("hideNativeAd",a),-1!=a&&i.splice(a,1)}reportNativeAdClick(e,t){e=e<this.nativeAd.length?e:0;let i=this.showAdList[e],a=this.nativeAdData[e];if(!i||!a)return;let s=i.indexOf(t),n=a.indexOf(t);if(console.log("reportNativeAdClick",s,n),-1!=s&&i.splice(s,1),-1!=n&&a.splice(n,1),this.platform==r.oppo){let i=[0],a=[1];0==this.thirdNativeBelong?i.push(2):a.push(2),-1!=i.indexOf(e)||-1!=a.indexOf(e)&&(this.nativeAd[e].reportAdShow({adId:t.adId}),this.reportShowTimeLeft--,Math.random()<this.secondReportPer&&(this.reportShowTimeLeft--,Laya.timer.once(1e4,this,()=>{this.nativeAd[e].reportAdShow({adId:t.adId})})))}this.nativeAd[e].reportAdClick({adId:t.adId})}reportNativeAdShow(e,t){if(e=e<this.nativeAd.length?e:0,this.platform==r.vivo)this.nativeAd[e].reportAdShow({adId:t.adId});else if(this.platform==r.oppo){let i=[0],a=[1];0==this.thirdNativeBelong?i.push(2):a.push(2),-1!=i.indexOf(e)?this.reportShowTimeLeft>0&&(this.reportShowTimeLeft--,this.nativeAd[e].reportAdShow({adId:t.adId})):a.indexOf(e)}}updateReportShowTimeLeft(){Laya.timer.loop(1e3*this.pullTimeDelay,this,()=>{this.reportShowTimeLeft++})}showBannerAd(){if(this.bannerAd||this.platform!=r.oppo||!this.oppoShowBanner)switch(this.platform){case r.wechat:let e=this.bannerAd;e&&e.show();break;case r.qq:let t=this.bannerAd;t&&t.show();break;case r.tt:let i=this.bannerAd;i&&i.show();break;case r.oppo:let a=this.bannerAd;a&&a.show();break;case r.vivo:let s=this.bannerAd;s&&s.show()}}showVideoAd(e){if(this.platform===r.editor)e&&e();else{if(!this.rewardedVideoAd)return;switch(this.video_OnClose_Callback=e,this.platform){case r.wechat:this.rewardedVideoAd.show().catch(e=>{this.showVideoEventId&&(this.showVideoEventId=0),console.log("微信视频播放失败原因",e),wx.showToast({icon:"none",title:"视频播放失败",duration:1500})});break;case r.qq:qq.aly&&window.videoPosition&&qq.aly.videoDot(window.videoPosition,"show"),this.rewardedVideoAd.show().catch(e=>{console.log("qq视频播放失败原因",e),window.videoPosition=void 0,qq.showToast({icon:"none",title:"视频播放失败",duration:1500})});break;case r.tt:let t=this.rewardedVideoAd;e&&t.onClose(t=>{t.isEnded&&e&&e()}),t.show().catch(e=>{});break;case r.oppo:this.rewardedVideoAd.load();break;case r.vivo:Laya.SoundManager.musicMuted=!0,this.rewardedVideoAd.show()}}}showAppBox(e){if(this.platform!=r.editor)switch(this.platform){case r.qq:let t=this.appBoxs[e];t.load().then(()=>{t.show()})}}showInterstitialAd(e){if(e&&this.platform===r.editor&&e(),this.interstitialAd||this.platform==r.vivo)switch(this.platform){case r.wechat:this.interstitialAd.show();break;case r.qq:this.interstitialAd.show();break;case r.oppo:let t=this.interstitialAd;t.onClose(()=>{t.load(),e&&e()}),t.show();break;case r.vivo:this.interstitialAd=qg.createInterstitialAd({posId:this.adUnitId_Interstitial});let i=this.interstitialAd;i.onError(e=>{console.error("vivo插屏广告加载失败",e)}),i.onLoad(()=>{console.log("vivo插屏广告加载成功")}),i.show()}}hideBannerAd(){if(this.bannerAd&&(this.platform!=r.oppo||!this.oppoShowBanner))switch(this.platform){case r.wechat:this.bannerAd.hide();break;case r.qq:this.bannerAd.hide();break;case r.tt:this.bannerAd.hide();break;case r.oppo:this.bannerAd.hide();break;case r.vivo:this.bannerAd.hide()}}compareVersion(e,t){e=e.split(".");const i=Math.max(e.length,t.length);for(;e.length<i;)e.push("0");for(;t.length<i;)t.push("0");for(let a=0;a<i;a++){const i=parseInt(e[a]),s=parseInt(t[a]);if(i>s)return 1;if(i<s)return-1}return 0}}class x extends Laya.Script3D{constructor(){super(),this.camera=void 0}onSetAttr(){}onAwake(){this.camera=this.owner,this.Start()}onEnable(){}onDisable(){}Start(){var e=(Laya.stage.height/Laya.stage.width<1600/720?Math.round(720/Laya.stage.width*Laya.stage.height):1600)/1600;this.camera.fieldOfView*=e,window.cameraScale=e}onUpdate(){}}class S{constructor(){}static init(){null==S._instance&&(S._instance=new S,Laya.loader.load("shaderconfig.json",Laya.Handler.create(this,e=>{for(const t in e)if(e.hasOwnProperty(t)){const i=e[t];for(let e=0;e<i.length;e++){let a=i[e],s=new Laya.ShaderVariant(Laya.Shader3D.find(t),a.subShaderIndex,a.passIndex,a.defineNames);Laya.Shader3D.debugShaderVariantCollection.add(s)}}Laya.Shader3D.debugShaderVariantCollection.compile()})))}}S._instance=null;class _{constructor(){UIConfig.closeDialogOnSide=!1,Laya.Scene.root,Laya.Dialog.manager.name="DialogRoot",_._GameSceneRoot=new Laya.Sprite,_._GameSceneRoot.name="GameSceneRoot",_._GameUIRoot=new Laya.Sprite,_._GameUIRoot.name="GameUIRoot",_._UpRoot=new Laya.Sprite,_._UpRoot.name="UpRoot",_._UpDialogRoot=new Laya.Sprite,_._UpDialogRoot.name="UpDialogRoot",_._UI3D=new Laya.Sprite;let e=[_._GameSceneRoot,_._GameUIRoot,Laya.Scene.root,_._UpRoot,Laya.Dialog.manager,_._UpDialogRoot];for(let t=0;t<e.length;t++){let i=e[t];i.zOrder=t+1,i!=Laya.Scene.root&&i!=Laya.Dialog.manager&&Laya.stage.addChild(i)}Laya.stage.updateZOrder()}static init(){_._StageManager||(_._StageManager=new _)}static get UI3D(){return _._UI3D}static get GameSceneRoot(){return _._GameSceneRoot}static get GameUIRoot(){return _._GameUIRoot}static get UpRoot(){return _._UpRoot}static get UpDialogRoot(){return _._UpDialogRoot}}class C{static findNodeByUrl(e,t){let i=t.split("/"),a=e;for(let e=0;e<i.length;e++)a=a.getChildByName(i[e]);return a}static findNodeByName(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);return a.name==t?a:this.findNodeByName(a,t)}}static findNodeByType(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);return a instanceof t?a:this.findNodeByType(a,t)}}static findNodesByType(e,t){let i=[];for(let a=0;a<e.numChildren;a++){let s=e.getChildAt(a);s instanceof t&&i.push(s),s.numChildren>0&&(i=i.concat(this.findNodeByType(s,t)))}return i}static getComponent(e,t){return e.getComponent(t)}static getComponents(e,t){return e.getComponents(t)}static getComponentInChildren(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i),s=this.getComponent(a,t);return s||this.getComponentInChildren(a,t)}}static getComponentsInChildren(e,t){for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i),s=this.getComponents(a,t);return s||this.getComponentsInChildren(a,t)}}static tweenTo(e,t,i,a,s,n,o,r){let h={};for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){h[i+"Start"]=e.transform[i].clone();let a=new Laya.Vector3;Laya.Vector3.subtract(t[i],e.transform[i],a),h[i+"Diff"]=a}let l={value:0};return Laya.Tween.to(l,{value:1,update:Laya.Handler.create(this,()=>{for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let t=new Laya.Vector3,a=new Laya.Vector3;Laya.Vector3.scale(h[i+"Diff"],l.value,a),Laya.Vector3.add(h[i+"Start"],a,t),e&&e.transform&&(e.transform[i]=t)}},null,!1)},i,a,s,n,o,r)}static convert3DTo2DPosition(e,t){let i=new Laya.Vector4;return e.viewport.project(t,e.projectionViewMatrix,i),new Laya.Vector2(i.x/Laya.stage.clientScaleX,i.y/Laya.stage.clientScaleY)}}class A extends o.pages.lotteryUI{constructor(){super(...arguments),this.index=0,this.lotterconfig=[{per:.01,reward:"武器斩月",num:1},{per:.15,reward:"金币",num:288},{per:.2,reward:"踏云靴",num:1},{per:.2,reward:"天雷符",num:1},{per:.05,reward:"金币",num:588},{per:.05,reward:"金币",num:888},{per:.2,reward:"补天石",num:1},{per:.14,reward:"八卦盘",num:1}]}onOpened(){this.closeBtn.on(Laya.Event.CLICK,this,this.onButtonClick),this.freeLottery.on(Laya.Event.CLICK,this,this.onButtonClick),this.videoLottery.on(Laya.Event.CLICK,this,this.onButtonClick)}onAwake(){Date.now()-k.instance.freeLotteryTimestamp>864e5?this.setFree(!0):this.setFree(!1)}onButtonClick(e){t.playSound("click.mp3"),"closeBtn"==e.target.name?n.close(A):"freeLottery"==e.target.name?(this.lottery(),k.instance.freeLotteryTimestamp=Date.now(),k.instance.onDataChange("freeLotteryTimestamp"),this.setFree(!1),a.event(s.UpdateRed)):"videoLottery"==e.target.name&&L.Instance.showVideoAd(()=>{this.lottery()})}lottery(){let e=this.calculateResult();this.videoLottery.disabled=!0,this.freeLottery.disabled=!0,this.rotate(e,0).then(()=>{this.videoLottery.disabled=!1,this.freeLottery.disabled=!1;let e=n.open(se,!1);e.isGameCount=!1,e.setPageIndex(2),e.setRewardData(this.lotterconfig[this.index])})}setFree(e){this.freeLottery.visible=e,this.videoLottery.visible=!e}calculateResult(){let e=0,t=Math.random();for(let i=0;i<this.lotterconfig.length;i++){let a=this.lotterconfig[i];if(t<(e+=a.per))return console.log(a,i),i}}rotate(e,t){return new Promise(i=>{let a=200-10*t;t>16&&(a=200+10*(t-32)),Laya.timer.once(a,this,()=>{if(t++,this.index=++this.index%8,this.selectFrame.rotation=45*this.index,!(t<=24||this.index!=e))return i();this.rotate(e,t).then(()=>{i()})})})}}!function(e){e[e.Always=1]="Always",e[e.Never=2]="Never",e[e.IfAtMostOneObstacle=3]="IfAtMostOneObstacle",e[e.OnlyWhenNoObstacles=4]="OnlyWhenNoObstacles"}(h||(h={}));class b{constructor(e,t,i){this.x=e,this.y=t,this.walkable=void 0===i||i}}class U{constructor(e,t,i){let a;"object"!=typeof e?a=e:(t=e.length,a=e[0].length,i=e),this.width=a,this.height=t,this.nodes=this._buildNodes(a,t,i)}_buildNodes(e,t,i){let a=new Array(t);for(let i=0;i<t;++i){a[i]=new Array(e);for(let t=0;t<e;++t)a[i][t]=new b(t,i)}if(void 0===i)return a;if(i.length!==t||i[0].length!==e)throw new Error("Matrix size does not fit");for(let s=0;s<t;++s)for(let t=0;t<e;++t)i[s][t]&&(a[s][t].walkable=!1);return a}getNodeAt(e,t){return this.nodes[t][e]}isWalkableAt(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable}isInside(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}setWalkableAt(e,t,i){this.nodes[t][e].walkable=i}getNeighbors(e,t){let i=e.x,a=e.y,s=[],n=!1,o=!1,r=!1,l=!1,p=!1,d=!1,c=!1,g=!1,y=this.nodes;if(this.isWalkableAt(i,a-1)&&(s.push(y[a-1][i]),n=!0),this.isWalkableAt(i+1,a)&&(s.push(y[a][i+1]),r=!0),this.isWalkableAt(i,a+1)&&(s.push(y[a+1][i]),p=!0),this.isWalkableAt(i-1,a)&&(s.push(y[a][i-1]),c=!0),t===h.Never)return s;if(t===h.OnlyWhenNoObstacles)o=c&&n,l=n&&r,d=r&&p,g=p&&c;else if(t===h.IfAtMostOneObstacle)o=c||n,l=n||r,d=r||p,g=p||c;else{if(t!==h.Always)throw new Error("Incorrect value of diagonalMovement");o=!0,l=!0,d=!0,g=!0}return o&&this.isWalkableAt(i-1,a-1)&&s.push(y[a-1][i-1]),l&&this.isWalkableAt(i+1,a-1)&&s.push(y[a-1][i+1]),d&&this.isWalkableAt(i+1,a+1)&&s.push(y[a+1][i+1]),g&&this.isWalkableAt(i-1,a+1)&&s.push(y[a+1][i-1]),s}clone(){let e=this.width,t=this.height,i=this.nodes,a=new U(e,t),s=new Array(t);for(let a=0;a<t;++a){s[a]=new Array(e);for(let t=0;t<e;++t)s[a][t]=new b(t,a,i[a][t].walkable)}return a.nodes=s,a}}class B{constructor(e){this.defaultCmp=((e,t)=>e<t?-1:e>t?1:0),this.cmp=null!=e?e:this.defaultCmp,this.nodes=[]}push(e){return this.heappush(this.nodes,e,this.cmp)}pop(){return this.heappop(this.nodes,this.cmp)}peek(){return this.nodes[0]}contains(e){return-1!==this.nodes.indexOf(e)}replace(e){return this.heapreplace(this.nodes,e,this.cmp)}pushpop(e){return this.heappushpop(this.nodes,e,this.cmp)}heapify(){return this._heapify(this.nodes,this.cmp)}updateItem(e){return this._updateItem(this.nodes,e,this.cmp)}clear(){return this.nodes=[]}empty(){return 0===this.nodes.length}size(){return this.nodes.length}clone(){let e=new B;return e.nodes=this.nodes.slice(0),e}toArray(){return this.nodes.slice(0)}heappush(e,t,i){return null==i&&(i=this.defaultCmp),e.push(t),this._siftdown(e,0,e.length-1,i)}heappop(e,t){let i,a;return null==t&&(t=this.defaultCmp),i=e.pop(),e.length?(a=e[0],e[0]=i,this._siftup(e,0,t)):a=i,a}heapreplace(e,t,i){let a;return null==i&&(i=this.defaultCmp),a=e[0],e[0]=t,this._siftup(e,0,i),a}heappushpop(e,t,i){let a;return null==i&&(i=this.defaultCmp),e.length&&i(e[0],t)<0&&(t=(a=[e[0],t])[0],e[0]=a[1],this._siftup(e,0,i)),t}_heapify(e,t){null==t&&(t=this.defaultCmp);let i=function(){let t=[];for(let i=0,a=Math.floor(e.length/2);0<=a?i<a:i>a;0<=a?i++:i--)t.push(i);return t}.apply(this).reverse(),a=[];for(let s=0,n=i.length;s<n;s++){let n=i[s];a.push(this._siftup(e,n,t))}return a}_updateItem(e,t,i){let a;if(null==i&&(i=this.defaultCmp),-1!==(a=e.indexOf(t)))return this._siftdown(e,0,a,i),this._siftup(e,a,i)}_siftdown(e,t,i,a){let s,n,o;for(null==a&&(a=this.defaultCmp),s=e[i];i>t&&a(s,n=e[o=i-1>>1])<0;)e[i]=n,i=o;return e[i]=s}_siftup(e,t,i){let a,s,n,o,r;for(null==i&&(i=this.defaultCmp),s=e.length,r=t,n=e[t],a=2*t+1;a<s;)(o=a+1)<s&&!(i(e[a],e[o])<0)&&(a=o),e[t]=e[a],a=2*(t=a)+1;return e[t]=n,this._siftdown(e,r,t,i)}}class M{static manhattan(e,t){return e+t}static euclidean(e,t){return Math.sqrt(e*e+t*t)}static octile(e,t){var i=Math.SQRT2-1;return e<t?i*e+t:i*t+e}static chebyshev(e,t){return Math.max(e,t)}}class N{static backtrace(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()}static biBacktrace(e,t){let i=N.backtrace(e),a=N.backtrace(t);return i.concat(a.reverse())}static pathLength(e){let t,i,a,s,n=0;for(let o=1;o<e.length;++o)t=e[o-1],i=e[o],a=t[0]-i[0],s=t[1]-i[1],n+=Math.sqrt(a*a+s*s);return n}static interpolate(e,t,i,a){let s,n,o,r,h,l,p=Math.abs,d=[];for(s=e<i?1:-1,n=t<a?1:-1,h=(o=p(i-e))-(r=p(a-t));d.push([e,t]),e!==i||t!==a;)(l=2*h)>-r&&(h-=r,e+=s),l<o&&(h+=o,t+=n);return d}static expandPath(e){let t,i,a,s,n=[],o=e.length;if(o<2)return n;for(let r=0;r<o-1;++r){t=e[r],i=e[r+1],s=(a=N.interpolate(t[0],t[1],i[0],i[1])).length;for(let e=0;e<s-1;++e)n.push(a[e])}return n.push(e[o-1]),n}static smoothenPath(e,t){let i,a,s,n,o,r,h,l,p,d=t.length,c=t[0][0],g=t[0][1],y=t[d-1][0],u=t[d-1][1];o=[[i=c,a=g]];for(let c=2;c<d;++c){s=(r=t[c])[0],n=r[1],h=N.interpolate(i,a,s,n),p=!1;for(let t=1;t<h.length;++t)if(l=h[t],!e.isWalkableAt(l[0],l[1])){p=!0;break}if(p){let e=t[c-1];o.push(e),i=e[0],a=e[1]}}return o.push([y,u]),o}static compressPath(e){if(e.length<3)return e;let t,i,a,s,n,o=[],r=e[0][0],h=e[0][1],l=e[1][0],p=e[1][1],d=l-r,c=p-h;d/=n=Math.sqrt(d*d+c*c),c/=n,o.push([r,h]);for(let r=2;r<e.length;r++)t=l,i=p,a=d,s=c,d=(l=e[r][0])-t,c=(p=e[r][1])-i,c/=n=Math.sqrt(d*d+c*c),(d/=n)===a&&c===s||o.push([t,i]);return o.push([l,p]),o}}class P{constructor(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||M.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=h.OnlyWhenNoObstacles:this.diagonalMovement=h.IfAtMostOneObstacle:this.diagonalMovement=h.Never),this.diagonalMovement===h.Never?this.heuristic=e.heuristic||M.manhattan:this.heuristic=e.heuristic||M.octile}findPath(e,t,i,a,s){let n,o,r,h,l,p,d=new B(function(e,t){return e.f-t.f}),c=s.getNodeAt(e,t),g=s.getNodeAt(i,a),y=this.heuristic,u=this.diagonalMovement,m=this.weight,f=Math.abs,v=Math.SQRT2;for(c.g=0,c.f=0,d.push(c),c.opened=!0;!d.empty();){if((n=d.pop()).closed=!0,n===g)return N.backtrace(g);for(let e=0,t=(o=s.getNeighbors(n,u)).length;e<t;++e)(r=o[e]).closed||(h=r.x,l=r.y,p=n.g+(h-n.x==0||l-n.y==0?1:v),(!r.opened||p<r.g)&&(r.g=p,r.h=r.h||m*y(f(h-i),f(l-a)),r.f=r.g+r.h,r.parent=n,r.opened?d.updateItem(r):(d.push(r),r.opened=!0)))}return[]}}class D extends Laya.Script3D{onAwake(){this.scene3d=this.owner,this.camera=C.findNodeByUrl(this.scene3d,"MainCamera/Camera"),this.clearNode=new Laya.Sprite3D,this.clearNode.name="clearNode",this.scene3d.addChild(this.clearNode)}convert3DTo2DPosition(e){let t=new Laya.Vector4;return this.camera.viewport.project(e,this.camera.projectionViewMatrix,t),new Laya.Vector2(t.x/Laya.stage.clientScaleX,t.y/Laya.stage.clientScaleY)}}class T extends o.pages.targetUI{onAwake(){this.updateConditionUi(),this.checkBtn.visible=!1}onOpened(){this.closeBtn.on(Laya.Event.CLICK,this,this.onButtonClick),this.checkBtn.on(Laya.Event.CLICK,this,this.onButtonClick),Laya.stage.on(Laya.Event.CLICK,this,this.onClick),L.Instance.showBannerAd()}onClosed(){Laya.stage.off(Laya.Event.CLICK,this,this.onClick),L.Instance.hideBannerAd()}updateConditionUi(){let e=[],t=I.Instance.conditionArr,i=I.Instance.levelData,a=["Ui_Monster8.png","Ui_Monster7.png","Ui_Monster9.png","Ui_Monster6.png","Ui_Monster10.png"],s=["Ui_Monster4.png","Ui_Monster3.png","Ui_Monster2.png","Ui_Monster1.png","Ui_Monster5.png"];for(let n=0;n<t.length;n++){let o=t[n];0==o?e.push({icon:{skin:`play/${s[i.openGateSpecifyMonster[0]-1]}`},num:{text:i.openGateSpecifyMonster[1]}}):1==o?e.push({icon:{skin:"play/Ui_Monster0.png"},num:{text:i.openGateMonster}}):2==o&&e.push({icon:{skin:`play/${a[I.Instance.bossTypeArr[0]-1]}`},num:{text:i.openGateBoss}})}this.openGateList.array=e,this.openGateList.repeatY=e.length,this.openGateList.refresh()}onClick(){n.close(T)}onButtonClick(e){e.target==this.closeBtn?this.onClick():(e.target,this.checkBtn)}onDestroy(){Laya.stage.off(Laya.Event.CLICK,this,this.onButtonClick)}}class O{constructor(e){this.id=e.id,this.name=e.name,this.hp=e.hp,this.canMove=e.move,this.moveDistance=e.movedistance,this.propDrop=JSON.parse(e.fullprop),this.attack=e.attack,this.detectionType=e.detecition,this.attackType=e.attackpattern,this.attackRange=JSON.parse(e.attackrange)}}class R extends Laya.Script3D{constructor(){super(),this.camera=void 0,this.posAim=[0,2.44,-15.48],this.shockNum=0,this.shockNumMax=0,this.shockPoint=[[.2,0,.2],[0,.2,.2],[.2,.2,0],[0,0,.2],[0,0,0]],this.xMove=0,this.zMove=0,this.yMove=0,this.shockAni=""}onSetAttr(){}onAwake(){this.camera=this.owner,this.posAim=[]}onEnable(){}onDisable(){}onUpdate(){if(this.shockNum<this.shockNumMax){this.shockNum=this.shockNum+1;var e=1/this.shockNumMax*2*(this.shockNumMax/2-Math.abs(this.shockNumMax/2-this.shockNum));this.posAim=[this.xMove*e,this.yMove*e,this.zMove*e]}else this.shockAni="",this.posAim=[0,0,0],this.yMove=0,this.xMove=0,this.zMove=0;var t=this.camera.transform.position;this.camera.transform.position=new Laya.Vector3(t.x+(this.posAim[0]-t.x)/3,t.y+(this.posAim[1]-t.y)/3,0+(this.posAim[2]-t.z)/3)}shockFun(e,t){if(e==this.shockAni)return;this.shockAni=e;this.shockNum=0,this.shockNumMax=5,this.zMove=-1*Math.sin((t-90)/180*Math.PI),this.xMove=-.2*Math.cos((t-90)/180*Math.PI),this.yMove=0}shockFun2(e){var t=window.GameManager.roleScript.aniName;console.log(t);var i=window.GameManager.shockParam[7],a=window.GameManager.shockParam2[7];this.shockNum=0,this.shockNumMax=a,this.yMove=i}}!function(e){e.none="None",e.stone="Rock1",e.player="Player",e.gold="Enemy1",e.wood="Enemy2",e.water="Enemy3",e.fire="Enemy4",e.soil="Enemy5",e.gem="Gem",e.treasure="Treasure",e.door="Door",e.obs="Obs",e.boss="Boss"}(l||(l={})),function(e){e[e.none=0]="none",e[e.bg=1]="bg",e[e.stone=2]="stone",e[e.obs=3]="obs",e[e.treasure1=4]="treasure1",e[e.treasure2=5]="treasure2",e[e.boss1=6]="boss1",e[e.boss2=7]="boss2",e[e.player=8]="player"}(p||(p={})),function(e){e[e.shell=0]="shell",e[e.arrow=1]="arrow",e[e.shoe=2]="shoe",e[e.blood=3]="blood"}(d||(d={})),function(e){e.StandMain="StandMain",e.StandBattle="StandBattel",e.Attack1="Attack1",e.Attack2="Attack2",e.Attack3="Attack3",e.Attack4="Attack4",e.Attack5="Attack5",e.Return1="Return1",e.Return2="Return2",e.Return3="Return3",e.Return4="Return4",e.Return5="Return5",e.BattleStart="BattelStart",e.BattleIn="BattelIn",e.BattleOut="BattleOut",e.BattleEnd="BattelEnd",e.Skill1="Skill1",e.GetHit="GetHit",e.Death="Death"}(c||(c={})),function(e){e.Stand="Stand",e.Anger="Anger",e.Attack="Attack",e.Death="Death",e.Fear="Fear"}(g||(g={}));class E{constructor(){this.hp=1,this.canMove=!1}}class G{constructor(e=null){this.hp=e.hp}clone(){return new G(this)}}class V{}V.none="None",V.stand="Stand",V.death="Death",V.damage="Damage",V.run="Run",V.attack="Attack";class W extends Laya.AnimatorStateScript{constructor(){super()}onStateEnter(){this.stateEnterHandler&&this.stateEnterHandler.runWith(this.name)}onStateUpdate(){this.stateUpdateHandler&&this.stateUpdateHandler.runWith(this.name)}onStateExit(){this.stateExitHandler&&this.stateExitHandler.runWith(this.name)}}class F extends Laya.Script3D{AniEvent(e,t,i){this.stateTriggerHandler&&this.stateTriggerHandler.runWith([e,t,i])}}class K extends Laya.Script3D{constructor(){super(...arguments),this.animator=null,this.physicsCollider=null,this.rigidbody3D=null,this._curState=V.none,this._animationId=null,this.sign=null,this.actorData=null,this.gameObject=null}onAwake(){if(this.sign=K.name,this.animator=this.owner.getComponent(Laya.Animator),this.gameObject=this.owner,this.animator||(this.animator=C.getComponentInChildren(this.owner,Laya.Animator)),this.animator){this.animator.owner.addComponent(F).stateTriggerHandler=Laya.Handler.create(this,this.onStateTrigger,null,!1),this._states=this.animator.getControllerLayer(0)._states;for(let e=0;e<this._states.length;e++){let t=this._states[e],i=t.addScript(W);i.name=t.name,i.stateEnterHandler=Laya.Handler.create(this,this.onStateEnter,null,!1),i.stateUpdateHandler=Laya.Handler.create(this,this.onStateUpdate,null,!1),i.stateExitHandler=Laya.Handler.create(this,this.onStateExit,null,!1)}}this.physicsCollider=this.owner.getComponent(Laya.PhysicsCollider),this.rigidbody3D=this.owner.getComponent(Laya.Rigidbody3D)}onEnable(){this.onRegisterCustomEvent()}onDisable(){this.onCancelCustomEvent()}onCollisionEnter(e){}onCollisionStay(e){}onCollisionExit(e){}onTriggerEnter(e){}onTriggerStay(e){}onTriggerExit(e){}onStateEnter(e){}onStateUpdate(e){}onStateExit(e){}onStateTrigger(e,t,i){}onRegisterCustomEvent(){}onCancelCustomEvent(){}changeActorState(e,t){e==this._curState&&this._animationId==t||(this.onAnimationChange(e+t),this._curState=e,this._animationId=t)}onAnimationChange(e){this.animator&&this.animator.play(e,0,0)}onRecovery(){this.owner.removeSelf(),Laya.Pool.recover(this.sign,this)}onInit(e){this.actorData=new G(e)}onDamage(e){0!=this.actorData.hp&&(this.actorData.hp-=e,this.actorData.hp<=0&&(this.actorData.hp=0,this.changeActorState(V.death,"")))}get curState(){return this._curState}get animationId(){return this._animationId}}class q extends K{constructor(){super(...arguments),this.x=0,this.y=0,this.hpLabel=null,this.haveKey=!1,this.treasureActor=null,this.isSelect=!1,this.color=l.none,this.unionData=null,this.key=null,this.keyParentNode=null,this.isAngry=!1,this.attackId=1,this.isLock=!0,this.isDeath=!1,this.isPlayer=!1,this.isBoss=!1,this.angryEffect=null,this.grayGameObject=null,this.grayAnimator=null,this.grayAngryEffect=null,this.isGem=!1,this.isJar=!1}onAwake(){if(super.onAwake(),this.sign=q.name,this.isPlayer=-1!=this.owner.name.indexOf("Player"),this.isBoss=-1!=this.owner.name.indexOf("Boss"),this.isGem=-1!=this.owner.name.indexOf("Gem"),this.isJar=-1!=this.owner.name.indexOf("Jar"),this.isPlayer?this.changeActorState("StandMain",""):this.isBoss?this.changeActorState("StandAnger",""):this.isGem?this.changeActorState("GemStand",""):this.changeActorState("Stand",""),this.isPlayer)for(let e=0;e<6;e++){let i=t.getResClone(`FX_KnifeLight${e+1}.lh`);this.gameObject.getChildAt(0).addChild(i),i.transform.localPosition=new Laya.Vector3,i.transform.localRotationEuler=new Laya.Vector3,i.active=!1}}onStateEnter(e){}onStateUpdate(e){}onStateExit(e){"Death"==e&&(this.isPlayer||Laya.timer.frameOnce(1,this,()=>{this.gameObject.destroy()})),this.isPlayer&&-1!=e.indexOf("Attack")&&a.event(s.AttackEnd),this.isPlayer?a.event(s.OnStateExit,e):-1!=e.indexOf("Attack")?this.isAngry&&!this.isBoss&&this.setAngry(!1):"Anger"==e&&this.changeActorState("StandAnger","")}onStateTrigger(e,t,i){this.isPlayer?"Move"==i?a.event(s.AttackMove):"Attack"==i&&a.event(s.AttackDamage):"Attack"==i&&a.event(s.EnemyAttack)}onRegisterCustomEvent(){}onCancelCustomEvent(){}onDestroy(){super.onDestroy(),this.hpLabel&&(this.hpLabel.destroy(),this.hpLabel=null)}onInit(e){this.unionData=e,this.setHp(this.unionData?this.unionData.hp:0)}setHp(e){e>1?(this.hpLabel||(this.hpLabel=new Laya.FontClip,this.hpLabel.sheet="0123456789",this.hpLabel.skin="play/Atk_Num10.png",_.GameUIRoot.addChild(this.hpLabel)),this.hpLabel.value=e+"",this.hpLabel.visible=!0):this.hpLabel&&(this.hpLabel.visible=!1)}setKey(e,i=null){return new Promise(a=>{this.haveKey=e,this.treasureActor=i,this.keyParentNode||(this.keyParentNode=new Laya.Sprite3D,this.gameObject.addChild(this.keyParentNode),this.key=t.getResClone("key"),this.keyParentNode.addChild(this.key),this.key.transform.localPosition=new Laya.Vector3),this.keyParentNode&&(this.keyParentNode.active=e),a()})}setAngry(e){return new Promise(i=>{if(this.isAngry=e,this.isAngry?this.isBoss?this.changeActorState("StandAnger",""):this.changeActorState("Anger",""):this.isGem?this.changeActorState("GemStand",""):this.changeActorState("Stand",""),e){if(!this.angryEffect){let e="Fx_AngerBoss.lh";if(!this.isBoss){let t=this.gameObject.name;e=`Fx_Anger${t[t.length-1]}.lh`}this.angryEffect=t.getResClone(e),this.angryEffect.transform.position=new Laya.Vector3,this.gameObject.addChild(this.angryEffect)}this.angryEffect.active=!0}else this.angryEffect&&(this.angryEffect.active=!1);Laya.timer.once(1300,this,()=>{i()})})}onUpdate(){super.onUpdate(),this.keyParentNode&&1==this.keyParentNode.active&&this.keyParentNode.transform.rotate(new Laya.Vector3(0,1,0),!0,!0)}lookAtActor(e){let t=0;this.x==e.x&&this.y==e.y-1?t=0:this.x==e.x&&this.y==e.y+1?t=180:this.y==e.y&&this.x==e.x-1?t=90:this.y==e.y&&this.x==e.x+1?t=270:this.x==e.x-1&&this.y==e.y-1?t=45:this.x==e.x-1&&this.y==e.y+1?t=135:this.y==e.y-1&&this.x==e.x+1?t=315:this.y==e.y+1&&this.x==e.x+1&&(t=225),this.gameObject.getChildAt(0).transform.localRotationEuler=new Laya.Vector3(0,t,0)}attack(e){return new Promise(i=>{this.changeActorState(V.attack,""),this.isBoss?t.playSound("bossAttack.mp3"):t.playSound("monsterAttack.mp3"),this.showEnemyAttackEffect(),a.once(s.EnemyAttack,this,()=>{for(let t=0;t<e.length;t++){let i=e[t];i.setDamage(i.unionData.hp)}Laya.timer.once(1e3,this,()=>{i()})})})}showEnemyAttackEffect(){let e=this.gameObject.name,i="EnemyKnifeLight"+e.slice(e.length-1)+".lh";this.isBoss&&(i="BossKnifeLight"+e.slice(e.length-1)+".lh");let a=t.getResClone(i);a.transform.position=this.gameObject.transform.position.clone(),this.gameObject.parent.addChild(a),Laya.timer.once(3e3,this,()=>{a&&!a.destroyed&&a.destroy()})}setDamage(e){if(this.unionData.hp-=e,this.unionData.hp=this.unionData.hp>0?this.unionData.hp:0,this.unionData.hp>0)this.changeActorState(V.damage,"");else if(this.isDeath=!0,this.color==l.gem)this.createDeathBody("GemC.lh");else if(this.color==l.obs){t.playSound("destroyObs.mp3");let e=this.gameObject.name,i=`JarC${e[e.length-1]}.lh`;this.createDeathBody(i)}else if(this.color==l.boss){let e=this.gameObject.name,i=`BossC${e[e.length-1]}.lh`;this.createDeathBody(i),t.playSound("bossDie.mp3")}else if(this.color==l.gold||this.color==l.wood||this.color==l.water||this.color==l.fire||this.color==l.soil){let e=this.gameObject.name,t=`EnemyC${e[e.length-1]}.lh`;this.createDeathBody(t)}else this.changeActorState(V.death,""),this.haveKey&&this.setKey(!1,this.treasureActor);this.setHp(this.unionData.hp)}refreshHpPos(e){this.hpLabel&&(this.hpLabel.x=e.x,this.hpLabel.y=e.y)}refreshAngryPos(e){}playerPlayAttackAni(e=!1){e?this.changeActorState(V.attack,"6"):(this.changeActorState(V.attack,`${this.attackId}`),this.attackId++,this.attackId=this.attackId>5?1:this.attackId),this.showAttackEffect()}createDeathBody(e){if(Laya.timer.frameOnce(1,this,()=>{this.gameObject.destroy()}),this.gameObject&&this.gameObject.transform){let i=t.getResClone(e);i.transform.position=this.gameObject.transform.position.clone(),this.gameObject.parent.addChild(i),Laya.timer.once(2500,null,()=>{if(i&&i.transform){let e=i.transform.position.clone();e.y-=1,C.tweenTo(i,{position:e},1e3,Laya.Ease.linearNone,Laya.Handler.create(null,()=>{i&&i.destroy()}))}})}}showDamageEffect(){let e=t.getResClone("FX_EnemyHit.lh");this.gameObject.parent.addChild(e),e.transform.position=this.gameObject.transform.position.clone(),Laya.timer.once(2e3,this,()=>{e&&!e.destroyed&&e.destroy()})}showAttackEffect(){let e=this.gameObject.getChildAt(0).getChildByName(`FX_KnifeLight${this.animationId}`);e.active=!1,e.active=!0,Laya.timer.once(3e3,this,()=>{e&&(e.active=!1)})}setGameObjectGray(e){if(e){if(0==this.gameObject.active)return;if(this.gameObject.active=!1,!this.grayGameObject){let e=this.gameObject.name,i=e.slice(0,e.length-1)+"G"+e.slice(e.length-1)+".lh";this.isGem&&(i="GemG.lh"),this.grayGameObject=t.getResClone(i),this.gameObject.parent.addChild(this.grayGameObject),this.isJar||(this.grayAnimator=C.getComponentInChildren(this.grayGameObject,Laya.Animator),this.isGem&&(this.grayAnimator=this.grayGameObject.getComponent(Laya.Animator)),this.grayAnimator||console.log(e,"没有动画控制器"))}this.grayGameObject.active=!0,this.grayGameObject.transform.position=this.gameObject.transform.position.clone(),this.isJar||this._curState+this._animationId!="Anger"&&this.grayAnimator.play(this._curState+this._animationId,0,0),this.setGrayAngry(this.isAngry)}else{if(1==this.gameObject.active)return;this.gameObject.active=!0;let e=this._curState,t=this._animationId;this._curState="",this._animationId="",this.changeActorState(e,t),this.grayGameObject&&(this.grayGameObject.active=!1)}}setGrayAngry(e){if(this.isJar||(e?this.grayAnimator.play("StandAnger",0,0):this.isGem?this.grayAnimator.play("GemStand",0,0):this.grayAnimator.play("Stand",0,0)),e){if(!this.grayAngryEffect){let e="Fx_AngerBossG.lh";this.isBoss||(e="Fx_AngerG.lh"),this.grayAngryEffect=t.getResClone(e),this.grayAngryEffect.transform.position=new Laya.Vector3,this.grayGameObject.addChild(this.grayAngryEffect)}this.grayAngryEffect.active=!0}else this.grayAngryEffect&&(this.grayAngryEffect.active=!1)}}class j{constructor(e,t){this.x=0,this.y=0,this.vec3Pos=null,this.vec2Pos=null,this.blockId=p.none,this.x=e,this.y=t,this.vec3Pos=new Laya.Vector3(-3+e,0,-6+t)}}class H{constructor(){this.detectionType=0,this.attackRange=[3,3],this.attackType=0,this.attack=1,this.canMove=1,this.hp=1}}class X extends D{constructor(){super(...arguments),this.playerActor=null,this.nodeMap=[],this.actorMap=[],this.lineArr=[],this.circleArr=[],this.outRay=new Laya.Ray(new Laya.Vector3,new Laya.Vector3),this.outHitResult=new Laya.HitResult,this.roundNum=1,this.roundType=0,this.killMonsterNum=[0,0,0,0,0],this.killBossNum=0,this.lastAttackHeavy=!1,this.colorMap=new Map,this.concatColorArr=null,this.selectNode=[],this.linkNum=0,this._attack=0,this.timeDelayMax=200,this.timeDelayMin=100,this.timeDelayCur=0,this.isWrongLink=!1,this.wrongLinkLine=null,this.wrongLinkCircle=null,this.comboNum=0,this.cameraOriginalPos=null,this.cameraOriginalRot=null,this.cameraAnimator=null,this.cameraShakeScript=null,this.warnArr=[],this.instantAttack=0,this.isCount=!1,this.killMonsterName=null,this.lightList=[],this.addStepSpine=null,this.gameState=0,this.killMonsterCount=0,this.isRevive=!1,this.guideDropConfig={level1:[[2,2,13,13,13,2,2,2,13,12,12,13,12,2,2,13,12,12,13,12,2,2,12,12,12,13,12,2,2,12,12,13,12,12,2,2,12,12,13,12,12,2,2,2,2,8,2,2,2],[2,2,12,13,13,2,2,2,12,12,13,13,12,2,2,8,12,12,13,12,2,2,12,12,12,13,12,2,2,12,12,12,12,12,2,2,12,12,12,12,12,2,2,2,2,12,2,2,2],[2,2,12,13,13,2,2,2,12,12,13,13,12,2,2,13,13,13,13,12,2,2,12,12,12,8,12,2,2,12,12,12,12,12,2,2,12,12,12,12,12,2,2,2,2,12,2,2,2]],level3:[[11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12]]},this.guideDiamondConfig={level1:[null,[4,2]]},this.guideAngryConfig={level2:[[4,2]]},this.isGuide=!1,this.guideSelectNode=[],this.guideSelectIndex=0,this.guideSpine=null,this.guideConfig=[[{task:"开始引导语",talk:"修炼之路上充满着各色的妖灵，你的任务就是把它们清理干净",finishType:0},{task:"连接10个蓝色妖灵",talk:"从我所在位置开始，选择一条穿过10个蓝色妖灵的攻击路径",finishType:1},{task:"连接正常情况",talk:"正常情况下，只能穿过颜色相同的妖灵",finishType:0},{task:"宝石介绍",talk:"看！彩色的宝石！",finishType:0},{task:"穿过宝石连线",talk:"穿过宝石后，就可以攻击其他颜色的妖灵啦！",finishType:1},{task:"关卡目标",talk:"这个关卡的目标是清理20个蓝色妖灵，完成目标吧",finishType:0}],[{task:"愤怒怪物指示",talk:"啊哦！这个妖灵愤怒了",finishType:0},{task:"愤怒怪物介绍",talk:"如果攻击路径终点在这些危险的红色区域，将会受到攻击！",finishType:0}],[{task:"BOSS介绍",talk:"这是只强大的妖灵！攻击他需要更强大的力量",finishType:0},{task:"BOSS血量",talk:"右下角的数字表示他的强壮程度",finishType:0},{task:"BOSS击杀",talk:"连接更多的妖灵来提升威力，击倒他！",finishType:1}],[{task:"法术介绍",talk:"战斗遇到困难，可以使用法术来打破窘境",finishType:0},{task:"使用天雷符",talk:"让我试试天雷符吧",finishType:1},{task:"天雷符使用完成",talk:"没错，天雷符可以随机消灭7个妖灵",finishType:0},{task:"八卦盘介绍",talk:"八卦盘可以刷新所有妖灵的位置",finishType:0},{task:"踏云靴介绍",talk:"踏云靴可以增加行动步数",finishType:0},{task:"补天石介绍",talk:"补天石可以立即召唤一个彩色宝石",finishType:0}]],this.maskLayer=null,this.talkImage=null,this.talkBg=null,this.guideId1=0,this.guideId2=0,this.touchFinishGuide=!1,this.controlDrop=!1,this.controlAngry=!1,this.controlDiamond=!1,this.lastDir=-1}onAwake(){Laya.MouseManager.enabled=!0,super.onAwake(),this.updateGuide(),this.initGuideId(),this.initAstar(),this.addKillNum(0),this.initNodeMap(),this.clearActorMap(),this.initActorMap(),this.showObsHp(!1),this.addCameraShakeScript(),this.getCameraOriginalTrans(),this.cameraAnimator=this.camera.parent.getComponent(Laya.Animator),this.cameraAnimator.play("CameraStand",0,0),this.playerActor.gameObject.active=!1;let e=n.open(T,!1);I.Instance.isPlayerOperate=!1,e.closeHandler=Laya.Handler.create(this,()=>{Laya.timer.once(900,this,()=>{this.playerActor.gameObject.active=!0,this.playerShow().then(()=>{this.showObsHp(!0),this.concatColorArr=this.updateConcatColorArr(this.playerActor),this.playerActor.changeActorState(c.StandMain,""),this.roundType=1,window.GameSceneLogic=this,Promise.resolve().then(()=>this.isGuide&&this.controlDrop?this.dropMonsterByConfig():this.dropMonster()).then(()=>(console.log("掉落怪物完成"),this.dropBoss())).then(()=>(console.log("掉落boss完成"),this.isGuide&&this.controlAngry?this.setAngryByConfig():this.setEnemyAngry())).then(()=>{console.log("设置怪物生气完成")}).then(()=>{this.loadGuideSpine().then(()=>{this.isGuide?(this.initGuide(),this.showTalk(null,!1),a.on(s.NewGuideEvent,this,this.onNewGuideEvent),a.event(s.NewGuideEvent)):(I.Instance.isPlayerOperate=!0,I.Instance.isPlayerKill=!0,I.Instance.isPlayerSkill=!0,I.Instance.isPlayerOther=!0,this.showPlayerPointer(I.Instance.isPlayerKill)),this.roundType=0,a.on(s.ControllerEvent,this,this.onControllerEvent),a.on(s.UseSkill,this,this.useProp),a.on(s.PlayerRevive,this,this.revive),Laya.stage.on(Laya.Event.CLICK,this,this.onGuideEvent)})})})})})}initAstar(){let e=I.Instance.levelConfig;this.grid=new U(e.width,e.height),this.astar=new P({allowDiagonal:!0}),this.astar.diagonalMovement=h.Always}onControllerEvent(e,t){if("go"==e);else if("scene"==e)if(t.type==Laya.Event.MOUSE_UP){if(this.selectNode.length>0){if(this.lastDir=-1,this.isGuide){if(this.guideSelectNode.length>0&&this.guideSelectNode.length!=this.guideSelectIndex){console.log("引导中没有连够足够的节点");for(let e=0;e<this.selectNode.length;){let t=this.selectNode[e];this.removeSelect(t,e)}return void this.removeWrongSelect()}this.guideId2++,this.guideSpine&&1==this.guideSpine.visible&&(this.guideSpine.visible=!1),this.showTalk(null,!1)}this.roundType=1,this.timeDelayCur=this.timeDelayMax,a.event(s.UpdatePointer,[!1,null]),this._attack=0,a.event(s.UpdateAttack,[this._attack+I.Instance.baseAttack]),this.useStep(1),this.concatColorArr=this.updateConcatColorArr(this.playerActor),Laya.MouseManager.enabled=!1,this.removeWrongSelect(),this.roundNum++,this.selectNode.length>=7&&(this.lastAttackHeavy=!0),this.showWarn(!1),this.instantAttack=0,this.updateLightList(null),a.event(s.ShowCombo,[!0,0]),a.event(s.ConnectTip,0),I.Instance.isPlayerOperate=!1,I.Instance.isPlayerKill=!1,I.Instance.isPlayerSkill=!1,I.Instance.isPlayerOther=!1,this.showBossAttackTip(!1),this.showPlayerPointer(I.Instance.isPlayerKill),Promise.resolve().then(()=>this.killEverything()).then(()=>(console.log("杀人完成"),Laya.timer.scale=1,this.isGuide&&this.controlDiamond?this.dropDiamondByConfig():this.throwDiamond())).then(()=>(console.log("扔钻石完成"),this.angryAttack())).then(()=>(console.log("生气怪物攻击完成"),this.arrangeMap())).then(()=>(console.log("整理地图完成"),this.isGuide&&this.controlDrop?this.dropMonsterByConfig():this.dropMonster())).then(()=>(console.log("掉落怪物完成"),this.dropBoss())).then(()=>(console.log("掉落boss完成"),this.bossApproachPlayer())).then(()=>(console.log("boss接近主角结束"),this.isGuide&&this.controlAngry?this.setAngryByConfig():this.setEnemyAngry())).then(()=>{console.log("设置怪物生气完成"),this.updateGuide(),this.roundType=0,this.addLinkNum(-this.linkNum),this.judgeLevelCount(),Laya.timer.once(500,this,()=>{this.isGuide?a.event(s.NewGuideEvent):(I.Instance.isPlayerOperate=!0,I.Instance.isPlayerKill=!0,I.Instance.isPlayerSkill=!0,I.Instance.isPlayerOther=!0,this.showPlayerPointer(I.Instance.isPlayerKill)),Laya.MouseManager.enabled=!0})})}}else{let e=this.getTouchPoint(new Laya.Point(t.stageX,t.stageY)),i=this.getTouchCellPos(e);if(i){let e=this.getLastNode(),a=this.grid.clone();this.updateWalkableNode(a);let s=this.astar.findPath(e.x,e.y,i.x,i.y,a);if(this.isGuide&&this.guideSelectNode.length>0){let e=this.actorMap[i.y][i.x],t=this.guideSelectNode.indexOf(e);if(-1!=t){s=[];for(let e=0;e<t+1;e++){let t=this.guideSelectNode[e];s.push([t.x,t.y])}}}if(s&&s.length>0)for(let e=0;e<s.length;e++){const a=s[e];i.x=a[0],i.y=a[1],this.onListEvent(i,t)}else i.x=this.playerActor.x,i.y=this.playerActor.y,this.onListEvent(i,t)}else a.event(s.BigBlood,0)}}getLastNode(){let e=this.playerActor;return this.selectNode.length>0&&(e=this.selectNode[this.selectNode.length-1]),e}initNodeMap(){this.nodeMap=[];let e=I.Instance.levelConfig;for(let t=0;t<e.height;t++){let i=[];for(let a=0;a<e.width;a++){let s=t*e.width+a,n=new j(a,t);n.vec2Pos=this.convert3DTo2DPosition(n.vec3Pos.clone()),n.blockId=e.data[s],i.push(n)}this.nodeMap.push(i)}}initActorMap(){for(let e=0;e<this.nodeMap.length;e++)for(let t=0;t<this.nodeMap[e].length;t++){let i=this.nodeMap[e][t];if(i.blockId==p.stone){let a=`Obs${I.Instance.levelData.mapScene}`;this.actorMap[e][t]=this.createActor(l.stone,a,null,null),this.actorMap[e][t].gameObject.transform.position=i.vec3Pos.clone(),this.actorMap[e][t].x=t,this.actorMap[e][t].y=e}else if(i.blockId==p.player)this.actorMap[e][t]=this.createActor(l.player,l.player,k.instance.playerID+1,new E),this.actorMap[e][t].gameObject.transform.position=i.vec3Pos.clone(),this.playerActor=this.actorMap[e][t],this.actorMap[e][t].x=t,this.actorMap[e][t].y=e,this.addWeapon(this.playerActor);else if(i.blockId==p.obs){let a=new E;a.hp=1,this.actorMap[e][t]=this.createActor(l.obs,`Jar${I.Instance.levelData.mapScene}`,null,a),this.actorMap[e][t].gameObject.transform.position=i.vec3Pos.clone(),this.actorMap[e][t].x=t,this.actorMap[e][t].y=e,this.actorMap[e][t].refreshHpPos(this.convert3DTo2DPosition(i.vec3Pos.clone()))}}}clearActorMap(){if(this.actorMap&&this.actorMap.length>0)for(let e=0;e<this.nodeMap.length;e++)for(let t=0;t<this.nodeMap[e].length;t++)this.actorMap[e][t]&&(this.actorMap[e][t].gameObject.destroy(),this.actorMap[e][t]=null);else for(let e=0;e<this.nodeMap.length;e++){this.actorMap[e]=[];for(let t=0;t<this.nodeMap[e].length;t++)this.actorMap[e].push(null)}}createActor(e,i,a,s){a&&(i+=a);let n=t.getResClone(`${i}.lh`);this.clearNode.addChild(n);let o=n.addComponent(q);return o.color=e,o.onInit(s),o}moveMapActor(e,t,i,a){return new Promise(s=>{let n=Laya.Handler.create(this,()=>{e.hpLabel&&(e.hpLabel.visible=!0),e.refreshHpPos(this.convert3DTo2DPosition(this.nodeMap[e.y][e.x].vec3Pos.clone())),s()});e.hpLabel&&(e.hpLabel.visible=!1),C.tweenTo(e.gameObject,{position:t},i,a,n)})}dropMonster(){let e=I.Instance.levelData;this.updateColorMap();let t=[l.gold,l.wood,l.water,l.fire,l.soil],i=this.findNodeByCondition({type:0,colorArr:[l.none]}),a=e.dropPercent[(this.roundNum-1)%e.dropPercent.length],s=0,n=[];for(let i=0;i<e.monsterType.length;i++){let o=t[e.monsterType[i]-1],r=this.colorMap.get(o);s+=r.length,n.push({color:o,nodeArr:r,born:0,percent:a[i],max:0})}n.sort((e,t)=>e.nodeArr.length-t.nodeArr.length);let o=s+i.length,r=0;for(let e=0;e<n.length;e++){let t=n[e];e<n.length-1?(t.max=Math.round(o*t.percent),r+=t.max):t.max=o-r}let h=[],p=0;for(let e=0;e<i.length;)for(let t=p;t<n.length;t++){let i=n[t];if(i.born<i.max){-1==h.indexOf(i)&&h.push(i),i.born+=1,e++,p+=1,p%=n.length;break}p+=1,p%=n.length}let d=new Map;if(this.roundNum>1)for(let e=0;e<n.length;e++){let t=n[e];for(let e=0;e<t.nodeArr.length;e++){let i=t.nodeArr[e],a=d.get(i.color);a||(a=[],d.set(i.color,a));let s=this.findNodeByCondition({type:4,width:3,height:3,startNode:i,colorArr:[l.none],nodeArr:a});a.push(...s)}}let c=[];for(let e=0;e<h.length;e++){let t=h[e],a=[];for(let e=0;e<t.born;e++){let s=null;if(1==this.roundNum){let e=v.getRandom(0,i.length-1);s=i[e]}else{if(0==e){let e=v.getRandom(0,i.length-1);s=i[e]}else if(a.length>0){let e=v.getRandom(0,a.length-1);s=a[e]}else{let e=d.get(t.color);if(e&&e.length>0){let t=v.getRandom(0,e.length-1);s=e[t]}else{let e=v.getRandom(0,i.length-1);s=i[e]}}let n=this.findNodeByCondition({type:4,startNode:s,width:3,height:3,colorArr:[l.none],nodeArr:a});a.push(...n)}let n=i.indexOf(s);-1!=n&&i.splice(n,1);let o=a.indexOf(s);-1!=o&&a.splice(o,1),d.forEach((e,t)=>{let i=e.indexOf(s);-1!=i&&e.splice(i,1)});let r=this.createActor(t.color,t.color,null,new H);r.gameObject.transform.position=this.getDropPos(s),this.actorMap[s.y][s.x]=r,r.x=s.x,r.y=s.y,c.push(this.moveMapActor(r,s.vec3Pos.clone(),1e3,Laya.Ease.bounceOut))}}return Promise.all(c)}clearLine(){let e=[...this.lineArr];Laya.timer.frameOnce(1,this,()=>{for(let t=0;t<e.length;t++){let i=e[t];i.removeSelf(),i.destroy()}}),this.lineArr=[];let t=[...this.circleArr];Laya.timer.frameOnce(1,this,()=>{for(let e=0;e<t.length;e++){let i=t[e];i.removeSelf(),i.destroy()}}),this.circleArr=[]}cameraRayCast(e){let t=0;return this.camera&&(this.camera.viewportPointToRay(new Laya.Vector2(e.stageX,e.stageY),this.outRay),this.scene3d.physicsSimulation.rayCast(this.outRay,this.outHitResult)&&-1!=this.outHitResult.collider.owner.name.indexOf("Trigger")&&(t=Number(this.outHitResult.collider.owner.name.substring(7)))),t}findNodeByCondition(e){let t=I.Instance.levelConfig,i=[];if(0==e.type||5==e.type||6==e.type||7==e.type||8==e.type||10==e.type)for(let t=0;t<this.nodeMap.length;t++)for(let a=0;a<this.nodeMap[t].length;a++){let s=this.actorMap[t][a],n=this.nodeMap[t][a];5==e.type?(!!s&&s.haveKey)==e.haveKey&&-1!=e.colorArr.indexOf(s?s.color:l.none)&&i.push(n):0==e.type?-1!=e.colorArr.indexOf(s?s.color:l.none)&&i.push(n):6==e.type?(!!s&&s.isAngry)==e.isAngry&&-1!=e.colorArr.indexOf(s?s.color:l.none)&&i.push(n):7==e.type?(!!s&&s.isAngry)==e.isAngry&&i.push(n):8==e.type?-1!=e.colorArr.indexOf(s?s.color:l.none)&&s.unionData&&s.unionData.canMove==e.canMove&&i.push(n):10==e.type&&-1!=e.colorArr.indexOf(s?s.color:l.none)&&n.blockId==e.blockId&&i.push(n)}else if(1==e.type||3==e.type||4==e.type){let a=0,s=0,n=0,o=0;a=(a=e.startNode.x-(e.width-1)/2)>0?a:0,s=(s=e.startNode.x+(e.width-1)/2)<t.width-1?s:t.width-1,n=(n=e.startNode.y-(e.height-1)/2)>0?n:0,o=(o=e.startNode.y+(e.height-1)/2)<t.height-1?o:t.height-1;for(let t=a;t<=s;t++)for(let a=n;a<=o;a++){let s=this.actorMap[a][t],n=this.nodeMap[a][t];n!=e.startNode&&(3==e.type?-1!=e.colorArr.indexOf(s?s.color:l.none)&&i.push(n):4==e.type?-1!=e.colorArr.indexOf(s?s.color:l.none)&&-1==e.nodeArr.indexOf(n)&&i.push(n):1==e.type&&i.push(n))}}else if(2==e.type){let a=0,s=0;0==e.direction?(a=0,s=e.startNode.y):1==e.direction?(a=e.startNode.y,s=t.height-1):2==e.direction?(a=0,s=e.startNode.x):3==e.direction&&(a=e.startNode.x,s=t.width-1);for(let t=a;t<=s;t++){let a=null;a=0==e.direction||1==e.direction?this.nodeMap[t][e.startNode.x]:this.nodeMap[e.startNode.y][t],i.push(a)}}else if(9==e.type||11==e.type){let a=e.startNode.x-1,s=e.startNode.x+1,n=e.startNode.y-1,o=e.startNode.y+1;if(a>=0){let t=this.nodeMap[e.startNode.y][a],s=this.actorMap[e.startNode.y][a];9==e.type?-1!=e.colorArr.indexOf(s?s.color:l.none)&&i.push(t):11==e.type&&i.push(t)}if(s<t.width){let t=this.nodeMap[e.startNode.y][s],a=this.actorMap[e.startNode.y][s];9==e.type?-1!=e.colorArr.indexOf(a?a.color:l.none)&&i.push(t):11==e.type&&i.push(t)}if(n>=0){let t=this.nodeMap[n][e.startNode.x],a=this.actorMap[n][e.startNode.x];9==e.type?-1!=e.colorArr.indexOf(a?a.color:l.none)&&i.push(t):11==e.type&&i.push(t)}if(o<t.height){let t=this.nodeMap[o][e.startNode.x],a=this.actorMap[o][e.startNode.x];9==e.type?-1!=e.colorArr.indexOf(a?a.color:l.none)&&i.push(t):11==e.type&&i.push(t)}}return i}initColorMap(){this.colorMap.set(l.none,[]),this.colorMap.set(l.player,[]),this.colorMap.set(l.gem,[]),this.colorMap.set(l.treasure,[]),this.colorMap.set(l.boss,[]),this.colorMap.set(l.stone,[]),this.colorMap.set(l.gold,[]),this.colorMap.set(l.wood,[]),this.colorMap.set(l.water,[]),this.colorMap.set(l.fire,[]),this.colorMap.set(l.soil,[]),this.colorMap.set(l.obs,[])}updateColorMap(){this.initColorMap();for(let e=0;e<this.nodeMap.length;e++)for(let t=0;t<this.nodeMap[e].length;t++){let i=this.nodeMap[e][t],a=this.actorMap[e][t];this.colorMap.get(a?a.color:l.none).push(i)}}getDropPos(e){let t=e.vec3Pos.clone();return t.y+=5,t}onDestroy(){this.astar=null,this.grid=null,this.clearNode.destroy(),this.addStepSpine&&this.addStepSpine.destroy(),this.guideSpine&&(this.guideSpine.removeSelf(),this.guideSpine.destroy()),this.talkBg&&(this.talkBg.removeSelf(),this.talkBg.destroy()),this.maskLayer&&(this.maskLayer.removeSelf(),this.maskLayer.destroy()),a.off(s.ControllerEvent,this,this.onControllerEvent),a.off(s.NewGuideEvent,this,this.onNewGuideEvent),a.off(s.UseSkill,this,this.useProp),a.off(s.PlayerRevive,this,this.revive),Laya.stage.off(Laya.Event.CLICK,this,this.onGuideEvent)}addLinkNum(e){this.linkNum+=e}addSelect(e){if(!e)return;if(this.isGuide&&this.guideSelectNode.length>0){if(e!=this.guideSelectNode[this.guideSelectIndex])return;this.guideSelectIndex++}let i=this.playerActor;this.selectNode.length>0&&(i=this.selectNode[this.selectNode.length-1]),e.color!=i.color&&(this.concatColorArr=this.updateConcatColorArr(e));let n=this.getLinkLineName(i,e,!0),o=this.getLineRotateAngle(i,e);e.unionData.hp>1?this._attack-=e.unionData.hp:this._attack+=1,a.event(s.UpdateAttack,[this._attack+I.Instance.baseAttack]),t.playSound("link.mp3");let r=this.createLine(`${n[0]}_${n[1]}`);if(r.transform.position=i.gameObject.transform.position.clone(),r.transform.rotate(new Laya.Vector3(0,o,0),!0,!1),this.lineArr.push(r),i==this.playerActor){let e=this.createLine(`0_${n[1]}`);e.transform.position=i.gameObject.transform.position.clone(),this.circleArr.push(e)}let h=this.createLine(`0_${n[1]}`);h.transform.position=e.gameObject.transform.position.clone(),this.circleArr.push(h),-1!=[l.boss,l.gold,l.wood,l.water,l.fire,l.soil].indexOf(e.color)&&e.color!=l.boss&&(e.changeActorState(g.Fear,""),e.angryEffect&&(e.angryEffect.active=!1)),this.lastDir=this.getLinkDir(i.x,i.y,e.x,e.y);let p=this.nodeMap[e.y][e.x];e.isSelect=!0,this.selectNode.push(e),this.addLinkNum(1),this.vibrate(),this.showWarn(!0,e),this.playerActor.changeActorState(c.BattleStart,""),a.event(s.UpdateKillBtn,[!1]),a.event(s.UpdatePointer,[!0,this.convert3DTo2DPosition(p.vec3Pos)]),e.unionData.hp>1?this.instantAttack-=e.unionData.hp:this.instantAttack+=e.unionData.hp,this.updateLightList(e),a.event(s.ShowCombo,[!0,this.instantAttack+I.Instance.baseAttack]),a.event(s.ConnectTip,this.selectNode.length),this.showBossAttackTip(!0),this.showPlayerPointer(!1)}removeSelect(e,t){if(!e)return;this.isGuide&&this.guideSelectNode.length>0&&-1!=this.guideSelectNode.indexOf(e)&&this.guideSelectIndex--,this.addLinkNum(-1),e.unionData.hp>1?this._attack+=e.unionData.hp:this._attack-=1,a.event(s.UpdateAttack,[this._attack+I.Instance.baseAttack]),-1!=[l.boss,l.gold,l.wood,l.water,l.fire,l.soil].indexOf(e.color)&&(e.isAngry?(e.changeActorState("StandAnger",""),e.angryEffect&&(e.angryEffect.active=!0)):(e.changeActorState(g.Stand,""),e.angryEffect&&(e.angryEffect.active=!1))),e.isSelect=!1;let i=this.lineArr.splice(t,1);i[0].removeSelf(),i[0].destroy();let n=this.circleArr.splice(t+1,1);n[0].removeSelf(),n[0].destroy(),this.selectNode.splice(t,1),e.unionData.hp>1?this.instantAttack+=e.unionData.hp:this.instantAttack-=e.unionData.hp;let o=null;if(0==this.selectNode.length){let e=this.circleArr.splice(0,1);e[0].removeSelf(),e[0].destroy(),o=this.playerActor,this.showWarn(!1),this.updateLightList(null),this.playerActor.changeActorState(c.StandMain,""),a.event(s.UpdateKillBtn,[!0]),a.event(s.UpdatePointer,[!1,null]),this.showBossAttackTip(!1),this.showPlayerPointer(!0)}else o=this.selectNode[this.selectNode.length-1],this.updateLightList(o),this.showWarn(!0,o),a.event(s.UpdatePointer,[!0,this.convert3DTo2DPosition(this.nodeMap[o.y][o.x].vec3Pos)]),this.showBossAttackTip(!0),this.showPlayerPointer(!1);this.concatColorArr=this.updateConcatColorArr(o),a.event(s.ShowCombo,[this.selectNode.length>0,this.instantAttack+I.Instance.baseAttack]),a.event(s.ConnectTip,this.selectNode.length)}updateConcatColorArr(e){let t=e.color,i=[];if(e.color==l.obs||e.color==l.treasure||e.color==l.boss)if(0==this.selectNode.length)t=l.player;else{let i=!1;for(let a=this.selectNode.length-1;a>=0;a--){let s=this.selectNode[a];if(s.color!=e.color){t=s.color,i=!0;break}}i||(t=l.player)}return t==l.player||t==l.gem?i=[l.obs,l.treasure,l.door,l.boss,l.gem,l.gold,l.wood,l.water,l.fire,l.soil]:t==l.gold?i=[l.obs,l.treasure,l.door,l.boss,l.gem,l.gold]:t==l.wood?i=[l.obs,l.treasure,l.door,l.boss,l.gem,l.wood]:t==l.water?i=[l.obs,l.treasure,l.door,l.boss,l.gem,l.water]:t==l.fire?i=[l.obs,l.treasure,l.door,l.boss,l.gem,l.fire]:t==l.soil&&(i=[l.obs,l.treasure,l.door,l.boss,l.gem,l.soil]),i}useStep(e){I.Instance.levelData.stepLimit&&(I.Instance.levelData.stepLimit-=e,a.event(s.UpdateStep,[I.Instance.levelData.stepLimit,I.Instance.levelDataClone.stepLimit]))}haveStepLeft(){return I.Instance.levelData.stepLimit>0}addKillNum(e,t=null){I.Instance.levelData;let i=[l.gold,l.wood,l.water,l.fire,l.soil].indexOf(t);-1!=i&&(this.killMonsterNum[i]+=e,k.instance.finishTask(0,i+1,e),k.instance.finishTask(0,0,e),k.instance.finishTask(1,1,e)),t==l.boss&&(this.killBossNum+=e,k.instance.finishTask(0,0,e),k.instance.finishTask(1,1,e),k.instance.finishTask(1,2,e));let n=0;for(let e=0;e<this.killMonsterNum.length;e++)n+=this.killMonsterNum[e];let o=I.Instance.levelData.openGateSpecifyMonster;o?a.event(s.UpdateKillNum,[[this.killMonsterNum[o[0]-1],n,this.killBossNum]]):a.event(s.UpdateKillNum,[[0,n,this.killBossNum]]),this.comboNum+=e}createLine(e){return this.clearNode.addChild(t.getResClone(`LinkLine${e}.lh`))}initRoundData(){}rotatePlayerFront(){return new Promise(e=>{let t=Laya.Handler.create(this,()=>{e()}),i=this.playerActor.gameObject.getChildAt(0),a=i.transform.localRotationEulerY%360;a>=180&&a<360?a-=360:a>-360&&a<=-180&&(a+=360),i.transform.localRotationEuler=new Laya.Vector3(0,a,0);let s=Math.abs(a)/180*500;C.tweenTo(i,{localRotationEuler:new Laya.Vector3(-30,0,0)},s,Laya.Ease.sineOut,t)})}useProp(e){if(1==this.roundType)return;this.isGuide&&(this.guideSpine&&1==this.guideSpine.visible&&(this.guideSpine.visible=!1),this.showTalk(null,!1),this.guideId2++),Laya.MouseManager.enabled=!1,this.playerActor.changeActorState("Skill","");let i=t.getResClone(`SKill${e+1}.lh`);i.transform.position=this.playerActor.gameObject.transform.position.clone(),this.clearNode.addChild(i),Laya.timer.once(3e3,this,()=>{i&&!i.destroyed&&i.destroy()}),a.once(s.OnStateExit,this,i=>{if("Skill"==i)if(this.playerActor.changeActorState(c.StandMain,""),0==e){k.instance.finishTask(0,6,1),k.instance.finishTask(0,7,1),k.instance.finishTask(1,3,1);let e=this.getKillMonsterByColor([l.gold,l.wood,l.water,l.fire,l.soil],7);this.thunderKillMonster(e).then(()=>this.dropMonster()).then(()=>{Laya.MouseManager.enabled=!0,this.isGuide&&(I.Instance.isPlayerOperate=!1,I.Instance.isPlayerSkill=!1,I.Instance.isOnlyThunder=!1,a.event(s.NewGuideEvent))})}else if(1==e){k.instance.finishTask(0,6,1),k.instance.finishTask(0,8,1),k.instance.finishTask(1,3,1);let e=this.getKillMonsterByColor([l.gold,l.wood,l.water,l.fire,l.soil,l.boss],0);this.hexMoveMonster(e).then(()=>this.dropMonster()).then(()=>{Laya.MouseManager.enabled=!0})}else 2==e?(k.instance.finishTask(0,6,1),k.instance.finishTask(0,9,1),k.instance.finishTask(1,3,1),t.playSound("recoveryStep.mp3"),this.playAddStepSpine(),this.addStepLeft(5),Laya.timer.once(2e3,this,()=>{Laya.MouseManager.enabled=!0})):3==e&&(k.instance.finishTask(0,6,1),k.instance.finishTask(0,10,1),k.instance.finishTask(1,3,1),this.throwDiamond(1).then(()=>{Laya.MouseManager.enabled=!0}))})}getKillMonsterByColor(e,t){let i=this.findNodeByCondition({type:0,colorArr:e}),a=t&&t<i.length?t:i.length,s=[];for(let e=0;e<a;e++){let e=i.splice(v.getRandom(0,i.length-1),1)[0],t=this.actorMap[e.y][e.x];this.actorMap[e.y][e.x]=null,s.push(t)}return s}thunderKillMonster(e){return new Promise(i=>{if(0==e.length)return i();let a=e.shift(),s=t.getResClone("FX_Skill1.lh");s.transform.position=a.gameObject.transform.position.clone(),this.clearNode.addChild(s),t.playSound("thunder.mp3"),Laya.timer.once(200,this,()=>{a.setDamage(a.unionData.hp),this.thunderKillMonster(e).then(()=>{i()})}),Laya.timer.once(3e3,this,()=>{s.destroy()})})}hexKillMonster(e){return new Promise(i=>{let a=t.getResClone("Fx_Skill2.lh");a.transform.position=new Laya.Vector3,this.clearNode.addChild(a),t.playSound("baguazheng.mp3"),Laya.timer.once(3e3,this,()=>{a.destroy()}),Laya.timer.once(800,this,()=>{for(let t=0;t<e.length;t++){let i=e[t];i.setDamage(i.unionData.hp)}}),Laya.timer.once(3e3,this,()=>{i()})})}hexMoveMonster(e){return new Promise(i=>{let a=t.getResClone("Fx_Skill2.lh");a.transform.position=new Laya.Vector3,this.clearNode.addChild(a),t.playSound("baguazheng.mp3"),Laya.timer.once(3e3,this,()=>{a.destroy()});let s=[];for(let t=0;t<e.length;t++){let i=e[t];s.push(this.nodeMap[i.y][i.x])}Laya.timer.once(800,this,()=>{let t=s.length;for(let i=0;i<t;i++){let t=s.splice(v.getRandom(0,s.length-1),1)[0],a=e[i];this.actorMap[t.y][t.x]=a,a.x=t.x,a.y=t.y,this.moveMapActor(a,t.vec3Pos,1e3,Laya.Ease.sineOut).then(()=>{})}}),Laya.timer.once(3e3,this,()=>{i()})})}addStepLeft(e){I.Instance.levelData.stepLimit>=0&&(I.Instance.levelData.stepLimit+=e,a.event(s.UpdateStep,[I.Instance.levelData.stepLimit,I.Instance.levelDataClone.stepLimit]))}clearMonsterByColor(e){return new Promise(t=>{let i=this.findNodeByCondition({type:0,colorArr:[e]});for(let e=0;e<i.length;e++){let t=i[e],a=this.actorMap[t.y][t.x];a&&a.setDamage(a.unionData.hp)}Laya.timer.once(1e3,this,()=>{t()})})}dropBoss(){let e=[p.boss1,p.boss2],t=[];if(I.Instance.levelData.bossCfg){let i=I.Instance.levelData.bossCfg[this.roundNum.toString()];if(i&&i.length>0)for(let a=0;a<i.length;a++){let s=i[a],n=e[s-1],o=this.findNodeByCondition({type:10,colorArr:[l.gold,l.wood,l.water,l.fire,l.soil],blockId:n}),r=this.findNodeByCondition({type:0,colorArr:[l.gold,l.wood,l.water,l.fire,l.soil]}),h=null;h=o.length>0?o[v.getRandom(0,o.length-1)]:r[v.getRandom(0,r.length-1)];let p=this.createActor(l.boss,l.boss,s,new O(I.Instance.bossConfig[s-1]));p.refreshHpPos(this.convert3DTo2DPosition(h.vec3Pos.clone())),p.gameObject.transform.position=this.getDropPos(h);let d=this.actorMap[h.y][h.x];this.actorMap[h.y][h.x]=p,p.x=h.x,p.y=h.y,p.unionData.roundNum=this.roundNum,p.unionData.index=a,Laya.timer.once(350,this,()=>{d&&d.setDamage(d.unionData.hp)});let c=this.moveMapActor(p,h.vec3Pos.clone(),1e3,Laya.Ease.bounceOut).then(()=>{});t.push(c)}}return Promise.all(t)}arrangeMap(){let e=[];for(let t=0;t<I.Instance.levelConfig.width;t++)for(let i=I.Instance.levelConfig.height-1;i>-1;i--)if(!this.actorMap[i][t])for(let a=i-1;a>-1;a--){let s=this.actorMap[a][t];if(s&&(s.color==l.gold||s.color==l.wood||s.color==l.water||s.color==l.fire||s.color==l.soil)){this.actorMap[i][t]=s,s.x=this.nodeMap[i][t].x,s.y=this.nodeMap[i][t].y,this.actorMap[a][t]=null,e.push(this.moveMapActor(s,this.nodeMap[i][t].vec3Pos.clone(),1e3,Laya.Ease.bounceOut));break}}return Promise.all(e)}onListEvent(e,t){let i=e,n=this.actorMap[i.y][i.x],o=this.getLastNode();if(n.color==l.none||n.color==l.stone||o==n)return void this.removeWrongSelect();n.unionData.hp>1&&a.event(s.BigBlood,n.unionData.hp);let r=this.indexOf(n);if(t.type==Laya.Event.MOUSE_DOWN)if(-1==r)if(this.playerActor==n){for(let e=0;e<this.selectNode.length;){let t=this.selectNode[e];this.removeSelect(t,e)}this.removeWrongSelect()}else this.isRound(n)?-1!=this.concatColorArr.indexOf(n.color)?n.unionData.hp>1?n.color==l.treasure&&0==n.isLock&&this._attack+I.Instance.baseAttack>n.unionData.hp||n.color!=l.treasure&&this._attack+I.Instance.baseAttack>n.unionData.hp?(this.removeWrongSelect(),this.addSelect(n)):this.addWrongSelect(n,0):(this.removeWrongSelect(),this.addSelect(n)):this.addWrongSelect(n,1):this.removeWrongSelect();else{for(let e=r+1;e<this.selectNode.length;){let t=this.selectNode[e];this.removeSelect(t,e)}this.removeWrongSelect()}else t.type==Laya.Event.MOUSE_MOVE&&(this.isRound(i)?-1==r?n==this.playerActor&&1==this.selectNode.length?(this.removeSelect(this.selectNode[0],0),this.removeWrongSelect()):-1!=this.concatColorArr.indexOf(n.color)?n.unionData.hp>1?n.color==l.treasure&&0==n.isLock&&this._attack+I.Instance.baseAttack>n.unionData.hp||n.color!=l.treasure&&this._attack+I.Instance.baseAttack>=n.unionData.hp?(this.removeWrongSelect(),this.addSelect(n)):this.addWrongSelect(n,0):(this.removeWrongSelect(),this.addSelect(n)):this.addWrongSelect(n,1):r==this.selectNode.length-2&&(this.removeSelect(o,this.selectNode.length-1),this.removeWrongSelect()):this.removeWrongSelect())}setEnemyAngry(){let e=I.Instance.levelData,i=[],a=this.findNodeByCondition({type:6,colorArr:[l.gold,l.wood,l.water,l.fire,l.soil],isAngry:!0}),s=this.findNodeByCondition({type:6,colorArr:[l.gold,l.wood,l.water,l.fire,l.soil],isAngry:!1}),n=e.maxAngry-a.length;n=n>0?n:0;let o=0;o=(o=(o=(o=this.roundNum<=e.angryGrow[0]?e.startAngry:e.startAngry+Math.floor((this.roundNum-e.angryGrow[0])/e.angryGrow[1])*e.angryGrow[2])<e.roundMaxAngry?o:e.roundMaxAngry)<n?o:n)<s.length?o:s.length;for(let e=0;e<o;e++){let e=v.getRandom(0,s.length-1),t=s.splice(e,1)[0],a=this.actorMap[t.y][t.x];i.push(a.setAngry(!0))}let r=this.findNodeByCondition({type:0,colorArr:[l.boss]});for(let e=0;e<r.length;e++){let t=r[e],a=this.actorMap[t.y][t.x];i.push(a.setAngry(!0))}return i.length>0&&t.playSound("angry.mp3"),Promise.all(i)}killEverything(){return new Promise(e=>{if(0==this.selectNode.length)return this.clearLine(),this.playerActor.changeActorState("Return",this.playerActor.animationId),a.once(s.OnStateExit,this,t=>{"Return"==this.playerActor.curState&&(this.playerActor.changeActorState(c.BattleEnd,""),a.once(s.OnStateExit,this,t=>{this.playerActor.curState==c.BattleEnd&&(this.playerActor.changeActorState(c.StandMain,""),e())}))}),this.rotatePlayerFront(),this.comboNum=0,this.instantAttack=0,this.updateGameState(),void a.event(s.ShowCombo,[!1,0]);let i=this.selectNode.shift(),n=i.color;this.playerActor.lookAtActor(i),n==l.boss?this.playerActor.playerPlayAttackAni(!0):0==this.selectNode.length&&this.lastAttackHeavy?(this.lastAttackHeavy=!1,this.playerActor.changeActorState("Return","6"),this.playerActor.playerPlayAttackAni(!0)):this.playerActor.playerPlayAttackAni(!1),a.once(s.AttackMove,this,()=>{let o=67;"Attack"==this.playerActor.curState&&"6"==this.playerActor.animationId&&(o=134,t.playSound("jumpKill.mp3")),this.moveMapActor(this.playerActor,this.nodeMap[i.y][i.x].vec3Pos.clone(),o,Laya.Ease.linearNone),a.once(s.AttackDamage,this,()=>{this.vibrate();let r=this.playerActor.gameObject.getChildAt(0);this.cameraShakeScript.shockFun("shake",r.transform.localRotationEuler.y),this.playerMoveToTarget(i),i.showDamageEffect();let h=i.unionData.hp;i.setDamage(i.unionData.hp),h>1?this.instantAttack-=h:this.instantAttack+=1,a.event(s.ShowCombo,[!0,this.instantAttack+I.Instance.baseAttack]),67==o&&"Attack"==this.playerActor.curState&&t.playSound(`kan${this.playerActor.animationId}.mp3`),this.addKillNum(1,n),a.once(s.AttackEnd,this,()=>{134==o?Laya.timer.scale=1:this.comboNum>7&&Laya.timer.scale<1.8&&(Laya.timer.scale+=.05),this.killEverything().then(()=>{e()})})})})})}angryAttack(){return new Promise(e=>{let t=this.findNodeByCondition({type:7,isAngry:!0});if(!t||0==t.length||1==this.gameState)return e();let i=null,a=null;for(let e=0;e<t.length;e++){let s=t[e],n=this.actorMap[s.y][s.x];if(n.color==l.boss){let e=this.findNodeByCondition({type:3,startNode:s,width:3,height:3,colorArr:[l.player]}),t=this.findNodeByCondition({type:3,startNode:s,width:3,height:3,colorArr:[l.player,l.gold,l.wood,l.water,l.fire,l.soil]});if(e.length>0){i=n,a=t;break}}else{let e=this.findNodeByCondition({type:9,startNode:s,colorArr:[l.player]});e.length>0&&(i=n,a=e)}}if(!i||!a)return e();let s=[];for(let e=0;e<a.length;e++){let t=a[e],i=this.actorMap[t.y][t.x];i.color!=l.player&&(this.actorMap[t.y][t.x]=null),s.push(i)}i.attack(s).then(()=>{this.killMonsterName=i.gameObject.name,e()})})}refreshGrid(e){for(let t=0;t<I.Instance.levelConfig.height;t++)for(let i=0;i<I.Instance.levelConfig.width;i++){let a=this.actorMap[t][i];a&&(a.color==l.obs||a.color==l.stone||a.color==l.boss||a.color==l.treasure||a.color==l.gem)?e.setWalkableAt(i,t,!1):e.setWalkableAt(i,t,!0)}}bossApproachPlayer(){let e=this.findNodeByCondition({type:8,colorArr:[l.boss],canMove:0}),t=e=>new Promise(i=>{if(!e||0==e.length)return i();if(this.playerActor.isDeath)return i();let a=e.shift(),s=this.actorMap[a.y][a.x],n=this.grid.clone();this.refreshGrid(n);let o=this.astar.findPath(a.x,a.y,this.playerActor.x,this.playerActor.y,n);if(o&&o.length>0){let a=o[1],n=this.actorMap[a[1]][a[0]];n==this.playerActor?t(e).then(()=>{i()}):this.switchNode(s,n).then(()=>{t(e).then(()=>{i()})})}else t(e).then(()=>{i()})});return t(e)}throwDiamond(e=0){return new Promise(i=>{let a=e;if(this.linkNum>=20?a=3:this.linkNum>=15?a=2:this.linkNum>=10&&(a=1),0==a)i();else{let e=this.findNodeByCondition({type:0,colorArr:[l.gold,l.wood,l.water,l.fire,l.soil,l.none]});if(0==e.length)return i();let a=e[v.getRandom(0,e.length-1)],s=this.actorMap[a.y][a.x],n=this.createActor(l.gem,"Gem",null,new E);n.gameObject.transform.position=this.getDropPos(a),this.actorMap[a.y][a.x]=n,n.x=a.x,n.y=a.y,Laya.timer.once(350,this,()=>{s&&s.setDamage(s.unionData.hp)}),t.playSound("baoshi.mp3"),this.moveMapActor(n,a.vec3Pos.clone(),1e3,Laya.Ease.bounceOut).then(()=>{i()})}})}convertIndexToNodePos(e){let t={x:0,y:0};return t.x=e%7,t.y=Math.floor(e/7),t}indexOf(e){for(let t=0;t<this.selectNode.length;t++){let i=this.selectNode[t];if(i.x==e.x&&i.y==e.y)return t}return-1}isRound(e,t=!1){let i=this.playerActor;return this.selectNode.length>0&&!t&&(i=this.selectNode[this.selectNode.length-1]),!(e.x<i.x-1||e.x>i.x+1||e.y<i.y-1||e.y>i.y+1)}switchNode(e,t){let i=[],a=e.x,s=e.y;return i.push(this.moveMapActor(e,this.nodeMap[t.y][t.x].vec3Pos.clone(),1e3,Laya.Ease.linearNone)),this.actorMap[t.y][t.x]=e,e.x=t.x,e.y=t.y,i.push(this.moveMapActor(t,this.nodeMap[s][a].vec3Pos.clone(),1e3,Laya.Ease.linearNone)),this.actorMap[s][a]=t,t.x=a,t.y=s,Promise.all(i)}playerMoveToTarget(e){this.actorMap[this.playerActor.y][this.playerActor.x]=null,this.playerActor.x=e.x,this.playerActor.y=e.y,this.actorMap[e.y][e.x]=this.playerActor,this.timeDelayCur-=20,this.timeDelayCur=this.timeDelayCur>this.timeDelayMin?this.timeDelayCur:this.timeDelayMin}getMapNodeActor(e){return this.actorMap[e.y][e.x]}showWrongLink(e,t,i=null){a.event(s.ShowWrongTip,[e,t,i])}addWrongSelect(e,t){if(!e||this.isWrongLink)return;this.isWrongLink=!0;let i=this.playerActor;this.selectNode.length>0&&(i=this.selectNode[this.selectNode.length-1]);let n=this.getLinkLineName(i,e,!1),o=this.getLineRotateAngle(i,e);if(this.wrongLinkLine=this.createLine(`${n[0]}_${n[1]}`),this.wrongLinkLine.transform.position=i.gameObject.transform.position.clone(),this.wrongLinkLine.transform.rotate(new Laya.Vector3(0,o,0),!0,!1),this.showWrongLink(!0,t,this.nodeMap[e.y][e.x].vec2Pos),this.wrongLinkCircle=this.createLine(`0_${n[1]}`),this.wrongLinkCircle.transform.position=e.gameObject.transform.position.clone(),0==t){let t=this.nodeMap[e.y][e.x].vec3Pos.clone();t.y+=1.5,a.event(s.AttackNotEnoughTip,[!0,e.unionData.hp-(this._attack+I.Instance.baseAttack),this.convert3DTo2DPosition(t)])}}removeWrongSelect(){this.isWrongLink&&(this.wrongLinkLine.destroy(),this.wrongLinkCircle.destroy(),this.isWrongLink=!1,this.showWrongLink(!1,1),a.event(s.AttackNotEnoughTip,[!1,null,null]))}getLineRotateAngle(e,t){let i=0;return t.x==e.x&&t.y==e.y-1?i=0:t.x==e.x&&t.y==e.y+1?i=180:t.y==e.y&&t.x==e.x-1?i=90:t.y==e.y&&t.x==e.x+1?i=270:t.x==e.x-1&&t.y==e.y-1?i=45:t.x==e.x-1&&t.y==e.y+1?i=135:t.y==e.y-1&&t.x==e.x+1?i=315:t.y==e.y+1&&t.x==e.x+1&&(i=225),i}getTouchPoint(e){let t=new Laya.Vector2(e.x*Laya.stage.clientScaleX,e.y*Laya.stage.clientScaleY);this.camera.viewportPointToRay(t,this.outRay);let i=new Laya.Vector3(0,1,0),a=(0-Laya.Vector3.dot(this.outRay.origin,i))/Laya.Vector3.dot(this.outRay.direction,i),s=new Laya.Vector3,n=new Laya.Vector3;return Laya.Vector3.scale(this.outRay.direction,a,n),Laya.Vector3.add(this.outRay.origin,n,s),s}getTouchCellPos(e){for(let t=0;t<7;t++)for(let i=0;i<7;i++){let a=1*t-3,s=1*i-6;if(e.x>=a-.375&&e.x<=a+.375&&e.z>=s-.375&&e.z<=s+.375)return{x:t,y:i}}return null}getCameraOriginalTrans(){this.cameraOriginalPos=this.camera.transform.position.clone(),this.cameraOriginalRot=this.camera.transform.localRotationEuler.clone()}cameraMicroMove(e,t){if(0==e){let e=this.camera.parent.transform.position.clone();e.x+=.1*t.dir.x,e.z+=.1*t.dir.y,C.tweenTo(this.camera.parent,{position:e},50,Laya.Ease.sineOut)}}playerShow(){return new Promise(e=>{this.playerActor.gameObject.transform.position=new Laya.Vector3(0,0,0),this.playerActor.gameObject.transform.localRotationEuler=new Laya.Vector3(0,180,0);let i=this.playerActor.gameObject.getChildAt(0);i.transform.localRotationEuler=new Laya.Vector3(0,0,0);let n=this.playerActor.gameObject.getChildAt(1);n.active=!1,t.playSound("run.mp3"),this.playerActor.changeActorState(c.BattleIn,""),this.cameraAnimator.play("CameraIn",0,0),a.once(s.OnStateExit,this,t=>{"BattelIn"==this.playerActor.curState&&(this.playerActor.changeActorState(c.StandMain,""),n.active=!0,C.tweenTo(this.playerActor.gameObject,{localRotationEuler:new Laya.Vector3(0,0,0)},800,Laya.Ease.sineInOut),C.tweenTo(i,{localRotationEuler:new Laya.Vector3(-30,0,0)},800,Laya.Ease.sineInOut),Laya.timer.once(1e3,this,()=>{e()}))})})}addCameraShakeScript(){this.cameraShakeScript=this.camera.parent.getComponent(R),this.cameraShakeScript||(this.cameraShakeScript=this.camera.parent.addComponent(R))}getLinkLineName(e,t,i){let a=1,s=0,n=t;if(t.color==l.obs||t.color==l.boss)for(let e=this.selectNode.length-1;e>=0;e--){let i=this.selectNode[e];if(i.color!=t.color){n=i;break}}return n.color==l.gem?s=6:n.color==l.gold?s=1:n.color==l.wood?s=2:n.color==l.water?s=3:n.color==l.fire?s=4:n.color==l.soil&&(s=5),i||(s=0),e.x!=t.x&&e.y!=t.y&&(a=2),[a,s]}showObsHp(e){for(let t=0;t<this.actorMap.length;t++)for(let i=0;i<this.actorMap[t].length;i++){let a=this.actorMap[t][i];a&&a.color==l.obs&&a.hpLabel&&(a.hpLabel.visible=e)}}showWarn(e,i){if(e){for(let e=0;e<this.warnArr.length;e++){this.warnArr[e].active=!1}let e=[],a=this.findNodeByCondition({type:1,startNode:this.nodeMap[i.y][i.x],width:3,height:3});for(let t=0;t<a.length;t++){let s=a[t],n=this.actorMap[s.y][s.x];if(n.isAngry){if(n.isBoss&&-1==this.selectNode.indexOf(n)){e=this.findNodeByCondition({type:1,startNode:this.nodeMap[n.y][n.x],width:3,height:3});break}n.x!=i.x&&n.y!=i.y||-1!=this.selectNode.indexOf(n)||(e=this.findNodeByCondition({type:11,startNode:this.nodeMap[n.y][n.x]}))}}for(let i=0;i<e.length;i++){let a=this.warnArr[i];a||(a=t.getResClone("Warn.lh"),this.warnArr[i]=a,this.clearNode.addChild(a)),a.transform.position=e[i].vec3Pos.clone(),a.active=!0}}else for(let e=0;e<this.warnArr.length;e++){this.warnArr[e].active=!1}}judgeLevelCount(){if(!this.isCount)if(1==this.gameState){this.isCount=!0;let e=n.open(se);e.setPageIndex(2),k.instance.level++,k.instance.level=k.instance.level<31?k.instance.level:31;let t=5*(this.killMonsterCount+this.killBossNum);t=t<500?t:500,e.setRewardData({reward:"金币",num:t}),k.instance.finishTask(0,11,1),k.instance.finishTask(0,12,1),k.instance.finishTask(1,0,1)}else if(this.playerActor.isDeath||2==this.gameState)if(this.playerActor.isDeath){this.isCount=!0;let e=n.open(se);this.isRevive?e.setPageIndex(1):e.setPageIndex(3),e.setLossReason(1,this.killMonsterName)}else{this.isCount=!0;let e=n.open(se);this.isRevive?e.setPageIndex(1):e.setPageIndex(3),e.setLossReason(0)}}findLightNode(e){let t=this.nodeMap[e.y][e.x],i=this.updateConcatColorArr(e);if(e.color==l.gem){i=this.selectNode[this.selectNode.length-1]==e?[l.obs,l.treasure,l.door,l.boss,l.gem,l.gold,l.wood,l.water,l.fire,l.soil]:[]}let a=this.findNodeByCondition({type:3,startNode:t,width:3,height:3,colorArr:i}),s=[];for(let e=0;e<a.length;e++){let t=a[e],i=this.actorMap[t.y][t.x];-1==this.lightList.indexOf(i)&&(i.unionData.hp>1?this.instantAttack+I.Instance.baseAttack>=i.unionData.hp&&s.push(i):s.push(i))}if(this.lightList.push(...s),e.color!=l.gem)for(let e=0;e<s.length;e++){let t=this.findLightNode(s[e]);this.lightList.push(...t)}return s}updateGray(){let e=[l.obs,l.treasure,l.door,l.boss,l.gem,l.gold,l.wood,l.water,l.fire,l.soil];for(let t=0;t<this.actorMap.length;t++)for(let i=0;i<this.actorMap[t].length;i++){let a=this.actorMap[t][i];-1!=e.indexOf(a.color)&&(this.lightList.length>0&&-1==this.lightList.indexOf(a)?a.setGameObjectGray(!0):a.setGameObjectGray(!1))}}updateLightList(e){this.lightList=[...this.selectNode],e?this.findLightNode(e):this.lightList=[],this.updateGray()}playAddStepSpine(){this.addStepSpine?(this.addStepSpine.visible=!0,this.addStepSpine.play(0,!1),Laya.timer.once(2e3,this,()=>{this.addStepSpine.stop(),this.addStepSpine.visible=!1})):t.loadSpines(["step.sk"]).then(e=>{this.addStepSpine=e[0],this.addStepSpine.pos(Laya.stage.width/2,Laya.stage.height/2),_.UpDialogRoot.addChild(this.addStepSpine),this.addStepSpine.play(0,!1),Laya.timer.once(2e3,this,()=>{this.addStepSpine.stop(),this.addStepSpine.visible=!1})})}updateGameState(){let e=I.Instance.levelData,t=I.Instance.levelDataClone;this.gameState=1;let i=0;for(let e=0;e<this.killMonsterNum.length;e++)i+=this.killMonsterNum[e];if(e.openGateMonster&&e.openGateMonster>i&&(this.gameState=0),e.openGateBoss&&e.openGateBoss>this.killBossNum&&(this.gameState=0),this.killMonsterCount=i,e.openGateSpecifyMonster){let t=e.openGateSpecifyMonster[0];e.openGateSpecifyMonster[1]>this.killMonsterNum[t-1]&&(this.gameState=0)}t.stepLimit>0&&0==e.stepLimit&&0==this.gameState&&(this.gameState=2)}revive(e){this.isRevive=!0;let i=t.getResClone("FX_PlayerBron.lh");i.transform.position=this.playerActor.gameObject.transform.position.clone(),this.clearNode.addChild(i),Laya.timer.once(3e3,this,()=>{i&&!i.destroyed&&i.destroy()}),this.isCount=!1,this.playerActor.isDeath=!1,this.playerActor.unionData.hp=1,this.playerActor.changeActorState(c.StandMain,""),e&&this.addStepLeft(5)}addWeapon(e){let i=`Weapon${k.instance.weaponID+1}_1.lh`,a=`Weapon${k.instance.weaponID+1}_2.lh`,s=t.getResClone(i),n=t.getResClone(a);s.transform.localPosition=new Laya.Vector3,s.transform.localRotationEuler=new Laya.Vector3,n.transform.localPosition=new Laya.Vector3,n.transform.localRotationEuler=new Laya.Vector3,C.findNodeByUrl(e.gameObject,"Player/Bone001").addChild(s),C.findNodeByUrl(e.gameObject,"Player/Bone002").addChild(n)}showBossAttackTip(e){if(e){let e=this.findNodeByCondition({type:0,colorArr:[l.boss]});if(e.length>0){let t=this.actorMap[e[0].y][e[0].x];if(-1!=this.selectNode.indexOf(t))a.event(s.ShowBossAttackDiff,[!1,0,0,0]);else{let e=Number(t.gameObject.name[t.gameObject.name.length-1]);a.event(s.ShowBossAttackDiff,[!0,e,this._attack+I.Instance.baseAttack,t.unionData.hp])}}else a.event(s.ShowBossAttackDiff,[!1,0,0,0])}else a.event(s.ShowBossAttackDiff,[!1,0,0,0])}vibrate(){t.vibrateOpen&&("undefined"!=typeof wx?wx.vibrateShort({type:"heavy"}):"undefined"!=typeof qg&&qg.vibrateShort({success:function(e){},fail:function(e){},complete:function(e){}}))}dropMonsterByConfig(){let e=k.instance.level,t=this.guideDropConfig["level"+e][this.roundNum-1],i=[];for(let e=0;e<this.actorMap.length;e++)for(let a=0;a<this.actorMap[e].length;a++){let s=this.actorMap[e][a],n=this.nodeMap[e][a],o=t[7*e+a];if(!s&&o>=10&&o<20){let t=l.gold;12==o?t=l.wood:13==o?t=l.water:14==o?t=l.fire:15==o&&(t=l.soil),(s=this.createActor(t,t,null,new H)).gameObject.transform.position=this.getDropPos(n),this.actorMap[e][a]=s,s.x=n.x,s.y=n.y,i.push(this.moveMapActor(s,n.vec3Pos.clone(),1e3,Laya.Ease.bounceOut))}}return Promise.all(i)}dropDiamondByConfig(){return new Promise(e=>{let i=k.instance.level,a=this.guideDiamondConfig["level"+i][this.roundNum-1];if(a){let i=this.nodeMap[a[1]][a[0]],s=this.actorMap[i.y][i.x],n=this.createActor(l.gem,"Gem",null,new E);n.gameObject.transform.position=this.getDropPos(i),this.actorMap[i.y][i.x]=n,n.x=i.x,n.y=i.y,Laya.timer.once(350,this,()=>{s&&s.setDamage(s.unionData.hp)}),t.playSound("baoshi.mp3"),this.moveMapActor(n,i.vec3Pos.clone(),1e3,Laya.Ease.bounceOut).then(()=>{e()})}else e()})}setAngryByConfig(){let e=k.instance.level,i=[];if(this.guideAngryConfig["level"+e]){let t=this.guideAngryConfig["level"+e][this.roundNum-1];if(t){let e=this.nodeMap[t[1]][t[0]],a=this.actorMap[e.y][e.x];i.push(a.setAngry(!0))}}let a=this.findNodeByCondition({type:0,colorArr:[l.boss]});for(let e=0;e<a.length;e++){let t=a[e],s=this.actorMap[t.y][t.x];i.push(s.setAngry(!0))}return i.length>0&&t.playSound("angry.mp3"),Promise.all(i)}updateGuide(){this.isGuide=!1,k.instance.level<=4&&this.guideId2<this.guideConfig[this.guideId1].length&&(this.isGuide=!0)}loadGuideSpine(){return new Promise(e=>{t.loadSpines(["road.sk"]).then(t=>{this.guideSpine=t[0],this.guideSpine.x=Laya.stage.width/2,this.guideSpine.y=Laya.stage.height/2,4==k.instance.level&&(this.guideSpine.y+=(Laya.stage.height-1600)/2),this.guideSpine.visible=!1,_.UpDialogRoot.addChild(this.guideSpine),e()})})}updateGuideSelectNodeArr(){let e=k.instance.level,t=[];this.guideSelectNode=[],1==e&&1==this.roundNum?t=[[3,5],[3,4],[4,3],[4,2],[4,1],[4,0],[3,0],[2,0],[1,1],[1,2]]:1==e&&2==this.roundNum?t=[[2,2],[3,2],[4,2],[4,3]]:3==e&&1==this.roundNum&&(t=[[2,6],[1,5],[0,4],[1,4],[2,4],[3,4],[3,3],[3,2],[4,2]]);for(let e=0;e<t.length;e++){let i=t[e],a=this.actorMap[i[1]][i[0]];this.guideSelectNode.push(a)}this.guideSelectIndex=0}onGuideEvent(){this.touchFinishGuide&&this.isGuide&&(this.guideId2++,a.event(s.NewGuideEvent))}onNewGuideEvent(){let e=this.guideConfig[this.guideId1][this.guideId2];console.log(this.guideId1,this.guideId2,e),e?(this.touchFinishGuide=0==e.finishType,"开始引导语"==e.task?this.showTalk(e.talk,!0):"连接10个蓝色妖灵"==e.task?(this.showTalk(e.talk,!1),this.updateGuideSelectNodeArr(),this.guideSpine.visible=!0,this.guideSpine.play("road1",!0),I.Instance.isPlayerOperate=!0,I.Instance.isPlayerKill=!0,this.showPlayerPointer(I.Instance.isPlayerKill)):"连接正常情况"==e.task?this.showTalk(e.talk,!0):"宝石介绍"==e.task?(this.showTalk(e.talk,!1),this.guideSpine.visible=!0,this.guideSpine.play("road2",!0)):"穿过宝石连线"==e.task?(this.showTalk(e.talk,!1),this.updateGuideSelectNodeArr(),this.guideSpine.visible=!0,this.guideSpine.play("road3",!0),I.Instance.isPlayerOperate=!0,I.Instance.isPlayerKill=!0,this.showPlayerPointer(I.Instance.isPlayerKill)):"关卡目标"==e.task?(this.showTalk(e.talk,!1),this.guideSpine.y-=(Laya.stage.height-1600)/2,this.guideSpine.visible=!0,this.guideSpine.play("road12",!0)):"愤怒怪物指示"==e.task?(this.showTalk(e.talk,!1),this.guideSpine.visible=!0,this.guideSpine.play("road4",!0)):"愤怒怪物介绍"==e.task?(this.showTalk(e.talk,!1),this.guideSpine.visible=!0,this.guideSpine.play("road5",!0)):"BOSS介绍"==e.task?(this.showTalk(e.talk,!1),this.guideSpine.visible=!0,this.guideSpine.play("road6",!0)):"BOSS血量"==e.task?this.showTalk(e.talk,!1):"BOSS击杀"==e.task?(this.showTalk(e.talk,!1),this.updateGuideSelectNodeArr(),this.guideSpine.visible=!0,this.guideSpine.play("road7",!0),I.Instance.isPlayerOperate=!0,I.Instance.isPlayerKill=!0,this.showPlayerPointer(I.Instance.isPlayerKill)):"法术介绍"==e.task?this.showTalk(e.talk,!0):"使用天雷符"==e.task?(this.showTalk(e.talk,!1),this.guideSpine.visible=!0,this.guideSpine.play("road8",!0),I.Instance.isPlayerOperate=!0,I.Instance.isPlayerSkill=!0,I.Instance.isOnlyThunder=!0):"天雷符使用完成"==e.task?this.showTalk(e.talk,!0):"八卦盘介绍"==e.task?(this.showTalk(e.talk,!1),this.guideSpine.visible=!0,this.guideSpine.play("road9",!0)):"踏云靴介绍"==e.task?(this.showTalk(e.talk,!1),this.guideSpine.visible=!0,this.guideSpine.play("road10",!0)):"补天石介绍"==e.task&&(this.showTalk(e.talk,!1),this.guideSpine.visible=!0,this.guideSpine.play("road11",!0))):(this.isGuide=!1,this.guideSpine.visible=!1,this.showTalk(null,!1),I.Instance.isPlayerOperate=!0,I.Instance.isPlayerKill=!0,I.Instance.isPlayerSkill=!0,I.Instance.isPlayerOther=!0,I.Instance.isOnlyThunder=!1,this.showPlayerPointer(I.Instance.isPlayerKill))}initGuide(){this.talkImage=new Laya.Image,this.talkImage.x=38,this.talkImage.y=23,this.maskLayer=new Laya.Sprite,this.talkBg=new Laya.Image,this.talkBg.width=635,this.talkBg.height=238,this.talkBg.skin="play/Ui_Talk.png",this.talkBg.addChild(this.talkImage),this.talkBg.x=Laya.stage.width-this.talkBg.width,this.talkBg.y=Laya.stage.height/2-400,_.UpDialogRoot.addChild(this.maskLayer),_.UpDialogRoot.addChild(this.talkBg),this.maskLayer.graphics.clear(!0),this.maskLayer.width=Laya.stage.width,this.maskLayer.height=Laya.stage.height,this.maskLayer.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,UIConfig.popupBgColor),this.maskLayer.alpha=.8}showTalk(e,i){if(e){this.talkBg.visible=!0;let e=[6,2,3,6],a=0;for(let t=0;t<this.guideId1;t++)a+=e[t];a+=this.guideId2+1,this.talkImage.skin=`play/Ui_Word${a}.png`,a-1&&t.stopSound(`${a-1}.mp3`),t.playSound(`${a}.mp3`),this.maskLayer.visible=i}else this.talkBg.visible=!1,this.maskLayer.visible=!1}initGuideId(){let e=k.instance.level;this.guideId1=e-1,this.guideId2=0,1==e?(this.controlDrop=!0,this.controlDiamond=!0,this.controlAngry=!0):2==e?this.controlAngry=!0:3==e&&(this.controlAngry=!0,this.controlDrop=!0)}showPlayerPointer(e){if(e){let e=this.playerActor.gameObject.transform.position.clone();e.y+=1.2;let t=this.convert3DTo2DPosition(e);a.event(s.ShowPlayerPointer,[!0,t])}else a.event(s.ShowPlayerPointer,[!1])}getTouchPointRoundCell(e){for(let t=0;t<7;t++)for(let i=0;i<7;i++){let a=1*t-3,s=1*i-6;if(e.x>a+.375&&e.x<a+1-.375&&e.z>s+.375&&e.z<s+1-.375)return t<6&&i<6?[{x:t,y:i},{x:t+1,y:i},{x:t,y:i+1},{x:t+1,y:i+1}]:null;if(e.x>a+.375&&e.x<a+1-.375&&e.z>=s-.375&&e.z<=s+.375)return t<6?[{x:t,y:i},{x:t+1,y:i}]:null;if(e.x>=a-.375&&e.x<=a+.375&&e.z>s+.375&&e.z<s+1-.375)return i<6?[{x:t,y:i},{x:t,y:i+1}]:null}return null}getLinkDir(e,t,i,a){return i<e&&a<t?0:i==e&&a<t?1:i>e&&a<t?2:i<e&&a==t?3:i>e&&a==t?4:i<e&&a>t?5:i==e&&a>t?6:i>e&&a>t?7:void 0}selectBestNode(e){let t=this.playerActor;this.selectNode.length>0&&(t=this.selectNode[this.selectNode.length-1]);let i=this.getTouchPointRoundCell(e);if(!i)return null;let a=[];for(let e=0;e<i.length;e++){let t=i[e],s=this.actorMap[t.y][t.x];-1!=this.concatColorArr.indexOf(s.color)&&a.push(s)}if(-1==this.lastDir)return a.length>0?{x:a[0].x,y:a[0].y}:null;for(let e=0;e<a.length;e++){const i=a[e];let s=Math.abs(t.x-i.x),n=Math.abs(t.y-i.y);if(!(0!=s&&1!=s||0!=n&&1!=n)){if(this.getLinkDir(t.x,t.y,i.x,i.y)==this.lastDir&&-1==this.selectNode.indexOf(i))return{x:i.x,y:i.y}}}return null}updateWalkableNode(e){for(let t=0;t<I.Instance.levelConfig.height;t++)for(let i=0;i<I.Instance.levelConfig.width;i++){let a=this.actorMap[t][i];-1==this.concatColorArr.indexOf(a.color)?e.setWalkableAt(i,t,!1):e.setWalkableAt(i,t,!0)}}}class Y extends o.pages.getPropUI{constructor(){super(...arguments),this.propId=0}onAwake(){}onOpened(){this.videoGet.on(Laya.Event.CLICK,this,this.onBtnClick),this.closeBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(e){t.playSound("click.mp3"),e.target==this.videoGet?L.Instance.showVideoAd(()=>{k.instance.propNum[this.propId]++,k.instance.onDataChange("propNum"),n.close(Y)}):e.target==this.closeBtn&&n.close(Y)}}class z extends o.pages.pauseUI{onAwake(){this.updateUi()}onOpened(){this.musicBtn.on(Laya.Event.CLICK,this,this.onClick),this.soundBtn.on(Laya.Event.CLICK,this,this.onClick),this.continueBtn.on(Laya.Event.CLICK,this,this.onClick),this.backBtn.on(Laya.Event.CLICK,this,this.onClick)}onClosed(){}onDestroy(){}onClick(e){e.target==this.musicBtn?(t.musicOpen=!t.musicOpen,t.musicOpen?t.playMusic("bgm.mp3",0):Laya.SoundManager.stopMusic()):e.target==this.soundBtn?t.soundOpen=!t.soundOpen:e.target==this.continueBtn?n.close(z):e.target==this.backBtn&&(n.close(z),n.open(J).isBack=!0),this.updateUi()}updateUi(){this.musicStateIcon.skin=t.musicOpen?"main/Btn_MusicYes.png":"main/Btn_MusicNo.png",this.soundStateIcon.skin=t.soundOpen?"main/Btn_MusicYes.png":"main/Btn_MusicNo.png"}}class $ extends o.pages.playUI{constructor(){super(...arguments),this.isPointerScale=!1}onAwake(){a.on(s.UpdateStep,this,this.onUpdateStep),a.on(s.UpdateKillNum,this,this.onUpdateKillNum),a.on(s.UpdateAttack,this,this.onUpdateAttack),a.on(s.UpdatePointer,this,this.onUpdatePointer),a.on(s.UpdateKillBtn,this,this.onUpdateKillBtn),a.on(s.ShowWrongTip,this,this.showWrongLink),a.on(s.ShowCombo,this,this.showCombo),a.on(s.BigBlood,this,this.onBigBlood),a.on(s.AttackNotEnoughTip,this,this.showAttackNotEnoughTip),a.on(s.ConnectTip,this,this.showConnectTip),a.on(s.ShowBossAttackDiff,this,this.showBossAttackDiff),a.on(s.ShowBossAttackDiff,this,this.showBossAttackDiff),a.on(s.ShowPlayerPointer,this,this.onShowPlayerPointer),a.on(s.UserDataChange,this,this.onUseDataChange),this.updateSkillUI(),this.updateConditionUi([0,0,0]),this.MoreTip.visible=!1,this.dispelBg.visible=!1,this.stepLimitFrame.visible=!1,I.Instance.levelData.stepLimit>0&&(this.stepLimitFrame.visible=!0,this.onUpdateStep()),this.levelNum.text=k.instance.level+"",this.skillAnswer.alpha=0,this.attackBossTip.visible=!1,window.PlayLogic=this,this.playerPointerBox.visible=!1}onOpened(){this.registerPageEvent()}onClosed(){}onDestroy(){a.off(s.UpdateStep,this,this.onUpdateStep),a.off(s.UpdateKillNum,this,this.onUpdateKillNum),a.off(s.UpdateAttack,this,this.onUpdateAttack),a.off(s.UpdatePointer,this,this.onUpdatePointer),a.off(s.UpdateKillBtn,this,this.onUpdateKillBtn),a.off(s.ShowWrongTip,this,this.showWrongLink),a.off(s.ShowCombo,this,this.showCombo),a.off(s.BigBlood,this,this.onBigBlood),a.off(s.AttackNotEnoughTip,this,this.showAttackNotEnoughTip),a.off(s.ConnectTip,this,this.showConnectTip),a.off(s.ShowBossAttackDiff,this,this.showBossAttackDiff),a.off(s.ShowPlayerPointer,this,this.onShowPlayerPointer),a.off(s.UserDataChange,this,this.onUseDataChange)}onShowPlayerPointer(e,t){this.playerPointerBox.visible=e,this.playerPointerBox.visible?(this.playerPointerBox.x=t.x,this.playerPointerBox.y=t.y,this.playerPointerJump.play(0,!0)):this.playerPointerJump.stop()}registerPageEvent(){this.on(Laya.Event.MOUSE_DOWN,this,this.onPageEvent,["scene"]),this.on(Laya.Event.MOUSE_MOVE,this,this.onPageEvent,["scene"]),this.on(Laya.Event.MOUSE_UP,this,this.onPageEvent,["scene"]),this.pointer.on(Laya.Event.MOUSE_DOWN,this,this.onPageEvent,["pointer"]),this.skill1Btn.on(Laya.Event.CLICK,this,this.onUseSkill,[0]),this.skill2Btn.on(Laya.Event.CLICK,this,this.onUseSkill,[1]),this.skill3Btn.on(Laya.Event.CLICK,this,this.onUseSkill,[2]),this.skill4Btn.on(Laya.Event.CLICK,this,this.onUseSkill,[3]),this.setting.on(Laya.Event.CLICK,this,this.onPageEvent,["setting"]),this.refresh.on(Laya.Event.CLICK,this,this.onPageEvent,["refresh"]),this.skillAsk.on(Laya.Event.MOUSE_UP,this,this.onSkillAskEvent),this.skillAsk.on(Laya.Event.MOUSE_DOWN,this,this.onSkillAskEvent),this.skillAsk.on(Laya.Event.MOUSE_OUT,this,this.onSkillAskEvent)}onPageEvent(e,i){if(I.Instance.isPlayerOperate)if(I.Instance.isPlayerKill&&a.event(s.ControllerEvent,[e,i]),"scene"==e&&i.type==Laya.Event.MOUSE_UP)1==this.pointer.visible&&1==this.isPointerScale&&(this.isPointerScale=!1,this.pointerScale.wrapMode=Laya.FrameAnimation.WRAP_REVERSE,this.pointerScale.play(this.pointerScale.index,!1),Laya.Tween.to(this.attackValue,{bottom:90},100,Laya.Ease.sineIn,null,200,!0));else if("pointer"==e)1==this.pointer.visible&&(this.isPointerScale=!0,this.pointerScale.wrapMode=Laya.FrameAnimation.WRAP_POSITIVE,this.pointerScale.play(this.pointerScale.index,!1),Laya.Tween.to(this.attackValue,{bottom:127},50,Laya.Ease.sineOut,null,50,!0));else if("setting"==e){if(!I.Instance.isPlayerOther)return;t.playSound("click.mp3"),n.open(z,!1)}else if("refresh"==e){if(!I.Instance.isPlayerOther)return;t.playSound("click.mp3"),n.open(J,!1)}else if("ask"==e){if(!I.Instance.isPlayerOther)return;t.playSound("click.mp3"),n.open(J,!1)}}onSkillAskEvent(e){I.Instance.isPlayerOperate&&I.Instance.isPlayerOther&&(e.type==Laya.Event.MOUSE_DOWN?Laya.Tween.to(this.skillAnswer,{alpha:1},300,Laya.Ease.sineIn,null,0,!0):e.type!=Laya.Event.MOUSE_UP&&e.type!=Laya.Event.MOUSE_OUT||Laya.Tween.to(this.skillAnswer,{alpha:0},300,Laya.Ease.sineOut,null,0,!0))}onUpdateStep(){this.stepLimit.text=`${I.Instance.levelData.stepLimit}`}onUpdateKillNum(e){this.updateConditionUi(e)}onUpdateAttack(e){this.attackValue.value=e+""}onUpdatePointer(e,t){0==this.pointer.visible&&t&&(this.pointer.x=t.x,this.pointer.y=t.y),this.pointer.visible=e,1!=this.pointer.visible||this.pointerBreath.isPlaying||(this.pointerBreath.wrapMode=Laya.FrameAnimation.WRAP_PINGPONG,this.pointerBreath.play(this.pointerBreath.index,!0)),1!=this.pointer.visible||this.isPointerScale||(this.isPointerScale=!0,this.pointerScale.wrapMode=Laya.FrameAnimation.WRAP_POSITIVE,this.pointerScale.play(this.pointerScale.index,!1),Laya.Tween.to(this.attackValue,{bottom:127},50,Laya.Ease.sineOut,null,50,!0)),t&&Laya.Tween.to(this.pointer,{x:t.x,y:t.y},50,Laya.Ease.sineOut,null,0,!0)}onUpdateKillBtn(e){}onUseSkill(e){if(!I.Instance.isPlayerOperate)return;if(!I.Instance.isPlayerSkill)return;if(I.Instance.isOnlyThunder&&0!=e)return;if(t.playSound("click.mp3"),1!=[this.skill1Btn,this.skill2Btn,this.skill3Btn,this.skill4Btn][e].gray)k.instance.propNum[e]--,k.instance.onDataChange("propNum"),this.updateSkillUI(),a.event(s.UseSkill,e);else{n.open(Y).propId=e}}updateSkillUI(){let e=k.instance.propNum,t=[this.skill1Btn,this.skill2Btn,this.skill3Btn,this.skill4Btn],i=[this.skill1Num,this.skill2Num,this.skill3Num,this.skill4Num];for(let a=0;a<4;a++){let s=e[a],n=t[a];i[a].text=s+"",n.gray=!(s>0)}}showWrongLink(e,t,i=null){}showCombo(e,t){}updateConditionUi(e){let t=[],i=I.Instance.conditionArr,a=I.Instance.levelData,s=["Ui_Monster8.png","Ui_Monster7.png","Ui_Monster9.png","Ui_Monster6.png","Ui_Monster10.png"],n=["Ui_Monster4.png","Ui_Monster3.png","Ui_Monster2.png","Ui_Monster1.png","Ui_Monster5.png"];for(let o=0;o<i.length;o++){let r=i[o];0==r?t.push({icon:{skin:`play/${n[a.openGateSpecifyMonster[0]-1]}`},num:{text:e[0]+"/"+a.openGateSpecifyMonster[1]}}):1==r?t.push({icon:{skin:"play/Ui_Monster0.png"},num:{text:e[1]+"/"+a.openGateMonster}}):2==r&&t.push({icon:{skin:`play/${s[I.Instance.bossTypeArr[0]-1]}`},num:{text:e[2]+"/"+a.openGateBoss}})}this.openGateList.array=t,this.openGateList.repeatY=t.length,this.openGateList.refresh(),1==this.openGateList.length?this.openGateList.y=55:2==this.openGateList.length&&(this.openGateList.y=31)}onBigBlood(e){}showAttackNotEnoughTip(e,t,i){this.MoreTip.visible=e,e&&(this.moreNum.value=t+"",this.MoreTip.x=i.x,this.MoreTip.y=i.y)}showConnectTip(e){let t=e>0;this.dispelBg.visible=t,t&&(this.dispelNum.text=e+"")}showBossAttackDiff(e,t,i,a){if(this.attackBossTip.visible=e,e){let e=["play/Ui_Monster8.png","play/Ui_Monster7.png","play/Ui_Monster9.png","play/Ui_Monster6.png","play/Ui_Monster10.png"];this.bossName.skin=e[t-1];let s=a-i;s=s>0?s:0,this.bossAttackDiff.value=s+""}}onUseDataChange(e){"propNum"==e&&this.updateSkillUI()}}class J extends o.pages.translationUI{constructor(){super(),this.isBack=!1,this.isShowEffect=!1}onAwake(){this.cloudOpen.wrapMode=Laya.FrameAnimation.WRAP_REVERSE,this.cloudOpen.play(0,!1),this.cloudOpen.on(Laya.Event.COMPLETE,this,this.onAnimationStop),this.progress.visible=!1,this.progressBar.visible=!1,this.width=Laya.stage.width,this.height=Laya.stage.height}onAnimationStop(){this.isBack?this.backMain():this.enterGame()}onProgress(e){this.progressMask.graphics.clear(),this.progressMask.graphics.drawRect(0,0,426*e.progress,86,"#110000"),this.progressLabel.text=Math.floor(100*e.progress)+"%"}backMain(){n.open(ae,!0),this.closeTranslation()}enterGame(){this.progress.visible=!0,this.progressBar.visible=!0,t.create(["level.json","bossproperty.json"]).then(()=>{I.Instance.init();let e=I.Instance.levelData,i=[];i.push(`Player${k.instance.playerID+1}.lh`),i.push(`Scene${e.mapScene}.ls`),i.push(`Jar${e.mapScene}.lh`),i.push(`JarC${e.mapScene}.lh`),i.push(`JarG${e.mapScene}.lh`),i.push(`Obs${e.mapScene}.lh`);for(let t=0;t<e.monsterType.length;t++)i.push(`Enemy${e.monsterType[t]}.lh`),i.push(`EnemyC${e.monsterType[t]}.lh`),i.push(`EnemyG${e.monsterType[t]}.lh`),i.push(`EnemyKnifeLight${e.monsterType[t]}.lh`),i.push(`Fx_Anger${e.monsterType[t]}.lh`);for(let e=0;e<I.Instance.bossTypeArr.length;e++){let t=I.Instance.bossTypeArr[e],a=`Boss${t}.lh`,s=`BossC${t}.lh`,n=`BossG${t}.lh`,o=`BossKnifeLight${t}.lh`;i.indexOf(a)&&(i.push(a),i.push(s),i.push(n),i.push(o))}I.Instance.bossTypeArr.length>0&&(i.push("Fx_AngerBoss.lh"),i.push("Fx_AngerBossG.lh")),4==k.instance.level&&(k.instance.propNum=[1,1,1,1],k.instance.onDataChange("propNum")),t.create(["MainCamera.lh","Gem.lh","GemC.lh","GemG.lh","LinkLine0_0.lh","LinkLine0_1.lh","LinkLine0_2.lh","LinkLine0_3.lh","LinkLine0_4.lh","LinkLine0_5.lh","LinkLine0_6.lh","LinkLine1_0.lh","LinkLine1_1.lh","LinkLine1_2.lh","LinkLine1_3.lh","LinkLine1_4.lh","LinkLine1_5.lh","LinkLine1_6.lh","LinkLine2_0.lh","LinkLine2_1.lh","LinkLine2_2.lh","LinkLine2_3.lh","LinkLine2_4.lh","LinkLine2_5.lh","LinkLine2_6.lh","Warn.lh"].concat(i),this.onProgress.bind(this)).then(()=>{if(n.close($),n.open($),this.uploadLevel(),this.progress.visible=!1,this.progressBar.visible=!1,_.GameUIRoot.destroyChildren(),_.GameSceneRoot.numChildren>0)for(let e=0;e<_.GameSceneRoot.numChildren;e++){let t=_.GameSceneRoot.getChildAt(e),i=C.getComponent(t,X);i&&i.destroy(),t.removeSelf()}let i=t.getRes(`Scene${e.mapScene}.ls`),a=C.getComponent(i,X);a&&a.destroy();let s=t.getRes("MainCamera.lh"),o=s.getChildAt(0);o.getComponent(x)||o.addComponent(x),i.addChild(s),i.addComponent(X),_.GameSceneRoot.addChild(i),this.closeTranslation()})})}closeTranslation(){this.cloudOpen.off(Laya.Event.COMPLETE,this,this.onAnimationStop),this.cloudOpen.wrapMode=Laya.FrameAnimation.WRAP_POSITIVE,this.cloudOpen.play(0,!1),this.cloudOpen.on(Laya.Event.COMPLETE,this,()=>{n.close(J)})}uploadLevel(){window.wx&&window.wx.aldLevel.onSetLevel({levelId:k.instance.level,levelName:"第"+k.instance.level+"局"})}}class Q extends o.pages.moneyGodUI{constructor(){super(...arguments),this.randomMoney=0}onAwake(){this.y=0,this.height=Laya.stage.height,this.randomMoney=388,this.moenyLabel.text="X"+this.randomMoney,this.showCheckBtn(!1),this.videoGetBtn.visible=!0,this.freeGet.visible=!1}onOpened(){Laya.MouseManager.enabled=!0,this.freeGet.on(Laya.Event.CLICK,this,this.onBtnClick),this.checkAdBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.videoGetBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.receiveNoBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(e){e.target==this.freeGet?(k.instance.gold+=this.randomMoney,k.instance.onDataChange("gold"),a.event(s.PopTip,"领取成功"),n.close(Q)):e.target==this.checkAdBtn||(e.target==this.videoGetBtn?L.Instance.showVideoAd(()=>{k.instance.gold+=this.randomMoney,k.instance.onDataChange("gold"),a.event(s.PopTip,"领取成功"),n.close(Q)}):e.target==this.receiveNoBtn&&(n.close(Q),this.enterGame()))}showCheckBtn(e){this.checkAdBtn.visible=e}enterGame(){I.Instance.playLevel=k.instance.level,31==k.instance.level&&(I.Instance.playLevel=v.getRandom(1,30)),n.open(J)}}class Z extends o.pages.popUI{onAwake(){this.reward.visible=!1}onOpened(){this.directReceive.on(Laya.Event.CLICK,this,this.onButtonClick),this.videoReceive.on(Laya.Event.CLICK,this,this.onButtonClick),this.videoAdd.on(Laya.Event.CLICK,this,this.onButtonClick),this.notAdd.on(Laya.Event.CLICK,this,this.onButtonClick),L.Instance.showBannerAd()}onClosed(){L.Instance.hideBannerAd()}onButtonClick(e){e.target==this.directReceive||e.target==this.videoReceive||(e.target==this.videoAdd?L.Instance.showVideoAd(()=>{k.instance.gold+=200,k.instance.onDataChange("gold"),a.event(s.PopTip,"领取成功"),n.close(Z)}):e.target==this.notAdd&&n.close(Z))}}class ee extends o.pages.settingUI{onAwake(){this.updateUi()}onOpened(){this.musicBtn.on(Laya.Event.CLICK,this,this.onClick),this.soundBtn.on(Laya.Event.CLICK,this,this.onClick),this.vibBtn.on(Laya.Event.CLICK,this,this.onClick),this.closeBtn.on(Laya.Event.CLICK,this,this.onClick)}onClick(e){t.playSound("click.mp3"),e.target==this.musicBtn?(t.musicOpen=!t.musicOpen,t.musicOpen?t.playMusic("bgm.mp3",0):Laya.SoundManager.stopMusic()):e.target==this.soundBtn?t.soundOpen=!t.soundOpen:e.target==this.vibBtn?t.vibrateOpen=!t.vibrateOpen:e.target==this.closeBtn&&n.close(ee),this.updateUi()}updateUi(){this.musicState.skin=t.musicOpen?"main/Btn_MusicYes.png":"main/Btn_MusicNo.png",this.soundState.skin=t.soundOpen?"main/Btn_MusicYes.png":"main/Btn_MusicNo.png",this.vibState.skin=t.vibrateOpen?"main/Btn_MusicYes.png":"main/Btn_MusicNo.png"}}class te extends o.pages.shopUI{constructor(){super(...arguments),this.curIndex=0,this.scene3d=null,this.camera=null,this.playerPoint=null}onAwake(){this.shopConfig=t.getRes("shop.json"),this.propNumArr=[this.prop1Num,this.prop2Num,this.prop3Num,this.prop4Num],this.updateMagicUi(),this.selectTab(this.tab1Bg),this.tab1Bg.on(Laya.Event.CLICK,this,this.onTabClick),this.tab2Bg.on(Laya.Event.CLICK,this,this.onTabClick),this.tab3Bg.on(Laya.Event.CLICK,this,this.onTabClick),this.back.on(Laya.Event.CLICK,this,this.closePage),a.on(s.UserDataChange,this,this.onUserDataChange),a.on(s.UpdateShopList,this,this.onUpdateShopList),a.on(s.UpdateMainPlayer,this,this.onUpdateMainPlayer),this.shopList.vScrollBarSkin=null}updateMagicUi(){let e=k.instance.propNum;for(let t=0;t<this.propNumArr.length;t++)this.propNumArr[t].text=e[t]+""}onTabClick(e){t.playSound("click.mp3"),this.selectTab(e.target)}selectTab(e){let t=0;e==this.tab2Bg?t=1:e==this.tab3Bg&&(t=2),this.updateShopList(t),this.tab1Bg.skin=e!=this.tab1Bg?"shop/Btn_Pink.png":"shop/Btn_Yellow.png",this.tab2Bg.skin=e!=this.tab2Bg?"shop/Btn_Pink.png":"shop/Btn_Yellow.png",this.tab3Bg.skin=e!=this.tab3Bg?"shop/Btn_Pink.png":"shop/Btn_Yellow.png"}onDestroy(){this.scene3d&&(this.scene3d.removeSelf(),this.scene3d.destroy()),a.off(s.UserDataChange,this,this.onUserDataChange),a.off(s.UpdateShopList,this,this.onUpdateShopList),a.off(s.UpdateMainPlayer,this,this.onUpdateMainPlayer)}closePage(){this.scene3d.active=!1,t.playSound("click.mp3"),n.close(te)}onUserDataChange(e){"propNum"==e&&this.updateMagicUi()}onUpdateShopList(){this.updateShopList(this.curIndex)}updateShopList(e){this.curIndex=e;let t=[];if(0==e)for(let e=0;e<5;e++){let i=k.instance.weaponUnlock[e],a=k.instance.weaponLevel[e],s=3*e+a,n=JSON.parse(JSON.stringify(this.shopConfig[s]));if(i&&a<2){let e=this.shopConfig[s+1];n.price=e.price,n.priceType=e.priceType}n.type=0,n.index=e,t.push(n)}else if(1==e)for(let e=0;e<5;e++){let i=15+e,a=JSON.parse(JSON.stringify(this.shopConfig[i]));a.type=1,a.index=e,t.push(a)}else if(2==e)for(let e=0;e<4;e++){let i=20+e,a=JSON.parse(JSON.stringify(this.shopConfig[i]));a.type=2,a.index=e,t.push(a)}console.log(t),this.shopList.array=t,this.shopList.refresh()}onOpened(){this.initShopShowScene(),this.updatePlayer()}initShopShowScene(){this.scene3d||(this.scene3d=new Laya.Scene3D,this.camera=new Laya.Camera,this.camera.clearFlag=Laya.CameraClearFlags.DepthOnly,this.camera.addComponent(x),this.playerPoint=new Laya.Sprite3D,this.playerPoint.transform.position=new Laya.Vector3(0,0,-1),this.scene3d.addChild(this.camera),this.scene3d.addChild(this.playerPoint),this.sceneBox.addChild(this.scene3d))}updatePlayer(){this.playerPoint.numChildren>0&&this.playerPoint.destroyChildren();let e=`Player${k.instance.playerID+1}.lh`,i=`Weapon${k.instance.weaponID+1}_1.lh`,a=`Weapon${k.instance.weaponID+1}_2.lh`,s=t.getResClone(e);s.getChildByName("Player").transform.localRotationEuler=new Laya.Vector3(0,0,0),C.findNodeByUrl(s,"Shadow").active=!1,this.playerPoint.transform.position=new Laya.Vector3(0,1.55,-8),s.transform.localPosition=new Laya.Vector3,this.playerPoint.addChild(s),s.getChildByName("Player").getComponent(Laya.Animator).play("StandMain",0,0);let n=t.getResClone(i),o=t.getResClone(a);n.transform.localPosition=new Laya.Vector3,n.transform.localRotationEuler=new Laya.Vector3,o.transform.localPosition=new Laya.Vector3,o.transform.localRotationEuler=new Laya.Vector3,C.findNodeByUrl(s,"Player/Bone001").addChild(n),C.findNodeByUrl(s,"Player/Bone002").addChild(o)}onUpdateMainPlayer(){let e=[],i=`Player${k.instance.playerID+1}.lh`,a=`Weapon${k.instance.weaponID+1}_1.lh`,s=`Weapon${k.instance.weaponID+1}_2.lh`;e.push(i),e.push(a),e.push(s),t.create(e).then(()=>{this.updatePlayer()})}}class ie extends o.pages.signUI{constructor(){super(...arguments),this.days=[],this.signconfig=[{reward:"天雷符",num:3},{reward:"武器玄铁",num:1},{reward:"金币",num:888},{reward:"金币",num:588},{reward:"金币",num:688},{reward:"金币",num:888},{reward:"伊之助",num:1}]}onAwake(){this.days.push(this.day1),this.days.push(this.day2),this.days.push(this.day3),this.days.push(this.day4),this.days.push(this.day5),this.days.push(this.day6),this.days.push(this.day7),this.updateSignCellState()}onOpened(){this.receiveBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.back.on(Laya.Event.CLICK,this,this.onBtnClick)}updateSignCellState(){1==k.instance.signRec[k.instance.signDay]?this.receiveBtn.disabled=!0:this.receiveBtn.disabled=!1;for(let e=0;e<this.days.length;e++){let t=this.days[e];e<k.instance.signDay?this.setDayState(e,t,2):e==k.instance.signDay?1==k.instance.signRec[e]?this.setDayState(e,t,2):this.setDayState(e,t,1):e>k.instance.signDay&&this.setDayState(e,t,0)}}setDayState(e,t,i){t.dayNum.skin=`sign/Ui_day${e+1}.png`,t.rewardImage.skin=`sign/Ui_Thing${e+1}.png`,2==i?(t.received.visible=!0,t.bg.skin="sign/Ui_framething5.png"):1==i?(t.received.visible=!1,t.bg.skin="sign/Ui_framething6.png"):0==i&&(t.received.visible=!1,t.bg.skin="sign/Ui_framething4.png")}onSignReceive(){let e=n.open(se,!1);e.isGameCount=!1,e.setPageIndex(2),e.setRewardData(this.signconfig[k.instance.signDay]),k.instance.signRec[k.instance.signDay]=1,k.instance.signTimestamp=Date.now(),k.instance.onDataChange("signRec"),k.instance.onDataChange("signTimestamp"),this.updateSignCellState()}onBtnClick(e){e.target==this.receiveBtn?(this.onSignReceive(),a.event(s.UpdateRed)):e.target==this.back&&n.close(ie)}}class ae extends o.pages.mainUI{constructor(){super(...arguments),this.camera=null,this.isPopMoneyGod=!1}onAwake(){this.mainScene3D=t.getRes("Main.ls"),this.playerPoint=C.findNodeByUrl(this.mainScene3D,"PlayerPoint"),this.sceneBox.addChild(this.mainScene3D),this.camera=C.findNodeByUrl(this.mainScene3D,"MainCamera"),this.camera.getComponent(x)||this.camera.addComponent(x),this.updatePlayer(),this.updateBtnPos(),this.updateLevel(),this.showGuide(),this.onUpdateRed(),this.ani2.wrapMode=Laya.FrameAnimation.WRAP_PINGPONG}onOpened(){this.start.on(Laya.Event.CLICK,this,this.onButtonClick),this.task.on(Laya.Event.CLICK,this,this.onButtonClick),this.setting.on(Laya.Event.CLICK,this,this.onButtonClick),this.sign.on(Laya.Event.CLICK,this,this.onButtonClick),this.lottery.on(Laya.Event.CLICK,this,this.onButtonClick),this.lodge.on(Laya.Event.CLICK,this,this.onButtonClick),a.on(s.UserDataChange,this,this.onUserDataChange),a.on(s.UpdateMainPlayer,this,this.onUpdateMainPlayer),a.on(s.UpdateRed,this,this.onUpdateRed),a.on(s.PopTip,this,this.popTip),t.playMusic("bgm.mp3",0),S.init(),Math.random()<L.Instance.moneyGodPer&&(Laya.MouseManager.enabled=!1,Laya.Scene.load("pages/treasure.scene",Laya.Handler.create(this,e=>{e.isShowEffect=!1,e.open(!1),Laya.MouseManager.enabled=!0})))}onClosed(){this.sceneBox.removeChild(this.mainScene3D),a.off(s.UserDataChange,this,this.onUserDataChange),a.off(s.UpdateMainPlayer,this,this.onUpdateMainPlayer),a.off(s.PopTip,this,this.popTip),a.off(s.UpdateRed,this,this.onUpdateRed)}onUserDataChange(e){}onButtonClick(e){t.playSound("click.mp3"),e.target==this.start?this.enterGame():e.target==this.task?n.open(f):e.target==this.setting?n.open(ee):e.target==this.lodge?n.open(te):e.target==this.lottery?n.open(A):e.target==this.sign&&n.open(ie)}updatePlayer(){this.playerPoint.numChildren>0&&this.playerPoint.destroyChildren();let e=`Player${k.instance.playerID+1}.lh`,i=`Weapon${k.instance.weaponID+1}_1.lh`,a=`Weapon${k.instance.weaponID+1}_2.lh`,s=t.getResClone(e);C.findNodeByUrl(s,"Shadow").active=!1,s.transform.localPosition=new Laya.Vector3,this.playerPoint.addChild(s),s.getChildByName("Player").getComponent(Laya.Animator).play("Show",0,0);let n=t.getResClone(i),o=t.getResClone(a);n.transform.localPosition=new Laya.Vector3,n.transform.localRotationEuler=new Laya.Vector3,o.transform.localPosition=new Laya.Vector3,o.transform.localRotationEuler=new Laya.Vector3,C.findNodeByUrl(s,"Player/Bone001").addChild(n),C.findNodeByUrl(s,"Player/Bone002").addChild(o)}updateBtnPos(){let e=["Scene/MainBG2"];for(let t=0;t<e.length;t++){let i=e[t],a=C.findNodeByUrl(this.mainScene3D,i),s=C.convert3DTo2DPosition(this.camera,a.transform.position);"Scene/MainBG2"==i&&(this.start.x=s.x,this.start.y=s.y)}}onUpdateMainPlayer(){let e=[],i=`Player${k.instance.playerID+1}.lh`,a=`Weapon${k.instance.weaponID+1}_1.lh`,s=`Weapon${k.instance.weaponID+1}_2.lh`;e.push(i),e.push(a),e.push(s),t.create(e).then(()=>{this.updatePlayer()})}updateLevel(){this.levelNum.text=k.instance.level+"";let e=k.instance.level-1,i=k.instance.level+1,a=[e,k.instance.level,i],s=[this.level1,this.level2,this.level3],n=[this.icon1,this.icon2,this.icon3],o=t.getRes("level.json");for(let e=0;e<a.length;e++){let t=a[e],i=s[e],r=n[e],h=o.layers[t-1];if(h){let e=h.properties,a=0;for(let t=0;t<e.length;t++){const i=e[t];if("bossCfg"==i.name){let e=JSON.parse(i.value),t=[];for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){let a=e[i];a.length>0&&t.push(a[0])}t.length>0&&(a=t[0]);break}}if(a>0){let e=["Ui_M8.png","Ui_M7.png","Ui_M9.png","Ui_M6.png","Ui_M10.png"];r.visible=!0,i.visible=!1,r.skin=`main/${e[a-1]}`}else r.visible=!1,i.visible=!0,i.text=t+""}else i.visible=!1,r.visible=!1}}popTip(e){let t=new Laya.Image;t.anchorX=t.anchorY=.5,"领取成功"==e?t.skin="main/Ui_GetSuccess.png":"升级成功"==e?t.skin="main/Ui_UpSuccess.png":"金币不足"==e&&(t.skin="main/Ui_NoMoney.png",n.open(Z,!1)),t.width=719,t.height=59,t.x=Laya.stage.width/2,t.y=Laya.stage.height/2,_.UpDialogRoot.addChild(t),Laya.timer.once(800,this,()=>{Laya.Tween.to(t,{y:Laya.stage.height/2-100,alpha:0},500,Laya.Ease.expoIn,Laya.Handler.create(this,()=>{t.destroy()}))})}showGuide(){this.ani1.wrapMode=Laya.FrameAnimation.WRAP_PINGPONG,this.ani1.play(0,!0)}onUpdateRed(){this.updateLotteryRed(),this.updateSignRed(),this.updateTaskRed()}updateLotteryRed(){Date.now()-k.instance.freeLotteryTimestamp>864e5?this.lotteryRed.visible=!0:this.lotteryRed.visible=!1}updateSignRed(){1==k.instance.signRec[k.instance.signDay]?this.signRed.visible=!1:this.signRed.visible=!0}updateTaskRed(){f.achieveRed=!1;for(let e=0;e<f.taskConfig2.length;e++){let t=f.taskConfig2[e],i=k.instance.achieveTaskStage[e],a=t.num[i];if(k.instance.achieveTaskCountRec[e]>=a){if(!k.instance.achieveTaskReceiveRec[e]){f.achieveRed=!0;break}}}f.dayRed=!1;let e=k.instance.dayTaskId;for(let t=0;t<e.length;t++){let i=f.taskConfig1[e[t]].num;if(k.instance.dayTaskCountRec[t]>=i){if(!k.instance.dayTaskReceiveRec[t]){f.dayRed=!0;break}}}this.taskRed.visible=f.dayRed||f.achieveRed,a.event(s.MainRedUpdate)}popMoneyGod(){let e=!1;return k.instance.level>1&&Math.random()<L.Instance.moneyGodPer&&(e=!0,Laya.timer.once(500,this,()=>{n.open(Q)})),e}enterGame(){I.Instance.playLevel=k.instance.level,31==k.instance.level&&(I.Instance.playLevel=v.getRandom(1,30)),n.open(J)}}class se extends o.pages.countUI{constructor(){super(...arguments),this.rewardData=null,this.isGameCount=!0,this.pageIndex=0}onAwake(){this.checkAd.visible=!1,this.countCheckAd.visible=!1}onOpened(){this.back.on(Laya.Event.CLICK,this,this.onPageEvent),this.reviveBtn.on(Laya.Event.CLICK,this,this.onPageEvent),this.reviveNoBtn.on(Laya.Event.CLICK,this,this.onPageEvent),this.checkAd.on(Laya.Event.CLICK,this,this.onPageEvent),this.receiveBtn.on(Laya.Event.CLICK,this,this.onPageEvent),this.countCheckAd.on(Laya.Event.CLICK,this,this.onPageEvent),this.next.on(Laya.Event.CLICK,this,this.onPageEvent),this.again.on(Laya.Event.CLICK,this,this.onPageEvent),this.videoReward.on(Laya.Event.CLICK,this,this.onPageEvent)}onClosed(){}onPageEvent(e){t.playSound("click.mp3"),e.target==this.back?(n.close(se),n.open(ae)):e.target==this.reviveBtn?L.Instance.showVideoAd(()=>{"count/Btn_AddFive.png"==this.reviveBtn.skin?a.event(s.PlayerRevive,!0):a.event(s.PlayerRevive,!1),n.close(se)}):e.target==this.reviveNoBtn?this.setPageIndex(1):e.target==this.checkAd||e.target==this.countCheckAd||(e.target==this.receiveBtn||e.target==this.videoReward?e.target==this.receiveBtn?(this.receiveReward(!1),this.isGameCount?this.setPageIndex(0):n.close(se)):L.Instance.showVideoAd(()=>{this.receiveReward(!0),this.isGameCount?this.setPageIndex(0):n.close(se)}):e.target==this.next?(k.instance.level<31?I.Instance.playLevel=k.instance.level:I.Instance.playLevel=v.getRandom(1,30),n.open(J,!1),n.close(se)):e.target==this.again&&(n.open(J,!1),n.close(se)))}setPageIndex(e){this.pageIndex=e,this.countBox.visible=0==e||1==e,this.rewardBox.visible=2==e,this.reviveBox.visible=3==e,this.winLogo.visible=0==e,this.loseLogo.visible=1==e,this.lossFrame.visible=1==e,this.next.visible=0==e,this.again.visible=1==e,this.videoReward.visible=this.isGameCount,2==e&&L.Instance.delayTime>0&&(this.receiveBtn.visible=!1,Laya.timer.once(1e3*L.Instance.delayTime,this,()=>{this.receiveBtn.visible=!0}))}setLossReason(e,t){let i=["Ui_Monster8.png","Ui_Monster7.png","Ui_Monster9.png","Ui_Monster6.png","Ui_Monster10.png"],a=["Ui_Monster4.png","Ui_Monster3.png","Ui_Monster2.png","Ui_Monster1.png","Ui_Monster5.png"];this.lossStep.visible=0==e,this.lossKill.visible=1==e,t&&(-1!=t.indexOf("Boss")?this.lossKiller.skin="play/"+i[Number(t[t.length-1])-1]:this.lossKiller.skin="play/"+a[Number(t[t.length-1])-1]),0==e&&(this.reviveIcon.skin="count/Ui_TitleRevive2.png",this.reviveTitle.skin="count/Ui_ReviveWord2.png",this.reviveBtn.skin="count/Btn_AddFive.png")}setRewardData(e){this.rewardData=e,"武器斩月"==this.rewardData.reward&&(this.rewardImage.skin="shop/Ui_Weapon4.png"),"武器玄铁"==this.rewardData.reward&&(this.rewardImage.skin="shop/Ui_Weapon3.png"),"伊之助"==this.rewardData.reward?this.rewardImage.skin="shop/Ui_Clothes5.png":"金币"==this.rewardData.reward?this.rewardImage.skin="count/Ui_Money.png":"踏云靴"==this.rewardData.reward?this.rewardImage.skin="shop/Ui_Magic3.png":"天雷符"==this.rewardData.reward?this.rewardImage.skin="shop/Ui_Magic1.png":"补天石"==this.rewardData.reward?this.rewardImage.skin="shop/Ui_Magic4.png":"八卦盘"==this.rewardData.reward&&(this.rewardImage.skin="shop/Ui_Magic2.png"),this.moenyLabel.text="X"+this.rewardData.num}receiveReward(e){if("武器斩月"==this.rewardData.reward&&(k.instance.weaponUnlock[3]=1,k.instance.onDataChange("weaponUnlocks")),"武器玄铁"==this.rewardData.reward&&(k.instance.weaponUnlock[2]=1,k.instance.onDataChange("weaponUnlocks")),"伊之助"==this.rewardData.reward)k.instance.playerUnlock[4]=1,k.instance.onDataChange("playerUnlock");else if("金币"==this.rewardData.reward){let t=this.rewardData.num;e&&(t=3*this.rewardData.num),k.instance.gold+=t,k.instance.onDataChange("gold")}else if("天雷符"==this.rewardData.reward){let t=this.rewardData.num;e&&(t=2*this.rewardData.num),k.instance.propNum[0]+=t,k.instance.onDataChange("propNum")}else if("八卦盘"==this.rewardData.reward){let t=this.rewardData.num;e&&(t=2*this.rewardData.num),k.instance.propNum[1]+=t,k.instance.onDataChange("propNum")}else if("踏云靴"==this.rewardData.reward){let t=this.rewardData.num;e&&(t=2*this.rewardData.num),k.instance.propNum[2]+=t,k.instance.onDataChange("propNum")}else if("补天石"==this.rewardData.reward){let t=this.rewardData.num;e&&(t=2*this.rewardData.num),k.instance.propNum[3]+=t,k.instance.onDataChange("propNum")}a.event(s.PopTip,"领取成功")}}class ne extends o.pages.loadUI{constructor(){super(...arguments),this.finish1=!1,this.finish2=!1}onAwake(){this.width=Laya.stage.width,this.height=Laya.stage.height,this.loadBox.width=Laya.stage.width,this.loadBox.height=Laya.stage.height,this.spineBox.width=Laya.stage.width,this.spineBox.height=Laya.stage.height,this.loadBox.visible=!1,UIConfig.popupBgAlpha=.8,Laya.MouseManager.multiTouchEnabled=!1,this.openWxShare(),t.loadSpines(["loading1.sk"]).then(e=>{let i=e[0];i.pos(Laya.stage.width/2,Laya.stage.height/2),this.spineBox.addChildAt(i,0),i.play(0,!1),i.on(Laya.Event.STOPPED,this,()=>{Laya.timer.once(500,this,()=>{Laya.Tween.to(this.spineBox,{alpha:0},500,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.loadBox.visible=!0,this.finish1=!0;let e=["Main.ls","shop.json","level.json","bossproperty.json","FX_EnemyHit.lh","FX_KnifeLight1.lh","FX_KnifeLight2.lh","FX_KnifeLight3.lh","FX_KnifeLight4.lh","FX_KnifeLight5.lh","FX_KnifeLight6.lh","FX_Skill1.lh","Fx_Skill2.lh","SKill1.lh","SKill2.lh","SKill3.lh","SKill4.lh","FX_PlayerBron.lh","Fx_AngerG.lh"],i=`Player${k.instance.playerID+1}.lh`,a=`Weapon${k.instance.weaponID+1}_1.lh`,s=`Weapon${k.instance.weaponID+1}_2.lh`;e.push(i),e.push(a),e.push(s),t.create(e,this.onProgress.bind(this)).then(()=>{this.finish2=!0})}))})})}),Laya.timer.frameLoop(1,this,()=>{this.finish1&&this.finish2&&(this.finish1=!1,this.finish2=!1,t.loadFonts(["Num1.fnt","shop1.fnt"]).then(()=>{1==k.instance.level?n.open(J):n.open(ae)}))})}onDestroy(){Laya.timer.clearAll(this)}onProgress(e){this.progressMask.graphics.clear(),this.progressMask.graphics.drawRect(0,0,this.progressMask.width*e.progress,this.progressMask.height,"#110000"),this.progressLabel.text=Math.floor(100*e.progress)+"%"}openWxShare(){window.wx&&wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})}}class oe extends o.pages.moneyUI{onAwake(){this.gold.text=k.instance.gold.toString(),this.goldAdd.on(Laya.Event.CLICK,this,this.onButtonClick),a.on(s.UserDataChange,this,this.onUserDataChange)}onDestroy(){a.off(s.UserDataChange,this,this.onUserDataChange)}onButtonClick(e){t.playSound("click.mp3"),"goldAdd"==e.target.name?n.open(Z,!1):"diamondAdd"==e.target.name&&(k.instance.diamond+=100,k.instance.onDataChange("diamond"))}onUserDataChange(e){"gold"==e&&(this.gold.text=k.instance.gold.toString())}}class re extends o.pages.propCellUI{onAwake(){this.contentBox.on(Laya.Event.CLICK,this,this.onClick),this.blueBtn.on(Laya.Event.CLICK,this,this.onClick),this.yellowBtn.on(Laya.Event.CLICK,this,this.onClick)}set dataSource(e){if(this._dataSource=e,this._dataSource)if(this.propDesc.text=e.des,0==e.type){this.propName.skin=`shop/Ui_WeaponName${e.index+1}.png`,this.propImage.skin=`shop/Ui_Weapon${e.index+1}.png`,e.index==k.instance.weaponID?this.useTag.visible=!0:this.useTag.visible=!1;let t=k.instance.weaponUnlock[e.index],i=k.instance.weaponLevel[e.index];0==t?(this.lockImage.visible=!0,this.blueBtn.visible=!0,this.yellowBtn.visible=!1,1==e.priceType?(this.blueBtn.skin="shop/Btn_Unlock1.png",this.unlockCost.visible=!0,this.unlockCost.text=e.price+""):2==e.priceType&&(this.blueBtn.skin="shop/Btn_Unlock2.png",this.unlockCost.visible=!1)):(this.lockImage.visible=!1,this.blueBtn.visible=!1,2==i?this.yellowBtn.visible=!1:(this.yellowBtn.visible=!0,this.yellowBtn.skin="shop/Btn_LvUp.png",this.goldCost.text=e.price+""))}else if(1==e.type){this.propName.skin=`shop/Ui_ClothesName${e.index+1}.png`,this.propImage.skin=`shop/Ui_Clothes${e.index+1}.png`,e.index==k.instance.playerID?this.useTag.visible=!0:this.useTag.visible=!1,0==k.instance.playerUnlock[e.index]?(this.lockImage.visible=!0,this.blueBtn.visible=!0,this.yellowBtn.visible=!1,1==e.priceType?(this.blueBtn.skin="shop/Btn_Unlock1.png",this.unlockCost.visible=!0,this.unlockCost.text=e.price+""):2==e.priceType&&(this.blueBtn.skin="shop/Btn_Unlock2.png",this.unlockCost.visible=!1)):(this.lockImage.visible=!1,this.blueBtn.visible=!1,this.yellowBtn.visible=!1)}else 2==e.type&&(this.propName.skin=`shop/Ui_WordMagic${e.index+1}.png`,this.propImage.skin=`shop/Ui_Magic${e.index+1}.png`,this.useTag.visible=!1,this.blueBtn.visible=!1,this.lockImage.visible=!1,this.yellowBtn.visible=!0,this.yellowBtn.skin="shop/Btn_Buy2.png",this.goldCost.text=e.price+"")}get dataSource(){return this._dataSource}onClick(e){e.stopPropagation(),t.playSound("click.mp3"),e.target==this.contentBox?this.useProp():e.target==this.blueBtn?1==this._dataSource.priceType?k.instance.gold>=this._dataSource.price?(k.instance.gold-=this._dataSource.price,k.instance.onDataChange("gold"),this.unlock()):a.event(s.PopTip,"金币不足"):2==this._dataSource.priceType&&L.Instance.showVideoAd(()=>{this.unlock()}):e.target==this.yellowBtn&&(k.instance.gold>=this._dataSource.price?(k.instance.gold-=this._dataSource.price,k.instance.onDataChange("gold"),0==this._dataSource.type?(k.instance.weaponLevel[this._dataSource.index]++,k.instance.onDataChange("weaponLevel"),a.event(s.UpdateShopList),a.event(s.PopTip,"升级成功")):2==this._dataSource.type&&(k.instance.propNum[this._dataSource.index]++,k.instance.onDataChange("propNum"))):a.event(s.PopTip,"金币不足"))}unlock(){0==this._dataSource.type?(k.instance.weaponUnlock[this._dataSource.index]=1,k.instance.onDataChange("weaponUnlock"),k.instance.finishTask(1,5,1)):1==this._dataSource.type&&(k.instance.playerUnlock[this._dataSource.index]=1,k.instance.onDataChange("playerUnlock"),k.instance.finishTask(1,4,1)),this.useProp()}useProp(){if(0==this._dataSource.type){k.instance.weaponUnlock[this._dataSource.index]&&k.instance.weaponID!=this._dataSource.index&&(k.instance.weaponID=this._dataSource.index,k.instance.onDataChange("weaponID"),a.event(s.UpdateShopList),a.event(s.UpdateMainPlayer))}else if(1==this._dataSource.type){k.instance.playerUnlock[this._dataSource.index]&&k.instance.playerID!=this._dataSource.index&&(k.instance.playerID=this._dataSource.index,k.instance.onDataChange("playerID"),a.event(s.UpdateShopList),a.event(s.UpdateMainPlayer))}}}class he extends o.pages.taskCellUI{set dataSource(e){this._dataSource=e,this._dataSource&&(this.reward.text=this._dataSource.reward+"",this.desc.text=this._dataSource.desc,0==e.state?(this.receiveBtn.visible=!0,this.receiveBtn.disabled=!0):1==e.state?(this.receiveBtn.visible=!0,this.receiveBtn.disabled=!1):2==e.state&&(this.receiveBtn.visible=!1))}onAwake(){this.receiveBtn.on(Laya.Event.CLICK,this,this.onClick)}onClick(){t.playSound("click.mp3");let e=n.open(se,!1);if(e.isGameCount=!1,e.setPageIndex(2),e.setRewardData({reward:"金币",num:this._dataSource.reward}),0==this._dataSource.type)k.instance.dayTaskReceiveRec[this._dataSource.index]=1,k.instance.onDataChange("dayTaskReceiveRec");else{k.instance.achieveTaskReceiveRec[this._dataSource.index]=1,k.instance.onDataChange("achieveTaskReceiveRec"),k.instance.achieveTaskStage[this._dataSource.index]<f.taskConfig2[this._dataSource.index].num.length-1&&(k.instance.achieveTaskStage[this._dataSource.index]++,k.instance.onDataChange("achieveTaskStage"))}a.event(s.UpdateTask),a.event(s.UpdateRed)}get dataSource(){return this._dataSource}}class le extends o.pages.treasureUI{constructor(){super(...arguments),this.isFade=!1,this.isGiveReward=!1}onAwake(){this.isShowEffect=!1,this.contentBox.width=Laya.stage.width,this.contentBox.height=Laya.stage.height,this.width=Laya.stage.width,this.height=Laya.stage.height,this.progressBar.width=0,this.y=0,Laya.timer.frameLoop(1,this,this.onFrameLoop),this.clickBtn.on(Laya.Event.MOUSE_DOWN,this,this.onClick),this.clickBtn.on(Laya.Event.MOUSE_UP,this,this.onClick)}onClick(e){e.type==Laya.Event.MOUSE_DOWN?(this.progressBar.width<405&&(this.progressBar.width+=32.4,this.progressBar.width=this.progressBar.width<405?this.progressBar.width:405,this.isFade=!1,Laya.timer.once(100,this,()=>{this.isFade=!0})),405==this.progressBar.width&&(this.isFade=!1),this.progressBar.width>=202.5&&0==this.isGiveReward&&(this.isGiveReward=!0,Laya.timer.clear(this,this.onFrameLoop),L.Instance.showBannerAd(),Laya.timer.once(2e3,this,()=>{k.instance.gold+=200,k.instance.onDataChange("gold"),a.event(s.PopTip,"领取成功"),this.close()})),Laya.Tween.to(this.clickBtn,{scaleX:.9,scaleY:.9},500,Laya.Ease.sineOut)):Laya.Tween.to(this.clickBtn,{scaleX:1,scaleY:1},500,Laya.Ease.sineIn)}onOpened(){le.isOpen=!0}onFrameLoop(){this.progressBar.width>0&&this.isFade&&(this.progressBar.width-=48.6*Laya.timer.delta/1e3,this.progressBar.width=this.progressBar.width>0?this.progressBar.width:0)}onClosed(){le.isOpen=!1,L.Instance.hideBannerAd()}}le.isOpen=!1;class pe{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("uilogic/CountLogic.ts",se),e("uilogic/GetPropLogic.ts",Y),e("uilogic/LoadLogic.ts",ne),e("uilogic/MoneyBoxLogic.ts",oe),e("uilogic/MoneyGodLogic.ts",Q),e("uilogic/PauseLogic.ts",z),e("uilogic/PlayLogic.ts",$),e("uilogic/PopLogic.ts",Z),e("uilogic/PropCellLogic.ts",re),e("uilogic/SettingLogic.ts",ee),e("uilogic/ShopLogic.ts",te),e("uilogic/TargetLogic.ts",T),e("uilogic/TaskLogic.ts",f),e("uilogic/TaskCellLogic.ts",he),e("uilogic/TranslationLogic.ts",J),e("uilogic/TreasureDialogRuntime.ts",le)}}pe.width=720,pe.height=1280,pe.scaleMode="fixedwidth",pe.screenMode="vertical",pe.alignV="top",pe.alignH="left",pe.startScene="pages/count.scene",pe.sceneRoot="",pe.debug=!1,pe.stat=!1,pe.physicsDebug=!1,pe.exportSceneToJson=!0,pe.init();class de{constructor(){UIConfig.popupBgAlpha=.8,a.init(),_.init(),n.init(),e.init(),L.Instance.init(),t.init().then(()=>{n.open(ne)})}}new class{constructor(){window.Laya3D?Laya3D.init(pe.width,pe.height):Laya.init(pe.width,pe.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=pe.scaleMode,Laya.stage.screenMode=pe.screenMode,Laya.stage.alignV=pe.alignV,Laya.stage.alignH=pe.alignH,Laya.URL.exportSceneToJson=pe.exportSceneToJson,(pe.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),pe.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),pe.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){new de}}}();