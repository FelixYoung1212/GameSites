!function(){"use strict";var t,e,i,a,s=Laya.View,n=Laya.Dialog,o=Laya.Scene,h=Laya.ClassUtils.regClass;!function(t){!function(t){class e extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(e.uiView)}}e.uiView={type:"Scene",props:{width:1280,runtime:"uilogic/ActivityViewRuntime.ts",height:720,autoDestroyAtClosed:!0},compId:2,child:[{type:"Box",props:{y:0,x:639,width:1,height:720,centerY:0,centerX:0},compId:3,child:[{type:"Sprite",props:{y:13,x:-281,texture:"main/Ui_FrameActivity.png"},compId:5}]}],loadList:["main/Ui_FrameActivity.png"],loadList3D:[]},t.activityUI=e,h("ui.pages.activityUI",e);class i extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/addMoney")}}t.addMoneyUI=i,h("ui.pages.addMoneyUI",i);class a extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(a.uiView)}}a.uiView={type:"Scene",props:{y:5,x:78,width:157,pivotY:6.5,pivotX:78.5,height:13},compId:2,child:[{type:"Sprite",props:{texture:"play/Ui_XieTiao.png"},compId:3},{type:"Sprite",props:{y:2,x:2,var:"progressBar",texture:"play/Ui_XieTiao2.png"},compId:4},{type:"Label",props:{y:-39,var:"nameLabel",text:"label",fontSize:40,color:"#ffffff",centerX:0},compId:5}],loadList:["play/Ui_XieTiao.png","play/Ui_XieTiao2.png"],loadList3D:[]},t.bloodUI=a,h("ui.pages.bloodUI",a);class r extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/count")}}t.countUI=r,h("ui.pages.countUI",r);class l extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/daySupply")}}t.daySupplyUI=l,h("ui.pages.daySupplyUI",l);class d extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(d.uiView)}}d.uiView={type:"Scene",props:{width:1280,runtime:"uilogic/DivisionRuntime.ts",height:720},compId:2,child:[{type:"Sprite",props:{y:0,x:0,var:"blackMask"},compId:19},{type:"Panel",props:{var:"slidePanel",right:133,left:135,height:629,elasticEnabled:!0,centerY:37},compId:8,child:[{type:"Sprite",props:{y:69,x:544,width:38,var:"mePointer",texture:"division/Ui_Me.png",pivotY:62,pivotX:19,height:62},compId:24}]},{type:"Box",props:{width:1,var:"middle",height:720,centerX:0},compId:20,child:[{type:"Image",props:{y:19,x:-228,skin:"division/Ui_FrameDuanWei.png"},compId:4,child:[{type:"Label",props:{y:28.5,var:"seasonTimeLeft",text:"0小时0分",fontSize:20,color:"#ffffff",centerX:-131},compId:7},{type:"Image",props:{y:17.5,var:"curDivisionName",skin:"division/Ui_DWName1.png",centerX:180},compId:6},{type:"Image",props:{y:4,var:"curDivisionIcon",skin:"division/Ui_DuanWei1.png",centerX:122},compId:5}]}]}],loadList:["division/Ui_Me.png","division/Ui_FrameDuanWei.png","division/Ui_DWName1.png","division/Ui_DuanWei1.png"],loadList3D:[]},t.divisionUI=d,h("ui.pages.divisionUI",d);class c extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(c.uiView)}}c.uiView={type:"Scene",props:{width:132,height:490},compId:2,child:[{type:"Image",props:{var:"bg",skin:"division/Ui_FrameGift1.png"},compId:3,child:[{type:"Image",props:{y:34,x:36,var:"divisionIcon",skin:"division/Ui_DuanWei1.png"},compId:5,child:[{type:"Image",props:{y:68,x:7,var:"divisionName",skin:"division/Ui_DWName1.png"},compId:6}]},{type:"Box",props:{y:154,x:16,width:100,var:"rewardBox1",height:100},compId:14,child:[{type:"Label",props:{y:72,var:"rewardNum1",text:"100",fontSize:20,color:"#ffffff",centerX:0},compId:11},{type:"Sprite",props:{y:5,x:15,width:69,texture:"count/Ui_Qian.png",height:69},compId:7},{type:"Sprite",props:{y:8,x:6,var:"receiveMask1",texture:"division/Ui_GiftMask.png"},compId:9},{type:"Image",props:{y:-7.5,x:71,var:"red1",skin:"main/Ui_RedPoint.png"},compId:17}]},{type:"Box",props:{y:327,x:16,width:100,var:"rewardBox2",height:100},compId:15,child:[{type:"Sprite",props:{y:8,x:16,width:69,texture:"count/Ui_Qian.png",height:69},compId:13},{type:"Label",props:{y:70,var:"rewardNum2",text:"100",fontSize:20,color:"#ffffff",centerX:0},compId:12},{type:"Sprite",props:{y:72,x:-9.5,texture:"lottery/Btn_ChouJiang2.png"},compId:19},{type:"Sprite",props:{y:8,x:7,var:"receiveMask2",texture:"division/Ui_GiftMask.png"},compId:10},{type:"Image",props:{y:-7,x:71,var:"red2",skin:"main/Ui_RedPoint.png"},compId:18}]}]}],loadList:["division/Ui_FrameGift1.png","division/Ui_DuanWei1.png","division/Ui_DWName1.png","count/Ui_Qian.png","division/Ui_GiftMask.png","main/Ui_RedPoint.png","lottery/Btn_ChouJiang2.png"],loadList3D:[]},t.divisionCellUI=c,h("ui.pages.divisionCellUI",c);class p extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(p.uiView)}}p.uiView={type:"Scene",props:{y:29,x:162,width:190,pivotY:29,pivotX:162,height:58},compId:2,child:[{type:"Image",props:{y:0,x:132,var:"point",skin:"division/Ui_Circle1.png"},compId:3},{type:"Sprite",props:{y:35,x:0,var:"lineBg",texture:"division/Ui_Line2.png",rotation:-90,height:151},compId:5},{type:"Image",props:{y:35,x:0,var:"line",skin:"division/Ui_Line1.png",rotation:-90,height:151},compId:4}],loadList:["division/Ui_Circle1.png","division/Ui_Line2.png","division/Ui_Line1.png"],loadList3D:[]},t.divisionLineUI=p,h("ui.pages.divisionLineUI",p);class g extends s{constructor(){super()}createChildren(){super.createChildren(),this.createView(g.uiView)}}g.uiView={type:"View",props:{width:113,height:118},compId:2,child:[{type:"Image",props:{var:"btnIcon",skin:"main/Btn_Reward.png",centerY:0,centerX:0},compId:3,child:[{type:"Image",props:{var:"redPoint",top:13,skin:"main/Ui_RedPoint.png",left:29},compId:6}]}],loadList:["main/Btn_Reward.png","main/Ui_RedPoint.png"],loadList3D:[]},t.downBtnUI=g,h("ui.pages.downBtnUI",g);class m extends s{constructor(){super()}createChildren(){super.createChildren(),this.createView(m.uiView)}}m.uiView={type:"View",props:{width:1280,runtime:"uilogic/DownPanelRuntime.ts",height:120},compId:2,loadList:[],loadList3D:[]},t.downPanelUI=m,h("ui.pages.downPanelUI",m);class y extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/evolutionSuccess")}}t.evolutionSuccessUI=y,h("ui.pages.evolutionSuccessUI",y);class u extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(u.uiView)}}u.uiView={type:"Scene",props:{width:54,height:45},compId:2,child:[{type:"Image",props:{y:22,x:27,var:"exp",skin:"play/Ui_LV3.png",scaleY:0,scaleX:0,anchorY:.5,anchorX:.5},compId:3}],animations:[{nodes:[{target:3,keyframes:{y:[{value:22,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:0},{value:-18,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:15},{value:-18,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"y",index:20},{value:22,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"y",index:30}],scaleY:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:15},{value:1.5,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleY",index:20},{value:1.5,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleY",index:30}],scaleX:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:15},{value:1.5,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleX",index:20},{value:1.5,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleX",index:30}]}}],name:"ani1",id:1,frameRate:60,action:1}],loadList:["play/Ui_LV3.png"],loadList3D:[]},t.expPopUI=u,h("ui.pages.expPopUI",u);class f extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(f.uiView)}}f.uiView={type:"Scene",props:{width:1280,runtime:"uilogic/GenRuntime.ts",height:720},compId:2,child:[{type:"Box",props:{y:0,x:0,width:1,var:"left",left:0,height:720},compId:77,child:[{type:"Image",props:{y:109,x:90,width:265,visible:!0,skin:"gen/Ui_Kuang.png",height:485},compId:4,child:[{type:"Label",props:{y:485,wordWrap:!0,width:134,visible:!1,var:"descLabel",valign:"middle",text:"不锈钢的前肢淋雨不会生锈",leading:3,fontSize:20,color:"#ffffff",centerX:85,align:"center"},compId:13},{type:"Sprite",props:{y:15,x:190,visible:!1,texture:"gen/Ui_Porperty.png"},compId:53,child:[{type:"propertyProgress",props:{y:7,x:38,var:"atkProgress",scaleY:.85,scaleX:.85,runtime:"uilogic/PropertyProgressRuntime.ts"},compId:54},{type:"propertyProgress",props:{y:34,x:38,var:"atkGapProgress",scaleY:.85,scaleX:.85,runtime:"uilogic/PropertyProgressRuntime.ts"},compId:55},{type:"propertyProgress",props:{y:62,x:38,var:"hpProgress",scaleY:.85,scaleX:.85,runtime:"uilogic/PropertyProgressRuntime.ts"},compId:56},{type:"propertyProgress",props:{y:91,x:38,var:"energyProgress",scaleY:.85,scaleX:.85,runtime:"uilogic/PropertyProgressRuntime.ts"},compId:57},{type:"propertyProgress",props:{y:121,x:38,var:"mSpeedProgress",scaleY:.85,scaleX:.85,runtime:"uilogic/PropertyProgressRuntime.ts"},compId:58}]},{type:"Image",props:{y:372,x:80,var:"exp",skin:"main/Ui_EXP2.png"},compId:64},{type:"Image",props:{y:360,x:23,skin:"main/Ui_EXP.png"},compId:65},{type:"Image",props:{y:375.5,x:-5,var:"lockBtn",skin:"gen/Btn_BianYi2.png"},compId:62,child:[{type:"Label",props:{y:130,wordWrap:!0,width:120,var:"unlockConditionLabel",valign:"middle",text:"钢尾剧毒头颅",fontSize:15,color:"#ffffff",centerX:29,align:"center"},compId:63}]},{type:"Button",props:{y:376,x:-4,var:"outBtn",stateNum:1,skin:"gen/Btn_Battle.png"},compId:67},{type:"Button",props:{y:376,x:-3.15625,var:"virationBtn",stateNum:1,skin:"main/Btn_BianYi.png"},compId:66,child:[{type:"FontClip",props:{y:68,x:97,var:"variationCostLabel",value:"0",text:"100",skin:"main/Num1.png",sheet:"0123456789+-X()./",scaleY:.7,scaleX:.7,color:"#ffffff"},compId:68}]},{type:"Label",props:{y:6,var:"nameLabel",text:"金刚前肢",fontSize:30,color:"#ffffff",centerX:-55,bold:!0},compId:69},{type:"Sprite",props:{y:67,x:80.5,width:104,var:"radar",height:101},compId:70},{type:"Image",props:{y:199,x:23,width:72,var:"skillIcon",skin:"gen/Ui_Skill4.png",height:73},compId:73},{type:"Label",props:{y:202,var:"skillName",text:"冲刺",fontSize:20,color:"#ffffff",centerX:30},compId:74},{type:"Label",props:{y:224,x:95,wordWrap:!0,width:155,var:"skillDesc",valign:"middle",text:"一段时间加速移动",height:44,fontSize:15,color:"#ffffff",align:"center"},compId:75}]}]},{type:"Box",props:{width:720,var:"middle",height:1,centerY:0},compId:49},{type:"Box",props:{y:0,width:1,var:"right",right:0,height:720},compId:59,child:[{type:"Sprite",props:{y:687,x:-118,texture:"gen/Ui_Slide.png"},compId:51}]},{type:"Panel",props:{y:71,var:"slidePanel",right:0,left:369,height:620,elasticEnabled:!0},compId:14,child:[{type:"Image",props:{x:5,var:"nodeBg",skin:"gen/Ui_Kuang3.png",centerY:0},compId:15,child:[{type:"icon",props:{y:244,x:-5,runtime:"ui.pages.iconUI"},compId:16},{type:"icon",props:{y:393,x:155,runtime:"ui.pages.iconUI"},compId:17},{type:"icon",props:{y:93,x:155,runtime:"ui.pages.iconUI"},compId:18},{type:"icon",props:{y:495,x:318,runtime:"ui.pages.iconUI"},compId:19},{type:"icon",props:{y:315,x:318,runtime:"ui.pages.iconUI"},compId:20},{type:"icon",props:{y:174,x:318,runtime:"ui.pages.iconUI"},compId:21},{type:"icon",props:{y:495,x:486,runtime:"ui.pages.iconUI"},compId:22},{type:"icon",props:{y:315,x:486,runtime:"ui.pages.iconUI"},compId:23},{type:"icon",props:{y:174,x:486,runtime:"ui.pages.iconUI"},compId:24},{type:"icon",props:{y:-5,x:486,runtime:"ui.pages.iconUI"},compId:25},{type:"icon",props:{y:393,x:651,runtime:"ui.pages.iconUI"},compId:26},{type:"icon",props:{y:174,x:651,runtime:"ui.pages.iconUI"},compId:27},{type:"icon",props:{y:-5,x:651,runtime:"ui.pages.iconUI"},compId:28},{type:"icon",props:{y:495,x:807,runtime:"ui.pages.iconUI"},compId:29},{type:"icon",props:{y:315,x:807,runtime:"ui.pages.iconUI"},compId:30},{type:"icon",props:{y:-5,x:807,runtime:"ui.pages.iconUI"},compId:31},{type:"icon",props:{y:391,x:970,runtime:"ui.pages.iconUI"},compId:32},{type:"icon",props:{y:174,x:970,runtime:"ui.pages.iconUI"},compId:33},{type:"icon",props:{y:287,x:1130,runtime:"ui.pages.iconUI"},compId:35},{type:"icon",props:{y:71,x:1130,runtime:"ui.pages.iconUI"},compId:34}]}]}],loadList:["gen/Ui_Kuang.png","gen/Ui_Porperty.png","main/Ui_EXP2.png","main/Ui_EXP.png","gen/Btn_BianYi2.png","gen/Btn_Battle.png","main/Btn_BianYi.png","main/Num1.png","gen/Ui_Skill4.png","gen/Ui_Slide.png","gen/Ui_Kuang3.png"],loadList3D:[]},t.genUI=f,h("ui.pages.genUI",f);class w extends s{constructor(){super()}createChildren(){super.createChildren(),this.createView(w.uiView)}}w.uiView={type:"View",props:{width:1280,height:720},compId:2,child:[{type:"Box",props:{y:223,x:0,width:720,var:"talkBg",height:365,bottom:132},compId:11,child:[{type:"Image",props:{y:0,x:0,var:"talkBgLeft",skin:"main/Ui_FrameYingDao.png",scaleX:1},compId:3},{type:"Image",props:{y:0,x:720,visible:!1,var:"talkBgRight",skin:"main/Ui_FrameYingDao.png",scaleX:-1},compId:12},{type:"Label",props:{y:243,x:252,wordWrap:!0,width:450,var:"talkLabel",height:20,fontSize:40,font:"Word"},compId:4}]},{type:"Box",props:{var:"clickHand"},compId:7}],loadList:["main/Ui_FrameYingDao.png"],loadList3D:[]},t.guideUI=w,h("ui.pages.guideUI",w);class L extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(L.uiView)}}L.uiView={type:"Scene",props:{width:34,height:21},compId:2,child:[{type:"Image",props:{var:"hpImg",skin:"play/Ui_HP5.png"},compId:3,child:[{type:"FontClip",props:{y:-11,x:41,var:"hpValue",value:"0123456789",skin:"play/Ui_HP6.png",sheet:"0123456789-"},compId:4}]}],animations:[{nodes:[{target:3,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:0},{value:-40,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:15},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:30}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:0},{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:15},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:30}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:0},{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:15},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:30}]}}],name:"ani1",id:1,frameRate:60,action:1}],loadList:["play/Ui_HP5.png","play/Ui_HP6.png"],loadList3D:[]},t.hpPopUI=L,h("ui.pages.hpPopUI",L);class v extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(v.uiView)}}v.uiView={type:"Scene",props:{width:124,height:123},compId:2,child:[{type:"Image",props:{y:-10,x:-9,var:"light",skin:"main/Ui_Kuang5.png",centerY:0,centerX:0},compId:5},{type:"Image",props:{var:"icon",skin:"icon/UI_YU1.png",centerY:0,centerX:0},compId:3},{type:"Image",props:{var:"lock",skin:"main/Ui_Kuang6.png",centerY:0,centerX:0},compId:4},{type:"Image",props:{var:"gen",skin:"gen/Ui_Kuang8.png",centerY:0,centerX:0},compId:6}],animations:[{nodes:[{target:6,keyframes:{alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:30},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:60}]}}],name:"ani1",id:1,frameRate:60,action:0}],loadList:["main/Ui_Kuang5.png","icon/UI_YU1.png","main/Ui_Kuang6.png","gen/Ui_Kuang8.png"],loadList3D:[]},t.iconUI=v,h("ui.pages.iconUI",v);class k extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(k.uiView)}}k.uiView={type:"Scene",props:{width:325,height:39},compId:2,child:[{type:"Sprite",props:{width:325,texture:"pop/Ui_KillTips.png",height:39},compId:3,child:[{type:"Label",props:{var:"player1Name",text:"玩家1",right:196,fontSize:25,color:"#ffffff",centerY:-4,anchorY:.5,anchorX:.5},compId:4},{type:"Label",props:{var:"player2Name",text:"玩家1",left:210,fontSize:25,color:"#ffffff",centerY:-4,anchorY:.5,anchorX:.5},compId:5}]}],loadList:["pop/Ui_KillTips.png"],loadList3D:[]},t.killTipUI=k,h("ui.pages.killTipUI",k);class S extends s{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/load")}}t.loadUI=S,h("ui.pages.loadUI",S);class I extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/lottery")}}t.lotteryUI=I,h("ui.pages.lotteryUI",I);class x extends s{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/main")}}t.mainUI=x,h("ui.pages.mainUI",x);class b extends s{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/match")}}t.matchUI=b,h("ui.pages.matchUI",b);class P extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(P.uiView)}}P.uiView={type:"Scene",props:{width:156,height:182},compId:2,child:[{type:"Image",props:{y:22,x:21,width:115,var:"head",skin:"match/Ui_wait.png",height:115},compId:6},{type:"Image",props:{y:22,x:21.5,var:"wait",skin:"match/Ui_wait.png"},compId:5},{type:"Label",props:{var:"nameLabel",color:"#ffffff",centerX:0,bottom:6},compId:7}],loadList:["match/Ui_wait.png"],loadList3D:[]},t.matchCellUI=P,h("ui.pages.matchCellUI",P);class B extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/pause")}}t.pauseUI=B,h("ui.pages.pauseUI",B);class D extends s{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/play")}}t.playUI=D,h("ui.pages.playUI",D);class C extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(C.uiView)}}C.uiView={type:"Scene",props:{width:108,runtime:"uilogic/PropertyProgressRuntime.ts",height:12},compId:2,child:[{type:"Image",props:{width:108,var:"bar",skin:"main/Ui_Property1.png",height:12},compId:3},{type:"Label",props:{y:0,x:120,var:"propertyValue",text:"100",color:"#ffffff"},compId:5}],loadList:["main/Ui_Property1.png"],loadList3D:[]},t.propertyProgressUI=C,h("ui.pages.propertyProgressUI",C);class R extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(R.uiView)}}R.uiView={type:"Scene",props:{width:176,runtime:"uilogic/RankCellRuntime.ts",height:32,autoDestroyAtClosed:!0},compId:2,child:[{type:"Image",props:{var:"bg",skin:"play/Ui_Paiming2.png"},compId:3},{type:"Image",props:{y:16,x:14,var:"rankNum",skin:"play/Ui_p1.png",centerY:0,anchorY:.5,anchorX:.5},compId:5},{type:"Sprite",props:{y:-4.5,x:166,var:"meTag",texture:"play/Ui_Wo2.png"},compId:6},{type:"Sprite",props:{y:-26,x:-14.5,var:"crownTag",texture:"play/Ui_Paiming6.png"},compId:7},{type:"Sprite",props:{y:-1,x:143.5,var:"deathTag",texture:"play/Ui_lose.png"},compId:8},{type:"Label",props:{x:37,var:"rankName",text:"鱼小鱼",fontSize:25,color:"#ffffff",centerY:0},compId:9}],loadList:["play/Ui_Paiming2.png","play/Ui_p1.png","play/Ui_Wo2.png","play/Ui_Paiming6.png","play/Ui_lose.png"],loadList3D:[]},t.rankCellUI=R,h("ui.pages.rankCellUI",R);class T extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/revive")}}t.reviveUI=T,h("ui.pages.reviveUI",T);class U extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/reward")}}t.rewardUI=U,h("ui.pages.rewardUI",U);class _ extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/setting")}}t.settingUI=_,h("ui.pages.settingUI",_);class A extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/sign")}}t.signUI=A,h("ui.pages.signUI",A);class M extends s{constructor(){super()}createChildren(){super.createChildren(),this.createView(M.uiView)}}M.uiView={type:"View",props:{width:1280,runtime:"uilogic/StartRuntime.ts",height:720},compId:2,child:[{type:"Box",props:{y:0,width:1,var:"leftBox",left:0,height:720},compId:3,child:[{type:"Sprite",props:{y:133,x:90,var:"propertyBg",texture:"main/Ui_FrameProperty.png"},compId:40,child:[{type:"propertyProgress",props:{y:88,x:90,var:"atkProgress",scaleY:.85,scaleX:.85,runtime:"uilogic/PropertyProgressRuntime.ts"},compId:41},{type:"propertyProgress",props:{y:115,x:90,var:"atkGapProgress",scaleY:.85,scaleX:.85,runtime:"uilogic/PropertyProgressRuntime.ts"},compId:42},{type:"propertyProgress",props:{y:143,x:90,var:"hpProgress",scaleY:.85,scaleX:.85,runtime:"uilogic/PropertyProgressRuntime.ts"},compId:43},{type:"propertyProgress",props:{y:172,x:90,var:"energyProgress",scaleY:.85,scaleX:.85,runtime:"uilogic/PropertyProgressRuntime.ts"},compId:44},{type:"propertyProgress",props:{y:202,x:90,var:"mSpeedProgress",scaleY:.85,scaleX:.85,runtime:"uilogic/PropertyProgressRuntime.ts"},compId:45},{type:"FontClip",props:{y:272,x:126,var:"fightValue",skin:"main/Num1.png",sheet:"0123456789+-X()./",centerX:0},compId:47}]}]},{type:"Box",props:{y:0,width:1,var:"rightBox",right:0,height:720,centerY:0},compId:4,child:[{type:"Box",props:{y:180.5,x:-477,width:252,var:"vibrateBox",height:297},compId:60,child:[{type:"downBtn",props:{var:"vibrateBtn",top:0,right:0,left:0,bottom:0,runtime:"ui.pages.downBtnUI"},compId:54}]},{type:"Box",props:{y:115.5,x:-221,width:196,var:"strengthBox",height:211},compId:62,child:[{type:"downBtn",props:{var:"strengthBtn",top:0,right:0,left:0,bottom:0,runtime:"ui.pages.downBtnUI"},compId:55}]},{type:"Box",props:{y:346,x:-241.5,width:208,var:"divisionBox",height:220},compId:63,child:[{type:"downBtn",props:{var:"divisionBtn",top:0,right:0,left:0,bottom:0,runtime:"ui.pages.downBtnUI"},compId:56}]}]},{type:"Box",props:{y:0,width:1,var:"middleBox",height:720,centerX:0},compId:5,child:[{type:"Image",props:{var:"startBtn",skin:"main/Btn_go.png",centerX:-1,bottom:148,anchorY:.5,anchorX:.5},compId:35},{type:"Sprite",props:{y:29,x:-233,var:"lotteryBtn",texture:"main/Btn_ZhuanPan.png"},compId:13},{type:"Sprite",props:{y:29,x:-328,var:"taskBtn",texture:"main/Btn_RenWu.png"},compId:11,child:[{type:"Sprite",props:{y:9,x:-7,var:"taskTag",texture:"main/Ui_RedPoint.png"},compId:12}]},{type:"Sprite",props:{y:32,x:-129,var:"signBtn",texture:"main/Btn_QianDao.png"},compId:10},{type:"Sprite",props:{y:68,x:-542,var:"settingBtn",texture:"main/Btn_SheDing.png"},compId:9}]}],loadList:["main/Ui_FrameProperty.png","main/Num1.png","main/Btn_go.png","main/Btn_ZhuanPan.png","main/Btn_RenWu.png","main/Ui_RedPoint.png","main/Btn_QianDao.png","main/Btn_SheDing.png"],loadList3D:[]},t.startUI=M,h("ui.pages.startUI",M);class F extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(F.uiView)}}F.uiView={type:"Scene",props:{width:1280,runtime:"uilogic/StrengthRuntime.ts",height:720},compId:2,child:[{type:"Box",props:{width:1,var:"right",height:720,centerX:0},compId:5,child:[{type:"Image",props:{y:72,width:1035,skin:"strength/Ui_FrameStrengthen2.png",height:648,centerX:0},compId:28,child:[{type:"Image",props:{y:343,x:355,width:338,skin:"strength/Ui_FrameStrengthen.png",pivotY:178,pivotX:170,height:333},compId:6,child:[{type:"Sprite",props:{y:0,x:0,width:338,var:"radar",height:333},compId:18},{type:"FontClip",props:{y:301,x:208,var:"strengthLevel",value:"1",text:"100",skin:"main/Num1.png",sheet:"0123456789+-X()./",scaleY:.8,scaleX:.8,fontSize:25,color:"#ffffff"},compId:32}]},{type:"Sprite",props:{y:29,x:296,var:"atk",texture:"strength/Ui_Strengthen1.png"},compId:7},{type:"Sprite",props:{y:215,x:57,var:"life",texture:"strength/Ui_Strengthen3.png"},compId:8},{type:"Sprite",props:{y:457,x:129,var:"energy",texture:"strength/Ui_Strengthen4.png"},compId:9},{type:"Sprite",props:{y:457,x:465,var:"mSpeed",texture:"strength/Ui_Strengthen5.png"},compId:10},{type:"Sprite",props:{y:215,x:531,var:"atkGap",texture:"strength/Ui_Strengthen2.png"},compId:11},{type:"Button",props:{y:466,x:693,var:"upBtn",stateNum:1,skin:"strength/Btn_Strengthen.png",scaleY:.8,scaleX:.8},compId:12,child:[{type:"FontClip",props:{y:95,x:135,var:"costLabel",value:"0",text:"100",skin:"main/Num1.png",sheet:"0123456789+-X()./",fontSize:25,color:"#ffffff"},compId:35}]},{type:"Sprite",props:{y:215,x:57,var:"upArrow",texture:"strength/Ui_StrengthenUp.png",pivotY:30,pivotX:-80},compId:13},{type:"Image",props:{y:61,x:758,skin:"strength/Ui_StrengthenNum.png"},compId:37,child:[{type:"FontClip",props:{y:161,x:91,var:"lifeLabel",value:"0",text:"100",skin:"main/Num1.png",sheet:"0123456789+-X()./",scaleY:.8,scaleX:.8,fontSize:25,color:"#ffffff"},compId:29},{type:"FontClip",props:{y:214,x:91,var:"energyLabel",value:"0",text:"100",skin:"main/Num1.png",sheet:"0123456789+-X()./",scaleY:.8,scaleX:.8,fontSize:25,color:"#ffffff"},compId:30},{type:"FontClip",props:{y:108,x:91,width:18,var:"atkGapLabel",value:"0",text:"100",skin:"main/Num1.png",sheet:"0123456789+-X()./",scaleY:.8,scaleX:.8,height:50,fontSize:25,color:"#ffffff"},compId:33},{type:"FontClip",props:{y:267,x:91,var:"mSpeedLabel",value:"0",text:"100",skin:"main/Num1.png",sheet:"0123456789+-X()./",scaleY:.8,scaleX:.8,fontSize:25,color:"#ffffff"},compId:31},{type:"FontClip",props:{y:55,x:91,var:"atkLabel",value:"0",text:"100",skin:"main/Num1.png",sheet:"0123456789+-X()./",scaleY:.8,scaleX:.8,fontSize:25,color:"#ffffff"},compId:34}]}]}]}],animations:[{nodes:[{target:13,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:30},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:60}]}}],name:"ani1",id:1,frameRate:60,action:0}],loadList:["strength/Ui_FrameStrengthen2.png","strength/Ui_FrameStrengthen.png","main/Num1.png","strength/Ui_Strengthen1.png","strength/Ui_Strengthen3.png","strength/Ui_Strengthen4.png","strength/Ui_Strengthen5.png","strength/Ui_Strengthen2.png","strength/Btn_Strengthen.png","strength/Ui_StrengthenUp.png","strength/Ui_StrengthenNum.png"],loadList3D:[]},t.strengthUI=F,h("ui.pages.strengthUI",F);class E extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/strengthSuccess")}}t.strengthSuccessUI=E,h("ui.pages.strengthSuccessUI",E);class N extends n{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("pages/task")}}t.taskUI=N,h("ui.pages.taskUI",N);class O extends o{constructor(){super()}createChildren(){super.createChildren(),this.createView(O.uiView)}}O.uiView={type:"Scene",props:{width:495,runtime:"uilogic/TaskCellRuntime.ts",height:105},compId:2,child:[{type:"Sprite",props:{y:0,x:0,texture:"task/Ui_kuang2.png"},compId:4},{type:"Sprite",props:{y:16.5,x:12,texture:"task/Ui_kuang3.png"},compId:6,child:[{type:"Sprite",props:{y:-9,x:2,texture:"main/Ui_money1.png"},compId:9},{type:"Label",props:{y:43,var:"rewardLabel",text:"100",fontSize:28,color:"#ffffff",centerX:0},compId:10}]},{type:"Sprite",props:{y:23.5,x:299,var:"receiveBtn",texture:"task/Btn_Get.png"},compId:7},{type:"Sprite",props:{y:46,x:334,var:"running",texture:"task/Ui_for.png"},compId:8},{type:"Label",props:{y:8,x:90,wordWrap:!0,width:213,var:"desc",text:"打败30只鱼包括鱼群中的鱼",fontSize:30,font:"task",color:"#ffffff"},compId:12},{type:"FontClip",props:{var:"progress",value:"1/3",text:"100",skin:"main/Num1.png",sheet:"0123456789+-X()./",scaleY:.7,scaleX:.7,fontSize:25,color:"#ffffff",centerY:29,centerX:-69},compId:14},{type:"Sprite",props:{y:0,x:0,var:"finishMask",texture:"task/Ui_YHuanCheng.png"},compId:11}],loadList:["task/Ui_kuang2.png","task/Ui_kuang3.png","main/Ui_money1.png","task/Btn_Get.png","task/Ui_for.png","main/Num1.png","task/Ui_YHuanCheng.png"],loadList3D:[]},t.taskCellUI=O,h("ui.pages.taskCellUI",O)}(t.pages||(t.pages={}))}(t||(t={}));class r extends t.pages.activityUI{onAwake(){this.width=Laya.stage.width,this.height=Laya.stage.height}}!function(t){t.ControlChange="ControlChange",t.FishDeath="FishDeath",t.PlayerUpLevel="PlayerUpLevel",t.UpdateEnergy="UpdateEnergy",t.UpdateRank="UpdateRank",t.TargetPointer="TargetPointer",t.PlayerUpdateHp="PlayerUpdateHp",t.PlayerKill="PlayerKill",t.PlayerAddExp="PlayerAddExp",t.UpdateFishData="UpdateFishData",t.BitFinger="BitFinger",t.BackInBox="BackInBox",t.EnterGen="EnterGen",t.RefreshRed="RefreshRed",t.Revive="Revive",t.UnlockFish="UnlockFish",t.UseSkill="UseSkill",t.UpdateTask="UpdateTask",t.UpdateRed="UpdateRed",t.UpdateDivisionRed="UpdateDivisionRed",t.UpdatePlayFish="UpdatePlayFish",t.PopImage="PopImage",t.ScaleFish="ScaleFish",t.PopTip="PopTip",t.BitEnd="BitEnd"}(e||(e={}));class l{static init(){l._disp||(l._disp=new Laya.EventDispatcher)}static event(t,e){return l._disp.event(t,e)}static on(t,e,i,a){return l._disp.on(t,e,i,a)}static once(t,e,i,a){return l._disp.once(t,e,i,a)}static off(t,e,i,a){return l._disp.off(t,e,i,a)}static offAll(t){return l._disp.offAll(t)}static isMouseEvent(t){return l._disp.isMouseEvent(t)}static hasListener(t){return l._disp.hasListener(t)}}class d{static init(){d.CUR_PLATFORM=d.BROWSER;let t=window.navigator.userAgent;-1==t.indexOf("OPPO")&&t.indexOf("MiniGame")>-1&&"wx"in window&&("tt"in window?d.CUR_PLATFORM=d.TT:"qq"in window?d.CUR_PLATFORM=d.QQ:d.CUR_PLATFORM=d.WX),t.indexOf("OPPO")>-1&&t.indexOf("MiniGame")>-1&&(d.CUR_PLATFORM=d.OPPO),t.indexOf("VVGame")>-1&&(d.CUR_PLATFORM=d.VIVO),console.log("当前小游戏运行平台",d.CUR_PLATFORM)}}d.CUR_PLATFORM=null,d.OPPO="OPPO",d.VIVO="VIVO",d.WX="WX",d.TT="TT",d.QQ="QQ",d.BROWSER="BROWSER";class c{constructor(){window.ResManager=c,c._resMap=new Map,d.CUR_PLATFORM==d.WX?(c._remote="https://cdn.xxtch.com/Fish/res/wx/",c._resBasePath=wx.env.USER_DATA_PATH+"/cache/res/",c._fileSystemManager=wx.getFileSystemManager(),c._downloadFile=wx.downloadFile,c._loadSubpackage=wx.loadSubpackage,c._fileSystemManager.access({path:c._resBasePath,fail:()=>{c._fileSystemManager.mkdirSync(c._resBasePath,!0)}})):d.CUR_PLATFORM==d.QQ?(c._remote="https://h5game.99aly.com/5agamewx/alywx/swzb/qq/",c._resBasePath=qq.env.USER_DATA_PATH+"/cache/res/",c._fileSystemManager=qq.getFileSystemManager(),c._downloadFile=qq.downloadFile,c._loadSubpackage=qq.loadSubpackage,c._fileSystemManager.access({path:c._resBasePath,fail:()=>{c._fileSystemManager.mkdirSync(c._resBasePath,!0)}})):d.CUR_PLATFORM!=d.OPPO&&d.CUR_PLATFORM!=d.VIVO||(c._remote="https://cdn.xxtch.com/ZombieEscape/res/oppo/",c._resBasePath=qg.env.USER_DATA_PATH+"/cache/res/",c._fileSystemManager=qg.getFileSystemManager(),c._downloadFile=qg.downloadFile,c._loadSubpackage=qg.loadSubpackage,c._fileSystemManager.access({path:c._resBasePath,fail:()=>{c._fileSystemManager.mkdirSync(c._resBasePath,!0)}}))}static init(){return new Promise(t=>{if(null==c._instance){c._instance=new c;let e=Laya.LocalStorage.getItem("zipVersion");e&&(c._zipVersion=JSON.parse(e));let i="resconfig.json";if(d.CUR_PLATFORM==d.WX){i=`resconfig_${"wx"}_${"1.0"}.json`}else if(d.CUR_PLATFORM==d.QQ){let t="qq",e="1.0";i=c._remote+`resconfig_${t}_${e}.json`,i+="?ran="+1e6*Math.random()}else if(d.CUR_PLATFORM==d.OPPO){let t="oppo",e="1.0";i=c._remote+`resconfig_${t}_${e}.json`,i+="?ran="+1e6*Math.random()}else if(d.CUR_PLATFORM==d.VIVO){let t="vivo",e="1.0";i=c._remote+`resconfig_${t}_${e}.json`,i+="?ran="+1e6*Math.random()}Laya.loader.load(i,Laya.Handler.create(this,e=>{"string"==typeof e&&(e=JSON.parse(e));for(const t in e)if(e.hasOwnProperty(t)){let i=e[t],a=i[0];for(let e=0;e<a.length;e++){let s=a[e];if("local"==i[1]||"sub"==i[1]){let e="res/"+t+"/"+s;d.CUR_PLATFORM==d.OPPO&&"sub"==i[1]&&(e=t+"/"+s),c._resMap.set(s,new p(s,t,i[1],e))}else{let e=c._resBasePath+s;c._resMap.set(s,new p(s,t+"_"+i[2],i[1],e))}}}console.log(c._resMap),t()}))}})}static getRes(t){return c._resMap.get(t)||console.error(t),Laya.loader.getRes(c._resMap.get(t).url)}static getResClone(t){return Laya.loader.getRes(c._resMap.get(t).url).clone()}static download(t,e=null){return new Promise(i=>{let a=[],s=[];for(let e=0;e<t.length;e++){let i=t[e],n=c._resMap.get(i);if(n||console.error("找不到资源",i),"sub"==n.location)-1==a.indexOf(n.bundleName)&&-1==c._loadedSubNames.indexOf(n.bundleName)&&a.push(n.bundleName);else if("net"==n.location&&-1==s.indexOf(n.bundleName)){let t=n.bundleName.split("_")[0],e=n.bundleName.split("_")[1];c._zipVersion[t]!=e&&s.push(n.bundleName)}}c._loadSubpackages(a,e).then(()=>{c._downloadFiles(s,e).then(()=>{i()})})})}static create(t,e=null){return new Promise(i=>{c.download(t,e).then(()=>{let a=[];for(let e=0;e<t.length;e++)a.push(c._resMap.get(t[e]));c._createRes(a,a.length,e).then(()=>{i()})})})}static _createRes(t,e,i=null){return new Promise(a=>{if(t.length>0){let s=t.shift(),n=s.name.split(".")[0],o=(e-t.length-1)/e;i&&i({type:"create",progress:o,name:n}),Laya.loader.create(s.url,Laya.Handler.create(this,()=>{o=(e-t.length)/e,i&&i({type:"create",progress:o,name:n}),c._createRes(t,e,i).then(()=>{a()})}),Laya.Handler.create(this,t=>{i&&i({type:"create",progress:o,name:n})}))}else a()})}static loadSpines(t){return new Promise(e=>{let i=[];if(t&&t.length>0){let a=t.shift();c.download([a]).then(()=>{let s=new Laya.Skeleton;i.push(s),s.load(c._resMap.get(a).url,Laya.Handler.create(this,()=>{c.loadSpines(t).then(t=>{e(i.concat(t))})}))})}else e(i)})}static loadFonts(t){return new Promise(e=>{if(t&&t.length>0){let i=t.shift();c.download([i]).then(()=>{let a=new Laya.BitmapFont;a.loadFont(c._resMap.get(i).url,Laya.Handler.create(this,a=>{a.setSpaceWidth(10),a.autoScaleSize=!0,Laya.Text.registerBitmapFont(i.split(".")[0],a),c.loadFonts(t).then(()=>{e()})},[a]))})}else e()})}static playSound(t,e=1,i=null,a=null,s=0){c.download([t]).then(()=>{if(c.soundOpen)return Laya.SoundManager.playSound(c._resMap.get(t).url,e,i,a,s)})}static stopSound(t){Laya.SoundManager.stopSound(c._resMap.get(t).url)}static playMusic(t,e=0,i=null,a=0){this.musicName=t,c.download([t]).then(()=>{if(c.musicOpen)return Laya.SoundManager.playMusic(c._resMap.get(t).url,e,i,a)})}static _loadSubpackages(t,e=null){return new Promise(i=>{if(t.length>0){let a=t.shift(),s=0;e&&e({type:"download",progress:s,location:"sub",name:a}),console.log("loadSubpackageStart"+a);let n={name:a,success:n=>{c._loadedSubNames.push(a),s=1,e&&e({type:"download",progress:s,location:"sub",name:a}),c._loadSubpackages(t,e).then(()=>{i()})},fail:t=>{console.log("loadSubpackageFail",JSON.stringify(t),a)}};console.log(n),c._loadSubpackage(n).onProgressUpdate(t=>{s=(s=t.progress>s?t.progress:s)<1?s:1,e&&e({type:"download",progress:s,location:"sub",name:a,totalBytesWritten:t.totalBytesWritten,totalBytesExpectedToWrite:t.totalBytesExpectedToWrite})})}else i()})}static _downloadFiles(t,e=null){return new Promise(i=>{if(t.length>0){let a=t.shift(),s=a.split("_")[0],n=a.split("_")[1],o=0;e&&e({type:"download",progress:o,location:"net",name:s});let h=c._resBasePath+a+".zip";c._downloadFile({url:c._remote+a+".zip",filePath:h,success:a=>{200===a.statusCode&&c._fileSystemManager.unzip({zipFilePath:h,targetPath:c._resBasePath,success:a=>{c._zipVersion[s]=n,Laya.LocalStorage.setItem("zipVersion",JSON.stringify(c._zipVersion)),o=1,e&&e({type:"download",progress:o,location:"net",name:s}),c._fileSystemManager.unlink({filePath:h}),c._downloadFiles(t,e).then(()=>{i()})},fail:t=>{}})},fail:t=>{}}).onProgressUpdate(t=>{let i=t.progress/100;o=(o=i>o?i:o)<1?o:1,e&&e({type:"download",progress:o,location:"net",name:s})})}else i()})}static manualShare(){}}c._instance=null,c._fileSystemManager=null,c._resBasePath=null,c._downloadFile=null,c._loadSubpackage=null,c._remote="",c._resMap=null,c._loadedSubNames=[],c._zipVersion={},c.musicOpen=!0,c.soundOpen=!0,c.vibrateOpen=!0,c.musicName="";class p{constructor(t,e,i,a){this._location=null,this._bundleName=null,this._url=null,this._name=null,this._name=t,this._location=i,this._bundleName=e,this._url=a}get location(){return this._location}get bundleName(){return this._bundleName}get url(){return this._url}get name(){return this._name}}class g{}g.UserDataChange="UserDataChange",g.ControllerEvent="ControllerEvent",g.UpdateStep="UpdateStep",g.UpdateKillNum="UpdateKillNum",g.UpdateAttack="UpdateAttack",g.UpdatePointer="UpdatePointer",g.UpdateKillBtn="UpdateKillBtn",g.OnStateExit="OnStateExit",g.UseSkill="UseSkill",g.ShowWrongTip="ShowWrongTip",g.OnStateTrigger="OnStateTrigger",g.AttackMove="AttackMove",g.AttackDamage="AttackDamage",g.EnemyAttack="EnemyAttack",g.AttackEnd="AttackEnd",g.ShowCombo="ShowCombo",g.BigBlood="BigBlood",g.AttackNotEnoughTip="AttackNotEnoughTip",g.ConnectTip="ConnectTip",g.PlayerRevive="PlayerRevive",g.ShowBossAttackDiff="ShowBossAttackDiff",g.UpdateShopList="UpdateShopList",g.UpdateMainPlayer="UpdateMainPlayer",g.UpdateTask="UpdateTask",g.NewGuideEvent="NewGuideEvent",g.ShowPlayerPointer="ShowPlayerPointer",g.PopTip="PopTip",g.UpdateRed="UpdateRed",g.MainRedUpdate="MainRedUpdate";class m{constructor(t=null){if(this.islandArea=1,this.gold=900,this.level=1,this.playLevel=1,this.isFull=0,this.playerID=0,this.playerUnlock=[1,0,0,0,0],this.weaponID=0,this.weaponType=0,this.weaponUnlock=[[1,0,0],[0,0,0],[0,0,0]],this.weaponLevel=[0,0,0,0,0],this.propNum=[0,0,0,0],this.freeLotteryTimestamp=0,this.freeLotteryTimeLeft=1,this.signDay=0,this.signTimestamp=0,this.signRec=[0,0,0,0,0,0,0],this.dayTaskRefreshTimestamp=0,this.dayTaskId=[0,0,0],this.dayTaskCountRec=[0,0,0],this.dayTaskReceiveRec=[0,0,0],this.achieveTaskCountRec=[0,0,0,0,0],this.achieveTaskReceiveRec=[0,0,0,0,0],this.achieveTaskStage=[0,0,0,0,0],this.roleQualityList=[1,1,1,1,1],this.warriorLevelList=[1,1,1,1,1],this.buildingLevelList=[1,1,1,1],this.divisionRewardState=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],this.upTicket=0,this.fishStage=[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.strengthLevel=1,this.strengthStage=[0,0,0,0,0],this.winCount=0,this.seasonStartTimeStamp=0,this.supplyCount=1,this.matchCount=0,t)for(const e in t)t.hasOwnProperty(e)&&t[e]&&(this[e]=t[e]);this.updateSign(),this.updateDayTask(),this.updateSeason()}static get instance(){if(!m._instance){let t=Laya.LocalStorage.getItem(m._name);t&&(t=JSON.parse(t)),m._instance=new m(t)}return m._instance}onDataChange(t){Laya.LocalStorage.setItem(m._name,JSON.stringify(this)),l.event(g.UserDataChange,t)}finishTask(t,e,i){0==t?(this.dayTaskCountRec[e]+=i,this.onDataChange("dayTaskCountRec")):(this.achieveTaskCountRec[e]+=i,this.onDataChange("achieveTaskCountRec"))}updateSign(){if(this.signTimestamp>0){Date.now()-this.signTimestamp>864e5&&(this.supplyCount=1,this.onDataChange("supplyCount"),1==this.signRec[this.signDay]&&(this.signDay++,7==this.signDay&&(this.signDay=0,this.signRec=[0,0,0,0,0,0,0]),this.onDataChange("signDay"),this.onDataChange("signRec")))}}updateDayTask(){let t=Date.now();if(t-this.dayTaskRefreshTimestamp>864e5){this.dayTaskRefreshTimestamp=t,this.dayTaskId=[],this.dayTaskCountRec=[],this.dayTaskReceiveRec=[];for(let t=0;t<3;t++)this.dayTaskCountRec.push(0),this.dayTaskReceiveRec.push(0);this.onDataChange("dayTaskRefreshTimestamp"),this.onDataChange("dayTaskId"),this.onDataChange("dayTaskCountRec"),this.onDataChange("dayTaskReceiveRec")}}updateSeason(){0==this.seasonStartTimeStamp&&(this.seasonStartTimeStamp=Date.now(),this.onDataChange("seasonStartTimeStamp"),this.winCount=0,this.onDataChange("winCount"),this.divisionRewardState=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],this.onDataChange("divisionRewardState"))}}m._name="UserData";class y extends t.pages.rewardUI{constructor(){super(...arguments),this.rewardNum=0,this.rewardType=0}onAwake(){c.playSound("strength.mp3")}onOpened(){Laya.MouseManager.enabled=!0,this.getBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.videoGetBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}setReward(t,e){this.rewardNum=t,this.rewardType=e,0==e?(this.rewardImg.skin="count/Ui_JiangLI.png",this.goldLabel.value="X"+t,this.videoGetBtn.visible=!0,this.getBtn.x=-138):(this.rewardImg.skin=`icon/UI_YU${t+1}.png`,this.goldLabel.value="X1",this.videoGetBtn.visible=!1,this.getBtn.x=0)}onBtnClick(t){t.target==this.getBtn?0==this.rewardType?(m.instance.gold+=this.rewardNum,m.instance.onDataChange("gold")):l.event(e.UnlockFish,this.rewardNum):t.target==this.videoGetBtn&&(m.instance.gold+=2*this.rewardNum,m.instance.onDataChange("gold")),this.close()}static loadScene(t,e){Laya.MouseManager.enabled=!1,Laya.Scene.load("pages/reward.scene",Laya.Handler.create(this,i=>{i.open(!1),i.setReward(t,e)}))}}class u extends t.pages.addMoneyUI{constructor(){super(...arguments),this.moneyNum=200}onAwake(){this.goldLabel.value="X"+this.moneyNum}onOpened(){Laya.MouseManager.enabled=!0,this.videoGetBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.noGetBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(t){t.target==this.videoGetBtn?(y.loadScene(this.moneyNum,0),this.close()):t.target==this.noGetBtn&&this.close()}}class f extends t.pages.divisionUI{constructor(){super(...arguments),this.seasonEndTime=0,this.cellList=[],this.lineList=[],this.reward=[[500,1e3],[1e3,2e3],[1500,3e3],[2e3,4e3],[2500,5e3],[3e3,6e3],[4e3,8e3],[5e3,1e4],[8e3,16e3]]}onAwake(){this.blackMask.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.blackMask.alpha=.8,this.width=Laya.stage.width,this.height=Laya.stage.height,this.slidePanel.hScrollBarSkin=null;for(let e=0;e<9;e++){let i=new t.pages.divisionCellUI,a=new t.pages.divisionLineUI;i.rewardBox1.on(Laya.Event.CLICK,this,this.onBtnClick,[e,0]),i.rewardBox2.on(Laya.Event.CLICK,this,this.onBtnClick,[e,1]),i.y=135,i.x=169*e,i.rewardNum1.text=this.reward[e][0]+"",i.rewardNum2.text=this.reward[e][1]+"",i.divisionIcon.skin=`division/Ui_DuanWei${e+1}.png`,i.divisionName.skin=`division/Ui_DWName${e+1}.png`,this.cellList.push(i),this.lineList.push(a),a.y=96,a.x=69+169*e,this.slidePanel.addChild(i),this.slidePanel.addChild(a)}this.updateCellState(),this.updateLineState(),this.seasonEndTime=m.instance.seasonStartTimeStamp+864e5,Laya.timer.frameLoop(1,this,this.onFrameLoop)}updateSeasonTimeLeft(){let t=Date.now(),e=this.seasonEndTime-t;if(e<=0)m.instance.updateSeason(),this.updateCellState(),this.updateLineState();else{let t=Math.floor(e/36e5),i=Math.ceil(e%36e5/6e4);this.seasonTimeLeft.text=`${t}小时${i}分`}}onDestroy(){Laya.timer.clearAll(this)}onFrameLoop(){this.updateSeasonTimeLeft()}onBtnClick(t,i){m.instance.winCount<f.winList[t]||0==m.instance.divisionRewardState[t][i]&&(this.receiveReward(t,i),l.event(e.UpdateDivisionRed))}receiveReward(t,e){y.loadScene(this.reward[t][e],0),m.instance.divisionRewardState[t][e]=1,m.instance.onDataChange("divisionRewardState"),this.updateCellState()}updateCellState(){for(let t=0;t<this.cellList.length;t++){let e=this.cellList[t];m.instance.winCount<f.winList[t]?(e.bg.gray=!0,e.red1.visible=!1,e.red2.visible=!1):e.bg.gray=!1,0==m.instance.divisionRewardState[t][0]?(e.receiveMask1.visible=!1,0==e.bg.gray&&(e.red1.visible=!0)):(e.receiveMask1.visible=!0,e.red1.visible=!1),0==m.instance.divisionRewardState[t][1]?(e.receiveMask2.visible=!1,0==e.bg.gray&&(e.red2.visible=!0)):(e.red2.visible=!1,e.receiveMask2.visible=!0)}}updateLineState(){let t=0;for(let e=0;e<this.lineList.length;e++){let i=this.lineList[e];if(m.instance.winCount>=f.winList[e])i.line.height=151,i.point.skin="division/Ui_Circle1.png",this.curDivisionIcon.skin=`division/Ui_DuanWei${e+1}.png`,this.curDivisionName.skin=`division/Ui_DWName${e+1}.png`,t=66+161*e;else{let a=0;e>0&&(a=f.winList[e-1]);let s=m.instance.winCount-a,n=(s=s>0?s:0)/(f.winList[e]-a);i.line.height=151*n,i.point.skin="division/Ui_Circle2.png",t+=161*n}}this.mePointer.x=t,this.mePointer.y=69}static getDivisionPropertyAdd(){let t=1;for(let e=0;e<this.winList.length&&m.instance.winCount>=this.winList[e];e++)t+=.1;return t}static curDivision(){let t={left:this.winList.length-2,right:this.winList.length-1,progress:1};for(let e=0;e<this.winList.length&&m.instance.winCount>=this.winList[e];e++)e<this.winList.length-1&&(t.left=e,t.right=e+1,t.progress=(m.instance.winCount-this.winList[e])/(this.winList[e+1]-this.winList[e]));return t}static haveReward(){for(let t=0;t<this.winList.length;t++)if(m.instance.winCount>=this.winList[t]){let e=m.instance.divisionRewardState[t];if(0==e[0]||0==e[1])return!0}return!1}}f.winList=[0,3,4,5,7,9,11,15,20];class w{constructor(t){this.atk=10,this.hp=10,this.atkGap=500,this.mSpeed=5,this.energy=100,t&&(this.id=t.id,this.atk=t.atk,this.hp=t.hp,this.atkGap=t.atkGap,this.mSpeed=t.mSpeed/20,this.energy=t.energy,this.skillType=t.skillType,this.param=t.param)}clone(){return new w(this)}}class L{constructor(){this.mapData=null,this.lowData=null,this.middleData=null,this.highData=null,this.bombData=null,this.strengthenData=null,this.aiNameList=["玩家1","玩家2","玩家3","玩家4","玩家5","玩家6","玩家7","玩家8","玩家9","玩家10"],this.fishInfo={Player1:[4,1,.85],Player2:[4,1,.85],Player3:[4,1,.85],Player4:[4,1,.85],Player5:[4,1,.85],Player6:[4,1,.85],Player7:[4,1,.85],Player8:[4,1,.85],Player9:[4,1,.85],Player10:[4,1,.85],Player11:[4,1,.85],Player12:[4,1,.85],Player13:[4,1,.85],Player14:[4,1,.85],Player15:[4,1,.85],Player16:[4,1,.85],Player17:[4,1,.85],Player18:[4,1,.85],Player19:[4,1,.85],Player20:[4,1,.85],Enemy1:[.7,.5,0],Enemy2:[.7,.5,0],Enemy3:[2,.7,0],Enemy4:[3.4,.45,0],Enemy5:[3.4,.45,0],Enemy6:[3,.7,0]},this.aiConfig=[{name:"XXTCH",icon:"https://demo.xxtch.com/AiImage/Ai1.png"},{name:"阳阳",icon:"https://demo.xxtch.com/AiImage/Ai2.png"},{name:"Vanl",icon:"https://demo.xxtch.com/AiImage/Ai3.png"},{name:"悦",icon:"https://demo.xxtch.com/AiImage/Ai4.png"},{name:"绝世总攻铁柱",icon:"https://demo.xxtch.com/AiImage/Ai5.png"},{name:"吸汉总少女丶",icon:"https://demo.xxtch.com/AiImage/Ai6.png"},{name:"V.",icon:"https://demo.xxtch.com/AiImage/Ai7.png"},{name:"陈小飞.",icon:"https://demo.xxtch.com/AiImage/Ai8.png"},{name:"小丑八怪",icon:"https://demo.xxtch.com/AiImage/Ai9.png"},{name:"Doraemon",icon:"https://demo.xxtch.com/AiImage/Ai10.png"},{name:"奥特鄙视",icon:"https://demo.xxtch.com/AiImage/Ai11.png"},{name:"未忈",icon:"https://demo.xxtch.com/AiImage/Ai12.png"},{name:"强颜欢笑",icon:"https://demo.xxtch.com/AiImage/Ai13.png"},{name:"BWUWB",icon:"https://demo.xxtch.com/AiImage/Ai14.png"},{name:"185****5206",icon:"https://demo.xxtch.com/AiImage/Ai15.png"},{name:"风华绝代的芋仔",icon:"https://demo.xxtch.com/AiImage/Ai16.png"},{name:"蘑菇炖提莫",icon:"https://demo.xxtch.com/AiImage/Ai17.png"},{name:"沧海入我杯中酒",icon:"https://demo.xxtch.com/AiImage/Ai18.png"},{name:"Heaven",icon:"https://demo.xxtch.com/AiImage/Ai19.png"},{name:"淺笑如夏",icon:"https://demo.xxtch.com/AiImage/Ai20.png"},{name:"橘味果酱",icon:"https://demo.xxtch.com/AiImage/Ai21.png"},{name:"纸鸢",icon:"https://demo.xxtch.com/AiImage/Ai22.png"},{name:"今世的繁华╮",icon:"https://demo.xxtch.com/AiImage/Ai23.png"},{name:"一抹胭脂冷",icon:"https://demo.xxtch.com/AiImage/Ai24.png"},{name:"短腿萝莉*^﹏^*",icon:"https://demo.xxtch.com/AiImage/Ai25.png"},{name:"风吹半茶凉",icon:"https://demo.xxtch.com/AiImage/Ai26.png"},{name:"爱在夜里翻滚",icon:"https://demo.xxtch.com/AiImage/Ai27.png"},{name:"别跟我玩心跳",icon:"https://demo.xxtch.com/AiImage/Ai28.png"},{name:"呆到﹏天然萌",icon:"https://demo.xxtch.com/AiImage/Ai29.png"},{name:"无恙",icon:"https://demo.xxtch.com/AiImage/Ai30.png"},{name:"执手不离",icon:"https://demo.xxtch.com/AiImage/Ai31.png"},{name:"吃货最怕做饿梦",icon:"https://demo.xxtch.com/AiImage/Ai32.png"},{name:"陌路人生",icon:"https://demo.xxtch.com/AiImage/Ai33.png"},{name:"袖染墨凉°",icon:"https://demo.xxtch.com/AiImage/Ai34.png"},{name:"刁民别害朕",icon:"https://demo.xxtch.com/AiImage/Ai35.png"},{name:"夏了夏天",icon:"https://demo.xxtch.com/AiImage/Ai36.png"},{name:"坚守、那份情",icon:"https://demo.xxtch.com/AiImage/Ai37.png"},{name:"谎言成双",icon:"https://demo.xxtch.com/AiImage/Ai38.png"},{name:"寡欢",icon:"https://demo.xxtch.com/AiImage/Ai39.png"},{name:"猫南北",icon:"https://demo.xxtch.com/AiImage/Ai40.png"},{name:"予你百年情深",icon:"https://demo.xxtch.com/AiImage/Ai41.png"},{name:"软妹贩卖机",icon:"https://demo.xxtch.com/AiImage/Ai42.png"},{name:"一纸折扇情",icon:"https://demo.xxtch.com/AiImage/Ai43.png"},{name:"陌挽巷",icon:"https://demo.xxtch.com/AiImage/Ai44.png"},{name:"为你尽力",icon:"https://demo.xxtch.com/AiImage/Ai45.png"},{name:"风吹半茶凉",icon:"https://demo.xxtch.com/AiImage/Ai46.png"},{name:"╭笑丶扯",icon:"https://demo.xxtch.com/AiImage/Ai47.png"},{name:"→苍凉ゝ",icon:"https://demo.xxtch.com/AiImage/Ai48.png"},{name:"怎么没把你淹死",icon:"https://demo.xxtch.com/AiImage/Ai49.png"},{name:"元气丶梦醒.",icon:"https://demo.xxtch.com/AiImage/Ai50.png"}],this.aiLevel=0,this.safeY=28,this.playerSafeY=28.8,this.enemyY=20,this.mapSize=900,this.bombRadius=.8,this.meatRadius=.8,this.bombExplodeRadius=2,this.curFrame=0,this.timeCount=60,this.fps=0,this.strengthData=new w(null),this.myRank=0,this.myKill=0,this.divisionPropertyAdd=1,this.fightPropertyAdd=1,this.aiFishIdList=null,this.fangsEffectList=["Fangs1","Fangs1","Fangs1","Fangs1","Fangs1","Fangs1","Fangs1","Fangs1","Fangs2","Fangs1","Fangs1","Fangs1","Fangs1","Fangs1","Fangs1","Fangs1","Fangs2","Fangs2","Fangs2","Fangs2"]}static get Instance(){return null==this._instance&&(this._instance=new L),this._instance}init(){this.mapData=c.getRes("mapData.json"),this.lowData=c.getRes("mapData1.json"),this.middleData=c.getRes("mapData2.json"),this.highData=c.getRes("mapData3.json"),this.bombData=c.getRes("mapData0.json"),this.strengthenData=c.getRes("strengthen.json"),this.divisionPropertyAdd=f.getDivisionPropertyAdd()}updateStrenthData(t){let e=this.strengthData.atk;1==t?e=this.strengthData.hp:2==t?e=this.strengthData.energy:3==t?e=this.strengthData.mSpeed:4==t&&(e=this.strengthData.atkGap),this.strengthData.atk=0,this.strengthData.hp=0,this.strengthData.atkGap=0,this.strengthData.mSpeed=0,this.strengthData.energy=0;let i=m.instance.strengthLevel;for(let t=0;t<i;t++)for(let e=0;e<5;e++){let a=5;t==i-1&&(a=m.instance.strengthStage[e]);for(let i=0;i<a;i++){let a=this.getConfigData(t+1,i);0==e?this.strengthData.atk+=a.atk:1==e?this.strengthData.hp+=a.hp:2==e?this.strengthData.energy+=a.energy:3==e?this.strengthData.mSpeed+=a.mSpeed:4==e&&(this.strengthData.atkGap+=a.atkGap)}}let a=this.strengthData.atk-e;return 1==t?a=this.strengthData.hp-e:2==t?a=this.strengthData.energy-e:3==t?a=this.strengthData.mSpeed-e:4==t&&(a=this.strengthData.atkGap-e),a}getFishConfigDataByName(t){if(-1!=t.indexOf("Player")){return c.getRes("fish.json")[Number(t.replace("Player",""))-1]}return null}getBodyInfoByName(t){return L.Instance.fishInfo[t]}getConfigData(t,e){let i=5*(t-1)+e;return this.strengthenData[i]}calculateFps(){if(this.curFrame++,this.timeCount+=Laya.timer.delta,5==this.curFrame){let t=this.timeCount/this.curFrame;this.curFrame=0,this.timeCount=0,L.Instance.fps=1e3/t}}}class v extends t.pages.countUI{constructor(){super(...arguments),this.reward=0}onAwake(){Laya.SoundManager.stopMusic(),this.receiveBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.checkAdBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.videoReceiveBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(t){c.playSound("click.mp3"),t.target==this.receiveBtn?(m.instance.gold+=this.reward,m.instance.onDataChange("gold")):t.target==this.checkAdBtn||t.target==this.videoReceiveBtn&&(m.instance.gold+=2*this.reward,m.instance.onDataChange("gold")),Laya.Scene.open("pages/main.scene"),this.close()}setData(t,e){m.instance.matchCount++,m.instance.onDataChange("matchCount"),1==e&&(m.instance.winCount++,m.instance.onDataChange("winCount"),m.instance.finishTask(0,1,1),m.instance.finishTask(1,3,1),c.playSound("success.mp3"));let i=f.curDivision();if(this.leftDIcon.skin=`division/Ui_DuanWei${i.left+1}.png`,this.rightDIcon.skin=`division/Ui_DuanWei${i.right+1}.png`,this.progressBar.width=0,Laya.Tween.to(this.progressBar,{width:279*i.progress},500,Laya.Ease.sineOut),this.killLabel.value=t+"",this.rankLabel.value=e+"",1==e){let t=L.Instance.fightPropertyAdd+=.3;L.Instance.fightPropertyAdd=t<1.3?t:1.3,this.reward=200}else{let t=L.Instance.fightPropertyAdd-=.3;L.Instance.fightPropertyAdd=t>.7?t:.7,this.reward=100}this.moneyLabel.text=this.reward+""}}class k extends t.pages.daySupplyUI{onAwake(){}onOpened(){Laya.MouseManager.enabled=!0,this.videoGetBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.noGetBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(t){t.target==this.videoGetBtn?(this.close(),y.loadScene(k.moneyNum,0),m.instance.supplyCount++,m.instance.supplyCount>5&&(m.instance.supplyCount=1),m.instance.onDataChange("supplyCount")):t.target==this.noGetBtn&&this.close()}static loadScene(){Laya.MouseManager.enabled=!1,k.moneyNum=300,5==m.instance.supplyCount&&(k.moneyNum=1e3),Laya.Scene.load("pages/daySupply.scene",Laya.Handler.create(this,t=>{t.open(!1)}))}}k.moneyNum=0;class S extends t.pages.downPanelUI{constructor(){super(...arguments),this.btnList=[],this.pageList=[],this.curIndex=0,this.lastIndex=0,this.tweenTarget={progress:0},this.isTweening=!1,this.canChangePage=!0,this.mainPage=null,this.mainBtn=null}onAwake(){}initBtnArr(t){this.curIndex=-1,this.lastIndex=-1;for(let e=0;e<t.length;e++){let i=t[e];this.btnList.push(i.btn),this.pageList.push(null),i.btn.btnIcon.skin=i.iconSkin,i.btn.on(Laya.Event.CLICK,this,this.onBtnClick,[e,i.btn])}this.tweenTarget.progress=1,this.onTweenUpdate()}setMainPage(t,e){this.mainPage=e,this.mainBtn=t,this.mainBtn.on(Laya.Event.CLICK,this,this.onBtnClick,[-1,this.mainBtn])}setPage(t,e){e&&(this.pageList[t]=e,e.x=Laya.stage.width)}getPage(t){return-1==t?this.mainPage:this.pageList[t]}getBtn(t){return-1==t?this.mainBtn:this.btnList[t]}onBtnClick(t,e,i){if(i.stopPropagation(),c.playSound("click.mp3"),this.isTweening||t==this.curIndex||!this.canChangePage)return;this.isTweening=!0,this.tweenTarget.progress=0,this.curIndex=t,Laya.Tween.to(this.tweenTarget,{progress:1,update:Laya.Handler.create(this,this.onTweenUpdate,null,!1)},380,Laya.Ease.backOut,Laya.Handler.create(this,this.onTweenComplete));let a=this.getPage(this.lastIndex);a.offSelect&&a.offSelect();let s=this.getPage(this.curIndex);s.onSelect&&s.onSelect(),-1==this.curIndex?Laya.Tween.to(this.mainBtn,{alpha:0},200,Laya.Ease.sineIn):Laya.Tween.to(this.mainBtn,{alpha:1},200,Laya.Ease.sineOut)}onTweenUpdate(){let t=this.getPage(this.lastIndex),e=this.getPage(this.curIndex);-1==this.curIndex?(e.x=(1-this.tweenTarget.progress)*-Laya.stage.width,e!=t&&(t.x=this.tweenTarget.progress*Laya.stage.width)):(e.x=(1-this.tweenTarget.progress)*Laya.stage.width,e!=t&&(t.x=this.tweenTarget.progress*-Laya.stage.width))}onTweenComplete(){this.isTweening=!1,this.lastIndex=this.curIndex}showBtnRedPoint(t,e){this.btnList[t].redPoint.visible=e}}class I{constructor(t){this.parentList=[],this.childList=[],this.isActive=!1,this.isUnlock=!1,this.atk=0,this.hp=0,this.atkGap=0,this.mSpeed=0,this.energy=0,this.costList=null,this.index=-1,this.skillType=0,this.atk=t.atk,this.hp=t.hp,this.atkGap=t.atkGap,this.mSpeed=t.mSpeed,this.energy=t.energy,this.skillType=t.skillType,this.name=t.name,this.desc=t.desc,this.costList=[t.exp1cost,t.exp2cost,t.exp3cost]}}class x{static getRandom(t,e){return Math.floor(t+Math.random()*(e-t+1))}static getRotateRad(t,e){Laya.Vector3.normalize(t,t),Laya.Vector3.normalize(e,e);let i=Math.acos(x.fixedDot(t,e)),a=new Laya.Vector3;return Laya.Vector3.cross(t,e,a),a.y<0?-i:i}static eulerToQuaternion(t,e){Laya.Quaternion.createFromYawPitchRoll(t.y*Math.PI/180,t.x*Math.PI/180,t.z*Math.PI/180,e)}static quaternionToEuler(t,e){t.getYawPitchRoll(e),e.setValue(180*e.y/Math.PI,180*e.x/Math.PI,180*e.z/Math.PI)}static getPitchRotateRad(t,e){Laya.Vector3.normalize(t,t),Laya.Vector3.normalize(e,e);let i=Math.acos(x.fixedDot(t,e)),a=new Laya.Vector3(t.x,0,t.z);Laya.Vector3.normalize(a,a);let s=t.y,n=e.y,o=Math.acos(x.fixedDot(t,a)),h=Math.acos(x.fixedDot(e,a));return s==n?s>=0?o>=h?i:-i:o>=h?-i:i:s>n?i:-i}static fixedDot(t,e){let i=Laya.Vector3.dot(t,e);return i=(i=i>-1?i:-1)<1?i:1}getNormalByVecInFace(t,e){let i=new Laya.Vector3(0,0,1),a=t.x,s=t.y,n=t.z,o=e.x,h=e.y,r=e.z;i.x=(r*s-n*h)/(a*h-o*s),i.y=(r*a-n*o)/(s*o-h*a),Laya.Vector3.normalize(i,i)}getProjectionVecInFace(t,e){Laya.Vector3.normalize(t,t),Laya.Vector3.normalize(e,e);let i=new Laya.Vector3;return Laya.Vector3.scale(e,Laya.Vector3.dot(t,e),e),Laya.Vector3.subtract(t,e,i),i}static getRadBetweenVec(t,e){return Laya.Vector3.normalize(t,t),Laya.Vector3.normalize(e,e),Math.acos(x.fixedDot(t,e))}static vector2Rotate(t,e){let i=t.x,a=t.y;t.x=i*Math.cos(e)+a*Math.sin(e),t.y=-i*Math.sin(e)+a*Math.cos(e)}static getYawAndPitch(t,e){let i=0,a=0;return this.projectionDir1.x=t.x,this.projectionDir1.z=t.z,this.projectionDir1.y=0,this.projectionDir2.x=e.x,this.projectionDir2.z=e.z,this.projectionDir2.y=0,a=x.getRotateRad(this.projectionDir1,this.projectionDir2),this.projectionDir1.x=t.x,this.projectionDir1.z=t.z,this.projectionDir1.y=t.y,this.projectionDir2.x=e.x,this.projectionDir2.z=e.z,this.projectionDir2.y=e.y,Laya.Quaternion.createFromYawPitchRoll(a,0,0,this.rotateQua),Laya.Vector3.transformQuat(this.projectionDir1,this.rotateQua,this.rotateVec),{yawDiff:a,pitchDiff:i=x.getPitchRotateRad(this.rotateVec,this.projectionDir2)}}static floatAdd(t,e){var i,a,s;try{i=t.toString().split(".")[1].length}catch(t){i=0}try{a=e.toString().split(".")[1].length}catch(t){a=0}return(t*(s=Math.pow(10,Math.max(i,a)))+e*s)/s}static floatSub(t,e){var i,a,s;try{i=t.toString().split(".")[1].length}catch(t){i=0}try{a=e.toString().split(".")[1].length}catch(t){a=0}return((t*(s=Math.pow(10,Math.max(i,a)))-e*s)/s).toFixed(i>=a?i:a)}static floatMul(t,e){var i=0,a=t.toString(),s=e.toString();try{i+=a.split(".")[1].length}catch(t){}try{i+=s.split(".")[1].length}catch(t){}return Number(a.replace(".",""))*Number(s.replace(".",""))/Math.pow(10,i)}static floatDiv(t,e){var i=0,a=0;try{i=t.toString().split(".")[1].length}catch(t){}try{a=e.toString().split(".")[1].length}catch(t){}return Number(t.toString().replace(".",""))/Number(e.toString().replace(".",""))*Math.pow(10,a-i)}}x.rad2Deg=180/Math.PI,x.deg2Rad=Math.PI/180,x.projectionDir1=new Laya.Vector3,x.projectionDir2=new Laya.Vector3,x.rotateVec2=new Laya.Vector2,x.rotateQua=new Laya.Quaternion,x.rotateVec=new Laya.Vector3;class b extends Laya.Sprite{constructor(){super(),this._guideConfig=[{task:"进入主界面",text:"欢迎来到深海变异世界，让我们进入深海，开始历险！",mp3:"1.mp3",closeType:1},{task:"进入战斗界面",text:"先来介绍下如何在这个世界生存。",mp3:"2.mp3",closeType:0},{task:"引导虚拟摇杆",text:"使用摇杆选择移动方向。",mp3:"3.mp3",closeType:1},{task:"引导攻击按钮",text:"轻按这个按钮进行攻击。",mp3:"4.mp3",closeType:1},{task:"锁定鱼",text:"锁定目标后攻击，会一直锁定敌人。",mp3:"5.mp3",closeType:0},{task:"引导技能按钮",text:"按住这个按钮可以发动技能。",mp3:"6.mp3",closeType:1},{task:"返回主界面",text:"漂亮的一次历险！",mp3:"7.mp3",closeType:0},{task:"引导进去变异界面",text:"让我们变异成更强力的海洋生物吧！",mp3:"8.mp3",closeType:0},{task:"引导点击变异界面",text:"",mp3:"",closeType:1},{task:"引导选择变异方向",text:"选择想要变异的方向。",mp3:"9.mp3",closeType:1},{task:"引导点击变异按钮",text:"点击变异！",mp3:"10.mp3",closeType:1},{task:"引导点击变异按钮",text:"再次点击！",mp3:"11.mp3",closeType:1},{task:"引导点击变异按钮",text:"再次点击！",mp3:"11.mp3",closeType:1},{task:"确定变异",text:"​看起来更强力了！让我们继续历险吧！",mp3:"12.mp3",closeType:1},{task:"进入开始界面",text:"",mp3:"",closeType:1},{task:"进入主界面",text:"",mp3:"",closeType:1}],this.enableGuide=!1,this._guideId=0,this.guideFinish=!1,this.guideData=null,this._nodeList=[],this._nodeExDataList=[],this._closeGuideOnFinish=!1,this._hand=null,this.stageArr=[16,39,43],this.isTaskShow=!1,this.finishDelay=0,this.isClickFinish=!1,this._forceSetHandPos=!1,this.handNodeIndex=0,this.changeDelay=0,this.mouseEnabled=!0,this.visible=!1,this.name="GuideManager",this.cacheAs="bitmap",this.zOrder=1001,this.width=Laya.stage.width,this.height=Laya.stage.height,this._guideMask=new Laya.Sprite,this._guideMask.alpha=.8,this._guideMask.cacheAs="bitmap",this._guideMask.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),this.addChild(this._guideMask),this._destroyBox=new Laya.Box,this._destroyBox.width=Laya.stage.width,this._destroyBox.height=Laya.stage.height,this.addChild(this._destroyBox),this._guideView=new t.pages.guideUI,this._guideView.width=Laya.stage.width,this._guideView.height=Laya.stage.height,this.addChild(this._guideView),window.GuideManager=this,this.on(Laya.Event.CLICK,this,this.onPageEvent)}static get Instance(){return b._instance||(b._instance=new b,Laya.stage.addChild(b._instance)),b._instance}setTalkBottom(t){this._guideView.talkBg.bottom=t}get guideId(){return this._guideId}set guideId(t){this._guideId=t,t>=0&&t<this._guideConfig.length?this.guideData=this._guideConfig[this._guideId]:this.guideData=null,localStorage.setItem("guideId",this._guideId.toString())}setHand(t){this._hand=t,this._hand.x=0,this._hand.y=0,this._guideView.clickHand.addChild(this._hand)}init(){let t=localStorage.getItem("guideId");t?this._guideId=Number(t):localStorage.setItem("guideId",this._guideId.toString()),this._guideId<this.stageArr[0]?(this._guideId=0,this.guideFinish=!1,this.guideData=this._guideConfig[this._guideId],localStorage.clear()):this._guideId<this.stageArr[1]?(this._guideId=this.stageArr[0],this.guideFinish=!1,this.guideData=this._guideConfig[this._guideId],localStorage.setItem("guideId",this._guideId.toString())):this._guideId<this.stageArr[2]?(this._guideId=this.stageArr[1],this.guideFinish=!1,this.guideData=this._guideConfig[this._guideId],localStorage.setItem("guideId",this._guideId.toString())):this.guideFinish=!0}onPageEvent(t){this.isClickFinish&&(this.isClickFinish=!1,this.guideData&&0==this.guideData.closeType&&this.isTaskShow&&Laya.timer.once(this.finishDelay,this,()=>{console.log(this.guideData,this.guideData.closeType,this.isTaskShow),this.finishTask(this.guideData.task)}))}setGuideMaskAlpha(t){this._guideMask.alpha=t}showGuide(t,e,i=!1){if(this.enableGuide&&this._guideId!=this._guideConfig.length&&this.guideData&&t==this.guideData.task)if(this.isClickFinish=!1,0==this.guideData.closeType&&(this.isClickFinish=!0),this.isTaskShow=!0,this.mouseEnabled=!0,this.visible=!0,this._guideMask.visible=!0,this._closeGuideOnFinish=i,this.guideData.text&&this.guideData.text.length>0&&this.showTalk(!0,this.guideData.text),this.guideData.mp3&&this.guideData.mp3.length>0&&c.playSound(this.guideData.mp3),e&&e.length>0){this.handNodeIndex=0,this.changeDelay=0,Laya.timer.frameLoop(1,this,this.onFrameLoop),this._nodeList=e;for(let t=0;t<this._nodeList.length;t++){let e=this._nodeList[t],i=this.removeNodeToUp(e);this._nodeExDataList.push(i)}}else{let t=new Laya.Point(670,315);this._guideView.talkBg.localToGlobal(t,!1,this),this.showHand(!0,t)}}onFrameLoop(){if(0==this.changeDelay){let t=this._nodeList[this.handNodeIndex],e=new Laya.Point(t.width/2,t.height/2);t.localToGlobal(e,!1),this.showHand(!0,e),this.handNodeIndex=++this.handNodeIndex%this._nodeList.length,this.changeDelay=500}else this._nodeList.length>=2&&(this.changeDelay-=Laya.timer.delta,this.changeDelay<=0&&(this.changeDelay=0))}removeNodeToUp(t){let e=this.realScale(t),i=t.anchorX?t.anchorX:0,a=t.anchorY?t.anchorY:0,s=new Laya.Point(t.width*e.scaleX*i,t.height*e.scaleY*a);t.localToGlobal(s,!1);let n={parent:t.parent,x:t.x,y:t.y,scaleX:t.scaleX,scaleY:t.scaleY};return t.parent.removeChild(t),this._destroyBox.addChild(t),t.x=s.x,t.y=s.y,t.scaleX=e.scaleX,t.scaleY=e.scaleY,n}backNode(t,e){t.removeSelf(),e.parent.addChild(t),t.x=e.x,t.y=e.y,t.scaleX=e.scaleX,t.scaleY=e.scaleY}finishTask(t,e=0){if(this.enableGuide&&this._guideId!=this._guideConfig.length&&this.guideData&&t==this.guideData.task){if(this.finishDelay=0,this._forceSetHandPos=!1,this.isTaskShow=!1,this._closeGuideOnFinish&&this.hideGuide(),this._nodeList&&this._nodeList.length>0){Laya.timer.clear(this,this.onFrameLoop);for(let t=0;t<this._nodeList.length;t++){let e=this._nodeList[t],i=this._nodeExDataList[t];this.backNode(e,i)}this._nodeList=[],this._nodeExDataList=[]}this.guideData.mp3&&this.guideData.mp3.length>0&&c.stopSound(this.guideData.mp3),this.showTalk(!1,null),this.showHand(!1,null),this._guideId++,localStorage.setItem("guideId",this._guideId.toString()),this._guideId==this._guideConfig.length?(this.guideFinish=!0,this.guideData=null):(this.guideData=null,Laya.timer.once(e,this,()=>{this.guideData=this._guideConfig[this._guideId],this.sendNewGuideTaskEvent()}))}}setHandPos(t){this._guideView.clickHand.x=t.x,this._guideView.clickHand.y=t.y,this._forceSetHandPos=!0}sendNewGuideTaskEvent(){this.enableGuide&&this.guideData&&l.event(b.NEWGUIDETASK,this.guideData.task)}hideGuide(){this.visible=!1}realScale(t){let e={scaleX:t.scaleX,scaleY:t.scaleY};return t.parent&&(e.scaleX*=this.realScale(t.parent).scaleX,e.scaleY*=this.realScale(t.parent).scaleY),e}showTalk(t,e){t?(this._guideView.talkBg.visible=!0,this._guideView.talkLabel.text=e):this._guideView.talkBg.visible=!1}showHand(t,e){this._guideView.clickHand.visible=t,t?(this._forceSetHandPos||(this._guideView.clickHand.x=e.x,this._guideView.clickHand.y=e.y),this._hand.play(0,!0)):this._hand.stop()}setTalkAlign(t){this._guideView.talkBg.width=720,"left"==t?(this._guideView.talkBg.left=0,this._guideView.talkBg.centerX=NaN,this._guideView.talkBg.right=NaN,this._guideView.talkBgLeft.visible=!0,this._guideView.talkBgRight.visible=!1,this._guideView.talkLabel.x=252):"center"==t?(this._guideView.talkBg.left=NaN,this._guideView.talkBg.centerX=0,this._guideView.talkBg.right=NaN,this._guideView.talkBgLeft.visible=!0,this._guideView.talkBgRight.visible=!1,this._guideView.talkLabel.x=252):"right"==t&&(this._guideView.talkBg.left=NaN,this._guideView.talkBg.centerX=NaN,this._guideView.talkBg.right=0,this._guideView.talkBgLeft.visible=!1,this._guideView.talkBgRight.visible=!0,this._guideView.talkLabel.x=28)}}b.NEWGUIDETASK="NEWGUIDETASK";class P extends t.pages.genUI{constructor(){super(...arguments),this.nodeList=[],this.playTreeNode=null,this.selectTreeNode=null,this.lastIconNode=null,this.curSelectId=-1,this.lastUnlock=0,this.progressList=[],this.radarCenterX=0,this.radarCenterY=0,this.startPoints=[0,0,0,0,0,0,0,0,0,0],this.destPoints=[0,0,0,0,0,0,0,0,0,0],this.isDrawing=!1,this.drawTweenTarget={progress:0},this.tweenTarget={width:0}}onAwake(){this.width=Laya.stage.width,this.height=Laya.stage.height,this.slidePanel.hScrollBarSkin=null,this.virationBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.outBtn.on(Laya.Event.CLICK,this,this.onBtnClick),P.initTreeNode(),this.initIconNode(),this.updateUnlockState();let t=this.getNodeId(m.instance.playerID);Laya.timer.frameOnce(1,this,()=>{this.setSelectNode(t,this.nodeList[t],P.treeNodeList[t])}),this.atkProgress.setProgressBarSkin("main/Ui_Property1.png"),this.atkGapProgress.setProgressBarSkin("main/Ui_Property2.png"),this.hpProgress.setProgressBarSkin("main/Ui_Property3.png"),this.energyProgress.setProgressBarSkin("main/Ui_Property4.png"),this.mSpeedProgress.setProgressBarSkin("main/Ui_Property5.png"),this.atkProgress.setProgressValuePos(120,0),this.atkGapProgress.setProgressValuePos(120,0),this.hpProgress.setProgressValuePos(120,0),this.energyProgress.setProgressValuePos(120,0),this.mSpeedProgress.setProgressValuePos(120,0),l.on(e.UnlockFish,this,this.onUnlockFish),this.radarCenterX=this.radar.width/2,this.radarCenterY=this.radar.height/2,this.radar.alpha=.8}onBtnClick(t){if(c.playSound("click.mp3"),t.target==this.virationBtn){Laya.MouseManager.enabled=!0;let t=m.instance.fishStage[this.curSelectId];if(3==t)return;let i=this.selectTreeNode.costList[t];m.instance.gold>=i?(b.Instance.finishTask("引导点击变异按钮"),m.instance.gold-=i,m.instance.onDataChange("gold"),m.instance.fishStage[this.curSelectId]=t+1,m.instance.onDataChange("fishStage"),this.setExpProgress(m.instance.fishStage[this.curSelectId]),this.updateCostLabel(),3==m.instance.fishStage[this.curSelectId]&&(b.Instance.visible&&b.Instance.hideGuide(),m.instance.finishTask(0,2,1),this.playTreeNode=P.treeNodeList[this.curSelectId],l.event(e.UpdatePlayFish,[P.getFishId(this.curSelectId),this.playTreeNode,!0,!0]),this.selectTreeNode.isActive=!0,this.updateUnlockState(),this.virationBtn.visible=!1,this.outBtn.visible=!0,this.outBtn.disabled=!0)):(Laya.MouseManager.enabled=!1,Laya.Scene.open("pages/addMoney.scene",!1))}else t.target==this.outBtn&&(this.outBtn.disabled=!0,this.playTreeNode=P.treeNodeList[this.curSelectId],l.event(e.UpdatePlayFish,[P.getFishId(this.curSelectId),this.playTreeNode,!0,!1]))}initIconNode(){let t=["icon/UI_YU1.png","icon/UI_YU2.png","icon/UI_YU3.png","icon/UI_YU4.png","icon/UI_YU5.png","icon/UI_YU6.png","icon/UI_YU9.png","icon/UI_YU8.png","icon/UI_YU10.png","icon/UI_YU7.png","icon/UI_YU12.png","icon/UI_YU15.png","icon/UI_YU11.png","icon/UI_YU13.png","icon/UI_YU14.png","icon/UI_YU16.png","icon/UI_YU17.png","icon/UI_YU18.png","icon/UI_YU19.png","icon/UI_YU20.png"];for(let e=0;e<20;e++){let i=this.nodeBg.getChildAt(e);i.on(Laya.Event.CLICK,this,this.onNodeEvent,[e,i,P.treeNodeList[e]]),this.nodeList.push(i),i.light.visible=!1,i.icon.skin=t[e]}}static initTreeNode(){if(this.treeNodeList.length>0)return;let t=c.getRes("fish.json");for(let e=0;e<20;e++){let i=new I(t[e]);i.index=e,this.treeNodeList.push(i),3==m.instance.fishStage[e]&&(i.isActive=!0)}for(const t in this.treeNodeData)if(Object.prototype.hasOwnProperty.call(this.treeNodeData,t)){let e=this.treeNodeList[Number(t)-1],i=this.treeNodeData[t];for(let t=0;t<i.length;t++){let a=this.treeNodeList[i[t]-1];e.childList.push(a),a.parentList.push(e)}}}onNodeEvent(t,e,i,a){b.Instance.finishTask("引导选择变异方向");let s=!0;for(let t=0;t<i.parentList.length;t++){if(!i.parentList[t].isActive){s=!1;break}}this.setSelectNode(t,e,i)}updateUnlockState(){let t=0;for(let e=0;e<P.treeNodeList.length;e++){let i=P.treeNodeList[e],a=this.nodeList[i.index],s=!0;for(let t=0;t<i.parentList.length;t++){if(!i.parentList[t].isActive){s=!1;break}}i.isUnlock=s,a.gen.visible=!1,i.isUnlock&&(i.isActive||(a.gen.visible=!0,a.ani1.play(0,!0))),s&&t++,a.lock.visible=!s}if(0==this.lastUnlock)this.lastUnlock=t;else{let e=t-this.lastUnlock;m.instance.finishTask(1,4,e),this.lastUnlock=t}}setSelectNode(t,e,i){if(t!=this.curSelectId){if(this.lastIconNode){this.lastIconNode.light.visible=!1;let t=P.treeNodeList[this.curSelectId];t.isUnlock&&(t.isActive||(this.lastIconNode.gen.visible=!0))}this.curSelectId=t,e.light.visible=!0,e.gen.visible=!1,this.lastIconNode=e,this.nameLabel.text=i.name,this.descLabel.text=i.desc;let a="";for(let t=0;t<i.parentList.length;t++){let e=i.parentList[t];0==t?a+=e.name:a=a+"和"+e.name}this.selectTreeNode=i,this.updateCostLabel(),this.unlockConditionLabel.text=a,this.progressList=[];for(let t=0;t<5;t++)if(0==t)this.progressList.push(i.atk/1e3);else if(1==t)this.progressList.push(i.hp/5e3);else if(2==t)this.progressList.push(i.energy/500);else if(3==t)this.progressList.push(i.mSpeed/300);else if(4==t){let t=1e3*Number(x.floatSub(1,i.atkGap));this.progressList.push(t/300)}this.drawRader(),this.setSkillData(i.skillType),this.setExpProgress(m.instance.fishStage[t]),this.getNodeId(m.instance.playerID)==this.curSelectId?(this.outBtn.visible=!0,this.outBtn.disabled=!0,this.virationBtn.visible=!1,this.lockBtn.visible=!1):3==m.instance.fishStage[this.curSelectId]?(this.outBtn.visible=!0,this.outBtn.disabled=!1,this.virationBtn.visible=!1,this.lockBtn.visible=!1):(this.outBtn.visible=!1,i.isUnlock?(this.virationBtn.visible=!0,this.lockBtn.visible=!1):(this.virationBtn.visible=!1,this.lockBtn.visible=!0))}}drawRader(){this.updateDestPoint(),this.drawTweenTarget.progress=0,Laya.Tween.to(this.drawTweenTarget,{progress:1,update:Laya.Handler.create(this,this.onDrawUpdate,null,!1)},380,Laya.Ease.sineOut,Laya.Handler.create(this,this.onDrawComplete),0,!0)}updateDestPoint(){for(let t=0;t<5;t++){let e=this.getRaderPoint(t);this.destPoints[2*t]=e[0],this.destPoints[2*t+1]=e[1]}}getRaderPoint(t){let e=(-90-72*t)*x.deg2Rad,i=30*this.progressList[t];return[Math.cos(e)*i,Math.sin(e)*i]}onDrawComplete(){}onDrawUpdate(){let t=[];for(let e=0;e<5;e++){let i=this.getDrawPointByProgress(e,this.drawTweenTarget.progress);t.push(...i)}this.radar.graphics.clear(),this.radar.graphics.drawPoly(this.radarCenterX,this.radarCenterY,t,"#78ff00")}getDrawPointByProgress(t,e){return[this.startPoints[2*t]+(this.destPoints[2*t]-this.startPoints[2*t])*e,this.startPoints[2*t+1]+(this.destPoints[2*t+1]-this.startPoints[2*t+1])*e]}static getFishId(t){return[0,2,1,3,4,5,8,7,9,6,11,15,10,12,13,16,14,17,19,18][t]}getNodeId(t){return[0,2,1,3,4,5,8,7,9,6,11,15,10,12,13,16,14,17,19,18].indexOf(t)}updateCostLabel(){m.instance.fishStage[this.curSelectId]<3?this.variationCostLabel.value=this.selectTreeNode.costList[m.instance.fishStage[this.curSelectId]]+"":this.variationCostLabel.value=""}setExpProgress(t){Laya.Tween.to(this.tweenTarget,{width:t/3*141,update:Laya.Handler.create(this,()=>{this.exp.width=this.tweenTarget.width},null,!1)},500,Laya.Ease.sineOut)}onSelect(){b.Instance.finishTask("引导点击变异界面",500),l.event(e.EnterGen,!0)}offSelect(){l.event(e.EnterGen,!1)}onDestroy(){l.off(e.UnlockFish,this,this.onUnlockFish)}onUnlockFish(t){m.instance.fishStage[t]=3,m.instance.onDataChange("fishStage"),P.treeNodeList[t].isActive=!0,this.updateUnlockState()}setSkillData(t){let e=P.skillConfig[t-1];this.skillDesc.text=e.desc,this.skillName.text=e.name,this.skillIcon.skin=`gen/Ui_Skill${t+1}.png`}static getCanOutFishList(){let t=[];for(let e=0;e<P.treeNodeList.length;e++){let i=P.treeNodeList[e];if(0==i.parentList.length){let i=this.getFishId(e);-1==t.indexOf(i)&&t.push(i)}else{let a=!0;for(let t=0;t<i.parentList.length;t++){if(!i.parentList[t].isActive){a=!1;break}}if(a){let i=this.getFishId(e);-1==t.indexOf(i)&&t.push(i)}}return t}}}P.treeNodeList=[],P.treeNodeData={1:[2,3],2:[4,5],3:[6,10],4:[7],5:[8,9],6:[9],7:[11],8:[11,12],9:[12,13],10:[13],11:[14,15],12:[16,18],13:[16],14:[17],15:[17],16:[20],17:[19],18:[19,20],19:[],20:[]},P.skillConfig=[{name:"急速",desc:"一段时间加速移动"},{name:"无敌",desc:"一段时间无法受到伤害。敌方鱼还是会正常攻击"},{name:"水遁",desc:"向前闪现一段距离"},{name:"隐匿",desc:"进入潜行状态，攻击不会显性"},{name:"毒液",desc:"向前方吐一口老痰，球状范围内造成伤害"},{name:"鱼雷",desc:"向前方发射鱼雷(机械鱼)，弹道触碰后，球状范围内造成伤害"},{name:"水雷",desc:"抛出一颗水雷陷阱(机械鱼)，弹道触碰后，球状范围内造成伤害"},{name:"咆哮",desc:"发出咆哮伤害周围，以自身为圆心，对周围一定半径内单位造成aoe伤害"},{name:"电磁",desc:"发出电磁振动击晕周围，以自身为圆心，对周围一定半径内单位造成眩晕"},{name:"振奋",desc:"一定时间属性增强，使用后强化自身，增加攻击、血量、攻速、移速"},{name:"自愈",desc:"快速回复大量生命，短时间内恢复最大生命值一定百分比的血量"}];class B extends t.pages.propertyProgressUI{constructor(){super(...arguments),this.fullWidth=0,this.fullValue=0,this.curValue=0,this.progress=0}onAwake(){this.fullWidth=this.bar.width}setProgressBarSkin(t){this.bar.skin=t}setProgressValuePos(t,e){this.propertyValue.x=t,this.propertyValue.y=e}setProgress(t,e){this.curValue=t,this.fullValue=e,this.propertyValue.text=this.curValue+"",this.progress=this.curValue/this.fullValue,this.progress=this.progress<1?this.progress:1,Laya.Tween.to(this.bar,{width:this.progress*this.fullWidth},500,Laya.Ease.sineOut)}}class D extends t.pages.loadUI{constructor(){super(...arguments),this.finish1=!1,this.finish2=!1}onAwake(){this.loadBox.visible=!1,this.width=Laya.stage.width,this.height=Laya.stage.height,this.progressLabel.text="0%",Laya.Shader3D.debugMode=!0,c.loadSpines(["loading1.sk","yindao.sk"]).then(t=>{c.loadFonts(["task.fnt","Word.fnt"]).then(()=>{let e=t[0];e.pos(Laya.stage.width/2,Laya.stage.height/2),this.spineBox.addChildAt(e,0),e.play(0,!1),e.on(Laya.Event.STOPPED,this,()=>{Laya.timer.once(500,this,()=>{Laya.Tween.to(this.spineBox,{alpha:0},500,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.loadBox.visible=!0,this.finish1=!0,b.Instance.enableGuide=!0,b.Instance.init(),b.Instance.setHand(t[1]);let e=["ShowScene.ls","Effect_Blood.lh","Effect_Water1.lh","Effect_Water2.lh"],i=m.instance.playerID;e.push(`Player${i+1}.lh`),e.push(`Fx_LevelUp${i+1}.lh`),L.Instance.init(),e.push(L.Instance.fangsEffectList[i]+".lh");c.create(["mapData0.json","mapData.json","mapData1.json","mapData2.json","mapData3.json","fish.json","strengthen.json"].concat(e),t=>{this.progressMask.x=526*t.progress-526,this.progressLabel.text=Math.floor(100*t.progress)+"%"}).then(()=>{Laya.Scene.open("pages/main.scene")})}))})})})})}}class C extends t.pages.lotteryUI{constructor(){super(...arguments),this.curRotateSpeed=0,this.maxRotateSpeed=400,this.normalRotateSpeed=100,this.isRotating=!1,this.rotateStage=0,this.curRotation=0,this.uniformSpeedTime=0,this.destRotation=0,this.lotteryIndex=0,this.adjustValue=0,this.lastIndex=0,this.lotteryData=[{type:"gold",desc:"钻石卡包",value:200,per:.3},{type:"gold",desc:"+1999",value:300,per:.18},{type:"fish",desc:"+188",value:2,per:.01},{type:"gold",desc:"+288",value:200,per:.3},{type:"gold",desc:"+88",value:800,per:.015},{type:"fish",desc:"卡牌 X1",value:11,per:0},{type:"gold",desc:"卡牌 X3",value:300,per:.18},{type:"gold",desc:"+588",value:800,per:.015}]}onAwake(){Date.now()-m.instance.freeLotteryTimestamp>864e5&&(m.instance.freeLotteryTimeLeft=1,m.instance.onDataChange("freeLotteryTimeLeft")),this.updateFree()}updateFree(){this.freeLeftLabel.text=m.instance.freeLotteryTimeLeft+"",m.instance.freeLotteryTimeLeft>0?this.videoTag.visible=!1:this.videoTag.visible=!0}onOpened(){Laya.MouseManager.enabled=!0,this.closeBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.lotteryBtn.on(Laya.Event.CLICK,this,this.onBtnClick),Laya.timer.frameLoop(1,this,this.onFrameLoop)}onDestroy(){Laya.timer.clearAll(this)}onBtnClick(t){c.playSound("click.mp3"),t.target==this.closeBtn?this.close():t.target==this.lotteryBtn&&(m.instance.freeLotteryTimeLeft>0&&(1==m.instance.freeLotteryTimeLeft&&(m.instance.freeLotteryTimestamp=Date.now(),m.instance.onDataChange("freeLotteryTimestamp")),m.instance.freeLotteryTimeLeft--,m.instance.onDataChange("freeLotteryTimeLeft")),this.updateFree(),this.lotteryIndex=this.calculateResult(),this.curRotateSpeed=0,this.lotteryBtn.disabled=!0,this.isRotating=!0,this.curRotation=this.curRotation%360,this.destRotation=1e8,this.rotateStage=0)}onFrameLoop(){if(this.isRotating){0==this.rotateStage?this.curRotateSpeed<this.maxRotateSpeed?this.curRotateSpeed+=4:(this.uniformSpeedTime=0,this.rotateStage=1):1==this.rotateStage?(this.uniformSpeedTime+=Laya.timer.delta,this.uniformSpeedTime>=500&&(this.rotateStage=2)):2==this.rotateStage?this.curRotateSpeed>this.normalRotateSpeed?this.curRotateSpeed-=1:(this.adjustValue=360-45*this.lotteryIndex-this.curRotation%360,this.adjustValue<=90&&this.adjustValue>=0&&(this.destRotation=this.curRotation+this.adjustValue,this.rotateStage=3)):3==this.rotateStage&&(this.curRotateSpeed-=3,this.curRotateSpeed=this.curRotateSpeed<30?30:this.curRotateSpeed);let t=this.curRotateSpeed*Laya.timer.delta/1e3,e=this.destRotation-this.curRotation;if(e<=t){t=e,this.isRotating=!1,this.lotteryBtn.disabled=!1;let i=this.lotteryData[this.lotteryIndex];"gold"==i.type?y.loadScene(i.value,0):y.loadScene(i.value,1)}let i=Math.floor(this.curRotation%360/45);i!=this.lastIndex&&(this.lastIndex=i,c.playSound("lottory.mp3")),this.curRotation+=t,this.rewardPanel.rotation=this.curRotation}}calculateResult(){let t=0,e=Math.random();for(let i=0;i<this.lotteryData.length;i++){let a=this.lotteryData[i];if(e<(t+=a.per))return console.log(a),i}}}class R{static findNodeByUrl(t,e){let i=e.split("/"),a=t;for(let t=0;t<i.length;t++)a=a.getChildByName(i[t]);return a}static findNodeByName(t,e){for(let i=0;i<t.numChildren;i++){let a=t.getChildAt(i);return a.name==e?a:this.findNodeByName(a,e)}}static findNodeByType(t,e){for(let i=0;i<t.numChildren;i++){let a=t.getChildAt(i);return a instanceof e?a:this.findNodeByType(a,e)}}static findNodesByType(t,e){let i=[];for(let a=0;a<t.numChildren;a++){let s=t.getChildAt(a);s instanceof e&&i.push(s),s.numChildren>0&&(i=i.concat(this.findNodeByType(s,e)))}return i}static getComponent(t,e){return t.getComponent(e)}static getComponents(t,e){return t.getComponents(e)}static getComponentInChildren(t,e){for(let i=0;i<t.numChildren;i++){let a=t.getChildAt(i),s=this.getComponent(a,e);if(s)return s;a.numChildren>0&&this.getComponentInChildren(a,e)}return null}static getComponentsInChildren(t,e){for(let i=0;i<t.numChildren;i++){let a=t.getChildAt(i),s=this.getComponents(a,e);return s||this.getComponentsInChildren(a,e)}}static tweenTo(t,e,i,a,s,n,o,h){let r={};for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){r[i+"Start"]=t.transform[i].clone();let a=new Laya.Vector3;Laya.Vector3.subtract(e[i],t.transform[i],a),r[i+"Diff"]=a}let l={value:0},d=Laya.Tween.to(l,{value:1,update:Laya.Handler.create(this,()=>{if(t&&t.transform){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){let e=new Laya.Vector3,a=new Laya.Vector3;Laya.Vector3.scale(r[i+"Diff"],l.value,a),Laya.Vector3.add(r[i+"Start"],a,e),t.transform[i]=e}}else Laya.Tween.clear(d)},null,!1)},i,a,s,n,o,h);return d}static convert3DTo2DPosition(t,e){this.convertWorldToCameraProjection(t,e);var i=this.out.x,a=this.out.y,s=this.out.z,n=this.out.w;if(n<=0)return null;1!==n&&(i/=n,a/=n,s/=n);let o=t.viewport;return this.out.x=.5*(i+1)*o.width+o.x,this.out.y=.5*(1-a)*o.height+o.y,this.out.z=s*(o.maxDepth-o.minDepth)+o.minDepth,this.vec2.x=this.out.x/Laya.stage.clientScaleX,this.vec2.y=this.out.y/Laya.stage.clientScaleY,this.vec2}static convertWorldToCameraProjection(t,e){let i=t.projectionViewMatrix;return Laya.Vector3.transformV3ToV4(e,i,this.out),this.out}}R.out=new Laya.Vector4,R.vec2=new Laya.Vector2;class T extends t.pages.strengthSuccessUI{constructor(){super(...arguments),this.value=0}onOpened(){Laya.MouseManager.enabled=!0,this.videoBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.sureBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(t){this.videoBtn==t.target?this.close("yes"):this.sureBtn==t.target&&this.close("no")}static loadScene(t,e,i=null){Laya.MouseManager.enabled=!1,Laya.Scene.load("pages/strengthSuccess.scene",Laya.Handler.create(this,a=>{a.open(!1),a.setIcon(t,e),a.closeHandler=i}))}setIcon(t,e){this.value=e,this.strengthIcon.skin=`strength/Ui_Strengthen${this.getIconIndex(t)+1}.png`,this.strengthValue.value=4==t?"+"+(100*e).toFixed(1):2==t?"+"+x.floatMul(e,10):3==t?"+"+x.floatMul(e,10):"+"+e}getIconIndex(t){return[0,2,3,4,1][t]}}class U extends t.pages.strengthUI{constructor(){super(...arguments),this.stageLength=20,this.radarCenterX=0,this.radarCenterY=0,this.startPoints=[0,0,0,0,0,0,0,0,0,0],this.destPoints=[0,0,0,0,0,0,0,0,0,0],this.isDrawing=!1,this.tweenTarget={progress:0},this.colorList=["#9fff7d","#38ffa4","#7dfffd","#00deff","#3875ff","#9138ff","#c438ff","#ff38a8","#ff6589","#ff4040"],this.index=0,this.cellList=null,this.isNextLevel=!1,this.curColor="",this.costValue=0,this.notFullList=null}onAwake(){this.width=Laya.stage.width,this.height=Laya.stage.height,this.cellList=[this.atk,this.life,this.energy,this.mSpeed,this.atkGap],this.radarCenterX=170,this.radarCenterY=178,this.radar.alpha=.8,this.drawRader(),this.upBtn.on(Laya.Event.CLICK,this,this.onBtnClick),L.Instance.init(),L.Instance.updateStrenthData(0),this.updateStrengthData(),this.strengthLevel.value=m.instance.strengthLevel+"",l.on("UserDataChange",this,this.onUserDataChange),this.costValue=this.getCost(m.instance.strengthLevel),this.costLabel.value=this.costValue+"",this.upArrow.alpha=0}onUserDataChange(t){"strengthLevel"==t&&(this.strengthLevel.value=m.instance.strengthLevel+"",this.costValue=this.getCost(m.instance.strengthLevel),this.costLabel.value=this.costValue+"")}onBtnClick(){c.playSound("click.mp3"),this.isDrawing||(m.instance.gold>=this.costValue?(m.instance.gold-=this.costValue,m.instance.onDataChange("gold"),this.lottery()):(Laya.MouseManager.enabled=!1,Laya.Scene.open("pages/addMoney.scene",!1)))}updateDestPoint(){for(let t=0;t<5;t++){let e=m.instance.strengthStage[t],i=this.getRaderPoint(t,e);this.destPoints[2*t]=i[0],this.destPoints[2*t+1]=i[1]}}getRaderPoint(t,e){let i=(-90-72*t)*x.deg2Rad,a=e*this.stageLength;return[Math.cos(i)*(a+20),Math.sin(i)*(a+20)]}drawRader(){this.isDrawing||(this.isDrawing=!0,this.updateDestPoint(),this.tweenTarget.progress=0,this.curColor=this.colorList[m.instance.strengthLevel-1],Laya.Tween.to(this.tweenTarget,{progress:1,update:Laya.Handler.create(this,this.onDrawUpdate,null,!1)},380,Laya.Ease.sineOut,Laya.Handler.create(this,this.onDrawComplete)))}onDrawUpdate(){let t=[];for(let e=0;e<5;e++){let i=this.getDrawPointByProgress(e,this.tweenTarget.progress);t.push(...i)}this.radar.graphics.clear(),this.radar.graphics.drawPoly(this.radarCenterX,this.radarCenterY,t,this.curColor)}getDrawPointByProgress(t,e){return[this.startPoints[2*t]+(this.destPoints[2*t]-this.startPoints[2*t])*e,this.startPoints[2*t+1]+(this.destPoints[2*t+1]-this.startPoints[2*t+1])*e]}onDrawComplete(){this.startPoints=[...this.destPoints],this.isDrawing=!1,this.setCellAlpha([0,1,2,3,4],1),this.isNextLevel?(this.isNextLevel=!1,Laya.timer.once(1e3,this,()=>{m.instance.strengthLevel<5?(m.instance.strengthLevel++,m.instance.onDataChange("strengthLevel"),m.instance.strengthStage=[0,0,0,0,0],m.instance.onDataChange("strengthStage"),this.startPoints=[0,0,0,0,0,0,0,0,0,0],this.drawRader()):this.upBtn.disabled=!1})):this.upBtn.disabled=!1}lottery(){this.notFullList=[];for(let t=0;t<5;t++)m.instance.strengthStage[t]<5&&this.notFullList.push(t);let t=x.getRandom(0,this.notFullList.length-1);this.upBtn.disabled=!0,Laya.MouseManager.enabled=!1,this.setCellAlpha([0,1,2,3,4],.8),this.rotate(t,0).then(()=>{Laya.MouseManager.enabled=!0;let t=this.notFullList[this.index],e=m.instance.strengthStage[t];if(this.isNextLevel=!0,console.log(e,t),e<5){m.instance.strengthStage[t]=e+1,m.instance.onDataChange("strengthStage");let i=L.Instance.updateStrenthData(t),a=Laya.Handler.create(this,e=>{"yes"==e&&(0==t?L.Instance.strengthData.atk=x.floatAdd(L.Instance.strengthData.atk,i):1==t?L.Instance.strengthData.hp=x.floatAdd(L.Instance.strengthData.hp,i):2==t?L.Instance.strengthData.energy=x.floatAdd(L.Instance.strengthData.energy,i):3==t?L.Instance.strengthData.mSpeed=x.floatAdd(L.Instance.strengthData.mSpeed,i):4==t&&(L.Instance.strengthData.atkGap=Number(x.floatAdd(L.Instance.strengthData.atkGap,i).toFixed(1)))),this.updateStrengthData(),this.ani1.play(0,!1),this.upArrow.x=this.cellList[t].x,this.upArrow.y=this.cellList[t].y;for(let t=0;t<m.instance.strengthStage.length;t++)if(5!=m.instance.strengthStage[t]){this.isNextLevel=!1;break}this.drawRader()});T.loadScene(t,i,a),c.playSound("strength.mp3")}})}rotate(t,e){return new Promise(i=>{if(1==this.notFullList.length)return this.index=t,i();{let a=200-10*e;e>16&&(a=200+10*(e-32)),c.playSound("lottory.mp3"),Laya.timer.once(a,this,()=>{e++;let a=this.notFullList[this.index];this.setCellAlpha([a],1);let s=this.index;if(this.index=(this.index+1)%this.notFullList.length,!(e<=24||this.index!=t))return this.index=s,i();this.rotate(t,e).then(()=>{i()})})}})}setCellAlpha(t,e){for(let i=0;i<5;i++){let a=this.cellList[i];-1!=t.indexOf(i)?a.alpha=e:a.alpha=.5}}onDestroy(){l.off("UserDataChange",this,this.onUserDataChange)}getCost(t){return L.Instance.strengthenData[5*(t-1)].cost}updateStrengthData(){this.atkLabel.value="+"+L.Instance.strengthData.atk;let t=x.floatMul(L.Instance.strengthData.atkGap,100);this.atkGapLabel.value="+"+t.toFixed(1),this.lifeLabel.value="+"+L.Instance.strengthData.hp,this.energyLabel.value="+"+10*L.Instance.strengthData.energy,this.mSpeedLabel.value="+"+10*L.Instance.strengthData.mSpeed}}class _ extends Laya.Script3D{constructor(){super(...arguments),this.fishBase=null,this.enemyFishState=0,this.turnThinkTime=0,this.isSelectFishGroup=!1,this.targetFish=null,this.wantFishDelay=0,this.playerTransform=null,this.hasAttackThink=!1,this.isInBit=!1,this.isInEvolution=!1,this.swimIn=!0,this.targetPoint=null,this.boxCenter=new Laya.Vector3(0,0,5),this.canBit=!0,this.leftMoveDis=0,this.attackDelay=1e3,this.curAttackDelay=0,this.attackTarget=null,this.runCenterTimeLeft=0,this.isFollowPlayer=!1}onAwake(){this.turnThinkTime=x.getRandom(5e3,7e3),this.targetPoint=this.getFollowPointInBox(this.boxCenter,4,6,8,3,5,7),l.on(e.PlayerUpLevel,this,this.onPlayerUpLevel)}onDestroy(){l.off(e.PlayerUpLevel,this,this.onPlayerUpLevel)}onPlayerUpLevel(t){t>this.fishBase.level&&this.fishBase.upLevel(t-this.fishBase.level)}onUpdate(){0==this.enemyFishState?this.updatePlayRound():1==this.enemyFishState?this.growUp():2==this.enemyFishState?(this.attackEnemy(),this.clearAttackTarget()):3==this.enemyFishState&&(this.isInBit||this.isInEvolution||this.fishBase.isFollowingTargetPoint||(this.swimIn?(this.swimIn=!1,this.targetPoint=this.getFollowPointInBox(this.boxCenter,1,4,8,0,0,0),this.fishBase.setFollowTargetPoint(this.targetPoint)):(this.swimIn=!0,this.targetPoint=this.getFollowPointInBox(this.boxCenter,1,4,8,0,0,0),this.fishBase.setFollowTargetPoint(this.targetPoint))))}runBoxCenter(){this.swimIn=!0,this.fishBase.setFollowTargetPoint(this.boxCenter)}growUp(){this.wantFishDelay>0&&(this.wantFishDelay-=Laya.timer.delta,this.wantFishDelay<=0&&(this.wantFishDelay=0)),this.targetFish&&(this.targetFish.isDeath?(this.targetFish=null,this.wantFishDelay=x.getRandom(1e3,2e3)):(this.targetFish.updateHeadPoint(),this.fishBase.setFollowPoint(this.targetFish.headPoint)))}attackEnemy(){this.attackTarget&&(this.curAttackDelay>0&&(this.curAttackDelay-=Laya.timer.delta),this.curAttackDelay<=0&&(this.curAttackDelay=this.attackDelay,this.fishBase.startBit(this.attackTarget)))}setAttackTarget(t){t&&(this.attackTarget=t,this.enemyFishState=2)}clearAttackTarget(){if(this.attackTarget)if(this.attackTarget.destroyed||this.attackTarget.isDeath)this.attackTarget.isDeath&&Laya.timer.once(1e4,this,()=>{this.hasAttackThink=!0}),this.attackTarget=null,this.enemyFishState=0,this.hasAttackThink=!1;else{this.fishBase.updateHeadPoint(),this.attackTarget.updateHeadPoint(),Laya.Vector3.distance(this.fishBase.headPoint,this.attackTarget.headPoint)>10&&(this.attackTarget=null,this.enemyFishState=0)}}updatePlayRound(){if(this.runCenterTimeLeft>0)this.slowDownNearPlayer(30),this.runCenterTimeLeft-=Laya.timer.delta,this.runCenterTimeLeft<=0&&(this.fishBase.moveSpeed=this.fishBase.originalFishData.mSpeed,this.fishBase.rotateSpeed=this.fishBase.rotateSpeed,this.runCenterTimeLeft=0);else{if(0==this.turnThinkTime){let t=this.getFollowPoint(this.playerTransform.position);this.isFollowPlayer||(t=this.getFollowPoint(this.fishBase.gameObject.transform.position)),this.fishBase.setFollowPoint(t),this.fishBase.moveSpeed=3*this.fishBase.originalFishData.mSpeed,this.fishBase.rotateSpeed=this.fishBase.rotateSpeed,this.turnThinkTime=x.getRandom(2e3,3e3)}this.turnThinkTime>0&&(this.turnThinkTime-=Laya.timer.delta,this.slowDownNearPlayer(30),this.turnThinkTime<=0&&(this.turnThinkTime=0,this.fishBase.moveSpeed=this.fishBase.originalFishData.mSpeed,this.fishBase.rotateSpeed=this.fishBase.rotateSpeed))}}getFollowPoint(t){let e=new Laya.Vector3,i=this.fishBase.gameObject.transform.position;return e.y=i.y,e.x=t.x-10+10*Math.random()*2,e.z=t.z-10+10*Math.random()*2,e}isOutBorder(){if(!this.playerTransform)return!1;let t=this.playerTransform.position;return this.fishBase.gameObject.transform.position.x<-50+t.x||this.fishBase.gameObject.transform.position.x>50+t.x||this.fishBase.gameObject.transform.position.z<-50+t.z||this.fishBase.gameObject.transform.position.z>50+t.z}isOutBox(t,e,i,a){let s=e/2,n=i/2,o=a/2;return this.fishBase.gameObject.transform.position.x<-s+t.x||this.fishBase.gameObject.transform.position.x>s+t.x||this.fishBase.gameObject.transform.position.y<-o+t.y||this.fishBase.gameObject.transform.position.y>o+t.y||this.fishBase.gameObject.transform.position.z<-n+t.z||this.fishBase.gameObject.transform.position.z>n+t.z}getFollowPointInBox(t,e,i,a,s,n,o){let h=new Laya.Vector3;return Math.random()<.5?h.x=-s/2-Math.random()*(e-s)/2:h.x=s/2+Math.random()*(e-s)/2,Math.random()<.5?h.y=-o/2-Math.random()*(a-o)/2:h.y=o/2+Math.random()*(a-o)/2,Math.random()<.5?h.z=-n/2-Math.random()*(i-n)/2:h.z=n/2+Math.random()*(i-n)/2,h.x+=t.x,h.y+=t.y,h.z+=t.z,h}setSelectFishGroup(t){this.isSelectFishGroup=!0,this.fishBase.setFollowPoint(t)}slowDownNearPlayer(t){if(!this.playerTransform)return;let e=this.playerTransform.position,i=this.fishBase.gameObject.transform.position,a=e.x-i.x,s=e.z-i.z;Math.sqrt(a*a+s*s)<=t&&(this.fishBase.moveSpeed=this.fishBase.originalFishData.mSpeed,this.fishBase.rotateSpeed=this.fishBase.rotateSpeed)}}class A{}A.none="None",A.stand="Stand",A.death="Death",A.damage="Damage",A.run="Run",A.attack="Attack";class M extends Laya.AnimatorStateScript{constructor(){super()}onStateEnter(){this.stateEnterHandler&&this.stateEnterHandler.runWith(this.name)}onStateUpdate(){this.stateUpdateHandler&&this.stateUpdateHandler.runWith(this.name)}onStateExit(){this.stateExitHandler&&this.stateExitHandler.runWith(this.name)}}class F extends Laya.Script3D{Ani_Event(t,e,i){this.stateTriggerHandler&&this.stateTriggerHandler.runWith([t,e,i])}}class E extends Laya.Script3D{constructor(){super(...arguments),this.animator=null,this.physicsCollider=null,this.rigidbody3D=null,this._curState=A.none,this._animationId=null,this.sign=null,this.actorData=null,this.gameObject=null}onAwake(){if(this.sign=E.name,this.animator=this.owner.getComponent(Laya.Animator),this.gameObject=this.owner,this.animator||(this.animator=R.getComponentInChildren(this.owner,Laya.Animator)),this.animator){this.animator.owner.addComponent(F).stateTriggerHandler=Laya.Handler.create(this,this.onStateTrigger,null,!1),this._states=this.animator.getControllerLayer(0)._states;for(let t=0;t<this._states.length;t++){let e=this._states[t],i=e.addScript(M);i.name=e.name,i.stateEnterHandler=Laya.Handler.create(this,this.onStateEnter,null,!1),i.stateUpdateHandler=Laya.Handler.create(this,this.onStateUpdate,null,!1),i.stateExitHandler=Laya.Handler.create(this,this.onStateExit,null,!1)}}this.physicsCollider=this.owner.getComponent(Laya.PhysicsCollider),this.rigidbody3D=this.owner.getComponent(Laya.Rigidbody3D)}onEnable(){this.onRegisterCustomEvent()}onDisable(){this.onCancelCustomEvent()}onCollisionEnter(t){}onCollisionStay(t){}onCollisionExit(t){}onTriggerEnter(t){}onTriggerStay(t){}onTriggerExit(t){}onStateEnter(t){}onStateUpdate(t){}onStateExit(t){}onStateTrigger(t,e,i){}onRegisterCustomEvent(){}onCancelCustomEvent(){}changeActorState(t,e){t==this._curState&&this._animationId==e||(this.onAnimationChange(t+e),this._curState=t,this._animationId=e)}onAnimationChange(t){this.animator&&this.animator.play(t,0,0)}onRecovery(){this.owner.removeSelf(),Laya.Pool.recover(this.sign,this)}onInit(t){this.actorData=t}onDamage(t){0!=this.actorData.hp&&(this.actorData.hp-=t,this.actorData.hp<=0&&(this.actorData.hp=0,this.changeActorState(A.death,"")))}get curState(){return this._curState}get animationId(){return this._animationId}}class N extends Laya.Script3D{constructor(){super(...arguments),this.gameObject=null,this.isExplode=!1}onAwake(){this.gameObject=this.owner}setBombExplode(){return this.createBombEffect(this.gameObject)}createBombEffect(t){this.isExplode=!0,c.playSound("explode.mp3");let e=Laya.Pool.getItem("Effect_Mine");return e||(e=c.getResClone("Effect_Mine.lh")),this.gameObject.parent.addChild(e),e.transform.position=t.transform.position.clone(),Laya.timer.once(2e3,this,()=>{e&&(e.removeSelf(),Laya.Pool.recover(e.name,e))}),e}}class O extends Laya.Script3D{constructor(){super(...arguments),this.fish=null,this.moveSpeed=1,this.speedAdd=.1,this.moveDir=new Laya.Vector3,this.gameObject=null,this.translation=new Laya.Vector3,this.exp=100}onAwake(){this.gameObject=this.owner}onUpdate(){if(this.fish){if(this.fish.isDeath||!this.fish.gameObject||this.fish.gameObject.destroyed)return void(this.fish=null);this.fish.updateBodyPoint(),Laya.Vector3.subtract(this.fish.headPoint,this.gameObject.transform.position,this.moveDir),Laya.Vector3.normalize(this.moveDir,this.moveDir),this.moveSpeed+=this.speedAdd;let t=Laya.timer.delta/1e3*this.moveSpeed;Laya.Vector3.scale(this.moveDir,t,this.translation),this.gameObject.transform.translate(this.translation,!1),Laya.Vector3.distance(this.gameObject.transform.position,this.fish.headPoint)<=.5&&(this.gameObject.removeSelf(),Laya.Pool.recover(this.gameObject.name,this),this.fish.fishEatMeat(this.exp),this.fish=null)}}setFish(t){this.fish=t,this.moveSpeed=1}reset(){this.fish=null}}class V extends E{constructor(){super(...arguments),this.speedX=0,this.speedZ=0,this.speedY=0,this.speedUpStage=0,this.translation=new Laya.Vector3,this.localFront=new Laya.Vector3(0,0,1),this.worldMoveDir=new Laya.Vector3,this.rotationLocal=new Laya.Vector3,this.rotationWorld=new Laya.Vector3,this.rotateDir=new Laya.Vector2,this.isRotating=!1,this.frameTime=0,this.curLocalRotationX=0,this.isSpeedUping=!1,this.forward=new Laya.Vector3,this.back=new Laya.Vector3,this.headNode=null,this.headRadius=0,this.waterEffectNode=null,this.bloodEffectNode=null,this.headPoint=new Laya.Vector3,this.bodyLength=0,this.halfLength=0,this.bodyRadius=0,this.isHitMap=!1,this.isHitFish=!1,this.frameMoveDis=0,this.frameRotateRad=0,this.isFollowingPoint=!1,this.updateBodyFrame=-1,this.updateHeadFrame=-1,this.originalFishData=null,this.cloneFishData=null,this.curHp=0,this.level=1,this.exp=0,this.curAttackDelay=0,this.curEnergy=100,this.speedUpCostEnergyPerS=20,this.recoveryEnergyPerS=10,this.moveSpeed=3,this.maxSpeed=20,this.speedAdd=.6,this.rotateSpeed=1.5,this.normalRotateSpeed=1.5,this.isDeath=!1,this.isAttacking=!1,this.pitchRad=0,this.yawRad=0,this.bodyBallPointList=[],this.waterEffect=null,this.swimState="M",this.fishType="player",this.fastTurnTarget=null,this.bitPoint=new Laya.Vector3,this.bitTarget=null,this.attackTarget=null,this.yawTarget=0,this.fishClass=0,this.maxDownDis=5,this.originalY=0,this.isDown=!1,this.bloodProgress=null,this.fishScale=1,this.speedUpEffect=null,this.levelUpEffect=null,this.isShowLevelUpEffect=!1,this.fishMat=null,this.isGod=!1,this.playerName="",this.bitEffect=null,this.playerFishId=0,this.bitStartYaw=0,this.isBackToBitStartYaw=!0,this.followRotateSpeed=0,this.frameFollowRotateRad=0,this.isRecoverying=!1,this.dir1=new Laya.Vector3,this.forwardRot=new Laya.Vector3,this.dir2=new Laya.Vector3,this.yawRotateTotal=0,this.yawRotateSign=0,this.pitchRotateTotal=0,this.pitchRotateSign=0,this.rotateQua=new Laya.Quaternion,this.followDir=new Laya.Vector3,this.lookDir=new Laya.Vector3,this.inBit=!1,this.minDis=0,this.bitCd=0,this.isBitFinger=!1,this.fingerPoint=null,this.bitDir=new Laya.Vector3,this.targetPoint=null,this.targetPointDir=new Laya.Vector3,this.isFollowingTargetPoint=!1,this.followDis=0,this.isPitchBackToZero=!1,this.pitchBackSign=0}onAwake(){super.onAwake();let t=this.gameObject;if(-1!=this.gameObject.name.indexOf("Player")){this.speedUpEffect=c.getResClone("Effect_Water2.lh"),this.speedUpEffect.transform.localPosition=new Laya.Vector3,this.speedUpEffect.transform.localRotationEuler=new Laya.Vector3,this.speedUpEffect.active=!1,this.gameObject.addChild(this.speedUpEffect),this.levelUpEffect=c.getResClone(this.gameObject.name.replace("Player","Fx_LevelUp")+".lh"),this.levelUpEffect.transform.localPosition=new Laya.Vector3,this.levelUpEffect.transform.localRotationEuler=new Laya.Vector3,this.levelUpEffect.active=!1,this.gameObject.addChild(this.levelUpEffect);let e=L.Instance.fangsEffectList[Number(this.gameObject.name.replace("Player",""))-1]+".lh";this.bitEffect=c.getResClone(e),this.bitEffect.transform.localPosition=new Laya.Vector3,this.bitEffect.transform.localRotationEuler=new Laya.Vector3,this.bitEffect.active=!1,this.gameObject.addChild(this.bitEffect),t=this.gameObject.getChildByName(this.gameObject.name)}for(let e=0;e<t.numChildren;e++){let i=t.getChildAt(e);-1!=i.name.indexOf("BloodPoint")?this.bloodEffectNode=i:-1!=i.name.indexOf("WaterPoint")&&(this.waterEffectNode=i)}this.showFangs(!1);for(let t=0;t<this.gameObject.numChildren;t++){let e=this.gameObject.getChildAt(t);-1!=e.name.indexOf("HeadPoint")?(this.headNode=e,this.headRadius=Number(e.name.split("_")[1])):-1!=e.name.indexOf("BallPoint")&&this.bodyBallPointList.push({ball:e,radius:Number(e.name.split("_")[1])})}0==this.headRadius&&(this.headRadius=this.bodyBallPointList[0].radius)}changeFishMat(){let t=R.findNodeByUrl(this.gameObject,this.gameObject.name+"/"+this.gameObject.name),e=t.simpleSkinnedMeshRenderer.sharedMaterial;this.fishMat=new Laya.BlinnPhongMaterial,e.cloneTo(this.fishMat),t.simpleSkinnedMeshRenderer.sharedMaterial=this.fishMat}showLevelUp(){this.isShowLevelUpEffect||(this.levelUpEffect.active=!0,this.isShowLevelUpEffect=!0,Laya.timer.once(4e3,this,()=>{this.levelUpEffect.active=!1,this.isShowLevelUpEffect=!1}))}onEnable(){-1!=this.gameObject.name.indexOf("Player")&&this.animator.play("Run",0,0)}showFangs(t){this.bitEffect&&(this.bitEffect.active=t)}onDestroy(){super.onDestroy(),this.bloodProgress&&this.bloodProgress.destroy()}onUpdate(){this.isDeath||(this.frameTime=Laya.timer.delta/1e3,this.frameRotateRad=this.rotateSpeed*this.frameTime,this.frameFollowRotateRad=this.followRotateSpeed*this.frameTime,this.isRotating&&!this.inBit&&this.rotate(),this.isBackToBitStartYaw||this.inBit||this.updateBackToBitStartYaw(),!this.isRotating&&this.isPitchBackToZero&&this.updatePitchBackToZero(),this.inBit&&this.updateBit(),this.isBitFinger&&this.updateBitFinger(),this.isFollowingPoint&&this.updateFollowPoint(),this.isFollowingTargetPoint&&this.updateFollowTargetPoint(),this.isSpeedUping&&this.speedUp(),this.isRecoverying&&this.recoveryEnergy(),this.isHitMap?(this.localFront.y=1,this.localFront.z=0):(this.localFront.y=0,this.localFront.z=1),0==this.fishClass||1==this.fishClass?this.localMoveFront():this.localMoveUp())}updateBackToBitStartYaw(){let t=(this.gameObject.transform.rotation.y%360+360)%360;Math.abs(this.bitStartYaw-t)}recoveryEnergy(){this.curEnergy<this.originalFishData.energy&&(this.curEnergy+=Laya.timer.delta/1e3*this.recoveryEnergyPerS,this.curEnergy>=this.originalFishData.energy&&(this.curEnergy=this.originalFishData.energy),l.event(e.UpdateEnergy,[this.curEnergy,this.originalFishData.energy]))}initData(t){this.originalFishData=new w(t),this.moveSpeed=this.originalFishData.mSpeed,this.maxSpeed=4*this.originalFishData.mSpeed,5==this.originalFishData.skillType?this.originalFishData.energy*=1+this.originalFishData.param:7==this.originalFishData.skillType&&(this.originalFishData.hp*=1+this.originalFishData.param),this.cloneFishData=this.originalFishData.clone(),this.curEnergy=this.originalFishData.energy,this.curHp=this.originalFishData.hp,this.level=1,this.exp=0,this.curAttackDelay=0,this.isDeath=!1,this.bloodProgress&&(this.bloodProgress.nameLabel.text=this.playerName,Laya.Tween.to(this.bloodProgress.progressBar,{width:this.curHp/this.originalFishData.hp*153},500,Laya.Ease.sineOut)),-1!=this.gameObject.name.indexOf("Player")&&this.scaleFishByLevel(1,!0),this.followRotateSpeed=this.normalRotateSpeed}rotate(){let t=Math.atan2(this.rotateDir.y,this.rotateDir.x);this.yawTarget=60*this.rotateDir.y*x.deg2Rad,this.rotationLocal.x=this.frameRotateRad*(this.yawTarget-this.curLocalRotationX),this.rotationWorld.y=-Math.cos(t)*this.frameRotateRad,this.curLocalRotationX+=this.rotationLocal.x,this.gameObject.transform.rotate(this.rotationLocal,!0,!0),this.gameObject.transform.rotate(this.rotationWorld,!1,!0)}getFrontPoint(t){this.updateBodyPoint();let e=new Laya.Vector3;e.x=this.forward.x,e.y=0,e.z=this.forward.z,Laya.Vector3.normalize(e,e);let i=new Laya.Vector3;return Laya.Vector3.scale(e,t,e),Laya.Vector3.add(this.gameObject.transform.position,e,i),i}judgeSwimState(t,e){"player"!=this.fishType&&"enemy"!=this.fishType||(Math.abs(t)>=Math.abs(e)?t>0?this.changeSwimState("R"):this.changeSwimState("L"):e>0?this.changeSwimState("D"):this.changeSwimState("U"))}localMoveFront(){if(this.frameMoveDis=this.moveSpeed*this.frameTime,Laya.Vector3.scale(this.localFront,this.frameMoveDis,this.translation),this.gameObject.transform.translate(this.translation,!0),this.gameObject.transform.position.y>L.Instance.playerSafeY){this.inBit&&this.endBit();let t=this.gameObject.transform.position.clone();t.y=L.Instance.playerSafeY,this.gameObject.transform.position=t}}worldMoveFront(){this.frameMoveDis=this.moveSpeed*this.frameTime,Laya.Vector3.scale(this.worldMoveDir,this.frameMoveDis,this.translation),this.gameObject.transform.translate(this.translation,!1),this.gameObject.transform.position.y>L.Instance.safeY&&(this.inBit&&this.endBit(),Laya.Vector3.scale(this.translation,-1,this.translation),this.gameObject.transform.translate(this.translation,!1))}localMoveUp(){this.isDown?(this.localFront.z=0,this.localFront.y=-1):(this.localFront.z=0,this.localFront.y=1),this.moveSpeed=this.originalFishData.mSpeed/2,this.frameMoveDis=this.moveSpeed*this.frameTime,Laya.Vector3.scale(this.localFront,this.frameMoveDis,this.translation);let t=this.gameObject.transform.position,e=t.y+this.translation.y;if(e>this.originalY+this.maxDownDis?(this.translation.y=this.originalY+this.maxDownDis-t.y,this.isDown=!0,this.moveSpeed=this.originalFishData.mSpeed):e<this.originalY-this.maxDownDis&&(this.translation.y=this.originalY-this.maxDownDis-t.y,this.isDown=!1,this.moveSpeed=2*this.originalFishData.mSpeed),this.gameObject.transform.translate(this.translation,!0),this.gameObject.transform.position.y>L.Instance.playerSafeY){let t=this.gameObject.transform.position.clone();t.y=L.Instance.safeY,this.gameObject.transform.position=t,this.isDown=!0}}startSpeedUp(){this.isRecoverying=!1,this.isSpeedUping=!0,this.speedUpStage=0,this.animator.speed=2,this.animator.play("Run",0,0),this.speedUpEffect.active=!0}endSpeedUp(){this.isRecoverying=!0,0==this.speedUpStage&&(this.speedUpStage=1,this.animator.play("Run",0,0),this.animator.speed=1,this.speedUpEffect.active=!1)}speedUp(){0==this.speedUpStage?(this.moveSpeed+=this.speedAdd,this.moveSpeed>=this.maxSpeed&&(this.moveSpeed=this.maxSpeed),this.curEnergy>0&&(this.curEnergy-=Laya.timer.delta/1e3*this.speedUpCostEnergyPerS,this.curEnergy<=0&&(this.curEnergy=0,this.speedUpStage=1,this.animator.play("Run",0,0),this.speedUpEffect.active=!1,c.stopSound("speedup.mp3"),l.event(e.PopTip,"体力不足")),l.event(e.UpdateEnergy,[this.curEnergy,this.originalFishData.energy]))):1==this.speedUpStage&&(this.moveSpeed-=this.speedAdd,this.moveSpeed<=this.originalFishData.mSpeed&&(this.moveSpeed=this.originalFishData.mSpeed,this.isSpeedUping=!1))}changeSwimState(t){t!=this.swimState&&(this.swimState=t,this.animator.play(this.swimState,1,0))}updateBodyPoint(){this.gameObject&&!this.gameObject.destroyed&&this.updateBodyFrame!=Laya.timer.currFrame&&(this.updateBodyFrame=Laya.timer.currFrame,this.gameObject.transform.getForward(this.back),Laya.Vector3.normalize(this.back,this.back),Laya.Vector3.scale(this.back,-1,this.forward),this.updateHeadPoint())}updateHeadPoint(){if(this.gameObject&&!this.gameObject.destroyed&&this.updateHeadFrame!=Laya.timer.currFrame)if(this.updateHeadFrame=Laya.timer.currFrame,this.headNode)this.headPoint.x=this.headNode.transform.position.x,this.headPoint.y=this.headNode.transform.position.y,this.headPoint.z=this.headNode.transform.position.z;else{let t=this.bodyBallPointList[0];this.headPoint.x=t.ball.transform.position.x,this.headPoint.y=t.ball.transform.position.y,this.headPoint.z=t.ball.transform.position.z}}setFishInfo(t,e){this.bodyLength=t,this.bodyRadius=e,this.halfLength=this.bodyLength/2,this.originalY=this.gameObject.transform.position.y,this.isDown=!0,this.localFront.z=0,this.localFront.y=-1,this.isDeath=!1}setFollowPoint(t){return this.updateBodyPoint(),Laya.Vector3.subtract(t,this.gameObject.transform.position,this.followDir),this.dir1.x=this.forward.x,this.dir1.y=0,this.dir1.z=this.forward.z,this.dir2.x=this.followDir.x,this.dir2.y=0,this.dir2.z=this.followDir.z,this.yawRad=x.getRotateRad(this.dir1,this.dir2),this.yawRotateSign=Math.sign(this.yawRad),Laya.Quaternion.createFromYawPitchRoll(this.yawRad,0,0,this.rotateQua),Laya.Vector3.transformQuat(this.forward,this.rotateQua,this.forwardRot),this.pitchRad=x.getPitchRotateRad(this.forwardRot,this.followDir),this.pitchRad=this.fixLocalRotationX(this.pitchRad),this.pitchRotateSign=Math.sign(this.pitchRad),this.yawRotateTotal=0,this.pitchRotateTotal=0,this.isFollowingPoint=!0,0==this.yawRad&&0==this.pitchRad&&(this.isFollowingPoint=!1),this.isFollowingPoint}updateFollowPoint(){this.rotationLocal.x=this.pitchRotateSign*this.frameFollowRotateRad,this.rotationWorld.y=this.yawRotateSign*this.frameFollowRotateRad;let t=this.pitchRotateTotal+this.rotationLocal.x;(this.pitchRotateSign<0&&t<this.pitchRad||this.pitchRotateSign>0&&t>this.pitchRad)&&(this.rotationLocal.x=this.pitchRad-this.pitchRotateTotal);let e=this.yawRotateTotal+this.rotationWorld.y;(this.yawRotateSign<0&&e<this.yawRad||this.yawRotateSign>0&&e>this.yawRad)&&(this.rotationWorld.y=this.yawRad-this.yawRotateTotal),this.rotationLocal.x=this.fixLocalRotationX(this.rotationLocal.x),this.curLocalRotationX+=this.rotationLocal.x,this.pitchRotateTotal+=this.rotationLocal.x,this.yawRotateTotal+=this.rotationWorld.y,this.pitchRotateTotal==this.pitchRad&&this.yawRotateTotal==this.yawRad&&(this.isFollowingPoint=!1,this.followRotateSpeed=this.normalRotateSpeed),this.gameObject.transform.rotate(this.rotationLocal,!0,!0),this.gameObject.transform.rotate(this.rotationWorld,!1,!0)}fixLocalRotationX(t){let e=this.curLocalRotationX+t,i=t;return t>0?e>60*x.deg2Rad&&(i=60*x.deg2Rad-this.curLocalRotationX):t<0&&e<-60*x.deg2Rad&&(i=-60*x.deg2Rad-this.curLocalRotationX),i}fishEatMeat(t){c.playSound("meat.mp3"),6==this.originalFishData.skillType&&(t*=1+this.originalFishData.param),this.addExp(t),this.addHp(.1*this.originalFishData.hp)}getUpExp(t){let e=[0,600,900,1e3,1300,1500,1800,2100,2400,2700],i=0;for(let a=0;a<=t;a++)i+=e[a];return i}addExp(t){if(10==this.level)return;let e=this.getUpExp(this.level);this.exp+=t,this.exp>=e&&this.upLevel(1)}scaleFishByLevel(t,i=!1){this.fishScale=[1,1.3,1.58,1.84,2.08,2.3,2.5,2.68,2.84,3][t-1];let a=new Laya.Vector3(this.fishScale,this.fishScale,this.fishScale);this.levelUpEffect&&(this.levelUpEffect.transform.localScale=a.clone()),i?this.gameObject.transform.localScale=a:(R.tweenTo(this.gameObject,{localScale:a},1e3,Laya.Ease.elasticOut,null,0,!0),l.event(e.ScaleFish,this))}addHp(t){this.curHp+=t,this.curHp=this.curHp<this.originalFishData.hp?this.curHp:this.originalFishData.hp,this.bloodProgress&&Laya.Tween.to(this.bloodProgress.progressBar,{width:this.curHp/this.originalFishData.hp*153},500,Laya.Ease.sineOut)}onHurt(t,i){this.isDeath||this.isGod||(this.curHp-=i,this.playBloodEffect(),this.bloodProgress&&Laya.Tween.to(this.bloodProgress.progressBar,{width:this.curHp/this.originalFishData.hp*153},500,Laya.Ease.sineOut),this.curHp<=0&&(this.fishType,l.event(e.FishDeath,[this,t,0]),this.isDeath=!0,"enemy"==this.fishType&&c.playSound("die.mp3")))}pointInCollider(t,e,i){for(let a=0;a<this.bodyBallPointList.length;a++){let s=this.bodyBallPointList[a];if(Laya.Vector3.distance(t,s.ball.transform.position)<=s.radius*this.fishScale+i+e)return!0}return!1}playBloodEffect(){for(let t=0;t<3;t++)this.addBlood()}addBlood(){if(this.bloodEffectNode){let t=Laya.Pool.getItem("Effect_Blood");t||(t=c.getResClone("Effect_Blood.lh")),this.bloodEffectNode.addChild(t),t.transform.localPosition=new Laya.Vector3,t.transform.localRotationEuler=new Laya.Vector3,t.active=!0,Laya.timer.once(2e3,this,()=>{t.removeSelf(),Laya.Pool.recover("Effect_Blood",t)})}}startAttack(t){if(this.attackTarget=t,this.attackTarget&&0==this.attackTarget.isDeath){let t=this.getAtk();t==this.originalFishData.atk?c.playSound("bit.mp3"):c.playSound("bitHard.mp3"),this.attackTarget.onHurt(this,t),2==this.originalFishData.skillType&&this.addHp(this.originalFishData.hp*this.originalFishData.param)}}updateAttackTargetDamage(){0==this.curAttackDelay&&(this.curAttackDelay=this.originalFishData.atkGap,this.attackTarget&&0==this.attackTarget.isDeath&&(this.attackTarget.onHurt(this,this.originalFishData.atk),this.attackTarget.isDeath&&(this.attackTarget=null))),this.curAttackDelay>0&&(this.curAttackDelay-=Laya.timer.delta,this.curAttackDelay<=0&&(this.curAttackDelay=0))}setHitMap(t){this.isHitMap=t,this.isHitMap&&(this.moveSpeed=this.originalFishData.mSpeed,this.endBit())}setHitFish(t){this.isHitFish=t,this.isHitFish&&(this.moveSpeed=this.originalFishData.mSpeed,this.endBit())}startBit(t){if(this.bitCd>0)return!1;if(this.bitCd=1e3*this.getAtkGap(),Laya.timer.once(this.bitCd,this,()=>{this.bitCd=0}),this.inBit=!0,this.isBackToBitStartYaw&&(this.isBackToBitStartYaw=!1,this.bitStartYaw=(this.gameObject.transform.rotation.y%360+360)%360),this.animator.play("Attack2",0,0),this.showFangs(!0),Laya.timer.frameOnce(15,this,()=>{this.animator.play("Run",0,0),this.showFangs(!1)}),t){this.moveSpeed=2*this.originalFishData.mSpeed,this.rotateSpeed=20*this.normalRotateSpeed,this.bitTarget=t,this.minDis=this.getBitTargetRadius(t);let e=1e3;Laya.timer.once(e,this,this.endBit)}else{this.moveSpeed=5*this.originalFishData.mSpeed;let t=300;Laya.timer.once(t,this,this.endBit)}return!0}startBitFinger(t){this.animator.play("Attack2",0,0),this.isFollowingPoint=!1,this.isFollowingTargetPoint=!1,this.isBitFinger=!0,this.fingerPoint=t,this.moveSpeed=this.originalFishData.mSpeed,this.rotateSpeed=20*this.normalRotateSpeed}updateBitFinger(){if(this.fingerPoint){this.updateBodyPoint(),Laya.Vector3.subtract(this.fingerPoint,this.gameObject.transform.position,this.bitDir),this.dir1.x=this.forward.x,this.dir1.y=0,this.dir1.z=this.forward.z,this.dir2.x=this.bitDir.x,this.dir2.y=0,this.dir2.z=this.bitDir.z,this.yawRad=x.getRotateRad(this.dir1,this.dir2),this.yawRotateSign=Math.sign(this.yawRad),Math.abs(this.yawRad)<5*x.deg2Rad&&(this.moveSpeed=5*this.originalFishData.mSpeed),Laya.Quaternion.createFromYawPitchRoll(this.yawRad,0,0,this.rotateQua),Laya.Vector3.transformQuat(this.forward,this.rotateQua,this.forwardRot),this.pitchRad=x.getPitchRotateRad(this.forwardRot,this.bitDir),this.pitchRotateSign=Math.sign(this.pitchRad);let t=Laya.Vector3.distance(this.gameObject.transform.position,this.fingerPoint),e=Math.ceil(t/this.frameMoveDis);e=e>0?e:1,Math.abs(this.yawRad)>this.frameRotateRad?this.rotationWorld.y=this.frameRotateRad*this.yawRotateSign:this.rotationWorld.y=this.yawRad,e<=3&&this.endBitFinger(),Math.abs(this.pitchRad)>this.frameRotateRad?this.rotationLocal.x=this.frameRotateRad*this.pitchRotateSign:this.rotationLocal.x=this.pitchRad,this.rotationLocal.x=this.fixLocalRotationX(this.rotationLocal.x),this.curLocalRotationX+=this.rotationLocal.x,this.gameObject.transform.rotate(this.rotationLocal,!0,!0),this.gameObject.transform.rotate(this.rotationWorld,!1,!0)}}endBitFinger(){this.fingerPoint=null,this.isBitFinger=!1,this.moveSpeed=this.originalFishData.mSpeed,this.rotateSpeed=this.normalRotateSpeed,l.event(e.BackInBox)}updateBit1(){if(this.bitTarget){this.updateBodyPoint(),Laya.Vector3.subtract(this.bitTarget.gameObject.transform.position,this.headPoint,this.bitDir),this.dir1.x=this.forward.x,this.dir1.y=0,this.dir1.z=this.forward.z,this.dir2.x=this.bitDir.x,this.dir2.y=0,this.dir2.z=this.bitDir.z,this.yawRad=x.getRotateRad(this.dir1,this.dir2),this.yawRotateSign=Math.sign(this.yawRad),Laya.Quaternion.createFromYawPitchRoll(this.yawRad,0,0,this.rotateQua),Laya.Vector3.transformQuat(this.forward,this.rotateQua,this.forwardRot),this.pitchRad=x.getPitchRotateRad(this.forwardRot,this.bitDir),this.pitchRotateSign=Math.sign(this.pitchRad);let t=Laya.Vector3.distance(this.headPoint,this.bitTarget.gameObject.transform.position),e=3*this.frameMoveDis;if(t<=e)this.rotationWorld.y=this.yawRad,this.rotationLocal.x=this.pitchRad;else{let i=Math.ceil((t-e)/this.frameMoveDis);this.rotationWorld.y=this.yawRad/i,this.rotationLocal.x=this.pitchRad/i}t<=e&&this.endBit(),this.rotationLocal.x=this.fixLocalRotationX(this.rotationLocal.x),this.curLocalRotationX+=this.rotationLocal.x,this.gameObject.transform.rotate(this.rotationLocal,!0,!0),this.gameObject.transform.rotate(this.rotationWorld,!1,!0)}}updateBit(){if(this.bitTarget){if(this.bitTarget.destroyed||this.bitTarget instanceof N&&this.bitTarget.isExplode)return void this.endBit();this.updateBodyPoint(),this.getBitTargetPoint(this.bitTarget,this.bitPoint),Laya.Vector3.subtract(this.bitPoint,this.gameObject.transform.position,this.bitDir),this.dir1.x=this.forward.x,this.dir1.y=0,this.dir1.z=this.forward.z,this.dir2.x=this.bitDir.x,this.dir2.y=0,this.dir2.z=this.bitDir.z,this.yawRad=x.getRotateRad(this.dir1,this.dir2),this.yawRotateSign=Math.sign(this.yawRad),Math.abs(this.yawRad)<5*x.deg2Rad&&(this.moveSpeed=5*this.originalFishData.mSpeed),Laya.Quaternion.createFromYawPitchRoll(this.yawRad,0,0,this.rotateQua),Laya.Vector3.transformQuat(this.forward,this.rotateQua,this.forwardRot),this.pitchRad=x.getPitchRotateRad(this.forwardRot,this.bitDir);let t=Laya.Vector3.distance(this.headPoint,this.bitPoint),e=Math.ceil(t/this.frameMoveDis);e=e>0?e:1,this.rotationWorld.y=this.yawRad/e,Math.abs(this.yawRad)>this.frameRotateRad?this.rotationWorld.y=this.frameRotateRad*this.yawRotateSign:this.rotationWorld.y=this.yawRad,this.rotationLocal.x=this.pitchRad/e,this.rotationLocal.x=this.fixLocalRotationX(this.rotationLocal.x),this.curLocalRotationX+=this.rotationLocal.x,this.gameObject.transform.rotate(this.rotationLocal,!0,!0),this.gameObject.transform.rotate(this.rotationWorld,!1,!0)}}updateFollowTargetPoint(){this.targetPoint&&(this.isFollowingPoint||(this.followDis-=this.frameMoveDis,this.followDis<=0&&this.reachFollowTargetPoint()))}reachFollowTargetPoint(){this.isFollowingTargetPoint=!1,this.targetPoint=null}setFollowTargetPoint(t){this.targetPoint=t,this.rotateSpeed=this.normalRotateSpeed,this.moveSpeed=1.8,this.setFollowPoint(t),this.followDis=Laya.Vector3.distance(t,this.gameObject.transform.position),this.isFollowingTargetPoint=!0}getBitTargetPoint(t,e){t instanceof V&&2==this.fishClass?(t.updateHeadPoint(),t.headPoint.cloneTo(e)):t.gameObject.transform.position.cloneTo(e)}getBitTargetRadius(t){return t instanceof V?t.headRadius*t.fishScale+this.headRadius*this.fishScale:t instanceof N?L.Instance.bombRadius+this.headRadius*this.fishScale:t instanceof O?L.Instance.meatRadius+this.headRadius*this.fishScale:void 0}endBit(){this.inBit&&(this.inBit=!1,this.isFollowingPoint=!1,this.moveSpeed=this.originalFishData.mSpeed,this.rotateSpeed=this.normalRotateSpeed,this.bitTarget=null,this.startPitchBackToZero(),l.event(e.BitEnd))}updatePitchBackToZero(){this.rotationLocal.x=this.pitchBackSign*this.frameRotateRad,this.rotationWorld.y=0;let t=this.curLocalRotationX+this.rotationLocal.x;this.rotationLocal.x>0?t>0*x.deg2Rad&&(this.rotationLocal.x=0*x.deg2Rad-this.curLocalRotationX):this.rotationLocal.x<0&&t<-0*x.deg2Rad&&(this.rotationLocal.x=-0*x.deg2Rad-this.curLocalRotationX),this.curLocalRotationX+=this.rotationLocal.x,0==this.curLocalRotationX&&(this.isPitchBackToZero=!1),this.gameObject.transform.rotate(this.rotationLocal,!0,!0),this.gameObject.transform.rotate(this.rotationWorld,!1,!0)}startPitchBackToZero(){0!=this.curLocalRotationX&&(this.isPitchBackToZero=!0,this.pitchBackSign=-1*Math.sign(this.curLocalRotationX))}upLevel(t){this.level>=10||(this.level+=t,this.upData(this.level),this.showLevelUp(),this.scaleFishByLevel(this.level))}getAtk(){let t=this.originalFishData.atk;return 4==this.originalFishData.skillType?t*(1+this.originalFishData.param):1==this.originalFishData.skillType&&Math.random()<=this.originalFishData.param?2*t:t}getAtkGap(){return 3==this.originalFishData.skillType&&this.curHp<this.originalFishData.hp?this.originalFishData.atkGap*(1-this.originalFishData.param):this.originalFishData.atkGap}setGod(t){if(this.isGod=t,this.isGod){let t=2e3,e=500,i=0,a=0,s=()=>{if(t>0&&(t-=Laya.timer.delta)<=0)return Laya.timer.clear(this,s),void this.setGod(!1);if((i+=Laya.timer.delta)>=e&&(i=e),0==a){let t=i/e;this.fishMat.albedoColorB=this.getLerp(1,0,t),this.fishMat.albedoIntensity=this.getLerp(.9,3,t)}else{let t=1-i/e;this.fishMat.albedoColorB=this.getLerp(1,0,t),this.fishMat.albedoIntensity=this.getLerp(.9,3,t)}i==e&&(i=0,a=0==a?1:0)};Laya.timer.frameLoop(1,this,s)}else this.fishMat.albedoColor=new Laya.Vector4(1,1,1,1),this.fishMat.albedoIntensity=.9}getLerp(t,e,i){return t+(e-t)*i}upData(t){let e=[1,1.3,1.6,1.8,2,2.1,2.2,2.3,2.4,2.5][t-1];this.originalFishData.hp=e*this.cloneFishData.hp,this.originalFishData.atk=e*this.cloneFishData.atk}}class H extends V{constructor(){super(...arguments),this.fishAI=null}onAwake(){super.onAwake(),this.fishType="enemy",this.waterEffect=c.getResClone("Effect_Water1.lh"),this.waterEffectNode.addChild(this.waterEffect),this.waterEffect.transform.localPosition=new Laya.Vector3,this.waterEffect.transform.localRotationEuler=new Laya.Vector3,this.fishAI=this.gameObject.addComponent(_),this.fishAI.fishBase=this}onUpdate(){super.onUpdate()}onHurt(t,i){super.onHurt(t,i),this.isDeath||this.curHp/this.originalFishData.hp<.5&&(this.fishAI.hasAttackThink=!0),l.event(e.PopImage,[this.gameObject.transform.position.clone(),0,i,!0])}}class z{constructor(){UIConfig.closeDialogOnSide=!1,Laya.Scene.root,Laya.Dialog.manager.name="DialogRoot",z._GameSceneRoot=new Laya.Sprite,z._GameSceneRoot.name="GameSceneRoot",z._GameUIRoot=new Laya.Sprite,z._GameUIRoot.name="GameUIRoot",z._UpRoot=new Laya.Sprite,z._UpRoot.name="UpRoot",z._UpDialogRoot=new Laya.Sprite,z._UpDialogRoot.name="UpDialogRoot",z._UI3D=new Laya.Sprite;let t=[z._GameSceneRoot,z._GameUIRoot,Laya.Scene.root,z._UpRoot,Laya.Dialog.manager,z._UpDialogRoot];for(let e=0;e<t.length;e++){let i=t[e];i.zOrder=e+1,i!=Laya.Scene.root&&i!=Laya.Dialog.manager&&Laya.stage.addChild(i)}Laya.stage.updateZOrder()}static init(){z._StageManager||(z._StageManager=new z)}static get UI3D(){return z._UI3D}static get GameSceneRoot(){return z._GameSceneRoot}static get GameUIRoot(){return z._GameUIRoot}static get UpRoot(){return z._UpRoot}static get UpDialogRoot(){return z._UpDialogRoot}}class j{constructor(){}static init(){null==j._instance&&(j._instance=new j,Laya.loader.load("shaderconfig.json",Laya.Handler.create(this,t=>{for(const e in t)if(t.hasOwnProperty(e)){const i=t[e];for(let t=0;t<i.length;t++){let a=i[t],s=new Laya.ShaderVariant(Laya.Shader3D.find(e),a.subShaderIndex,a.passIndex,a.defineNames);Laya.Shader3D.debugShaderVariantCollection.add(s)}}Laya.Shader3D.debugShaderVariantCollection.compile()})))}}j._instance=null;class G extends Laya.Script3D{constructor(){super(...arguments),this.changeHander=null}Ani_Change(){this.changeHander&&this.changeHander.run()}}class Y extends Laya.Script3D{constructor(){super(),this.camera=void 0,this.posAim=[0,2.44,-15.48],this.posOriginal=new Laya.Vector3,this.shockNum=0,this.shockNumMax=0,this.shockPoint=[[.2,0,.2],[0,.2,.2],[.2,.2,0],[0,0,.2],[0,0,0]],this.xMove=0,this.zMove=0,this.yMove=0,this.shockAni=""}setCameraOriginalPos(t){this.posOriginal.x=t.x,this.posOriginal.y=t.y,this.posOriginal.z=t.z}onSetAttr(){}onAwake(){this.camera=this.owner,this.posAim=[],this.posOriginal=this.camera.transform.position.clone()}onEnable(){}onDisable(){}onUpdate(){if(this.shockNum<this.shockNumMax){this.shockNum=this.shockNum+1;var t=1/this.shockNumMax*2*(this.shockNumMax/2-Math.abs(this.shockNumMax/2-this.shockNum));this.posAim=[this.posOriginal.x+this.xMove*t,this.posOriginal.y+this.yMove*t,this.posOriginal.z+this.zMove*t]}else this.shockAni="",this.posAim=[this.posOriginal.x,this.posOriginal.y,this.posOriginal.z],this.yMove=0,this.xMove=0,this.zMove=0;var e=this.camera.transform.position;this.camera.transform.position=new Laya.Vector3(e.x+(this.posAim[0]-e.x)/3,e.y+(this.posAim[1]-e.y)/3,e.z+(this.posAim[2]-e.z)/3)}shockFun(t,e){if(t==this.shockAni)return;this.shockAni=t;this.shockNum=0,this.shockNumMax=5,this.yMove=-.8*Math.sin((e-90)/180*Math.PI),this.xMove=-.8*Math.cos((e-90)/180*Math.PI),this.zMove=0}shockFun2(t){var e=window.GameManager.roleScript.aniName;console.log(e);var i=window.GameManager.shockParam[7],a=window.GameManager.shockParam2[7];this.shockNum=0,this.shockNumMax=a,this.yMove=i}}class X extends t.pages.mainUI{constructor(){super(...arguments),this.camera=null,this.player=null,this.ray=new Laya.Ray(new Laya.Vector3,new Laya.Vector3),this.hitResult=new Laya.HitResult,this.pointPos=null,this.evolution=null,this.evolutionAnimationScript=null,this.evolutionAni=null,this.showId=-1,this.cameraMove=null}onAwake(){j.init(),c.playMusic("bgm.mp3"),L.Instance.init(),this.goldLabel.value=m.instance.gold+"",this.width=Laya.stage.width,this.height=Laya.stage.height,this.addMoneyBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.mainScene3D=c.getRes("ShowScene.ls"),this.evolution=this.mainScene3D.getChildByName("Evolution"),this.evolution.active=!1,this.evolutionAni=this.evolution.getChildByName("EvolutionAni"),this.evolutionAnimationScript=this.evolution.getComponent(G),this.evolutionAnimationScript||(this.evolutionAnimationScript=this.evolution.addComponent(G)),this.camera=this.mainScene3D.getChildByName("ShowCamera").getChildByName("MainCamera"),this.cameraMove=this.camera.getComponent(Y),this.cameraMove||(this.cameraMove=this.camera.addComponent(Y)),this.sceneBox.addChild(this.mainScene3D),l.on("UserDataChange",this,this.onUserDataChange),l.on(e.BitFinger,this,this.onBitFinger),l.on(e.BackInBox,this,this.onBackInBox),l.on(e.EnterGen,this,this.onEnterGen);let t=[{iconSkin:"main/Btn_Reward.png",btn:this.startPage.divisionBtn,pageClass:f},{iconSkin:"main/Btn_DNA.png",btn:this.startPage.vibrateBtn,pageClass:P},{iconSkin:"main/Btn_Strengthen.png",btn:this.startPage.strengthBtn,pageClass:U}];this.backBtn.alpha=0,this.downPanel.setMainPage(this.backBtn,this.startPage),this.downPanel.initBtnArr(t);for(let e=0;e<t.length;e++){let i=new t[e].pageClass;this.pageBox.addChild(i),this.downPanel.setPage(e,i),this.downPanel.showBtnRedPoint(e,!1)}let i=f.haveReward();this.downPanel.showBtnRedPoint(0,i),this.changeShowPlayer(m.instance.playerID,!1,!1),l.on(e.UpdatePlayFish,this,this.setPlayerFish),l.on(e.UpdateDivisionRed,this,this.onUpdateDivisionRed),l.on(b.NEWGUIDETASK,this,this.onNewGuideTask),Laya.timer.frameOnce(1,this,()=>{b.Instance.setTalkBottom(0),b.Instance.showGuide("进入主界面",[this.startPage.startBtn],!0),b.Instance.showGuide("返回主界面",null)})}onNewGuideTask(t){if("引导点击变异界面"==t)b.Instance.showGuide(t,[this.startPage.vibrateBox]),b.Instance.setTalkAlign("right");else if("引导选择变异方向"==t){let e=this.downPanel.getPage(1),i=e.nodeBg.getChildAt(1),a=e.nodeBg.getChildAt(2);b.Instance.showGuide(t,[i,a])}else if("引导点击变异按钮"==t){let e=this.downPanel.getPage(1);b.Instance.setTalkBottom(0),b.Instance.showGuide(t,[e.virationBtn])}else"变异成功"==t?b.Instance.showGuide(t,null,!0):"进入开始界面"==t?b.Instance.showGuide(t,[this.backBtn]):"引导进去变异界面"==t?b.Instance.showGuide(t,null):"进入主界面"==t&&b.Instance.showGuide("进入主界面",[this.startPage.startBtn],!0)}onUpdateDivisionRed(){let t=f.haveReward();this.downPanel.showBtnRedPoint(0,t)}onBitFinger(t,e){if(0==this.player.fishAI.canBit)return;this.player.fishAI.canBit=!1;let i=new Laya.Vector2(t*Laya.stage.clientScaleX,e*Laya.stage.clientScaleY);if(this.camera.viewportPointToRay(i,this.ray),this.mainScene3D.physicsSimulation.rayCast(this.ray,this.hitResult)){this.hitResult.collider.owner&&(this.player.fishAI.isInBit=!0,this.pointPos=this.hitResult.point.clone(),this.pointPos.z=-2,this.player.startBitFinger(this.pointPos))}}onBackInBox(){this.player.animator.play("Run",0,0),this.cameraMove.shockFun("1",90),c.playSound("Fracture.mp3");let t=R.convert3DTo2DPosition(this.camera,this.pointPos),e=new Laya.Image("main/Ui_Glass1.png");Math.random()<.5&&(e.skin="main/Ui_Glass2.png"),e.x=t.x,e.y=t.y,e.anchorX=e.anchorY=.5,z.UpRoot.addChild(e),Laya.timer.once(2e3,null,()=>{Laya.Tween.to(e,{alpha:0},1e3,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{e&&e.destroy()}))}),this.player.fishAI.isInBit=!1,this.player.fishAI.runBoxCenter();let i=()=>{this.player.gameObject.transform.position.z>=0&&(this.player.fishAI.canBit=!0,Laya.timer.clear(this,i))};Laya.timer.frameLoop(1,this,i)}onUserDataChange(t){"gold"==t&&(this.goldLabel.value=m.instance.gold+"")}onClosed(){this.mainScene3D.removeSelf(),this.player.gameObject.destroy(),z.UpRoot.destroyChildren()}onDestroy(){l.off("UserDataChange",this,this.onUserDataChange),l.off(e.UpdatePlayFish,this,this.setPlayerFish),l.off(e.BitFinger,this,this.onBitFinger),l.off(e.EnterGen,this,this.onEnterGen),l.off(e.BackInBox,this,this.onBackInBox),l.off(e.UpdateDivisionRed,this,this.onUpdateDivisionRed),l.off(b.NEWGUIDETASK,this,this.onNewGuideTask)}onBtnClick(t){c.playSound("click.mp3"),Laya.MouseManager.enabled=!1,t.target==this.addMoneyBtn&&k.loadScene()}setPlayerFish(t,e,i,a){if(this.showId!=t)if(this.showId=t,a){Laya.MouseManager.enabled=!1;let e=this.downPanel.getPage(1);this.downPanel.canChangePage=!1,c.playSound("evolution.mp3"),Laya.Tween.to(e,{alpha:0},500,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.evolution.active=!0;let s=this.player.gameObject.transform.position.clone();this.evolutionAni.addChild(this.player.gameObject),this.player.gameObject.transform.position=s,this.evolutionAnimationScript.changeHander=Laya.Handler.create(this,()=>{console.log("changeHandler"),this.changeShowPlayer(t,i,a)}),Laya.timer.once(5e3,this,()=>{let t=this.player.gameObject.transform.position.clone();this.mainScene3D.addChild(this.player.gameObject),this.player.gameObject.transform.position=t,this.evolution.active=!1,Laya.Scene.load("pages/evolutionSuccess.scene",Laya.Handler.create(this,t=>{t.isShowEffect=!1,t.open(!1),Laya.MouseManager.enabled=!0,b.Instance.showGuide("确定变异",[t.sureBtn]),b.Instance.setTalkAlign("left"),t.sureBtn.on(Laya.Event.CLICK,t,()=>{Laya.timer.once(100,this,()=>{b.Instance.finishTask("确定变异")}),c.playSound("click.mp3"),t.close(),Laya.Tween.to(e,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.downPanel.canChangePage=!0}))})}))})}))}else this.changeShowPlayer(t,i,a)}changeShowPlayer(t,i,a){Laya.MouseManager.enabled=!1;let s="Player"+(t+1),n=s+".lh",o=this.mainScene3D;i&&a&&(o=this.evolutionAni);let h="Fx_LevelUp"+(t+1)+".lh",r=L.Instance.fangsEffectList[t]+".lh";console.log(t,r),c.create([n,h,r]).then(()=>{m.instance.playerID=t,m.instance.onDataChange("playerID"),a||(Laya.MouseManager.enabled=!0);let h=this.player,r=c.getRes(n),d=Laya.Sprite3D.instantiate(r,o);this.player=d.addComponent(H),this.player.fishAI.enemyFishState=3;let p=L.Instance.getBodyInfoByName(s);this.player.setFishInfo(p[0],p[1]);let g=L.Instance.getFishConfigDataByName(s);if(this.player.initData(g),this.player.gameObject.transform.localScale=new Laya.Vector3(1,1,1),l.event(e.UpdateFishData,g),i)if(this.onEnterEvolution(),a)this.player.gameObject.transform.localPosition=h.gameObject.transform.localPosition.clone(),this.player.gameObject.transform.localRotationEuler=h.gameObject.transform.localRotationEuler.clone();else{let t=this.mainScene3D.getChildByName(`Player${m.instance.playerID+1}Point`);this.player.gameObject.transform.position=t.transform.position.clone(),this.player.gameObject.transform.localRotationEuler=new Laya.Vector3(0,90,0)}else this.player.gameObject.transform.localPosition=new Laya.Vector3(0,0,0),this.player.gameObject.transform.localRotationEuler=new Laya.Vector3(0,0,0);h&&h.gameObject.destroy()})}moveFishToEvolutionPos(){this.onEnterEvolution();let t=this.mainScene3D.getChildByName(`Player${m.instance.playerID+1}Point`);R.tweenTo(this.player.gameObject,{position:t.transform.position,localRotationEuler:new Laya.Vector3(0,90,0)},380,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{}),0,!0)}onEnterEvolution(){this.player.fishAI.isInEvolution=!0,this.player.moveSpeed=0,this.player.isFollowingPoint=!1,this.player.reachFollowTargetPoint(),this.player.endBit()}onEnterGen(t){t?this.moveFishToEvolutionPos():(this.evolution.active=!1,this.mainScene3D.addChild(this.player.gameObject),this.player.moveSpeed=1.8,this.player.fishAI.isInEvolution=!1,this.player.fishAI.runBoxCenter())}}class W extends t.pages.taskUI{constructor(){super(...arguments),this.taskType=0}onAwake(){this.dayTag.visible=W.dayHaveRed(),this.achieveTag.visible=W.achieveHaveRed(),this.taskList.vScrollBarSkin=null,this.showTask(0),this.taskList.mouseHandler=Laya.Handler.create(this,this.onListMouseHandler,null,!1),l.on(e.UpdateTask,this,this.onUpdateTask)}onDestroy(){l.off(e.UpdateTask,this,this.onUpdateTask)}onUpdateTask(){this.showTask(this.taskType),this.dayTag.visible=W.dayHaveRed(),this.achieveTag.visible=W.achieveHaveRed()}onOpened(){Laya.MouseManager.enabled=!0,this.achieveTaskBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.dayTaskBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.closeBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(t){c.playSound("click.mp3"),t.target==this.closeBtn?this.close():this.achieveTaskBtn==t.target?this.showTask(1):this.dayTaskBtn==t.target&&this.showTask(0)}onListMouseHandler(t,i){if(t.type==Laya.Event.CLICK){if(2==this.taskList.array[i].state){if(0==this.taskType)m.instance.dayTaskReceiveRec[i]=1,m.instance.onDataChange("dayTaskReceiveRec");else{m.instance.achieveTaskReceiveRec[i]=1,m.instance.onDataChange("achieveTaskReceiveRec"),m.instance.achieveTaskStage[i]<W.taskConfig2[i].num.length-1&&(m.instance.achieveTaskStage[i]++,m.instance.onDataChange("achieveTaskStage"),m.instance.achieveTaskReceiveRec[i]=0,m.instance.onDataChange("achieveTaskReceiveRec"))}this.showTask(this.taskType),l.event(e.RefreshRed)}}}showTask(t){this.taskType=t,this.dayTaskBtn.skin=0==t?"task/Btn_daily.png":"task/Btn_daily2.png",this.achieveTaskBtn.skin=1==t?"task/Btn_Chenjiu2.png":"task/Btn_Chenjiu.png";let e=[];if(0==t)for(let t=0;t<W.taskConfig1.length;t++){let i=W.taskConfig1[t],a={rewardNum:i.reward,taskDesc:i.desc.replace("*",i.num+""),taskType:0,index:t,num:i.num};e.push(a)}else if(1==t)for(let t=0;t<W.taskConfig2.length;t++){let i=W.taskConfig2[t],a=m.instance.achieveTaskStage[t],s=i.reward[a],n=i.num[a],o={rewardNum:s,taskDesc:i.desc.replace("*",n+""),taskType:1,index:t,num:n};e.push(o)}this.taskList.array=e,this.taskList.refresh()}static dayHaveRed(){for(let t=0;t<W.taskConfig1.length;t++){let e=W.taskConfig1[t];if(m.instance.dayTaskCountRec[t]>=e.num){if(!m.instance.dayTaskReceiveRec[t])return!0}}return!1}static achieveHaveRed(){for(let t=0;t<W.taskConfig2.length;t++){let e=W.taskConfig2[t],i=m.instance.achieveTaskStage[t],a=(e.reward[i],e.num[i]);if(m.instance.achieveTaskCountRec[t]>=a){if(!m.instance.achieveTaskReceiveRec[t])return!0}}return!1}static haveRed(){return this.dayHaveRed()||this.achieveHaveRed()}}W.taskConfig1=[{desc:"打败30只鱼包括鱼群中的鱼",num:30,reward:300},{desc:"在一场比赛中获得第一名",num:1,reward:300},{desc:"变异升级两次",num:2,reward:300}],W.taskConfig2=[{desc:"累计消灭*条鱼",num:[5,20,100,300],reward:[100,300,400,500]},{desc:"匹配*局比赛",num:[5,20,50,100],reward:[100,300,400,500]},{desc:"使用冲刺累计*次",num:[3,5,10,20,30,50,100],reward:[50,100,150,200,250,300,350]},{desc:"比赛获得第一名*次",num:[20,60,200,500],reward:[100,300,400,500]},{desc:"解锁*条鱼",num:[5,10,15,20],reward:[100,300,400,500]}];class q extends t.pages.startUI{onAwake(){this.width=Laya.stage.width,this.height=Laya.stage.height,this.settingBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.lotteryBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.taskBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.signBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.startBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.atkProgress.setProgressBarSkin("main/Ui_Property1.png"),this.atkGapProgress.setProgressBarSkin("main/Ui_Property2.png"),this.hpProgress.setProgressBarSkin("main/Ui_Property3.png"),this.energyProgress.setProgressBarSkin("main/Ui_Property4.png"),this.mSpeedProgress.setProgressBarSkin("main/Ui_Property5.png"),this.atkProgress.setProgressValuePos(120,0),this.atkGapProgress.setProgressValuePos(120,0),this.hpProgress.setProgressValuePos(120,0),this.energyProgress.setProgressValuePos(120,0),this.mSpeedProgress.setProgressValuePos(120,0),this.on(Laya.Event.CLICK,this,this.onMouseEvent),l.on(e.UpdateFishData,this,this.onUpdateFishData),l.on(e.UpdateRed,this,this.onUpdateRed),this.taskTag.visible=W.haveRed()}onBtnClick(t){c.playSound("click.mp3"),Laya.MouseManager.enabled=!1,t.target==this.settingBtn?Laya.Scene.open("pages/setting.scene",!1):t.target==this.signBtn?Laya.Scene.open("pages/sign.scene",!1):t.target==this.taskBtn?Laya.Scene.open("pages/task.scene",!1):t.target==this.lotteryBtn?Laya.Scene.open("pages/lottery.scene",!1):t.target==this.startBtn&&(b.Instance.finishTask("进入主界面"),Laya.Scene.open("pages/match.scene"))}onDestroy(){l.off(e.UpdateFishData,this,this.onUpdateFishData),l.off(e.UpdateRed,this,this.onUpdateRed)}onMouseEvent(t){l.event(e.BitFinger,[t.stageX,t.stageY])}onUpdateFishData(t){this.atkProgress.setProgress(t.atk,1e3);let e=1e3*Number(x.floatSub(1,t.atkGap));this.atkGapProgress.setProgress(e,300),this.hpProgress.setProgress(t.hp,5e3),this.energyProgress.setProgress(t.energy,500),this.mSpeedProgress.setProgress(t.mSpeed,300);let i=Math.ceil(1/t.atkGap*t.atk+t.hp);this.fightValue.value=i+""}onUpdateRed(){this.taskTag.visible=W.haveRed()}onSelect(){b.Instance.finishTask("进入开始界面",500)}}class K extends t.pages.matchUI{constructor(){super(...arguments),this.matchCellList=[],this.isLoadFinish=!1,this.matchCount=0}onAwake(){this.width=Laya.stage.width,this.height=Laya.stage.height,m.instance.finishTask(1,1,1);for(let t=0;t<this.headBg.numChildren;t++)this.matchCellList.push(this.headBg.getChildAt(t));let t=[];for(let e=0;e<L.Instance.aiConfig.length;e++)t.push(e);L.Instance.aiNameList=[];for(let e=0;e<7;e++){let i=x.getRandom(0,t.length-1),a=L.Instance.aiConfig[t[i]];t.splice(i,1);let s=this.matchCellList[e];L.Instance.aiNameList.push(a.name),this.setCellData(s,a,5e3*Math.random())}P.initTreeNode(),L.Instance.aiFishIdList=P.getCanOutFishList();let e=[];for(let t=0;t<L.Instance.aiFishIdList.length;t++){let i=L.Instance.aiFishIdList[t];e.push(`Player${i+1}.lh`),e.push(`Fx_LevelUp${i+1}.lh`),e.push(L.Instance.fangsEffectList[i]+".lh")}c.create(["Mine.lh","Effect_Mine.lh","MainCamera.lh","Scene1.ls","Enemy1.lh","Enemy2.lh","Enemy3.lh","Enemy4.lh","Enemy5.lh","Enemy6.lh","Meat1.lh","Meat2.lh","Meat3.lh"].concat(e)).then(()=>{this.isLoadFinish=!0;let e=x.getRandom(0,t.length-1),i=L.Instance.aiConfig[t[e]];t.splice(e,1);let a=this.matchCellList[7];L.Instance.aiNameList.push(i.name),this.setCellData(a,i,0)})}setCellData(t,e,i){Laya.timer.once(i,this,()=>{c.playSound("matchSuccess.mp3"),t.head.skin=e.icon,t.nameLabel.text=e.name,t.wait.visible=!1,this.matchCount++,this.checkFinish()})}checkFinish(){this.isLoadFinish&&8==this.matchCount&&Laya.timer.frameOnce(1,this,()=>{Laya.Scene.open("pages/play.scene")})}}class Z extends t.pages.pauseUI{onAwake(){}onOpened(){Laya.MouseManager.enabled=!0,this.setPause(!0),this.continueBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.backBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(t){c.playSound("click.mp3"),t.target==this.backBtn&&Laya.Scene.open("pages/main.scene"),this.setPause(!1),this.close()}setPause(t){t?(Laya.timer.pause(),Laya.updateTimer.pause()):(Laya.timer.resume(),Laya.updateTimer.resume())}}class Q extends Laya.Script3D{onAwake(){this.scene3d=this.owner,this.camera=R.findNodeByUrl(this.scene3d,"MainCamera/Camera"),this.clearNode=new Laya.Sprite3D,this.clearNode.name="clearNode",this.scene3d.addChild(this.clearNode)}onDestroy(){this.clearNode.destroy(),this.scene3d.removeSelf()}convert3DTo2DPosition(t){let e=new Laya.Vector4;return this.camera.viewport.project(t,this.camera.projectionViewMatrix,e),new Laya.Vector2(e.x/Laya.stage.clientScaleX,e.y/Laya.stage.clientScaleY)}}class ${constructor(t){this.pos=new Laya.Vector3,this.originalPos=new Laya.Vector3,this.pos.x=t.pos.x,this.pos.y=t.pos.y,this.pos.z=t.pos.z,this.originalPos.x=t.pos.x,this.originalPos.y=t.pos.y,this.originalPos.z=t.pos.z}}class J extends ${constructor(t){super(t),this.height=0,this.halfHeight=0,this.length=0,this.halfLength=0,this.width=0,this.halfWidth=0,this.length=t.length,this.halfLength=this.length/2,this.width=t.width,this.halfWidth=this.width/2,this.height=t.height,this.halfHeight=this.height/2}pointInCollider(t){let e=this.pos.x-this.halfLength,i=this.pos.x+this.halfLength,a=this.pos.y-this.halfHeight,s=this.pos.y+this.halfHeight,n=this.pos.z-this.halfWidth,o=this.pos.z+this.halfWidth;return!(t.x<e||t.x>i||t.y<a||t.y>s||t.z<n||t.z>o)}}class et extends Laya.Script3D{constructor(){super(...arguments),this.followTransform=null,this.camera=null,this.cameraNode=null,this.offsetX=0,this.offsetY=0,this.offsetZ=0,this.moveSpeed=5,this.rotateSpeed=2,this.maxRotateSpeed=2,this.minRotateSpeed=.1,this.cameraTargetPos=new Laya.Vector3,this.translation=new Laya.Vector3,this.rotation=new Laya.Vector3,this.isSendEvent=!1,this.selfEuler=new Laya.Vector3,this.targetEuler=new Laya.Vector3,this.diff=new Laya.Vector3,this.isHitMap=!1,this.isHitWaterFace=!1,this.verticalTranslation=new Laya.Vector3(0,0,0),this.upSpeed=1,this.maxDis=2,this.curDis=0,this.closestPosition=new Laya.Vector3(0,1.68,-3.84),this.normalPosition=new Laya.Vector3(0,5.33,-10.58),this.targetZ=0,this.sensitive=1,this.forward=new Laya.Vector3,this.scale=1,this.standerNearZ=-3.84,this.standerFarZ=-10.58,this.standerFarY=-10.58,this.targetY=0,this.standerOffsetZ=0,this.lockOffsetZ=0,this.scaleOffsetZ=0,this.isLockEnemy=!1,this.rotateFollowTransform=null,this.originalLocalRotationEuler=new Laya.Vector3,this.targetLocalRotationEuler=new Laya.Vector3,this.lookNode=null,this.upVec=new Laya.Vector3(0,1,0),this.curLocalRotationX=0,this.cameraLocalTargetPos=new Laya.Vector3,this.startYawDiff=0,this.centerYawDiff=0,this.endYawDiff=0,this.updateFowardFrame=-1,this.isRecoverySensitive=!1}onAwake(){this.cameraNode=this.owner,this.camera=this.findNodeByType(this.cameraNode,Laya.Camera),this.originalLocalRotationEuler=this.camera.transform.localRotationEuler.clone(),this.lookNode=new Laya.Sprite3D,this.lookNode.transform.localRotationEuler=this.originalLocalRotationEuler.clone(),this.cameraNode.addChild(this.lookNode)}onUpdate(){this.positionFollow(),this.rotationFollow(),this.recoveryCameraSensitive(),this.cameraMoveClose1(),this.lookNode.transform.position=this.camera.transform.position.clone()}updateForward(){Laya.timer.currFrame!=this.updateFowardFrame&&(this.updateFowardFrame=Laya.timer.currFrame,this.camera.transform.getForward(this.forward))}setCameraTargetTransform(t){this.isSendEvent=!1,this.followTransform=t}findNodeByType(t,e){if(t instanceof e)return t;for(let i=0;i<t.numChildren;i++){let a=t.getChildAt(i);return this.findNodeByType(a,e)}return null}scaleDistance(t){let e=[[4.6,-10],[5.5,-12],[6.6,-14.4],[7.6,-16.6],[8.7,-19],[9.5,-20.6],[9.6,-21],[9.9,-21.6],[10.3,-22.6],[10.4,-22.8]];this.standerFarZ=e[t-1][1],this.standerOffsetZ=this.lockOffsetZ+this.scaleOffsetZ,this.targetZ=this.standerFarZ+this.standerOffsetZ,this.standerFarY=e[t-1][0],this.targetY=this.standerFarY,this.cameraLocalTargetPos.x=0,this.cameraLocalTargetPos.y=this.targetY,this.cameraLocalTargetPos.z=this.targetZ}onDestroy(){}positionFollow(){if(!this.followTransform)return;this.cameraTargetPos.x=this.followTransform.position.x+this.offsetX,this.cameraTargetPos.z=this.followTransform.position.z+this.offsetZ,this.cameraTargetPos.y=this.followTransform.position.y+this.offsetY;let t=this.cameraTargetPos.x-this.cameraNode.transform.position.x,e=this.cameraTargetPos.y-this.cameraNode.transform.position.y,i=this.cameraTargetPos.z-this.cameraNode.transform.position.z;if(0==t&&0==e&&0==i&&!this.isSendEvent)return void(this.isSendEvent=!0);let a=this.moveSpeed*Laya.timer.delta/1e3;this.translation.x=Math.abs(t)<=.01?t:t*a,this.translation.y=Math.abs(e)<=.01?e:e*a,this.translation.z=Math.abs(i)<=.01?i:i*a,this.cameraNode.transform.translate(this.translation,!1)}rotationFollow(){if(!this.followTransform)return;this.isLockEnemy?this.normalizeRotationEuler(this.rotateFollowTransform.localRotationEuler,this.targetEuler):this.normalizeRotationEuler(this.followTransform.localRotationEuler,this.targetEuler),this.normalizeRotationEuler(this.cameraNode.transform.localRotationEuler,this.selfEuler),this.nearestRotationDiff(this.selfEuler,this.targetEuler,this.diff);let t=this.diff.x,e=this.diff.y,i=this.diff.z;if(0==t&&0==e&&0==i&&!this.isSendEvent)return void(this.isSendEvent=!0);this.rotateSpeed=100;let a=this.rotateSpeed*Laya.timer.delta/1e3,s=1-Math.abs(Math.abs(t)-90)/90,n=1-Math.abs(Math.abs(e)-90)/90,o=1-Math.abs(Math.abs(i)-90)/90;this.rotation.x=Math.abs(t)<=.01*this.sensitive?s*Math.sign(t)*this.sensitive:s*Math.sign(t)*a*this.sensitive,this.rotation.y=Math.abs(e)<=.01*this.sensitive?n*Math.sign(e)*this.sensitive:n*Math.sign(e)*a*this.sensitive,this.rotation.z=Math.abs(i)<=.01*this.sensitive?o*Math.sign(i)*this.sensitive:o*Math.sign(i)*a*this.sensitive,this.rotation.x=this.fixLocalRotationX(this.rotation.x),this.curLocalRotationX+=this.rotation.x,this.cameraNode.transform.rotate(this.rotation,!0,!1)}getRotateSpeed(t){return 0==this.centerYawDiff?this.maxRotateSpeed:t<this.centerYawDiff?this.minRotateSpeed+(this.maxRotateSpeed-this.minRotateSpeed)*(this.startYawDiff-t)/this.centerYawDiff:t==this.centerYawDiff?this.maxRotateSpeed:this.maxRotateSpeed+(this.minRotateSpeed-this.maxRotateSpeed)*((this.startYawDiff-t)/this.centerYawDiff-1)}setRotateFollowTrans(t){this.rotateFollowTransform=t,t?(this.isLockEnemy=!0,this.lockOffsetZ=-3):(this.isLockEnemy=!1,this.lockOffsetZ=0,this.normalizeRotationEuler(this.followTransform.localRotationEuler,this.targetEuler),this.normalizeRotationEuler(this.cameraNode.transform.localRotationEuler,this.selfEuler),this.startYawDiff=Math.abs(this.targetEuler.y-this.selfEuler.y),this.endYawDiff=0,this.centerYawDiff=(this.startYawDiff+this.endYawDiff)/2),this.standerOffsetZ=this.lockOffsetZ+this.scaleOffsetZ,this.targetZ=this.standerFarZ+this.standerOffsetZ,this.cameraLocalTargetPos.x=0,this.cameraLocalTargetPos.y=this.targetY,this.cameraLocalTargetPos.z=this.targetZ}lookTargetFollow(){this.rotateFollowTransform?(this.lookNode.transform.lookAt(this.rotateFollowTransform.position,this.upVec,!1),this.normalizeRotationEuler(this.lookNode.transform.localRotationEuler,this.targetEuler)):this.normalizeRotationEuler(this.originalLocalRotationEuler,this.targetEuler),this.normalizeRotationEuler(this.camera.transform.localRotationEuler,this.selfEuler),this.nearestRotationDiff(this.selfEuler,this.targetEuler,this.diff);let t=this.diff.x,e=this.diff.y,i=this.diff.z;if(0==t&&0==e&&0==i&&!this.isSendEvent)return void(this.isSendEvent=!0);let a=this.rotateSpeed*Laya.timer.delta/1e3;this.rotation.x=Math.abs(t)<=.01*this.sensitive?t*this.sensitive:t*a*this.sensitive,this.rotation.y=Math.abs(e)<=.01*this.sensitive?e*this.sensitive:e*a*this.sensitive,this.rotation.z=Math.abs(i)<=.01*this.sensitive?i*this.sensitive:i*a*this.sensitive,this.rotation.x=this.fixLocalRotationX(this.rotation.x),this.curLocalRotationX+=this.rotation.x,this.camera.transform.rotate(this.rotation,!0,!1)}fixLocalRotationX(t){let e=this.curLocalRotationX+t,i=t;return t>0?e>0&&(i=0-this.curLocalRotationX):t<0&&e<-0&&(i=-0-this.curLocalRotationX),i}cameraMoveClose(){let t=this.upSpeed*Laya.timer.delta/1e3,e=this.camera.transform.localPosition;if(this.standerOffsetZ=this.lockOffsetZ+this.scaleOffsetZ,e.z!=this.targetZ){if(this.verticalTranslation.y=0,this.isHitMap){if(this.verticalTranslation.z=-(this.targetZ-e.z)*t*5,e.z-this.verticalTranslation.z>this.standerNearZ+this.standerOffsetZ){this.verticalTranslation.z=0;let t=this.camera.transform.localPosition.clone();t.z=this.standerNearZ+this.standerOffsetZ,this.camera.transform.localPosition=t}}else if(this.verticalTranslation.z=2.5*t,e.z-this.verticalTranslation.z<this.standerFarZ+this.standerOffsetZ){this.verticalTranslation.z=0;let t=this.camera.transform.localPosition.clone();t.z=this.standerFarZ+this.standerOffsetZ,this.camera.transform.localPosition=t}this.camera.transform.translate(this.verticalTranslation,!0)}e.y!=this.targetY&&(this.verticalTranslation.z=0,Math.abs(this.targetY-e.y)>2.5*t?this.verticalTranslation.y=2.5*t*Math.sign(this.targetY-e.y):this.verticalTranslation.y=this.targetY-e.y,this.camera.transform.translate(this.verticalTranslation,!0))}cameraMoveClose1(){let t=this.upSpeed*Laya.timer.delta/1e3,e=this.camera.transform.localPosition;Laya.Vector3.subtract(this.cameraLocalTargetPos,e,this.verticalTranslation);let i=Laya.Vector3.distance(e,this.cameraLocalTargetPos);this.isHitMap&&(t=t*i*5),t>i?t=1:(t*=3,Laya.Vector3.normalize(this.verticalTranslation,this.verticalTranslation)),Laya.Vector3.scale(this.verticalTranslation,t,this.verticalTranslation);let a=new Laya.Vector3;if(Laya.Vector3.add(this.camera.transform.localPosition,this.verticalTranslation,a),this.camera.transform.localPosition=a,this.isHitWaterFace){let t=this.camera.transform.position.clone();t.y=L.Instance.playerSafeY-.5,this.camera.transform.position=t}}normalizeRotationEuler(t,e){e.x=(t.x%360+360)%360,e.y=(t.y%360+360)%360,e.z=(t.z%360+360)%360}nearestRotationDiff(t,e,i){return Laya.Vector3.subtract(t,e,i),Math.abs(i.x)>180&&(i.x>0?i.x=i.x-360:i.x=i.x+360),Math.abs(i.y)>180&&(i.y>0?i.y=i.y-360:i.y=i.y+360),Math.abs(i.z)>180&&(i.z>0?i.z=i.z-360:i.z=i.z+360),i.x*=-1,i.y*=-1,i.z*=-1,i}setHitMap(t,e){if(this.isHitMap=t,this.isHitWaterFace=e,this.standerOffsetZ=this.lockOffsetZ+this.scaleOffsetZ,this.isHitMap){let t=this.standerNearZ+this.standerOffsetZ;this.targetZ=this.camera.transform.localPosition.z+(t-this.camera.transform.localPosition.z)/5,Laya.Vector3.subtract(new Laya.Vector3(0,0,t),this.camera.transform.localPosition,this.verticalTranslation),Laya.Vector3.scale(this.verticalTranslation,.2,this.verticalTranslation),Laya.Vector3.add(this.camera.transform.localPosition,this.verticalTranslation,this.cameraLocalTargetPos)}else this.targetZ=this.standerFarZ+this.standerOffsetZ,this.targetY=this.standerFarY,this.cameraLocalTargetPos.x=0,this.cameraLocalTargetPos.y=this.targetY,this.cameraLocalTargetPos.z=this.targetZ;console.log("1111111111",this.cameraLocalTargetPos)}setCameraRotateSensitive(t){this.isRecoverySensitive=!1,1==t?this.isRecoverySensitive=!0:this.sensitive=t}recoveryCameraSensitive(){if(this.isRecoverySensitive){let t=Laya.timer.delta/1e3;this.sensitive+t>1&&(t=1-this.sensitive,this.isRecoverySensitive=!1),this.sensitive+=t}}}class it extends ${constructor(t){super(t),this.upRadius=0,this.downRadius=0,this.height=0,this.halfHeight=0,this.upRadius=t.upRadius,this.downRadius=t.downRadius,this.height=t.height,this.halfHeight=this.height/2}pointInCollider(t){let e=this.pos.y+this.halfHeight,i=this.pos.y-this.halfHeight;if(t.y>e||t.y<i)return!1;let a=(t.y-i)/(e-i),s=this.downRadius+(this.upRadius-this.downRadius)*a,n=t.x-this.pos.x,o=t.z-this.pos.z;return!(Math.sqrt(n*n+o*o)>s)}}class at extends V{onAwake(){super.onAwake(),this.fishType="player",this.waterEffect=c.getResClone("Effect_Water1.lh"),this.waterEffectNode.addChild(this.waterEffect),this.waterEffect.transform.localPosition=new Laya.Vector3,this.waterEffect.transform.localRotationEuler=new Laya.Vector3}onUpdate(){super.onUpdate()}onHurt(t,i){super.onHurt(t,i),this.isDeath&&this.animator.play("Death1",0,0),l.event(e.PopImage,[this.gameObject.transform.position,0,i,!1]),l.event(e.PlayerUpdateHp,[this.curHp,this.originalFishData.hp])}addHp(t){super.addHp(t),l.event(e.PlayerUpdateHp,[this.curHp,this.originalFishData.hp])}addExp(t){super.addExp(t),l.event(e.PopImage,[this.gameObject.transform.position,1,t,!1]),l.event(e.PlayerUpLevel,this.level),l.event(e.PlayerAddExp,t)}}!function(t){t[t.None=-1]="None",t[t.Heng1=0]="Heng1",t[t.Heng2=1]="Heng2",t[t.Xie1=2]="Xie1",t[t.Xie2=3]="Xie2",t[t.LeftRot=4]="LeftRot",t[t.RightRot=5]="RightRot"}(i||(i={}));class st extends Laya.Script3D{constructor(){super(...arguments),this._moveType=0,this.fishBase=null,this.moveStage=0,this.totalRotateRad=0,this.zPos1=0,this.zPos2=0,this.zMoveStage=i.Heng1,this.lastZMoveStage=i.None,this.isRunning=!1,this.runDir=new Laya.Vector3,this.runDistance=0,this.moveDistance=0}onUpdate(){this.isRunning?this.updateFastRun():this.normalMove()}normalMove(){0==this._moveType?this.fishBase.isRotating&&(this.totalRotateRad+=this.fishBase.rotationWorld.y,this.fishBase.rotationWorld.y>0?this.totalRotateRad>=2*Math.PI&&(this.totalRotateRad=0,this.fishBase.rotateDir.x*=-1,this.fishBase.rotateDir.y=0):this.totalRotateRad<=-2*Math.PI&&(this.totalRotateRad=0,this.fishBase.rotateDir.x*=-1,this.fishBase.rotateDir.y=0)):1==this._moveType||(2==this._moveType?this.zMoveStage==i.Heng1?this.fishBase.gameObject.transform.position.z>=this.zPos2&&(this.lastZMoveStage=this.zMoveStage,this.zMoveStage=i.RightRot,this.fishBase.rotateDir.x=1,this.fishBase.rotateDir.y=0,this.fishBase.isRotating=!0,this.totalRotateRad=0):this.zMoveStage==i.Heng2?this.fishBase.gameObject.transform.position.z>=this.zPos2&&(this.lastZMoveStage=this.zMoveStage,this.zMoveStage=i.LeftRot,this.fishBase.rotateDir.x=-1,this.fishBase.rotateDir.y=0,this.fishBase.isRotating=!0,this.totalRotateRad=0):this.zMoveStage==i.Xie1?this.fishBase.gameObject.transform.position.z<=this.zPos1&&(this.lastZMoveStage=this.zMoveStage,this.zMoveStage=i.LeftRot,this.fishBase.rotateDir.x=-1,this.fishBase.rotateDir.y=0,this.fishBase.isRotating=!0,this.totalRotateRad=0):this.zMoveStage==i.Xie2?this.fishBase.gameObject.transform.position.z<=this.zPos1&&(this.lastZMoveStage=this.zMoveStage,this.zMoveStage=i.RightRot,this.fishBase.rotateDir.x=1,this.fishBase.rotateDir.y=0,this.fishBase.isRotating=!0,this.totalRotateRad=0):this.zMoveStage==i.LeftRot?(this.totalRotateRad+=this.fishBase.rotationWorld.y,this.totalRotateRad>=.75*Math.PI&&(this.totalRotateRad=0,this.lastZMoveStage==i.Xie1?this.zMoveStage=i.Heng2:this.zMoveStage=i.Xie2,this.fishBase.rotateDir.x=0,this.fishBase.rotateDir.y=0,this.fishBase.isRotating=!1)):this.zMoveStage==i.RightRot&&(this.totalRotateRad+=this.fishBase.rotationWorld.y,this.totalRotateRad<=-.75*Math.PI&&(this.totalRotateRad=0,this.lastZMoveStage==i.Heng1?this.zMoveStage=i.Xie1:this.zMoveStage=i.Heng1,this.fishBase.rotateDir.x=0,this.fishBase.rotateDir.y=0,this.fishBase.isRotating=!1)):this._moveType)}startFastRun(t,e,i){this.runDir=e,this.runDistance=i,this.moveDistance=0,this.fishBase.moveSpeed*=2,this.fishBase.rotateSpeed*=2,this.fishBase.setFollowPoint(t),this.isRunning=!0}updateFastRun(){this.moveDistance+=this.fishBase.frameMoveDis,this.moveDistance>=this.runDistance&&(this.isRunning=!1,this.moveType=this._moveType,this.fishBase.moveSpeed=this.fishBase.originalFishData.mSpeed,this.fishBase.rotateSpeed=this.fishBase.normalRotateSpeed),this.fishBase.moveSpeed>this.fishBase.originalFishData.mSpeed&&(this.fishBase.moveSpeed-=.01,this.fishBase.moveSpeed<=this.fishBase.originalFishData.mSpeed&&(this.fishBase.moveSpeed=this.fishBase.originalFishData.mSpeed))}set moveType(t){this._moveType=t,0==this._moveType?(this.fishBase.isRotating=!0,this.fishBase.rotateDir.x=1,this.fishBase.rotateDir.y=0):1==this._moveType?(this.fishBase.isRotating=!0,this.fishBase.rotateDir.x=1,this.fishBase.rotateDir.y=0):2==this._moveType?(this.zPos1=this.fishBase.gameObject.transform.position.z,this.zPos2=this.zPos1+10,this.zMoveStage=0,this.lastZMoveStage=-1):this._moveType}}class nt extends V{constructor(){super(...arguments),this.fishAI=null,this.group=null}onAwake(){super.onAwake(),this.fishType="group",this.fishAI=this.gameObject.addComponent(st),this.fishAI.fishBase=this}onUpdate(){super.onUpdate(),Laya.timer.currFrame==nt.updateCenterFrame||this.isHitFish||this.isHitMap||!this.group.center||(nt.updateCenterFrame=Laya.timer.currFrame,Laya.Vector3.add(this.group.center,this.translation,this.group.center))}setGroup(t){this.group=t,nt.updateCenterFrame=-1}}nt.updateCenterFrame=-1;class ot extends ${constructor(t){super(t),this.radius=0,this.radius=t.radius}pointInCollider(t){return Laya.Vector3.distance(t,this.pos)<=this.radius}}class ht extends Q{constructor(){super(...arguments),this.player=null,this.enemyList=[],this.cameraFollowScript=null,this.mapBlockPrefab=null,this.mapBlockHideList=[],this.mapBlockShowMap=new Map,this.mapColliderHideList=[],this.mapColliderShowMap=new Map,this.mapBombAreaHideList=[],this.mapBombAreaShowMap=new Map,this.mapSafeAreaHideList=[],this.mapSafeAreaShowMap=new Map,this.selectSafeAreaShowMap=new Map,this.mapBlockCreateList=[],this.blockWidth=100,this.blockHeight=100,this.playerBlockPos=new Laya.Vector2,this.mapBlockCreateInfo={alreadyShow:[],readyShow:[],readyHide:[]},this.refreshAreaInfo={readyRefreshArea:{low:[],middle:[],high:[]},readyHideArea:{low:[],middle:[],high:[]}},this.fishGroupList=new Map,this.meatList=[],this.safeLeft=20,this.bombLeft=20,this.enemyNum=7,this.enemyPointerMap=new Map,this.debugBallMap=new Map,this.potentialAttackGroup=new Map,this.playDataMap=[],this.bombMap=new Map,this.bitTarget=null,this.lastTarget=null,this.rankData=null,this.lookTargetNode=null,this.lockTarget=null,this.upVec=new Laya.Vector3(0,1,0),this.lookTarget=new Laya.Vector3,this.detectFrame=0,this.targetDir=new Laya.Vector3,this.readyShowKill=[],this.killImageList=[],this.isShowKilling=!1}onAwake(){super.onAwake();let t=this.scene3d.getChildByName("Scene").getChildByName("Scene_Water").getChildByName("Plane1"),i=t.transform.position.clone();i.y=40,t.transform.position=i;let a=this.scene3d.getChildByName("Scene").getChildByName("Scene_Water").getChildByName("Plane1Add"),s=a.transform.position.clone();s.y=39.9,a.transform.position=s,this.mapBlockPrefab=this.scene3d.getChildByName("Scene"),this.mapBlockPrefab.active=!1,this.cameraFollowScript=this.camera.parent.addComponent(et),window.cameraFollow=this.cameraFollowScript;let n="Player"+(m.instance.playerID+1);this.player=this.createFishByName(n,new Laya.Vector3(0,10,10),new Laya.Vector3,at),this.player.playerName="我自己",this.player.initData(this.getFishData(n,!0)),this.player.changeFishMat(),Laya.timer.frameOnce(1,this,()=>{l.event(e.UpdateEnergy,[this.player.curEnergy,this.player.originalFishData.energy])}),l.event(e.PlayerUpdateHp,[this.player.curHp,this.player.originalFishData.hp]),this.rankData={fish:this.player,name:"我自己",isDeath:!1,isMe:!0,kill:0,index:0},this.playDataMap.push(this.rankData),this.cameraFollowScript.setCameraTargetTransform(this.player.gameObject.transform),window.GameScenelogic=this,this.initEnemyGroup(),this.initEnemyPointer(),this.initPotentialAttackGroupMap(),this.updateRankList(),l.on(e.UseSkill,this,this.onUseSkill),l.on(e.ControlChange,this,this.onControlChange),l.on(e.FishDeath,this,this.onFishDeath),l.on(e.Revive,this,this.onRevive),l.on(e.PopImage,this,this.onPopImage),l.on(e.ScaleFish,this,this.onScaleFish),l.on(e.PopTip,this,this.onPopTip),l.on(e.BitEnd,this,this.onBitEnd),this.playGuluSound(),this.autoDie(),this.lookTargetNode=new Laya.Sprite3D,this.clearNode.addChild(this.lookTargetNode),this.onScaleFish(this.player),this.cameraFollowScript.setCameraRotateSensitive(.65)}syncLookNodeWithPlayer(){this.lookTargetNode.transform.position=this.player.gameObject.transform.position.clone()}setLockTarget(t){this.lockTarget=t,t?this.cameraFollowScript.setRotateFollowTrans(this.lookTargetNode.transform):(l.event(e.TargetPointer,[!1,null,!1]),this.cameraFollowScript.setRotateFollowTrans(null))}updateRankList(){this.playDataMap.sort((t,e)=>t.isDeath||e.isDeath?t.isDeath&&!e.isDeath?1:!t.isDeath&&e.isDeath?-1:0:e.kill-t.kill);for(let t=0;t<this.playDataMap.length;t++)this.playDataMap[t].index=t+1;L.Instance.myRank=this.rankData.index,L.Instance.myKill=this.rankData.kill,l.event(e.UpdateRank,[this.playDataMap])}initPotentialAttackGroupMap(){this.potentialAttackGroup.set(this.player,[]);for(let t=0;t<this.enemyList.length;t++)this.potentialAttackGroup.set(this.enemyList[t],[])}onUpdate(){this.updateTargetInRadius(this.player,5*this.player.bodyLength),L.Instance.calculateFps(),this.updatePlayerMapPos(),this.updateMapBlockInfoByBlockPos(),this.updateMapColliderByNameList(),this.updateMapBlockByNameList(),this.updateMapSafeAreaByNameList(),this.updateBombAreaByNameList(),this.updateRefreshBomb(),this.updateRandomSafeAreaList(),this.updateFishGroup(),this.syncLookNodeWithPlayer(),this.updataLockTarget(),this.clearLockTarget(),1==this.detectFrame&&(this.mapCollisionDetect(this.player),this.fishCollisionDetect(this.player),this.updateFishCollisionBomb(this.player)),this.judgeCameraCollisionMap(),this.updatePotentialGroupFish(this.player),this.fishEatMeat(this.player);for(let t=0;t<this.enemyList.length;t++){let e=this.enemyList[t];1==this.detectFrame&&(this.fishCollisionDetect(e),this.updateFishCollisionBomb(e)),this.updateEnemyWantFishGroup(e),this.updatePotentialGroupFish(e),this.fishEatMeat(e),this.transferEnemyFishToNearPlayer(e),this.updateEnemyBloodPos(e),this.updateEnemyAttackTarget(e)}this.detectFrame=++this.detectFrame%2,this.mapBlockCreateInfo.readyHide=[],this.mapBlockCreateInfo.readyShow=[]}createSuicideFish(){this.player.moveSpeed=0;let t=null;for(const e of this.fishGroupList.keys()){t=this.fishGroupList.get(e).fishList[0];break}t.gameObject.transform.position=this.player.getFrontPoint(2),t.moveSpeed=0}onDestroy(){this.clearNode.destroy(),this.scene3d.removeSelf(),this.cameraFollowScript.destroy(),Laya.timer.clearAll(this),z.UpDialogRoot.destroyChildren(),l.off(e.UseSkill,this,this.onUseSkill),l.off(e.ControlChange,this,this.onControlChange),l.off(e.FishDeath,this,this.onFishDeath),l.off(e.Revive,this,this.onRevive),l.off(e.PopImage,this,this.onPopImage),l.off(e.ScaleFish,this,this.onScaleFish),l.off(e.PopTip,this,this.onPopTip),l.off(e.BitEnd,this,this.onBitEnd)}onScaleFish(t){if(t==this.player){let e=[60,61,62,63,64,65,66,67,68,69];this.scene3d.fogRange=e[t.level-1],this.cameraFollowScript.scaleDistance(t.level)}}onFishDeath(t,i,a){if(t instanceof H){let a=this.enemyList.indexOf(t);this.enemyList.splice(a,1),t.bloodProgress&&t.bloodProgress.removeSelf(),i==this.player&&l.event(e.PlayerKill)}else if(t instanceof nt){let e=t.group.fishList.indexOf(t);t.group.fishList.splice(e,1);t.group.afterRunNum,t.group.fishList.length;Math.floor(.3*t.group.afterRunNum)}if(t instanceof at||t instanceof H)if(i)this.showKill(i.playerName,t.playerName);else{let e=this.getFakeKillerName();this.showKill(e,t.playerName)}if(t instanceof at||t instanceof H){let e=null,a=null;for(let s=0;s<this.playDataMap.length;s++){let n=this.playDataMap[s];i&&i==n.fish?a=n:t==n.fish&&(e=n)}a&&a.kill++,e.isDeath=!0,this.updateRankList(),t instanceof at?Laya.Scene.open("pages/revive.scene",!1):0==this.enemyList.length&&Laya.Scene.load("pages/count.scene",Laya.Handler.create(this,t=>{t.setData(L.Instance.myKill,L.Instance.myRank),t.open(!1)}))}(t instanceof nt||t instanceof H)&&(m.instance.finishTask(0,0,1),m.instance.finishTask(1,0,1),Laya.timer.once(a,this,()=>{let e=this.createMeatsByFish(t);if(i)for(let t=0;t<e.length;t++)e[t].fish=i;else this.meatList.push(...e);this.onRecoveryFish(t)}))}onUseSkill(t,e){if(0==t)e?(c.playSound("speedup.mp3"),this.player.startSpeedUp()):(c.stopSound("speedup.mp3"),this.player.endSpeedUp()),m.instance.finishTask(1,2,1);else if(1==t&&e){this.player.startBit(this.bitTarget)&&this.bitTarget&&!this.lockTarget&&this.setLockTarget(this.bitTarget)}}onBitEnd(){}recoverySenstive(){this.cameraFollowScript.setCameraRotateSensitive(1)}onControlChange(t,e,i){this.player.isRotating=t,this.player.rotateDir.x=e,this.player.rotateDir.y=i,t||this.player.startPitchBackToZero()}initEnemyGroup(){let e=[];for(let t=0;t<L.Instance.aiFishIdList.length;t++)e.push(`Player${L.Instance.aiFishIdList[t]+1}`);let i=[...L.Instance.aiNameList];for(let a=0;a<this.enemyNum;a++){let a=new Laya.Vector3;a.y=L.Instance.enemyY,a.x=50*Math.random()*2-50,a.z=50*Math.random()*2-50;let s=e[x.getRandom(0,e.length-1)],n=this.createFishByName(s,a,new Laya.Vector3,H);n.bloodProgress||(n.bloodProgress=new t.pages.bloodUI,n.bloodProgress.scaleX=.5,n.bloodProgress.scaleY=.5);let o=i.splice(x.getRandom(0,i.length-1),1)[0];n.playerName=o,n.initData(this.getFishData(s)),z.GameUIRoot.addChild(n.bloodProgress),this.enemyList.push(n),n.fishAI.playerTransform=this.player.gameObject.transform,this.playDataMap.push({fish:n,name:o,isDeath:!1,isMe:!1,kill:0,index:0})}}initEnemyPointer(){for(let t=0;t<this.enemyList.length;t++){let e=this.enemyList[t],i=new Laya.Image("play/Ui_DiRen.png"),a=new Laya.Image("play/Ui_DiRen2.png");i.pivotX=i.pivotY=41,a.pivotX=14,a.pivotY=-43,a.x=41,a.y=41,i.addChild(a),this.enemyPointerMap.set(e,{ball:i,arrow:a}),z.GameUIRoot.addChild(i)}}updateEnemyPointerPos(t){this.enemyPointerMap.forEach((e,i)=>{i==t?this.setPointerPosAndRot(e.ball,e.arrow,i.gameObject.transform.position):(e.arrow.visible=!1,e.ball.visible=!1)})}updateMapBlockByNameList(){for(let t=0;t<this.mapBlockCreateInfo.readyShow.length;t++){let e=this.mapBlockCreateInfo.readyShow[t],i=this.mapBlockCreateInfo.readyShow[t].split("_"),a=Number(i[0]),s=Number(i[1]),n=null,o=this.getPositionByBlockPos(a,s);this.mapBlockHideList.length>0?(n=this.mapBlockHideList.shift(),this.clearNode.addChild(n)):((n=Laya.Sprite3D.instantiate(this.mapBlockPrefab,this.clearNode)).active=!0,this.mapBlockCreateList.push(n)),n.transform.position=o,this.mapBlockShowMap.set(e,n),this.mapBlockCreateInfo.alreadyShow.push(e)}for(let t=0;t<this.mapBlockCreateInfo.readyHide.length;t++){let e=this.mapBlockCreateInfo.readyHide[t],i=this.mapBlockShowMap.get(e);i.removeSelf(),this.mapBlockShowMap.delete(e),this.mapBlockHideList.push(i);let a=this.mapBlockCreateInfo.alreadyShow.indexOf(e);this.mapBlockCreateInfo.alreadyShow.splice(a,1)}}updateMapColliderByNameList(){for(let t=0;t<this.mapBlockCreateInfo.readyShow.length;t++){let e=this.mapBlockCreateInfo.readyShow[t],i=this.mapBlockCreateInfo.readyShow[t].split("_"),a=Number(i[0]),s=Number(i[1]),n=null,o=this.getPositionByBlockPos(a,s);n=this.mapColliderHideList.length>0?this.mapColliderHideList.shift():this.createColliderList(),this.updatePosByMapBlockPos(o,n),this.mapColliderShowMap.set(e,n)}for(let t=0;t<this.mapBlockCreateInfo.readyHide.length;t++){let e=this.mapBlockCreateInfo.readyHide[t],i=this.mapColliderShowMap.get(e);this.mapColliderShowMap.delete(e),this.mapColliderHideList.push(i)}}updateBombAreaByNameList(){for(let t=0;t<this.mapBlockCreateInfo.readyShow.length;t++){let e=this.mapBlockCreateInfo.readyShow[t],i=this.mapBlockCreateInfo.readyShow[t].split("_"),a=Number(i[0]),s=Number(i[1]),n=null,o=this.getPositionByBlockPos(a,s);n=this.mapBombAreaHideList.length>0?this.mapBombAreaHideList.shift():this.createBombAreaList(),this.updatePosByMapBlockPos(o,n),this.mapBombAreaShowMap.set(e,n)}for(let t=0;t<this.mapBlockCreateInfo.readyHide.length;t++){let e=this.mapBlockCreateInfo.readyHide[t],i=this.mapBombAreaShowMap.get(e);this.mapBombAreaShowMap.delete(e),this.mapBombAreaHideList.push(i);for(let t=0;t<i.length;t++){let e=i[t],a=this.bombMap.get(e);if(this.bombMap.delete(e),a&&a.length>0){this.bombLeft+=a.length;for(let t=0;t<a.length;t++){let e=a[t];e.gameObject.removeSelf(),Laya.Pool.recover(e.gameObject.name,e)}}}}}updateRefreshBomb(){if(this.bombLeft>0){let t=this.getRandomSolutionList(this.mapBlockCreateInfo.readyShow.length,this.bombLeft);for(let e=0;e<this.mapBlockCreateInfo.readyShow.length;e++){let i=t[e];if(0==i)break;let a=this.mapBlockCreateInfo.readyShow[e],s=this.mapBombAreaShowMap.get(a),n=this.getRandomSolutionList(s.length,i);for(let t=0;t<n.length;t++){let e=n[t];if(0==e)break;let i=s[t],a=this.bombMap.get(i);a||(a=[],this.bombMap.set(i,a)),this.bombLeft-=e;for(let t=0;t<e;t++){let t=this.createBomb();t.gameObject.transform.position=this.getRandomPosInSpace(i.pos,i.length,i.width,i.height),a.push(t)}}}}}updateMapSafeAreaByNameList(){for(let t=0;t<this.mapBlockCreateInfo.readyShow.length;t++){let e=this.mapBlockCreateInfo.readyShow[t],i=this.mapBlockCreateInfo.readyShow[t].split("_"),a=Number(i[0]),s=Number(i[1]),n=null,o=this.getPositionByBlockPos(a,s);n=this.mapSafeAreaHideList.length>0?this.mapSafeAreaHideList.shift():this.createSafeAreaList(),this.updatePosByMapBlockPos(o,n.low),this.updatePosByMapBlockPos(o,n.middle),this.updatePosByMapBlockPos(o,n.high),this.mapSafeAreaShowMap.set(e,n)}for(let t=0;t<this.mapBlockCreateInfo.readyHide.length;t++){let e=this.mapBlockCreateInfo.readyHide[t],i=this.mapSafeAreaShowMap.get(e);this.mapSafeAreaShowMap.delete(e),this.mapSafeAreaHideList.push(i)}}updateRandomSafeAreaList(){for(let t=0;t<this.mapBlockCreateInfo.readyHide.length;t++){let e=this.mapBlockCreateInfo.readyHide[t],i=this.selectSafeAreaShowMap.get(e);i&&(this.selectSafeAreaShowMap.delete(e),this.safeLeft+=i.low.length+i.middle.length+i.high.length,this.refreshAreaInfo.readyHideArea.low.push(...i.low),this.refreshAreaInfo.readyHideArea.middle.push(...i.middle),this.refreshAreaInfo.readyHideArea.high.push(...i.high))}if(this.safeLeft>0){let t=this.getRandomSolutionList(this.mapBlockCreateInfo.readyShow.length,this.safeLeft),e=L.Instance.lowData.boxList.length+L.Instance.middleData.boxList.length+L.Instance.highData.boxList.length;for(let i=0;i<this.mapBlockCreateInfo.readyShow.length;i++){let a=t[i];if(0==a)break;a=a<e?a:e;let s=this.mapBlockCreateInfo.readyShow[i],n=this.mapSafeAreaShowMap.get(s),o={low:[],middle:[],high:[]},h=this.getRandomSolutionList(3,a);for(let t=0;t<h.length;t++){let e=h[t];if(0==e)break;if(0==t)for(let t=0;t<e;t++)o.high.push(n.high[t]);else if(1==t)for(let t=0;t<e;t++)o.middle.push(n.middle[t]);else if(2==t)for(let t=0;t<e;t++)o.low.push(n.low[t])}this.selectSafeAreaShowMap.set(s,o),this.refreshAreaInfo.readyRefreshArea.low.push(...o.low),this.refreshAreaInfo.readyRefreshArea.middle.push(...o.middle),this.refreshAreaInfo.readyRefreshArea.high.push(...o.high)}this.safeLeft=0}}getPositionByBlockPos(t,e){let i=new Laya.Vector3;return i.x=t*this.blockWidth,i.z=e*this.blockHeight+this.blockHeight/2,i}updateMapBlockInfoByBlockPos(){let t=this.playerBlockPos.x-1,e=this.playerBlockPos.y-1,i=[...this.mapBlockCreateInfo.alreadyShow];for(let a=0;a<3;a++){let s=t+a;for(let t=0;t<3;t++){let a=`${s}_${e+t}`,n=i.indexOf(a);-1==n?this.mapBlockCreateInfo.readyShow.push(a):i.splice(n,1)}}this.mapBlockCreateInfo.readyHide=i,this.mapBlockCreateInfo.readyShow.length>0||this.mapBlockCreateInfo.readyHide.length}updatePlayerMapPos(){let t=this.player.gameObject.transform.position,e=Math.sign(t.x),i=Math.sign(t.z);this.playerBlockPos.x=Math.ceil((Math.abs(t.x)-this.blockWidth/2)/this.blockWidth)*e,this.playerBlockPos.y=Math.ceil((Math.abs(t.z)-this.blockHeight/2)/this.blockHeight)*i}mapCollisionDetect(t){t.updateBodyPoint();let e=!1;this.mapColliderShowMap.forEach((i,a)=>{for(let a=0;a<i.length;a++){if(i[a].pointInCollider(t.headPoint))return t.setHitMap(!0),void(e=!0)}}),e||t.setHitMap(!1)}fishCollisionDetect(t){t.updateBodyPoint();let e=!1;for(let i=0;i<=this.enemyList.length;i++){let a=this.enemyList[i];if(i==this.enemyList.length&&(a=this.player),a!=t&&t.inBit&&a.pointInCollider(t.headPoint,t.headRadius*t.fishScale,.5*t.fishScale))return t.setHitFish(!0),e=!0,void t.startAttack(a)}let i=this.potentialAttackGroup.get(t);if(i&&i.length>0)for(let a=0;a<i.length;a++){let s=i[a];for(let i=0;i<s.fishList.length;i++){let a=s.fishList[i];if(t.inBit&&a.pointInCollider(t.headPoint,t.headRadius*t.fishScale,.5*t.fishScale))return t.setHitFish(!0),e=!0,void t.startAttack(a)}}e||t.setHitFish(!1)}createColliderList(){let t=[],e=L.Instance.mapData.cylinderList;if(e&&e.length>0)for(let i=0;i<e.length;i++){let a=this.createCollider(0,e[i]);t.push(a)}let i=L.Instance.mapData.boxList;if(i&&i.length>0)for(let e=0;e<i.length;e++){let a=this.createCollider(1,i[e]);t.push(a)}let a=L.Instance.mapData.ballList;if(a&&a.length>0)for(let e=0;e<a.length;e++){let i=this.createCollider(2,a[e]);t.push(i)}return t}createSafeAreaList(){let t=[],e=[],i=[],a=L.Instance.lowData.boxList,s=L.Instance.middleData.boxList,n=L.Instance.highData.boxList;if(a&&a.length>0)for(let e=0;e<a.length;e++){let i=this.createCollider(1,a[e]);t.push(i)}if(s&&s.length>0)for(let t=0;t<s.length;t++){let i=this.createCollider(1,s[t]);e.push(i)}if(n&&n.length>0)for(let t=0;t<n.length;t++){let e=this.createCollider(1,n[t]);i.push(e)}return{low:t,middle:e,high:i}}createBombAreaList(){let t=[],e=L.Instance.bombData.boxList;if(e&&e.length>0)for(let i=0;i<e.length;i++){let a=this.createCollider(1,e[i]);t.push(a)}return t}createCollider(t,e){return 0==t?new it(e):1==t?new J(e):2==t?new ot(e):void 0}updatePosByMapBlockPos(t,e){for(let i=0;i<e.length;i++){let a=e[i];a.pos.x=a.originalPos.x+t.x,a.pos.y=a.originalPos.y+t.y,a.pos.z=a.originalPos.z+t.z}}createFishByName(t,e,i,a){let s=t+".lh",n=Laya.Pool.getItem(t);if(n)if(n.gameObject.transform.position=e,n.gameObject.transform.rotationEuler=i,n instanceof a)this.clearNode.addChild(n.gameObject);else{let t=n.gameObject;n.destroy(),n=t.addComponent(a),this.clearNode.addChild(t)}else{let t=c.getRes(s),o=Laya.Sprite3D.instantiate(t,this.clearNode);o.transform.position=e,o.transform.rotationEuler=i,n=o.addComponent(a)}let o=L.Instance.getBodyInfoByName(t);return n.setFishInfo(o[0],o[1]),n}getFishData(t,e=!1){let i=JSON.parse(JSON.stringify(L.Instance.getFishConfigDataByName(t)));return e?(i.atk+=L.Instance.strengthData.atk,i.atkGap+=L.Instance.strengthData.atkGap,i.hp+=L.Instance.strengthData.hp,i.energy+=L.Instance.strengthData.energy,i.mSpeed+=L.Instance.strengthData.mSpeed):(i.atk=i.atk*L.Instance.divisionPropertyAdd*L.Instance.fightPropertyAdd,i.hp=i.hp*L.Instance.divisionPropertyAdd*L.Instance.fightPropertyAdd,m.instance.matchCount<3&&(i.atkGap=3*i.atkGap)),i}onRecoveryFish(t){t.gameObject.removeSelf(),Laya.Pool.recover(t.gameObject.name,t)}getRandomPosInSpace(t,e,i,a){let s=t.x-e/2,n=t.y-a/2,o=t.z-i/2,h=new Laya.Vector3;return h.x=s+Math.random()*e,h.y=n+Math.random()*a,h.z=o+Math.random()*i,h}createFishGroup(t,e,i,a){let s=[],n=this.getRandomPosInSpace(e.pos,e.length,e.width,e.height),o={safeArea:e,originalNum:t,afterRunNum:t,size:a,center:n,fishList:s},h=0;"Enemy1"==i?h=1:"Enemy5"!=i&&"Enemy6"!=i||(h=2);for(let e=0;e<t;e++){let t=null;(t=1==h?this.getRandomPosInSpace(n,a,a,0):this.getRandomPosInSpace(n,a,a,a)).y>=L.Instance.safeY&&(t.y=L.Instance.safeY-1);let e=this.createFishByName(i,t,new Laya.Vector3,nt);e.initData(null),0==h||2==h?e.fishAI.moveType=x.getRandom(0,2):1==h&&(e.fishAI.moveType=3),e.fishClass=h,e.setGroup(o),s.push(e)}return o}createMeatsByFish(t){t.updateBodyPoint();let e=1,i=["Meat1"];(t instanceof H||t instanceof at)&&(e=2*t.level+2,i=["Meat2","Meat3"]),e=e<16?e:16;let a=[];for(let s=0;s<e;s++){let e=i[x.getRandom(0,i.length-1)],s=Laya.Pool.getItem(e);if(s)this.clearNode.addChild(s.gameObject);else{let t=c.getRes(e+".lh");s=Laya.Sprite3D.instantiate(t,this.clearNode).addComponent(O)}s.reset();let n=this.getRandomPointBetween(t.headPoint,t.back,t.bodyLength);n.y=n.y-t.bodyRadius+2*t.bodyRadius*Math.random(),s.gameObject.transform.position=n,a.push(s)}return a}createBomb(){let t=Laya.Pool.getItem("Mine");if(t)this.clearNode.addChild(t.gameObject);else{let e=c.getRes("Mine.lh").clone();t=e.addComponent(N),this.clearNode.addChild(e)}return t.isExplode=!1,t}getRandomPointBetween(t,e,i){let a=new Laya.Vector3;return Laya.Vector3.scale(e,Math.random()*i,a),Laya.Vector3.add(t,a,a),a}getRandomPosInBall(t,e){let i=t.x-e+2*e*Math.random(),a=t.y-e+2*e*Math.random(),s=t.z-e+2*e*Math.random(),n=new Laya.Vector3,o=Math.random()*e,h=Math.sqrt(i*i+a*a+s*s);return n.x=t.x+o*i/h,n.y=t.y+o*a/h,n.z=t.z+o*s/h,n}fishEatMeat(t){t.updateBodyPoint();for(let e=0;e<this.meatList.length;e++){let i=this.meatList[e];Laya.Vector3.distance(t.headPoint,i.gameObject.transform.position)<=5&&!i.fish&&i.setFish(t)}}updatePotentialGroupFish(t){let e=this.potentialAttackGroup.get(t);t.updateBodyPoint(),this.fishGroupList.forEach(i=>{Laya.Vector3.distance(t.headPoint,i.center)<=i.size/2+10&&-1==e.indexOf(i)&&e.push(i)});for(let i=0;i<e.length;){let a=e[i];Laya.Vector3.distance(t.headPoint,a.center)>a.size/2+20?e.splice(i,1):i++}}updateEnemyWantFishGroup(t){t&&!t.fishAI.isSelectFishGroup&&1==t.fishAI.enemyFishState&&this.fishGroupList.forEach((e,i)=>{let a=e;Laya.Vector3.distance(t.headPoint,a.center)<1e8&&t.fishAI.setSelectFishGroup(a.center)})}getRandomSolutionList(t,e){let i=[];for(let e=0;e<t;e++)i.push(0);let a=0;for(;e>0;)i[a]++,e--,a++,a%=t;return i}recoveryGroupFish(t){let e=this.fishGroupList.get(t);if(e){for(let t=0;t<e.fishList.length;t++){let i=e.fishList[t];this.onRecoveryFish(i)}this.fishGroupList.delete(t)}}updateFishGroup(){let t=["Enemy1"],e=["Enemy3","Enemy5"],i=["Enemy2","Enemy4","Enemy6"];for(let t=0;t<this.refreshAreaInfo.readyHideArea.low.length;t++)this.recoveryGroupFish(this.refreshAreaInfo.readyHideArea.low[t]);for(let t=0;t<this.refreshAreaInfo.readyHideArea.middle.length;t++)this.recoveryGroupFish(this.refreshAreaInfo.readyHideArea.middle[t]);for(let t=0;t<this.refreshAreaInfo.readyHideArea.high.length;t++)this.recoveryGroupFish(this.refreshAreaInfo.readyHideArea.high[t]);this.refreshAreaInfo.readyHideArea.low=[],this.refreshAreaInfo.readyHideArea.middle=[],this.refreshAreaInfo.readyHideArea.high=[];for(let e=0;e<this.refreshAreaInfo.readyRefreshArea.low.length;e++){let i=this.refreshAreaInfo.readyRefreshArea.low[e],a=this.createFishGroup(20,i,t[x.getRandom(0,t.length-1)],10);this.fishGroupList.set(i,a)}for(let t=0;t<this.refreshAreaInfo.readyRefreshArea.middle.length;t++){let i=this.refreshAreaInfo.readyRefreshArea.middle[t],a=this.createFishGroup(20,i,e[x.getRandom(0,e.length-1)],10);this.fishGroupList.set(i,a)}for(let t=0;t<this.refreshAreaInfo.readyRefreshArea.high.length;t++){let e=this.refreshAreaInfo.readyRefreshArea.high[t],a=this.createFishGroup(20,e,i[x.getRandom(0,i.length-1)],10);this.fishGroupList.set(e,a)}this.refreshAreaInfo.readyRefreshArea.low=[],this.refreshAreaInfo.readyRefreshArea.middle=[],this.refreshAreaInfo.readyRefreshArea.high=[]}setPointerPosAndRot(t,e,i){let a=R.convert3DTo2DPosition(this.camera,this.player.gameObject.transform.position);if(!a)return t.visible=!1,void(e.visible=!1);let s=a.x,n=a.y,o=R.convert3DTo2DPosition(this.camera,i);if(!o)return t.visible=!1,void(e.visible=!1);let h=o.x,r=o.y;if(!(h<0||h>Laya.stage.width||r<0||r>Laya.stage.height))return t.visible=!1,void(e.visible=!1);t.visible=!0,e.visible=!0;t.x=h<90?90:h,t.x=t.x>Laya.stage.width-90?Laya.stage.width-90:t.x,t.y=r<90?90:r,t.y=t.y>Laya.stage.height-90?Laya.stage.height-90:t.y;let l=(Math.atan2(r-n,h-s)-Math.PI/2)*x.rad2Deg;e.rotation=l}judgeCameraCollisionMap(){this.cameraFollowScript&&this.mapColliderShowMap.forEach((t,e)=>{for(let e=0;e<t.length;e++){if(t[e].pointInCollider(this.camera.transform.position))return this.cameraFollowScript.setHitMap(!0,!1),void Laya.timer.once(2e3,this,this.setHitMapFalse,null,!0)}})}setHitMapFalse(){this.cameraFollowScript.setHitMap(!1,!1)}updateFishGroupCenter(){for(const t of this.fishGroupList.keys()){let e=this.debugBallMap.get(t),i=this.fishGroupList.get(t);e||(e=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(.5)),this.clearNode.addChild(e),this.debugBallMap.set(t,e)),e.transform.position=i.center.clone()}}fishGroupRun(t){let e=this.getRunCenter(t.center,t.safeArea),i=new Laya.Vector3;Laya.Vector3.subtract(e,t.center,i);let a=Laya.Vector3.distance(t.center,e);for(let s=0;s<t.fishList.length;s++){let n=t.fishList[s];n.isDeath||n.fishAI.startFastRun(e,i,a)}}getRunCenter(t,e){let i=new Laya.Vector3;i.y=t.y;let a=0;return e.width>e.length&&(a=1),0==a?(t.x<=e.pos.x?i.x=e.pos.x-e.halfLength:i.x=e.pos.x+e.halfLength,i.z=e.pos.z-e.halfWidth+Math.random()*e.width):(t.z<=e.pos.z?i.z=e.pos.z-e.halfWidth:i.z=e.pos.z+e.halfWidth,i.x=e.pos.x-e.halfLength+Math.random()*e.length),i}updateTargetInRadius(t,i){this.bitTarget=null;let a=[];this.player.updateHeadPoint();for(let e=0;e<3;e++){let s=null;0==e?(s=this.getClosetEnemy(t,1),this.updateEnemyPointerPos(s.closetTarget)):1==e?s=this.getClosetGroupFish(t,1):2==e&&(s=this.getClosetBomb(t,1)),s.closetDis<=i&&a.push(s)}if(a.length>0&&(a.sort((t,e)=>t.closetDis-e.closetDis),this.bitTarget=a[0].closetTarget),this.bitTarget&&!this.lockTarget){let t=this.bitTarget.gameObject.transform.position;this.bitTarget instanceof nt&&(this.bitTarget.updateHeadPoint(),t=this.bitTarget.headPoint);let i=!1;this.lastTarget!=this.bitTarget&&(i=!0,this.lastTarget=this.bitTarget),l.event(e.TargetPointer,[!0,R.convert3DTo2DPosition(this.camera,t),i])}}updataLockTarget(){if(!this.lockTarget)return;if(this.lockTarget instanceof N){if(this.lockTarget.isExplode)return void this.setLockTarget(null)}else if(this.lockTarget instanceof V&&this.lockTarget.isDeath)return void this.setLockTarget(null);let t=this.lockTarget.gameObject.transform.position;this.lockTarget instanceof nt&&(this.lockTarget.updateHeadPoint(),t=this.lockTarget.headPoint),l.event(e.TargetPointer,[!0,R.convert3DTo2DPosition(this.camera,t),!1]);let i=this.lookTargetNode.transform.position,a=this.lockTarget.gameObject.transform.position;this.lookTarget.x=2*i.x-a.x,this.lookTarget.y=2*i.y-a.y,this.lookTarget.z=2*i.z-a.z,this.lookTargetNode.transform.lookAt(this.lookTarget,this.upVec,!1),this.player.followRotateSpeed=.5*this.player.normalRotateSpeed,this.player.setFollowPoint(this.lockTarget.gameObject.transform.position)}clearLockTarget(){if(!this.lockTarget)return;let t=this.lockTarget.gameObject.transform.position.x-this.player.gameObject.transform.position.x,e=this.lockTarget.gameObject.transform.position.z-this.player.gameObject.transform.position.z;Math.sqrt(t*t+e*e)>15&&this.setLockTarget(null)}getClosetEnemy(t,e){t.updateHeadPoint();let i=1e5,a=null;for(let s=0;s<=this.enemyList.length;s++){let n=this.enemyList[s];if(s==this.enemyList.length&&(n=this.player),t==n)continue;n.updateHeadPoint();let o=Laya.Vector3.distance(n.headPoint,t.headPoint);R.convertWorldToCameraProjection(this.camera,n.headPoint).w<e||o<=i&&(i=o,a=n)}return{closetTarget:a,closetDis:i}}getClosetGroupFish(t,e){t.updateHeadPoint();let i=1e5,a=null,s=this.potentialAttackGroup.get(t);if(s&&s.length>0)for(let n=0;n<s.length;n++){let o=s[n];for(let s=0;s<o.fishList.length;s++){let n=o.fishList[s];n.updateHeadPoint();let h=Laya.Vector3.distance(n.headPoint,t.headPoint);R.convertWorldToCameraProjection(this.camera,n.headPoint).w<e||h<=i&&(i=h,a=n)}}return{closetTarget:a,closetDis:i}}getClosetBomb(t,e){t.updateHeadPoint();let i=1e5,a=null;for(const s of this.bombMap.values())for(let n=0;n<s.length;n++){let o=s[n],h=Laya.Vector3.distance(o.gameObject.transform.position,t.headNode.transform.position);R.convertWorldToCameraProjection(this.camera,o.gameObject.transform.position).w<e||h<=i&&(i=h,a=o)}return{closetTarget:a,closetDis:i}}updateFishCollisionBomb(t){for(const e of this.bombMap.values())for(let i=0;i<e.length;i++){let a=e[i];if(Laya.Vector3.distance(a.gameObject.transform.position,t.headNode.transform.position)<=t.headRadius+L.Instance.bombRadius){e.splice(i,1);let t=a.setBombExplode();a.gameObject.removeSelf(),Laya.Pool.recover(a.gameObject.name,a);for(let e=0;e<this.enemyList.length+1;e++){let i=this.enemyList[e];if(e==this.enemyList.length&&(i=this.player),Laya.Vector3.distance(i.headNode.transform.position,t.transform.position)<=i.headRadius+L.Instance.bombExplodeRadius){let t=.7*i.originalFishData.hp;b.Instance.guideFinish||(t=.1*i.originalFishData.hp),i.onHurt(null,t)}}return void this.bombLeft++}}}transferEnemyFishToNearPlayer(t){if(this.player.updateHeadPoint(),t.updateHeadPoint(),Laya.Vector3.distance(t.headPoint,this.player.headPoint)>60){let e=new Laya.Vector3,i=Math.random()*Math.PI*2;e.x=55*Math.cos(i)+this.player.gameObject.transform.position.x,e.z=55*Math.sin(i)+this.player.gameObject.transform.position.z,e.y=L.Instance.enemyY,t.gameObject.transform.position=e}}updateEnemyBloodPos(t){if(t.bloodProgress){t.gameObject.transform.position.y+=1;let e=R.convert3DTo2DPosition(this.camera,t.gameObject.transform.position);if(!e)return void(t.bloodProgress.visible=!1);t.bloodProgress.visible=!0,t.bloodProgress.x=e.x,t.bloodProgress.y=e.y}}updateEnemyAttackTarget(t){t.fishAI.hasAttackThink&&t.fishAI.setAttackTarget(this.player)}onRevive(t){t?(c.playSound("revive.mp3"),this.player.animator.play("Run",0,0),this.player.isDeath=!1,this.player.setGod(!0),this.player.addHp(this.player.originalFishData.hp),this.rankData.isDeath=!1,this.updateRankList()):Laya.Scene.load("pages/count.scene",Laya.Handler.create(this,t=>{t.setData(L.Instance.myKill,L.Instance.myRank+1),t.open(!1)}))}playGuluSound(){Laya.timer.frameLoop(1e4,this,()=>{let t="gulu1.mp3";Math.random()<.5&&(t="gulu2.mp3"),c.playSound(t)})}popKill(e,i,a,s){e.y+=1;let n=this.convert3DTo2DPosition(e),o="hpPop";1==i&&(o="expPop");let h=Laya.Pool.getItem(o);h||(h=0==i?new t.pages.hpPopUI:new t.pages.expPopUI),0==i&&(s?(h.scaleX=.6,h.scaleY=.6,h.hpImg.skin=""):(h.scaleX=1,h.scaleY=1,h.hpImg.skin="play/Ui_HP5.png"),h.hpValue.value="-"+Math.floor(a)),h.x=n.x,h.y=n.y,z.GameUIRoot.addChild(h),h.ani1.play(),h.ani1.on(Laya.Event.COMPLETE,this,()=>{h.removeSelf(),h instanceof t.pages.hpPopUI?Laya.Pool.recover("hpPop",h):Laya.Pool.recover("expPop",h)})}onPopImage(t,e,i,a){this.popKill(t,e,i,a)}onPopTip(t,e){let i=new Laya.Image;if(i.anchorX=i.anchorY=.5,"体力不足"==t)i.skin="pop/Ui_NoTili.png";else if("升级"==t){i.skin="pop/Ui_LvUpTips.png";let t=new Laya.FontClip("main/Num1.png","0123456789+-X()./");t.x=877,t.centerY=-3,t.value=e+"",i.addChild(t)}i.width=1600,i.height=41,i.x=Laya.stage.width/2,i.y=Laya.stage.height/2,z.UpDialogRoot.addChild(i),Laya.timer.once(800,this,()=>{Laya.Tween.to(i,{y:Laya.stage.height/2-100,alpha:0},500,Laya.Ease.expoIn,Laya.Handler.create(this,()=>{i.destroy()}))})}autoDie(){let t=()=>{if(this.enemyList.length<=1)return void Laya.timer.clear(this,t);let e=null;for(let t=0;t<this.enemyList.length;t++){let i=this.enemyList[t];Laya.Vector3.distance(this.player.gameObject.transform.position,i.gameObject.transform.position)>0&&(e=i)}e&&e.onHurt(null,e.curHp)};Laya.timer.loop(3e4,this,t)}showKill(t,e){this.readyShowKill.push([t,e]),1!=this.readyShowKill.length||this.isShowKilling||this.addKillImage()}addKillImage(){if(0==this.readyShowKill.length)return;this.isShowKilling=!0;let e=this.readyShowKill.shift(),i=new t.pages.killTipUI;i.player1Name.text=e[0],i.player2Name.text=e[1],i.x=Laya.stage.width,i.y=150,z.UpDialogRoot.addChild(i),this.moveKill(i)}moveKill(t){Laya.Tween.to(t,{x:(Laya.stage.width-t.width)/2},500,Laya.Ease.sineOut);let e={progress:0},i=[];for(let t=0;t<this.killImageList.length;t++)i.push(this.killImageList[t].y);Laya.Tween.to(e,{progress:1,update:Laya.Handler.create(this,()=>{for(let t=0;t<this.killImageList.length;t++)this.killImageList[t].y=i[t]-50*e.progress},null,!1)},500,Laya.Ease.sineOut,Laya.Handler.create(this,()=>{this.killImageList.push(t),this.isShowKilling=!1,Laya.timer.once(2500,this,()=>{let e=this.killImageList.indexOf(t);this.killImageList.splice(e,1),console.log(t,e),t&&t.destroy()}),this.addKillImage()}))}getFakeKillerName(){let t="我自己";for(let e=0;e<this.enemyList.length;e++){t=this.enemyList[0].playerName;break}return t}}class rt extends t.pages.playUI{constructor(){super(...arguments),this.fingerDownPoint=new Laya.Vector2,this.fingerMovePoint=new Laya.Vector2,this.triggerMoveThreshold=0,this.joyMoveMax=140,this.fingerMoveDir=new Laya.Vector2,this.curExp=0,this.curLevel=1,this.progressCurExp=0,this.progressCurHp=0,this.progressCurLevel=1,this.progressFullExp=0,this.tweenTarget={progress:0},this.rankDataList=[],this.killRec=0,this.gameSceneLogic=null,this.initY=0,this.fishPointer=null,this.fullDeg=0,this.expTweenTarget={progress:0}}onAwake(){this.eventBox.width=Laya.stage.width,this.eventBox.height=Laya.stage.height,this.rankList.vScrollBarSkin=null,this.initRankDataList(null),l.on(e.PlayerUpdateHp,this,this.onPlayerUpdateHp),l.on(e.UpdateRank,this,this.onUpdateRank),l.on(e.UpdateEnergy,this,this.onUpdateEnergy),L.Instance.init();let t=c.getRes("Scene1.ls"),i=c.getRes("MainCamera.lh");i.transform.position=new Laya.Vector3,i.transform.localRotationEuler=new Laya.Vector3,t.addChild(i),z.GameSceneRoot.addChild(t),this.gameSceneLogic=t.getComponent(ht),this.gameSceneLogic&&this.gameSceneLogic.destroy(),this.gameSceneLogic=t.addComponent(ht),this.speedBtn.on(Laya.Event.MOUSE_DOWN,this,this.onBtnClick),this.speedBtn.on(Laya.Event.MOUSE_UP,this,this.onBtnClick),this.speedBtn.on(Laya.Event.MOUSE_OUT,this,this.onBtnClick),this.biteBtn.on(Laya.Event.MOUSE_DOWN,this,this.onBtnClick),this.biteBtn.on(Laya.Event.MOUSE_UP,this,this.onBtnClick),this.pauseBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.controlEventBox.on(Laya.Event.MOUSE_DOWN,this,this.onStageEvent),this.controlEventBox.on(Laya.Event.MOUSE_MOVE,this,this.onStageEvent),this.controlEventBox.on(Laya.Event.MOUSE_UP,this,this.onStageEvent),this.clearLevelProgress(),l.on(e.PlayerAddExp,this,this.onPlayerAddExp),l.on(e.TargetPointer,this,this.onTargetPointer),l.on(e.PlayerKill,this,this.onPlayerKill),l.on(e.PlayerUpLevel,this,this.onPlayerUpLevel),this.skillBarMask.graphics.clear(),this.skillBarMask.graphics.drawPie(62,62,62,90,360,"#ff0000","#ff0000",0),this.initPlayerKill(),this.initY=574/720*Laya.stage.height,this.joyStick.x=164,this.joyStick.y=this.initY,this.joyStickInner.x=164,this.joyStickInner.y=this.initY,l.on(b.NEWGUIDETASK,this,this.onNewGuideTask),b.Instance.setTalkBottom(0),b.Instance.showGuide("进入战斗界面",null),c.loadSpines(["Quan.sk"]).then(t=>{this.fishPointer=t[0],this.fishPointer.scaleX=.5,this.fishPointer.scaleY=.5,this.fishPointer.pos(Laya.stage.width/2,Laya.stage.height/2),this.addChild(this.fishPointer),this.fishPointer.visible=!1})}onNewGuideTask(t){if("引导虚拟摇杆"==t){b.Instance.showGuide(t,[this.controlEventBox]);let e=new Laya.Point(this.joyStick.width/2,this.joyStick.height/2);this.joyStick.localToGlobal(e,!1),b.Instance.setHandPos(e),b.Instance.setTalkAlign("right")}else"引导攻击按钮"==t?(b.Instance.showGuide(t,[this.biteBtn]),b.Instance.setTalkAlign("left")):"锁定鱼"==t?(b.Instance.finishDelay=1e3,b.Instance.showGuide(t,null)):"引导技能按钮"==t?b.Instance.showGuide(t,[this.speedBtn]):"返回主界面"==t&&(this.controlEventBox.zOrder=0,b.Instance.hideGuide())}onPlayerUpLevel(t){this.levelNum.value=t+""}initPlayerKill(){this.killBg.visible=!1,this.killRec=0,this.killNum.value=this.killRec+""}onPlayerKill(){this.killBg.visible=!0,this.killRec++,this.killNum.value=this.killRec+"",Laya.timer.once(2e3,this,()=>{this.killBg.visible=!1})}onPlayerUpdateHp(t,e){this.tweenTarget.progress=0;let i=this.progressCurHp,a=t-this.progressCurHp;Laya.Tween.to(this.tweenTarget,{progress:1,update:Laya.Handler.create(this,()=>{this.progressCurHp=i+a*this.tweenTarget.progress;let t=this.progressCurHp/e;t=t<1?t:1,this.playHpImage.skin=t<=.2?"play/Ui_HP4.png":t<=.5?"play/Ui_HP3.png":"play/Ui_HP2.png",this.hpMask.graphics.clear(),this.hpMask.graphics.drawRect(0,0,412*t,23,"#ff0000","#ff0000",0)},null,!1)},500,Laya.Ease.sineOut,null,0,!0)}initRankDataList(t){for(let e=0;e<8;e++)t?(this.rankDataList[e].name=t[e].name,this.rankDataList[e].isDeath=t[e].isDeath,this.rankDataList[e].isMe=t[e].isMe):this.rankDataList.push({index:e,isDeath:!1,isMe:!1,name:""});this.rankList.array=this.rankDataList,this.rankList.refresh()}onUpdateRank(t){this.initRankDataList(t)}onOpened(){Laya.MouseManager.enabled=!0,c.playMusic("BattleBGM.mp3")}onDestroy(){Laya.Tween.clearAll(this.tweenTarget),l.off(e.PlayerAddExp,this,this.onPlayerAddExp),l.off(e.UpdateEnergy,this,this.onUpdateEnergy),l.off(e.UpdateRank,this,this.onUpdateRank),l.off(e.TargetPointer,this,this.onTargetPointer),l.off(e.PlayerUpdateHp,this,this.onPlayerUpdateHp),l.off(e.PlayerKill,this,this.onPlayerKill),l.off(e.PlayerUpLevel,this,this.onPlayerUpLevel),l.off(b.NEWGUIDETASK,this,this.onNewGuideTask)}onTargetPointer(t,e,i){if(this.fishPointer)if(t){if(!e)return void(this.fishPointer.visible=!1);this.fishPointer.visible=!0,i&&this.fishPointer.play(0,!1),this.fishPointer.x=e.x,this.fishPointer.y=e.y}else this.fishPointer.visible=!1}onUpdateEnergy(t,e){this.skillBarMask.graphics.clear(),e<=30?(this.fullDeg=54,this.blueBg.skin="play/Ui_Strength1.png"):e<=60?(this.fullDeg=108,this.blueBg.skin="play/Ui_Strength2.png"):e<=90?(this.fullDeg=162,this.blueBg.skin="play/Ui_Strength3.png"):e<=120?(this.fullDeg=216,this.blueBg.skin="play/Ui_Strength4.png"):(this.fullDeg=270,this.blueBg.skin="play/Ui_Strength5.png"),this.skillBarMask.graphics.drawPie(62,62,62,90,90+this.fullDeg*t/e,"#ff0000","#ff0000",0),this.speedBtn.gray=0==t}onPlayerAddExp(t){if(10==this.curLevel)return;this.curExp+=t;let i=this.getTotalExp(this.curLevel);this.curExp>=i&&(this.curLevel++,c.playSound("uplevel.mp3"),l.event(e.PopTip,["升级",this.curLevel]));let a=this.progressCurExp,s=this.curExp;this.expTweenTarget.progress=0,console.log(a,s),Laya.Tween.to(this.expTweenTarget,{progress:1,update:Laya.Handler.create(this,()=>{this.progressCurExp=a+(s-a)*this.expTweenTarget.progress;let t=this.getTotalExp(this.progressCurLevel-1),e=this.getTotalExp(this.progressCurLevel),i=this.getTotalExp(this.progressCurLevel+1),n=0,o=0;this.progressCurExp>=e?(this.progressCurLevel++,n=this.progressCurExp-e,o=i-e):(n=this.progressCurExp-t,o=e-t);let h=n/o;0==(h=h<1?h:1)&&(h=.01),this.levelMask.graphics.clear(),this.levelMask.graphics.drawPie(79,89,89,-180,180*h-180,"#ff0000","#ff0000",0)},null,!1)},500,Laya.Ease.sineOut,null,0,!0)}getTotalExp(t){let e=[0,600,900,1e3,1300,1500,1800,2100,2400,2700],i=0;for(let a=0;a<=t;a++)i+=e[a];return i}onBtnClick(t){t.target==this.speedBtn?t.type==Laya.Event.MOUSE_DOWN?(Laya.Tween.to(this.speedBtn,{scaleX:.9,scaleY:.9},200,Laya.Ease.sineOut),l.event(e.UseSkill,[0,!0])):(Laya.Tween.to(this.speedBtn,{scaleX:1,scaleY:1},200,Laya.Ease.sineIn),l.event(e.UseSkill,[0,!1]),b.Instance.finishTask("引导技能按钮")):t.target==this.biteBtn?t.type==Laya.Event.MOUSE_DOWN?(Laya.Tween.to(this.biteBtn,{scaleX:.9,scaleY:.9},200,Laya.Ease.sineOut),l.event(e.UseSkill,[1,!0])):(Laya.Tween.to(this.biteBtn,{scaleX:1,scaleY:1},200,Laya.Ease.sineIn),l.event(e.UseSkill,[1,!1]),b.Instance.finishTask("引导攻击按钮",100)):t.target==this.pauseBtn&&t.type==Laya.Event.CLICK&&(Laya.MouseManager.enabled=!1,Laya.Scene.open("pages/pause.scene",!1))}onStageEvent(t){if(t.type==Laya.Event.MOUSE_DOWN)this.fingerDownPoint.x=t.stageX,this.fingerDownPoint.y=t.stageY,this.joyStick.visible=!0,this.joyStickInner.visible=!0,this.joyStick.x=t.stageX,this.joyStick.y=t.stageY,this.joyStickInner.x=t.stageX,this.joyStickInner.y=t.stageY;else if(t.type==Laya.Event.MOUSE_MOVE){this.fingerMovePoint.x=t.stageX,this.fingerMovePoint.y=t.stageY,this.fingerMoveDir.x=this.fingerMovePoint.x-this.fingerDownPoint.x,this.fingerMoveDir.y=this.fingerMovePoint.y-this.fingerDownPoint.y;let i=Math.sqrt(this.fingerMoveDir.x*this.fingerMoveDir.x+this.fingerMoveDir.y*this.fingerMoveDir.y);if(i>=this.triggerMoveThreshold){if(i>140){let t=Math.atan2(this.fingerMoveDir.y,this.fingerMoveDir.x);this.joyStickInner.x=this.fingerDownPoint.x+140*Math.cos(t),this.joyStickInner.y=this.fingerDownPoint.y+140*Math.sin(t)}else this.joyStickInner.x=t.stageX,this.joyStickInner.y=t.stageY;l.event(e.ControlChange,[!0,(this.joyStickInner.x-this.fingerDownPoint.x)/140,(this.joyStickInner.y-this.fingerDownPoint.y)/140])}b.Instance.visible&&Laya.timer.once(1500,this,()=>{b.Instance.finishTask("引导虚拟摇杆"),this.controllerUp()})}else t.type==Laya.Event.MOUSE_UP&&this.controllerUp()}controllerUp(){this.fingerDownPoint.x=0,this.fingerDownPoint.y=0,this.fingerMovePoint.x=0,this.fingerMovePoint.y=0,this.joyStick.x=164,this.joyStick.y=this.initY,this.joyStickInner.x=164,this.joyStickInner.y=this.initY,l.event(e.ControlChange,[!1,0,0])}clearLevelProgress(){this.progressCurExp=0,this.progressCurLevel=1,this.progressFullExp=100*this.progressCurLevel,this.curLevel=1,this.curExp=0,this.levelNum.value=this.curLevel+"",this.levelMask.graphics.clear(),this.levelMask.graphics.drawPie(79,89,89,-180,-180,"#ff0000","#ff0000",0)}onClosed(){this.gameSceneLogic.destroy()}popAddExp(){}}class lt extends t.pages.rankCellUI{set dataSource(t){t&&(this.rankName.text=t.name,this.rankNum.skin=`play/Ui_p${t.index+1}.png`,this.meTag.visible=t.isMe,this.deathTag.visible=t.isDeath,this.crownTag.visible=0==t.index,0==t.index?this.bg.skin="play/Ui_Paiming2.png":1==t.index?this.bg.skin="play/Ui_Paiming3.png":2==t.index?this.bg.skin="play/Ui_Paiming4.png":this.bg.skin="play/Ui_Paiming5.png")}}class dt extends t.pages.reviveUI{onOpened(){this.reviveBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.reviveNoBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(t){c.playSound("click.mp3"),t.target==this.reviveBtn?l.event(e.Revive,!0):t.target==this.reviveNoBtn&&l.event(e.Revive,!1),this.close()}}class ct extends t.pages.settingUI{onAwake(){this.updateBtnImage()}onOpened(){Laya.MouseManager.enabled=!0,this.closeBtn.on(Laya.Event.CLICK,this,this.onClickBtn),this.musicBtn.on(Laya.Event.CLICK,this,this.onClickBtn),this.soundBtn.on(Laya.Event.CLICK,this,this.onClickBtn),this.vibrateBtn.on(Laya.Event.CLICK,this,this.onClickBtn)}onClickBtn(t){t.target==this.closeBtn?this.close():t.target==this.musicBtn?(c.musicOpen=!c.musicOpen,this.updateBtnImage(),c.musicOpen?c.playMusic(c.musicName):Laya.SoundManager.stopMusic()):t.target==this.soundBtn?(c.soundOpen=!c.soundOpen,this.updateBtnImage()):t.target==this.vibrateBtn&&(c.vibrateOpen=!c.vibrateOpen,this.updateBtnImage())}updateBtnImage(){this.soundBtn.skin=c.soundOpen?"setting/Btn_YinXiao.png":"setting/Btn_YinXiao2.png",this.musicBtn.skin=c.musicOpen?"setting/Btn_YinLiang2.png":"setting/Btn_YinLiang.png",this.vibrateBtn.skin=c.vibrateOpen?"setting/Btn_ZhengDong.png":"setting/Btn_ZhengDong2.png"}}class pt extends t.pages.signUI{constructor(){super(...arguments),this.lightList=[],this.maskList=[],this.gouList=[],this.numList=[],this.signconfig=[{reward:"金币",num:300},{reward:"金币",num:500},{reward:"金币",num:1e3},{reward:"金币",num:1200},{reward:"金币",num:1300},{reward:"金币",num:1400},{reward:"金币",num:2e3}]}onAwake(){this.lightList=[this.bg1,this.bg2,this.bg3,this.bg4,this.bg5,this.bg6,this.bg7],this.maskList=[this.receiveTag1,this.receiveTag2,this.receiveTag3,this.receiveTag4,this.receiveTag5,this.receiveTag6,this.receiveTag7],this.gouList=[this.canTag1,this.canTag2,this.canTag3,this.canTag4,this.canTag5,this.canTag6,this.canTag7],this.numList=[this.day1Num,this.day2Num,this.day3Num,this.day4Num,this.day5Num,this.day6Num,this.day7Num],this.updateSignCellState();for(let t=0;t<this.numList.length;t++)this.numList[t].value="X"+this.signconfig[t].num}onOpened(){Laya.MouseManager.enabled=!0,this.closeBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.receiveBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onBtnClick(t){c.playSound("click.mp3"),t.target==this.closeBtn?this.close():t.target==this.receiveBtn?this.onSignReceive(!1):t.target==this.videoReceiveBtn&&this.onSignReceive(!0)}setDayState(t,e){let i=this.lightList[t],a=this.maskList[t],s=this.gouList[t];m.instance.signDay==t?i.skin=0==t||1==t||5==t||6==t?"sign/Ui_kuang.png":"sign/Ui_kuang5.png":i.skin=0==t||1==t||5==t||6==t?"sign/Ui_kuang4.png":"sign/Ui_kuang2.png",2==e?(a.visible=!0,s.visible=!1):1==e?(a.visible=!1,s.visible=!0):0==e&&(a.visible=!1,s.visible=!1)}updateSignCellState(){1==m.instance.signRec[m.instance.signDay]?this.receiveBtn.disabled=!0:this.receiveBtn.disabled=!1;for(let t=0;t<7;t++)t<m.instance.signDay?this.setDayState(t,2):t==m.instance.signDay?1==m.instance.signRec[t]?this.setDayState(t,2):this.setDayState(t,1):t>m.instance.signDay&&this.setDayState(t,0)}onSignReceive(t){let e=this.signconfig[m.instance.signDay];m.instance.gold+=t?2*e.num:e.num,m.instance.onDataChange("gold"),m.instance.signRec[m.instance.signDay]=1,m.instance.signTimestamp=Date.now(),m.instance.onDataChange("signRec"),m.instance.onDataChange("signTimestamp"),this.updateSignCellState()}}class gt extends t.pages.taskCellUI{constructor(){super(...arguments),this.taskType=0,this.taskState=0,this._dataSource=null}onAwake(){this.receiveBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}set dataSource(t){if(t)if(this._dataSource=t,this.rewardLabel.text=t.rewardNum,this.desc.text=t.taskDesc,this.taskType=t.taskType,0==this.taskType){let e=m.instance.dayTaskCountRec[t.index];if(e>=t.num){m.instance.dayTaskReceiveRec[t.index]?this.setState(1):this.setState(2)}else this.setState(0);this.progress.value=`(${e}/${t.num})`}else{let e=m.instance.achieveTaskCountRec[t.index];if(e>=t.num){m.instance.achieveTaskReceiveRec[t.index]?this.setState(1):this.setState(2)}else this.setState(0);this.progress.value=`(${e}/${t.num})`}}setState(t){this.taskState=t,0==t?(this.running.visible=!0,this.finishMask.visible=!1,this.receiveBtn.visible=!1):2==t?(this.running.visible=!1,this.finishMask.visible=!1,this.receiveBtn.visible=!0):1==t&&(this.running.visible=!1,this.finishMask.visible=!0,this.receiveBtn.visible=!1)}onBtnClick(){if(c.playSound("click.mp3"),y.loadScene(this._dataSource.rewardNum,0),0==this._dataSource.taskType)m.instance.dayTaskReceiveRec[this._dataSource.index]=1,m.instance.onDataChange("dayTaskReceiveRec");else{m.instance.achieveTaskStage[this._dataSource.index]<W.taskConfig2[this._dataSource.index].num.length-1?(m.instance.achieveTaskStage[this._dataSource.index]++,m.instance.onDataChange("achieveTaskStage"),m.instance.achieveTaskReceiveRec[this._dataSource.index]=0):m.instance.achieveTaskReceiveRec[this._dataSource.index]=1,m.instance.onDataChange("achieveTaskReceiveRec")}l.event(e.UpdateTask),l.event(e.UpdateRed)}}class mt{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("uilogic/ActivityViewRuntime.ts",r),t("uilogic/AddMoneyDialogRuntime.ts",u),t("uilogic/CountDialogRuntime.ts",v),t("uilogic/DaySupplyDialogRuntime.ts",k),t("uilogic/DivisionRuntime.ts",f),t("uilogic/DownPanelRuntime.ts",S),t("uilogic/GenRuntime.ts",P),t("uilogic/PropertyProgressRuntime.ts",B),t("uilogic/LoadViewRuntime.ts",D),t("uilogic/LotteryDialogRuntime.ts",C),t("uilogic/MainViewRuntime.ts",X),t("uilogic/StartRuntime.ts",q),t("uilogic/MatchViewRuntime.ts",K),t("uilogic/PauseDialogRuntime.ts",Z),t("uilogic/PlayViewRuntime.ts",rt),t("uilogic/RankCellRuntime.ts",lt),t("uilogic/ReviveDialogRuntime.ts",dt),t("uilogic/RewardDialogRuntime.ts",y),t("uilogic/SettingDialogRuntime.ts",ct),t("uilogic/SignDialogRuntime.ts",pt),t("uilogic/StrengthRuntime.ts",U),t("uilogic/StrengthSuccessDialogRuntime.ts",T),t("uilogic/TaskDialogRuntime.ts",W),t("uilogic/TaskCellRuntime.ts",gt)}}mt.width=1280,mt.height=720,mt.scaleMode="fixedheight",mt.screenMode="horizontal",mt.alignV="top",mt.alignH="left",mt.startScene="pages/load.scene",mt.sceneRoot="",mt.debug=!1,mt.stat=!1,mt.physicsDebug=!1,mt.exportSceneToJson=!0,mt.init(),function(t){t.unknown="unknown",t.qq="qq",t.wechat="wx",t.tt="tt",t.oppo="oppo",t.vivo="vivo",t.editor="editor"}(a||(a={}));class yt{constructor(){this.platform=a.unknown,this.adUnitId_Config={wx:{bannerId:"adunit-83215d8b1a2f38eb",videoId:"adunit-b4de8f4a9aede4eb",interstitialId:"adunit-9d7d6675ccfc7d20"},qq:{bannerId:"ad2918d389e3686713d15e9dd4aa85b2",videoId:"f643227e68419423ff634b594dc139a8",appBoxId:["8795f01ae515971a67967322f0a8bbfe","e7543f1deacad96dff7ad9a1d919c7bf"],blockId:"89bd30f53749f7b662ab31b5e8ee7614",interstitialId:"fc02726f82ae326434122b8d01664d58"},tt:{bannerId:null,videoId:null},oppo:{appId:"30523283",nativeId:["316928","316929","316930"],videoId:"316927",bannerId:null,interstitialId:null,boxId:null},vivo:{appId:"100012178",nativeId:["fa3581708725480992aa5885d48a8a4c","c19765a97fef4481b9eaffd06d033fd4","29beaf0e15d0413b8b593cddd36c283c","a28c6641cdc34f4299513f829ccc6c04","5bad1eae21d547c9bb0ab28979b3d13b","48be9800f7da4cbc80bee9cfa0dd9323","94b31ba1dd614c28835f34e6fee80501","4d4d53ee56b54ac789c2f4ac04702cbf","a592cb77f0314063ac30acd8703c147e","181f8927cad849af82b7bb886ed7f494"],videoId:"081915e69c89445698fa91eb33a14442",bannerId:"0b2a4a8ed49d4b63897237331c9c5e19",interstitialId:"72e488c74a584e028551f6c8ecd6dc55"}},this.recommendConfig=[{name:"我冲的贼快",appId:"30444933",pkgName:"com.wcdzk.xxtch.nearme.gamecenter"},{name:"兽王争霸",appId:"30428233",pkgName:"com.monsterking.xxtch.nearme.gamecenter"},{name:"撞飞糖豆人",appId:"30439515",pkgName:"com.zftdr.xxtch.nearme.gamecenter"},{name:"音速少女",appId:"30348185",pkgName:"com.speedgirl.xxtch.nearme.gamecenter"},{name:"肥仔大冲撞",appId:"30439517",pkgName:"com.fzdcz.xxtch.nearme.gamecenter"},{name:"剁手狂欢",appId:"30439516",pkgName:"com.xx.cutmyhand.nearme.gamecenter"}],this.adUnitId_Banner=null,this.adUnitId_Video=null,this.adUnitId_AppBox=null,this.adUnitId_BlockAd=null,this.adUnitId_Interstitial=null,this.adUnitId_Native=null,this.adUnitId_OppoBox=null,this.rewardedVideoAd=null,this.bannerAd=null,this.interstitialAd=null,this.appBoxs=null,this.blockAd=null,this.nativeAd=[],this.nativeAdData=[],this.showAdList=[],this.boxAdSelf=null,this.boxAdOfficial=null,this.banner_Width=300,this.banner_Height=120,this.margin_Bottom=0,this.nativeLoadTime=0,this.video_OnLoad_Callback=null,this.video_OnClose_Callback=null,this.native_OnLoad_Callback=null,this.adList=[],this.noAd=!1,this.isCheat=0,this.isShowNative=0,this.exchangeTime=0,this.delayTime=0,this.defaultOpen=0,this.oppoLimit=0,this.oppoShowBanner=0,this.boxTimeLimit=4,this.boxType=0,this.isOfficial=1,this.freeTry=1,this.showVideoEventId=0,this.isOld=0,this.forceAd=0,this.forceTimeDelay=18e4,this.forceTimeLeft=1,this.tryDelayTime=0,this.packDelayTime=0,this.reportShowPer=[],this.reportShowTimeLeft=2,this.refreshNativeTimeDelay=[],this.nativePer=[100,10,100,50,50,1],this.isNativeInsertShow=!1,this.mistakeSwitch=0,this.mistakeTimeDelay=0,this.pullTimeDelay=60,this.secondReportPer=0,this.thirdReportPer=0,this.nativeRefreshTimeDelay=10,this.thirdNativeBelong=0,this.improveExpPer=.3,this.rewardPurplePer=.02,this.moneyGodPer=0}static get Instance(){return null==this._instance&&(this._instance=new yt),window.AllPlatformAdMgr=this._instance,this._instance}getPlatform(){if(window.wx)this.platform=a.wechat,window.tt&&(this.platform=a.tt),window.qq&&(this.platform=a.qq);else if(window.qg){let t=qg.getSystemInfoSync();"OPPO"==t.brand?this.platform=a.oppo:"vivo"==t.brand&&(this.platform=a.vivo)}else this.platform=a.editor}init(){this.getPlatform(),this.initAdId(),this.getCheatState().then(()=>{this.initAdComponent()})}initAdId(){switch(this.platform){case a.wechat:this.adUnitId_Video=this.adUnitId_Config.wx.videoId,this.adUnitId_Banner=this.adUnitId_Config.wx.bannerId,this.adUnitId_Interstitial=this.adUnitId_Config.wx.interstitialId;break;case a.qq:this.adUnitId_Video=this.adUnitId_Config.qq.videoId,this.adUnitId_Banner=this.adUnitId_Config.qq.bannerId,this.adUnitId_AppBox=this.adUnitId_Config.qq.appBoxId,this.adUnitId_BlockAd=this.adUnitId_Config.qq.blockId,this.adUnitId_Interstitial=this.adUnitId_Config.qq.interstitialId;break;case a.tt:this.adUnitId_Video=this.adUnitId_Config.tt.videoId,this.adUnitId_Banner=this.adUnitId_Config.tt.bannerId;break;case a.oppo:this.adUnitId_Video=this.adUnitId_Config.oppo.videoId,this.adUnitId_Interstitial=this.adUnitId_Config.oppo.interstitialId,this.adUnitId_Native=this.adUnitId_Config.oppo.nativeId,this.adUnitId_Banner=this.adUnitId_Config.oppo.bannerId,this.adUnitId_OppoBox=this.adUnitId_Config.oppo.boxId;break;case a.vivo:this.adUnitId_Video=this.adUnitId_Config.vivo.videoId,this.adUnitId_Interstitial=this.adUnitId_Config.vivo.interstitialId,this.adUnitId_Native=this.adUnitId_Config.vivo.nativeId,this.adUnitId_Banner=this.adUnitId_Config.vivo.bannerId}}initAdComponent(){switch(this.platform){case a.wechat:this.initVideoAd(),this.initBannerAd(),this.initInterstitialAd();break;case a.qq:this.initVideoAd(),this.initBannerAd(),this.initAppBox(),this.initBlockAd(),this.initInterstitialAd();break;case a.tt:break;case a.oppo:this.initVideoAd(),this.initBannerAd(),this.initNativeAd(),this.initBox(),this.refreshNativeAd(),this.refreshNativeAd1(0),this.updateReportShowTimeLeft();break;case a.vivo:this.initVideoAd(),this.initBannerAd(),this.initNativeAd(),this.initInterstitialAd(),this.refreshNativeAd(),this.refreshNativeAd1(0),this.updateReportShowTimeLeft()}}getCheatState(){return new Promise(t=>{let e=this.getAdconfigUrl();Laya.loader.load(e,Laya.Handler.create(this,e=>{e&&(this.isCheat=e.isCheat,this.isShowNative=e.isShowNative,this.exchangeTime=e.exchangeTime,this.delayTime=e.delayTime,this.defaultOpen=e.defaultOpen,this.oppoLimit=e.oppoLimit,this.oppoShowBanner=e.oppoShowBanner,this.isOfficial=e.isOfficial,this.freeTry=e.freeTry?e.freeTry:0,this.isOld=e.isOld?e.isOld:0,this.forceAd=e.forceAd?e.forceAd:0,this.tryDelayTime=e.tryDelayTime?e.tryDelayTime:0,this.mistakeSwitch=e.mistakeSwitch?e.mistakeSwitch:0,this.mistakeTimeDelay=e.mistakeTimeDelay?e.mistakeTimeDelay:0,this.packDelayTime=e.packDelayTime?e.packDelayTime:0,this.forceAd&&Laya.timer.once(12e4,this,()=>{this.forceTimeDelay=0}),this.reportShowPer=e.reportShowPer?e.reportShowPer:this.reportShowPer,this.refreshNativeTimeDelay=e.refreshNativeTimeDelay?e.refreshNativeTimeDelay:this.refreshNativeTimeDelay,this.nativePer=e.nativePer?e.nativePer:this.nativePer,this.pullTimeDelay=e.pullTimeDelay?e.pullTimeDelay:this.pullTimeDelay,this.secondReportPer=e.secondReportPer?e.secondReportPer:this.secondReportPer,this.thirdReportPer=e.thirdReportPer?e.thirdReportPer:this.thirdReportPer,this.nativeRefreshTimeDelay=e.nativeRefreshTimeDelay?e.nativeRefreshTimeDelay:this.nativeRefreshTimeDelay,this.thirdNativeBelong=e.thirdNativeBelong?e.thirdNativeBelong:this.thirdNativeBelong,this.adUnitId_Native=e.nativeId?e.nativeId:this.adUnitId_Native,this.improveExpPer=e.improveExpPer?e.improveExpPer:this.improveExpPer,this.rewardPurplePer=e.rewardPurplePer?e.rewardPurplePer:this.rewardPurplePer,this.moneyGodPer=e.moneyGodPer?e.moneyGodPer:this.moneyGodPer,t())}))})}getAdconfigUrl(){return`https://cdn.xxtch.com/Fish/adconfig/adconfig_${this.platform}_1.0.json?ran=${Math.floor(1e6*Math.random())}`}initBox(){if(this.adUnitId_OppoBox&&this.platform===a.oppo){Laya.timer.once(60*this.boxTimeLimit*1e3,this,()=>{this.boxTimeLimit=0}),this.boxAdSelf=new Laya.Image("ads/Ui_Commontuijian.png"),this.boxAdSelf.width=Laya.stage.width,this.boxAdSelf.height=275;for(let t=0;t<this.recommendConfig.length;t++){let e=this.recommendConfig[t];if(e.appId==this.adUnitId_Config.oppo.appId){let i=new Laya.Image("ads/icon"+e.appId+".png");i.anchorY=.5,i.y=168,i.width=i.height=128,i.x=52+148*t,i.on(Laya.Event.CLICK,this,()=>{qg.navigateToMiniGame({pkgName:e.pkgName})}),this.boxAdSelf.addChild(i)}}qg.getSystemInfoSync().platformVersionCode>=1076&&(this.boxAdOfficial=qg.createGameBannerAd({adUnitId:this.adUnitId_OppoBox}),this.boxAdOfficial.onError(t=>{console.error(t)}),this.boxAdOfficial.onLoad(t=>{console.log(t)}))}}showBox(){(this.boxAdSelf||this.boxAdOfficial)&&(this.isOfficial&&this.boxAdOfficial?this.boxAdOfficial.show():(this.boxAdSelf.x=0,this.boxAdSelf.y=Laya.stage.height-this.boxAdSelf.height,Laya.stage.addChild(this.boxAdSelf)))}hideBox(){(this.boxAdSelf||this.boxAdOfficial)&&(this.isOfficial&&this.boxAdOfficial?this.boxAdOfficial.hide():Laya.stage.removeChild(this.boxAdSelf))}initBlockAd(){if(this.adUnitId_BlockAd&&this.platform===a.qq){let t=this.blockAd;t&&t.destroy();let e=qq.getSystemInfoSync();this.blockAd=qq.createBlockAd({adUnitId:this.adUnitId_BlockAd,style:{left:0,top:0},size:5,orientation:"landscape"}),(t=this.blockAd).onError(t=>{console.log(t)}),t.onResize(i=>{console.log(i);let a=e.screenHeight-i.height-300/e.pixelRatio,s=(e.screenWidth-i.width)/2;t.style.top=a,t.style.left=s})}}showBlockAd(){this.blockAd&&this.blockAd.show()}hideBlockAd(){this.blockAd&&this.initBlockAd()}getBannerStyle(){if(this.bannerAd&&this.platform==a.qq){return this.bannerAd.style}}initBannerAd(){if(this.adUnitId_Banner)if(this.platform===a.wechat){let t=this.bannerAd;t&&t.destroy();let e=wx.getSystemInfoSync();this.banner_Width=e.screenWidth;let i=(e.screenWidth-this.banner_Width)/2,a=e.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=wx.createBannerAd({adUnitId:this.adUnitId_Banner,adIntervals:30,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(t=this.bannerAd).onError(t=>{console.log(t)}),t.onResize(i=>{this.banner_Height=i.height,t.style.top=e.screenHeight-this.banner_Height-this.margin_Bottom})}else if(this.platform===a.qq){let t=this.bannerAd;t&&t.destroy();let e=qq.getSystemInfoSync(),i=(e.screenWidth-this.banner_Width)/2,a=e.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=qq.createBannerAd({adUnitId:this.adUnitId_Banner,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(t=this.bannerAd).onResize(i=>{this.banner_Height=i.height,t.style.top=e.screenHeight-this.banner_Height-this.margin_Bottom})}else if(this.platform===a.tt){this.banner_Width=208;let t=tt.getSystemInfoSync(),e=(t.screenWidth-this.banner_Width)/2,i=t.screenHeight-this.banner_Height-this.margin_Bottom,a=this.bannerAd;a&&a.destory(),this.bannerAd=tt.createBannerAd({adUnitId:this.adUnitId_Banner,adIntervals:30,style:{left:e,top:i,width:this.banner_Width}}),(a=this.bannerAd).onError(t=>{console.log(t)}),a.onResize(e=>{this.banner_Height=e.height,a.style.top=t.screenHeight-this.banner_Height-this.margin_Bottom})}else if(this.platform===a.oppo){let t=this.bannerAd;if(t)return;let e=qg.getSystemInfoSync();this.banner_Width=e.screenWidth;let i=(e.screenWidth-this.banner_Width)/2,a=e.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=qg.createBannerAd({adUnitId:this.adUnitId_Banner,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(t=this.bannerAd).onError(t=>{console.error(t)}),t.onResize(i=>{this.banner_Height=i.height,this.banner_Width=i.width,t.style.top=e.screenHeight-this.banner_Height-this.margin_Bottom,t.style.width=i.width,t.style.left=(e.screenWidth-i.width)/2})}else if(this.platform===a.vivo){let t=this.bannerAd;if(t)return;let e=qg.getSystemInfoSync();this.banner_Width=e.screenWidth;let i=(e.screenWidth-this.banner_Width)/2,a=e.screenHeight-this.banner_Height-this.margin_Bottom;this.bannerAd=qg.createBannerAd({posId:this.adUnitId_Banner,style:{left:i,top:a,width:this.banner_Width,height:this.banner_Height}}),(t=this.bannerAd).onError(t=>{console.error(t)}),t.onResize(i=>{this.banner_Height=i.height,this.banner_Width=i.width,t.style.top=e.screenHeight-this.banner_Height-this.margin_Bottom,t.style.width=i.width,t.style.left=(e.screenWidth-i.width)/2})}}initVideoAd(){if(this.adUnitId_Video)switch(this.platform){case a.wechat:this.rewardedVideoAd=wx.createRewardedVideoAd({adUnitId:this.adUnitId_Video});let t=this.rewardedVideoAd;t.onError(t=>{console.log(t)}),t.onClose(t=>{t.isEnded?(this.video_OnClose_Callback&&this.video_OnClose_Callback(),this.showVideoEventId&&(this.showVideoEventId=0)):this.showVideoEventId&&(this.showVideoEventId=0),this.video_OnClose_Callback=null});break;case a.qq:this.rewardedVideoAd=qq.createRewardedVideoAd({adUnitId:this.adUnitId_Video});let e=this.rewardedVideoAd;e.onError(t=>{console.log(t)}),e.onClose(t=>{t.isEnded?(this.video_OnClose_Callback&&this.video_OnClose_Callback(),qq.aly&&window.videoPosition&&(qq.aly.videoDot(window.videoPosition,"success"),window.videoPosition=void 0)):qq.aly&&window.videoPosition&&(qq.aly.videoDot(window.videoPosition,"fail"),window.videoPosition=void 0),this.video_OnClose_Callback=null});break;case a.tt:this.rewardedVideoAd=tt.createRewardedVideoAd({adUnitId:this.adUnitId_Video}),this.rewardedVideoAd.onError(t=>{console.log(t)});break;case a.oppo:this.rewardedVideoAd=qg.createRewardedVideoAd({adUnitId:this.adUnitId_Video});let i=this.rewardedVideoAd;i.onError(t=>{console.error(t),qg.showToast({title:"视频广告加载失败",icon:"none"})}),i.onClose(t=>{t.isEnded&&this.video_OnClose_Callback&&this.video_OnClose_Callback()}),i.onLoad(()=>{i.show()});break;case a.vivo:this.rewardedVideoAd=qg.createRewardedVideoAd({posId:this.adUnitId_Video});let s=this.rewardedVideoAd;s.onError(t=>{console.error(t),qg.showToast({title:"视频广告加载失败",icon:"none"})}),s.onClose(t=>{s.load(),t.isEnded&&this.video_OnClose_Callback&&this.video_OnClose_Callback(),Laya.SoundManager.musicMuted=!1}),s.onLoad(()=>{})}}initAppBox(){if(this.adUnitId_AppBox){this.appBoxs=[];for(let t=0;t<this.adUnitId_AppBox.length;t++){let e=this.adUnitId_AppBox[t],i=qq.createAppBox({adUnitId:e});this.appBoxs.push(i)}}}initInterstitialAd(){if(this.adUnitId_Interstitial)switch(this.platform){case a.wechat:this.interstitialAd=wx.createInterstitialAd({adUnitId:this.adUnitId_Interstitial}),this.interstitialAd.onError(t=>{console.log(t)});break;case a.qq:this.interstitialAd=qq.createInterstitialAd({adUnitId:this.adUnitId_Interstitial});let t=this.interstitialAd;t.onError(t=>{console.error("qq插屏广告加载失败",t)}),t.onLoad(()=>{console.log("qq插屏广告加载成功")});break;case a.oppo:this.interstitialAd=qg.createInsertAd({adUnitId:this.adUnitId_Interstitial});let e=this.interstitialAd;e.onError(t=>{console.error("oppo插屏广告加载失败",t)}),e.onLoad(()=>{console.log("oppo插屏广告加载成功")})}}initNativeAd(){if(this.adUnitId_Native&&(this.platform==a.oppo||this.platform==a.vivo)){if(this.nativeAd.length>0){for(let t=0;t<this.nativeAd.length;t++)this.nativeAd.shift().destroy();this.nativeAdData=[],this.showAdList=[]}if(this.platform==a.oppo){this.reportShowPer=[],this.refreshNativeTimeDelay=[];for(let t=0;t<this.adUnitId_Native.length;t++){let e=qg.createNativeAd({adUnitId:this.adUnitId_Native[t]});this.nativeAd.push(e),this.nativeAdData.push([]),this.showAdList.push([]),this.loadNativeAd(t),this.reportShowPer.push(1),this.refreshNativeTimeDelay.push(0)}}else if(this.platform==a.vivo)for(let t=0;t<this.adUnitId_Native.length;t++){let e=t;Laya.timer.once(5e3*e,this,()=>{let t=qg.createNativeAd({posId:this.adUnitId_Native[e]});this.nativeAd.push(t),this.nativeAdData.push([]),this.showAdList.push([]),this.loadNativeAd(e),this.reportShowPer.push(1),this.refreshNativeTimeDelay.push(0)})}}}loadNativeAd(t,e=!1){return new Promise(i=>{let a=this.nativeAd[t],s=this.nativeAdData[t],n=e=>{console.error("oppo原生广告出错"+t,e),a.offError(n),a.offLoad(o),i()},o=e=>{console.log("oppo原生广告加载成功"+t,e),this.nativeLoadTime++,2==this.nativeLoadTime&&Laya.timer.once(45e3,this,()=>{this.nativeLoadTime=0});for(let t=0;t<e.adList.length;t++){let i=e.adList[t];if(s.length>0)for(let t=0;t<s.length;t++){s[t].adId!=i.adId&&s.push(i)}else s.push(i)}a.offError(n),a.offLoad(o),i()};a.onError(n),a.onLoad(o),e?a.load():s.length>0?i():a.load()})}refreshNativeAd(){for(let t=0;t<this.nativeAd.length;t++){let e=this.refreshNativeTimeDelay[t];if(e>0){let i=t;Laya.timer.loop(1e3*e,this,()=>{this.loadNativeAd(i,!0)})}}}refreshNativeAd1(t){this.nativeRefreshTimeDelay>0&&Laya.timer.loop(1e3*this.nativeRefreshTimeDelay,this,()=>{this.showNativeAd(t,null)})}showNativeAd(t,e){this.platform!=a.editor&&(t=t<this.nativeAd.length?t:0,this.loadNativeAd(t).then(()=>{let i=this.nativeAdData[t],a=this.showAdList[t];for(let s=0;s<i.length;s++){let n=i[i.length-1-s];if(-1==a.indexOf(n))return e&&e(n),void this.reportNativeAdShow(t,n)}e&&e(null)}))}hideNativeAd(t,e){t=t<this.nativeAd.length?t:0;let i=this.showAdList[t];if(!i)return;let a=i.indexOf(e);console.log("hideNativeAd",a),-1!=a&&i.splice(a,1)}reportNativeAdClick(t,e){t=t<this.nativeAd.length?t:0;let i=this.showAdList[t],s=this.nativeAdData[t];if(!i||!s)return;let n=i.indexOf(e),o=s.indexOf(e);if(console.log("reportNativeAdClick",n,o),-1!=n&&i.splice(n,1),-1!=o&&s.splice(o,1),this.platform==a.oppo){let i=[0],a=[1];0==this.thirdNativeBelong?i.push(2):a.push(2),-1!=i.indexOf(t)||-1!=a.indexOf(t)&&(this.nativeAd[t].reportAdShow({adId:e.adId}),this.reportShowTimeLeft--,Math.random()<this.secondReportPer&&(this.reportShowTimeLeft--,Laya.timer.once(1e4,this,()=>{this.nativeAd[t].reportAdShow({adId:e.adId})})),Math.random()<this.thirdReportPer&&(this.reportShowTimeLeft--,Laya.timer.once(2e4,this,()=>{this.nativeAd[t].reportAdShow({adId:e.adId})})))}this.nativeAd[t].reportAdClick({adId:e.adId})}reportNativeAdShow(t,e){if(t=t<this.nativeAd.length?t:0,this.platform==a.vivo)this.nativeAd[t].reportAdShow({adId:e.adId});else if(this.platform==a.oppo){let i=[0],a=[1];0==this.thirdNativeBelong?i.push(2):a.push(2),-1!=i.indexOf(t)?this.reportShowTimeLeft>0&&(this.reportShowTimeLeft--,this.nativeAd[t].reportAdShow({adId:e.adId})):a.indexOf(t)}}updateReportShowTimeLeft(){Laya.timer.loop(1e3*this.pullTimeDelay,this,()=>{this.reportShowTimeLeft++})}showBannerAd(){if((this.bannerAd||this.platform!=a.oppo||!this.oppoShowBanner)&&!this.noAd)switch(this.platform){case a.wechat:let t=this.bannerAd;t&&t.show();break;case a.qq:let e=this.bannerAd;e&&e.show();break;case a.tt:let i=this.bannerAd;i&&i.show();break;case a.oppo:let s=this.bannerAd;s&&s.show();break;case a.vivo:let n=this.bannerAd;n&&n.show()}}showVideoAd(t){if(this.platform===a.editor||this.noAd)t&&t();else{if(!this.rewardedVideoAd)return;switch(this.video_OnClose_Callback=t,this.platform){case a.wechat:this.rewardedVideoAd.show().catch(t=>{this.showVideoEventId&&(this.showVideoEventId=0),console.log("微信视频播放失败原因",t),wx.showToast({icon:"none",title:"视频播放失败",duration:1500}),c.manualShare()});break;case a.qq:qq.aly&&window.videoPosition&&qq.aly.videoDot(window.videoPosition,"show"),this.rewardedVideoAd.show().catch(t=>{console.log("qq视频播放失败原因",t),window.videoPosition=void 0,qq.showToast({icon:"none",title:"视频播放失败",duration:1500})});break;case a.tt:let e=this.rewardedVideoAd;t&&e.onClose(e=>{e.isEnded&&t&&t()}),e.show().catch(t=>{});break;case a.oppo:this.rewardedVideoAd.load();break;case a.vivo:Laya.SoundManager.musicMuted=!0,this.rewardedVideoAd.show()}}}showAppBox(t){if(this.platform!=a.editor)switch(this.platform){case a.qq:let e=this.appBoxs[t];e.load().then(()=>{e.show()})}}showInterstitialAd(t){if(t&&this.platform===a.editor&&t(),this.interstitialAd||this.platform==a.vivo)switch(this.platform){case a.wechat:this.interstitialAd.show();break;case a.qq:this.interstitialAd.show();break;case a.oppo:let e=this.interstitialAd;e.onClose(()=>{e.load(),t&&t()}),e.show();break;case a.vivo:this.interstitialAd=qg.createInterstitialAd({posId:this.adUnitId_Interstitial});let i=this.interstitialAd;i.onError(t=>{console.error("vivo插屏广告加载失败",t)}),i.onLoad(()=>{console.log("vivo插屏广告加载成功")}),i.show()}}hideBannerAd(){if(this.bannerAd&&(this.platform!=a.oppo||!this.oppoShowBanner))switch(this.platform){case a.wechat:this.bannerAd.hide();break;case a.qq:this.bannerAd.hide();break;case a.tt:this.bannerAd.hide();break;case a.oppo:this.bannerAd.hide();break;case a.vivo:this.bannerAd.hide()}}compareVersion(t,e){t=t.split(".");const i=Math.max(t.length,e.length);for(;t.length<i;)t.push("0");for(;e.length<i;)e.push("0");for(let a=0;a<i;a++){const i=parseInt(t[a]),s=parseInt(e[a]);if(i>s)return 1;if(i<s)return-1}return 0}}class ut{constructor(){ut._uiMap=new Map}static init(){ut._UIManager||(ut._UIManager=new ut)}static open(t,e=!0){let i=ut._uiMap.get(t.name);return null==i&&(i=new t,ut._uiMap.set(t.name,i)),e&&ut.closeAll(i),i.open(e),console.log(ut._uiMap),i}static close(t){let e=ut._uiMap.get(t.name);e&&(e.close(),e.autoDestroyAtClosed&&ut._uiMap.set(t.name,null)),console.log(ut._uiMap)}static closeAll(t){ut._uiMap.forEach((e,i)=>{!(e&&t instanceof Laya.Dialog&&e instanceof Laya.Dialog&&t!=e)&&(!e||t instanceof Laya.Dialog||e instanceof Laya.Dialog||t==e)||(e.close(),e.autoDestroyAtClosed&&ut._uiMap.set(i,null))})}}class ft{constructor(){}static init(){return new Promise(t=>{UIConfig.closeDialogOnSide=!1,Laya.MouseManager.multiTouchEnabled=!0,UIConfig.popupBgAlpha=.8,l.init(),z.init(),ut.init(),d.init(),yt.Instance.init(),c.init().then(()=>{t()})})}}new class{constructor(){window.Laya3D?Laya3D.init(mt.width,mt.height):Laya.init(mt.width,mt.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=mt.scaleMode,Laya.stage.screenMode=mt.screenMode,Laya.stage.alignV=mt.alignV,Laya.stage.alignH=mt.alignH,Laya.URL.exportSceneToJson=mt.exportSceneToJson,(mt.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),mt.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),mt.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){ft.init().then(()=>{mt.startScene&&Laya.Scene.open(mt.startScene)})}}}();